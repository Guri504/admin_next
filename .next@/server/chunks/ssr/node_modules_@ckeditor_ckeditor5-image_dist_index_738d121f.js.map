{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"file":"index.js.map","sources":["file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/dist/index.js","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/image/utils.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageutils.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/autoimage.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagetextalternative/imagetextalternativecommand.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagetextalternative/imagetextalternativeediting.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagetextalternative/ui/textalternativeformview.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/image/ui/utils.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagetextalternative/imagetextalternativeui.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagetextalternative.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/image/converters.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/image/imageloadobserver.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/image/insertimagecommand.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/image/replaceimagesourcecommand.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/image/imageediting.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagesizeattributes.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/image/imagetypecommand.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/image/imageplaceholder.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/image/imageblockediting.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageinsert/ui/imageinsertformview.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageinsert/imageinsertui.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageblock.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/image/imageinlineediting.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageinline.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/image.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagecaption/imagecaptionutils.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagecaption/toggleimagecaptioncommand.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagecaption/imagecaptionediting.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagecaption/imagecaptionui.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagecaption.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageupload/utils.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageupload/imageuploadui.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageupload/imageuploadprogress.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageupload/uploadimagecommand.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageupload/imageuploadediting.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageupload.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageinsert/ui/imageinserturlview.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageinsert/imageinsertviaurlui.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageinsertviaurl.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageinsert.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageresize/resizeimagecommand.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageresize/imageresizeediting.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageresize/imageresizebuttons.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageresize/imageresizehandles.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageresize/utils/tryparsedimensionwithunit.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageresize/utils/getselectedimageeditornodes.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageresize/utils/getselectedimagewidthinunits.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageresize/ui/imagecustomresizeformview.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageresize/utils/getselectedimagepossibleresizerange.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageresize/imagecustomresizeui.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imageresize.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagestyle/imagestylecommand.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagestyle/utils.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagestyle/converters.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagestyle/imagestyleediting.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagestyle/imagestyleui.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagestyle.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/imagetoolbar.ts","file://D%3A/Gurpreet%20Singh/next.js/admin_next/node_modules/%40ckeditor/ckeditor5-image/src/pictureediting.ts"],"sourcesContent":["import { Plugin, Command, icons } from '@ckeditor/ckeditor5-core/dist/index.js';\nimport { Clipboard, ClipboardPipeline } from '@ckeditor/ckeditor5-clipboard/dist/index.js';\nimport { LivePosition, LiveRange, Observer, UpcastWriter, enablePlaceholder, Element } from '@ckeditor/ckeditor5-engine/dist/index.js';\nimport { Undo } from '@ckeditor/ckeditor5-undo/dist/index.js';\nimport { Delete } from '@ckeditor/ckeditor5-typing/dist/index.js';\nimport { first, DomEmitterMixin, global, FocusTracker, KeystrokeHandler, logWarning, toArray, env, CKEditorError, Collection, Rect } from '@ckeditor/ckeditor5-utils/dist/index.js';\nimport { toWidget, isWidget, findOptimalInsertionRange, Widget, toWidgetEditable, WidgetResize, calculateResizeHostAncestorWidth, WidgetToolbarRepository } from '@ckeditor/ckeditor5-widget/dist/index.js';\nimport { View, ViewCollection, FocusCycler, submitHandler, ButtonView, LabeledFieldView, createLabeledInputText, BalloonPanelView, ContextualBalloon, CssTransitionDisablerMixin, clickOutsideHandler, CollapsibleView, SplitButtonView, createDropdown, MenuBarMenuView, MenuBarMenuListView, MenuBarMenuListItemView, FileDialogButtonView, MenuBarMenuListItemFileDialogButtonView, Notification, Dialog, MenuBarMenuListItemButtonView, ViewModel, DropdownButtonView, addListToDropdown, createLabeledInputNumber, addToolbarToDropdown } from '@ckeditor/ckeditor5-ui/dist/index.js';\nimport { FileRepository } from '@ckeditor/ckeditor5-upload/dist/index.js';\nimport { map, isObject, identity } from 'lodash-es';\n\n/**\n * Creates a view element representing the inline image.\n *\n * ```html\n * <span class=\"image-inline\"><img></img></span>\n * ```\n *\n * Note that `alt` and `src` attributes are converted separately, so they are not included.\n *\n * @internal\n */ function createInlineImageViewElement(writer) {\n    return writer.createContainerElement('span', {\n        class: 'image-inline'\n    }, writer.createEmptyElement('img'));\n}\n/**\n * Creates a view element representing the block image.\n *\n * ```html\n * <figure class=\"image\"><img></img></figure>\n * ```\n *\n * Note that `alt` and `src` attributes are converted separately, so they are not included.\n *\n * @internal\n */ function createBlockImageViewElement(writer) {\n    return writer.createContainerElement('figure', {\n        class: 'image'\n    }, [\n        writer.createEmptyElement('img'),\n        writer.createSlot('children')\n    ]);\n}\n/**\n * A function returning a `MatcherPattern` for a particular type of View images.\n *\n * @internal\n * @param matchImageType The type of created image.\n */ function getImgViewElementMatcher(editor, matchImageType) {\n    const imageUtils = editor.plugins.get('ImageUtils');\n    const areBothImagePluginsLoaded = editor.plugins.has('ImageInlineEditing') && editor.plugins.has('ImageBlockEditing');\n    return (element)=>{\n        // Check if the matched view element is an <img>.\n        if (!imageUtils.isInlineImageView(element)) {\n            return null;\n        }\n        // If just one of the plugins is loaded (block or inline), it will match all kinds of images.\n        if (!areBothImagePluginsLoaded) {\n            return getPositiveMatchPattern(element);\n        }\n        // The <img> can be standalone, wrapped in <figure>...</figure> (ImageBlock plugin) or\n        // wrapped in <figure><a>...</a></figure> (LinkImage plugin).\n        const imageType = element.getStyle('display') == 'block' || element.findAncestor(imageUtils.isBlockImageView) ? 'imageBlock' : 'imageInline';\n        if (imageType !== matchImageType) {\n            return null;\n        }\n        return getPositiveMatchPattern(element);\n    };\n    function getPositiveMatchPattern(element) {\n        const pattern = {\n            name: true\n        };\n        // This will trigger src consumption (See https://github.com/ckeditor/ckeditor5/issues/11530).\n        if (element.hasAttribute('src')) {\n            pattern.attributes = [\n                'src'\n            ];\n        }\n        return pattern;\n    }\n}\n/**\n * Considering the current model selection, it returns the name of the model image element\n * (`'imageBlock'` or `'imageInline'`) that will make most sense from the UX perspective if a new\n * image was inserted (also: uploaded, dropped, pasted) at that selection.\n *\n * The assumption is that inserting images into empty blocks or on other block widgets should\n * produce block images. Inline images should be inserted in other cases, e.g. in paragraphs\n * that already contain some text.\n *\n * @internal\n */ function determineImageTypeForInsertionAtSelection(schema, selection) {\n    const firstBlock = first(selection.getSelectedBlocks());\n    // Insert a block image if the selection is not in/on block elements or it's on a block widget.\n    if (!firstBlock || schema.isObject(firstBlock)) {\n        return 'imageBlock';\n    }\n    // A block image should also be inserted into an empty block element\n    // (that is not an empty list item so the list won't get split).\n    if (firstBlock.isEmpty && firstBlock.name != 'listItem') {\n        return 'imageBlock';\n    }\n    // Otherwise insert an inline image.\n    return 'imageInline';\n}\n/**\n * Returns parsed value of the size, but only if it contains unit: px.\n */ function getSizeValueIfInPx(size) {\n    if (size && size.endsWith('px')) {\n        return parseInt(size);\n    }\n    return null;\n}\n/**\n * Returns true if both styles (width and height) are set.\n *\n * If both image styles: width & height are set, they will override the image width & height attributes in the\n * browser. In this case, the image looks the same as if these styles were applied to attributes instead of styles.\n * That's why we can upcast these styles to width & height attributes instead of resizedWidth and resizedHeight.\n */ function widthAndHeightStylesAreBothSet(viewElement) {\n    const widthStyle = getSizeValueIfInPx(viewElement.getStyle('width'));\n    const heightStyle = getSizeValueIfInPx(viewElement.getStyle('height'));\n    return !!(widthStyle && heightStyle);\n}\n\nconst IMAGE_WIDGETS_CLASSES_MATCH_REGEXP = /^(image|image-inline)$/;\n/**\n * A set of helpers related to images.\n */ class ImageUtils extends Plugin {\n    /**\n\t * DOM Emitter.\n\t */ _domEmitter = new (DomEmitterMixin())();\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageUtils';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * Checks if the provided model element is an `image` or `imageInline`.\n\t */ isImage(modelElement) {\n        return this.isInlineImage(modelElement) || this.isBlockImage(modelElement);\n    }\n    /**\n\t * Checks if the provided view element represents an inline image.\n\t *\n\t * Also, see {@link module:image/imageutils~ImageUtils#isImageWidget}.\n\t */ isInlineImageView(element) {\n        return !!element && element.is('element', 'img');\n    }\n    /**\n\t * Checks if the provided view element represents a block image.\n\t *\n\t * Also, see {@link module:image/imageutils~ImageUtils#isImageWidget}.\n\t */ isBlockImageView(element) {\n        return !!element && element.is('element', 'figure') && element.hasClass('image');\n    }\n    /**\n\t * Handles inserting single file. This method unifies image insertion using {@link module:widget/utils~findOptimalInsertionRange}\n\t * method.\n\t *\n\t * ```ts\n\t * const imageUtils = editor.plugins.get( 'ImageUtils' );\n\t *\n\t * imageUtils.insertImage( { src: 'path/to/image.jpg' } );\n\t * ```\n\t *\n\t * @param attributes Attributes of the inserted image.\n\t * This method filters out the attributes which are disallowed by the {@link module:engine/model/schema~Schema}.\n\t * @param selectable Place to insert the image. If not specified,\n\t * the {@link module:widget/utils~findOptimalInsertionRange} logic will be applied for the block images\n\t * and `model.document.selection` for the inline images.\n\t *\n\t * **Note**: If `selectable` is passed, this helper will not be able to set selection attributes (such as `linkHref`)\n\t * and apply them to the new image. In this case, make sure all selection attributes are passed in `attributes`.\n\t *\n\t * @param imageType Image type of inserted image. If not specified,\n\t * it will be determined automatically depending of editor config or place of the insertion.\n\t * @param options.setImageSizes Specifies whether the image `width` and `height` attributes should be set automatically.\n\t * The default is `true`.\n\t * @return The inserted model image element.\n\t */ insertImage(attributes = {}, selectable = null, imageType = null, options = {}) {\n        const editor = this.editor;\n        const model = editor.model;\n        const selection = model.document.selection;\n        const determinedImageType = determineImageTypeForInsertion(editor, selectable || selection, imageType);\n        // Mix declarative attributes with selection attributes because the new image should \"inherit\"\n        // the latter for best UX. For instance, inline images inserted into existing links\n        // should not split them. To do that, they need to have \"linkHref\" inherited from the selection.\n        attributes = {\n            ...Object.fromEntries(selection.getAttributes()),\n            ...attributes\n        };\n        for(const attributeName in attributes){\n            if (!model.schema.checkAttribute(determinedImageType, attributeName)) {\n                delete attributes[attributeName];\n            }\n        }\n        return model.change((writer)=>{\n            const { setImageSizes = true } = options;\n            const imageElement = writer.createElement(determinedImageType, attributes);\n            model.insertObject(imageElement, selectable, null, {\n                setSelection: 'on',\n                // If we want to insert a block image (for whatever reason) then we don't want to split text blocks.\n                // This applies only when we don't have the selectable specified (i.e., we insert multiple block images at once).\n                findOptimalPosition: !selectable && determinedImageType != 'imageInline' ? 'auto' : undefined\n            });\n            // Inserting an image might've failed due to schema regulations.\n            if (imageElement.parent) {\n                if (setImageSizes) {\n                    this.setImageNaturalSizeAttributes(imageElement);\n                }\n                return imageElement;\n            }\n            return null;\n        });\n    }\n    /**\n\t * Reads original image sizes and sets them as `width` and `height`.\n\t *\n\t * The `src` attribute may not be available if the user is using an upload adapter. In such a case,\n\t * this method is called again after the upload process is complete and the `src` attribute is available.\n\t */ setImageNaturalSizeAttributes(imageElement) {\n        const src = imageElement.getAttribute('src');\n        if (!src) {\n            return;\n        }\n        if (imageElement.getAttribute('width') || imageElement.getAttribute('height')) {\n            return;\n        }\n        this.editor.model.change((writer)=>{\n            const img = new global.window.Image();\n            this._domEmitter.listenTo(img, 'load', ()=>{\n                if (!imageElement.getAttribute('width') && !imageElement.getAttribute('height')) {\n                    // We use writer.batch to be able to undo (in a single step) width and height setting\n                    // along with any change that triggered this action (e.g. image resize or image style change).\n                    this.editor.model.enqueueChange(writer.batch, (writer)=>{\n                        writer.setAttribute('width', img.naturalWidth, imageElement);\n                        writer.setAttribute('height', img.naturalHeight, imageElement);\n                    });\n                }\n                this._domEmitter.stopListening(img, 'load');\n            });\n            img.src = src;\n        });\n    }\n    /**\n\t * Returns an image widget editing view element if one is selected or is among the selection's ancestors.\n\t */ getClosestSelectedImageWidget(selection) {\n        const selectionPosition = selection.getFirstPosition();\n        if (!selectionPosition) {\n            return null;\n        }\n        const viewElement = selection.getSelectedElement();\n        if (viewElement && this.isImageWidget(viewElement)) {\n            return viewElement;\n        }\n        let parent = selectionPosition.parent;\n        while(parent){\n            if (parent.is('element') && this.isImageWidget(parent)) {\n                return parent;\n            }\n            parent = parent.parent;\n        }\n        return null;\n    }\n    /**\n\t * Returns a image model element if one is selected or is among the selection's ancestors.\n\t */ getClosestSelectedImageElement(selection) {\n        const selectedElement = selection.getSelectedElement();\n        return this.isImage(selectedElement) ? selectedElement : selection.getFirstPosition().findAncestor('imageBlock');\n    }\n    /**\n\t * Returns an image widget editing view based on the passed image view.\n\t */ getImageWidgetFromImageView(imageView) {\n        return imageView.findAncestor({\n            classes: IMAGE_WIDGETS_CLASSES_MATCH_REGEXP\n        });\n    }\n    /**\n\t * Checks if image can be inserted at current model selection.\n\t *\n\t * @internal\n\t */ isImageAllowed() {\n        const model = this.editor.model;\n        const selection = model.document.selection;\n        return isImageAllowedInParent(this.editor, selection) && isNotInsideImage(selection);\n    }\n    /**\n\t * Converts a given {@link module:engine/view/element~Element} to an image widget:\n\t * * Adds a {@link module:engine/view/element~Element#_setCustomProperty custom property} allowing to recognize the image widget\n\t * element.\n\t * * Calls the {@link module:widget/utils~toWidget} function with the proper element's label creator.\n\t *\n\t * @param writer An instance of the view writer.\n\t * @param label The element's label. It will be concatenated with the image `alt` attribute if one is present.\n\t */ toImageWidget(viewElement, writer, label) {\n        writer.setCustomProperty('image', true, viewElement);\n        const labelCreator = ()=>{\n            const imgElement = this.findViewImgElement(viewElement);\n            const altText = imgElement.getAttribute('alt');\n            return altText ? `${altText} ${label}` : label;\n        };\n        return toWidget(viewElement, writer, {\n            label: labelCreator\n        });\n    }\n    /**\n\t * Checks if a given view element is an image widget.\n\t */ isImageWidget(viewElement) {\n        return !!viewElement.getCustomProperty('image') && isWidget(viewElement);\n    }\n    /**\n\t * Checks if the provided model element is an `image`.\n\t */ isBlockImage(modelElement) {\n        return !!modelElement && modelElement.is('element', 'imageBlock');\n    }\n    /**\n\t * Checks if the provided model element is an `imageInline`.\n\t */ isInlineImage(modelElement) {\n        return !!modelElement && modelElement.is('element', 'imageInline');\n    }\n    /**\n\t * Get the view `<img>` from another view element, e.g. a widget (`<figure class=\"image\">`), a link (`<a>`).\n\t *\n\t * The `<img>` can be located deep in other elements, so this helper performs a deep tree search.\n\t */ findViewImgElement(figureView) {\n        if (this.isInlineImageView(figureView)) {\n            return figureView;\n        }\n        const editingView = this.editor.editing.view;\n        for (const { item } of editingView.createRangeIn(figureView)){\n            if (this.isInlineImageView(item)) {\n                return item;\n            }\n        }\n    }\n    /**\n\t * @inheritDoc\n\t */ destroy() {\n        this._domEmitter.stopListening();\n        return super.destroy();\n    }\n}\n/**\n * Checks if image is allowed by schema in optimal insertion parent.\n */ function isImageAllowedInParent(editor, selection) {\n    const imageType = determineImageTypeForInsertion(editor, selection, null);\n    if (imageType == 'imageBlock') {\n        const parent = getInsertImageParent(selection, editor.model);\n        if (editor.model.schema.checkChild(parent, 'imageBlock')) {\n            return true;\n        }\n    } else if (editor.model.schema.checkChild(selection.focus, 'imageInline')) {\n        return true;\n    }\n    return false;\n}\n/**\n * Checks if selection is not placed inside an image (e.g. its caption).\n */ function isNotInsideImage(selection) {\n    return [\n        ...selection.focus.getAncestors()\n    ].every((ancestor)=>!ancestor.is('element', 'imageBlock'));\n}\n/**\n * Returns a node that will be used to insert image with `model.insertContent`.\n */ function getInsertImageParent(selection, model) {\n    const insertionRange = findOptimalInsertionRange(selection, model);\n    const parent = insertionRange.start.parent;\n    if (parent.isEmpty && !parent.is('element', '$root')) {\n        return parent.parent;\n    }\n    return parent;\n}\n/**\n * Determine image element type name depending on editor config or place of insertion.\n *\n * @param imageType Image element type name. Used to force return of provided element name,\n * but only if there is proper plugin enabled.\n */ function determineImageTypeForInsertion(editor, selectable, imageType) {\n    const schema = editor.model.schema;\n    const configImageInsertType = editor.config.get('image.insert.type');\n    if (!editor.plugins.has('ImageBlockEditing')) {\n        return 'imageInline';\n    }\n    if (!editor.plugins.has('ImageInlineEditing')) {\n        return 'imageBlock';\n    }\n    if (imageType) {\n        return imageType;\n    }\n    if (configImageInsertType === 'inline') {\n        return 'imageInline';\n    }\n    if (configImageInsertType !== 'auto') {\n        return 'imageBlock';\n    }\n    // Try to replace the selected widget (e.g. another image).\n    if (selectable.is('selection')) {\n        return determineImageTypeForInsertionAtSelection(schema, selectable);\n    }\n    return schema.checkChild(selectable, 'imageInline') ? 'imageInline' : 'imageBlock';\n}\n\n// Implements the pattern: http(s)://(www.)example.com/path/to/resource.ext?query=params&maybe=too.\nconst IMAGE_URL_REGEXP = new RegExp(String(/^(http(s)?:\\/\\/)?[\\w-]+\\.[\\w.~:/[\\]@!$&'()*+,;=%-]+/.source + /\\.(jpg|jpeg|png|gif|ico|webp|JPG|JPEG|PNG|GIF|ICO|WEBP)/.source + /(\\?[\\w.~:/[\\]@!$&'()*+,;=%-]*)?/.source + /(#[\\w.~:/[\\]@!$&'()*+,;=%-]*)?$/.source));\n/**\n * The auto-image plugin. It recognizes image links in the pasted content and embeds\n * them shortly after they are injected into the document.\n */ class AutoImage extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            Clipboard,\n            ImageUtils,\n            Undo,\n            Delete\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'AutoImage';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * The paste–to–embed `setTimeout` ID. Stored as a property to allow\n\t * cleaning of the timeout.\n\t */ _timeoutId;\n    /**\n\t * The position where the `<imageBlock>` element will be inserted after the timeout,\n\t * determined each time a new content is pasted into the document.\n\t */ _positionToInsert;\n    /**\n\t * @inheritDoc\n\t */ constructor(editor){\n        super(editor);\n        this._timeoutId = null;\n        this._positionToInsert = null;\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const editor = this.editor;\n        const modelDocument = editor.model.document;\n        const clipboardPipeline = editor.plugins.get('ClipboardPipeline');\n        // We need to listen on `Clipboard#inputTransformation` because we need to save positions of selection.\n        // After pasting, the content between those positions will be checked for a URL that could be transformed\n        // into an image.\n        this.listenTo(clipboardPipeline, 'inputTransformation', ()=>{\n            const firstRange = modelDocument.selection.getFirstRange();\n            const leftLivePosition = LivePosition.fromPosition(firstRange.start);\n            leftLivePosition.stickiness = 'toPrevious';\n            const rightLivePosition = LivePosition.fromPosition(firstRange.end);\n            rightLivePosition.stickiness = 'toNext';\n            modelDocument.once('change:data', ()=>{\n                this._embedImageBetweenPositions(leftLivePosition, rightLivePosition);\n                leftLivePosition.detach();\n                rightLivePosition.detach();\n            }, {\n                priority: 'high'\n            });\n        });\n        editor.commands.get('undo').on('execute', ()=>{\n            if (this._timeoutId) {\n                global.window.clearTimeout(this._timeoutId);\n                this._positionToInsert.detach();\n                this._timeoutId = null;\n                this._positionToInsert = null;\n            }\n        }, {\n            priority: 'high'\n        });\n    }\n    /**\n\t * Analyzes the part of the document between provided positions in search for a URL representing an image.\n\t * When the URL is found, it is automatically converted into an image.\n\t *\n\t * @param leftPosition Left position of the selection.\n\t * @param rightPosition Right position of the selection.\n\t */ _embedImageBetweenPositions(leftPosition, rightPosition) {\n        const editor = this.editor;\n        // TODO: Use a marker instead of LiveRange & LivePositions.\n        const urlRange = new LiveRange(leftPosition, rightPosition);\n        const walker = urlRange.getWalker({\n            ignoreElementEnd: true\n        });\n        const selectionAttributes = Object.fromEntries(editor.model.document.selection.getAttributes());\n        const imageUtils = this.editor.plugins.get('ImageUtils');\n        let src = '';\n        for (const node of walker){\n            if (node.item.is('$textProxy')) {\n                src += node.item.data;\n            }\n        }\n        src = src.trim();\n        // If the URL does not match the image URL regexp, let's skip that.\n        if (!src.match(IMAGE_URL_REGEXP)) {\n            urlRange.detach();\n            return;\n        }\n        // Position will not be available in the `setTimeout` function so let's clone it.\n        this._positionToInsert = LivePosition.fromPosition(leftPosition);\n        // This action mustn't be executed if undo was called between pasting and auto-embedding.\n        this._timeoutId = setTimeout(()=>{\n            // Do nothing if image element cannot be inserted at the current position.\n            // See https://github.com/ckeditor/ckeditor5/issues/2763.\n            // Condition must be checked after timeout - pasting may take place on an element, replacing it. The final position matters.\n            const imageCommand = editor.commands.get('insertImage');\n            if (!imageCommand.isEnabled) {\n                urlRange.detach();\n                return;\n            }\n            editor.model.change((writer)=>{\n                this._timeoutId = null;\n                writer.remove(urlRange);\n                urlRange.detach();\n                let insertionPosition;\n                // Check if the position where the element should be inserted is still valid.\n                // Otherwise leave it as undefined to use the logic of insertImage().\n                if (this._positionToInsert.root.rootName !== '$graveyard') {\n                    insertionPosition = this._positionToInsert.toPosition();\n                }\n                imageUtils.insertImage({\n                    ...selectionAttributes,\n                    src\n                }, insertionPosition);\n                this._positionToInsert.detach();\n                this._positionToInsert = null;\n            });\n            const deletePlugin = editor.plugins.get('Delete');\n            deletePlugin.requestUndoOnBackspace();\n        }, 100);\n    }\n}\n\n/**\n * The image text alternative command. It is used to change the `alt` attribute of `<imageBlock>` and `<imageInline>` model elements.\n */ class ImageTextAlternativeCommand extends Command {\n    /**\n\t * @inheritDoc\n\t */ refresh() {\n        const editor = this.editor;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const element = imageUtils.getClosestSelectedImageElement(this.editor.model.document.selection);\n        this.isEnabled = !!element;\n        if (this.isEnabled && element.hasAttribute('alt')) {\n            this.value = element.getAttribute('alt');\n        } else {\n            this.value = false;\n        }\n    }\n    /**\n\t * Executes the command.\n\t *\n\t * @fires execute\n\t * @param options\n\t * @param options.newValue The new value of the `alt` attribute to set.\n\t */ execute(options) {\n        const editor = this.editor;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const model = editor.model;\n        const imageElement = imageUtils.getClosestSelectedImageElement(model.document.selection);\n        model.change((writer)=>{\n            writer.setAttribute('alt', options.newValue, imageElement);\n        });\n    }\n}\n\n/**\n * The image text alternative editing plugin.\n *\n * Registers the `'imageTextAlternative'` command.\n */ class ImageTextAlternativeEditing extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageUtils\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageTextAlternativeEditing';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        this.editor.commands.add('imageTextAlternative', new ImageTextAlternativeCommand(this.editor));\n    }\n}\n\n/**\n * The TextAlternativeFormView class.\n */ class TextAlternativeFormView extends View {\n    /**\n\t * Tracks information about the DOM focus in the form.\n\t */ focusTracker;\n    /**\n\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\n\t */ keystrokes;\n    /**\n\t * An input with a label.\n\t */ labeledInput;\n    /**\n\t * A button used to submit the form.\n\t */ saveButtonView;\n    /**\n\t * A button used to cancel the form.\n\t */ cancelButtonView;\n    /**\n\t * A collection of views which can be focused in the form.\n\t */ _focusables;\n    /**\n\t * Helps cycling over {@link #_focusables} in the form.\n\t */ _focusCycler;\n    /**\n\t * @inheritDoc\n\t */ constructor(locale){\n        super(locale);\n        const t = this.locale.t;\n        this.focusTracker = new FocusTracker();\n        this.keystrokes = new KeystrokeHandler();\n        this.labeledInput = this._createLabeledInputView();\n        this.saveButtonView = this._createButton(t('Save'), icons.check, 'ck-button-save');\n        this.saveButtonView.type = 'submit';\n        this.cancelButtonView = this._createButton(t('Cancel'), icons.cancel, 'ck-button-cancel', 'cancel');\n        this._focusables = new ViewCollection();\n        this._focusCycler = new FocusCycler({\n            focusables: this._focusables,\n            focusTracker: this.focusTracker,\n            keystrokeHandler: this.keystrokes,\n            actions: {\n                // Navigate form fields backwards using the Shift + Tab keystroke.\n                focusPrevious: 'shift + tab',\n                // Navigate form fields forwards using the Tab key.\n                focusNext: 'tab'\n            }\n        });\n        this.setTemplate({\n            tag: 'form',\n            attributes: {\n                class: [\n                    'ck',\n                    'ck-text-alternative-form',\n                    'ck-responsive-form'\n                ],\n                // https://github.com/ckeditor/ckeditor5-image/issues/40\n                tabindex: '-1'\n            },\n            children: [\n                this.labeledInput,\n                this.saveButtonView,\n                this.cancelButtonView\n            ]\n        });\n    }\n    /**\n\t * @inheritDoc\n\t */ render() {\n        super.render();\n        this.keystrokes.listenTo(this.element);\n        submitHandler({\n            view: this\n        });\n        [\n            this.labeledInput,\n            this.saveButtonView,\n            this.cancelButtonView\n        ].forEach((v)=>{\n            // Register the view as focusable.\n            this._focusables.add(v);\n            // Register the view in the focus tracker.\n            this.focusTracker.add(v.element);\n        });\n    }\n    /**\n\t * @inheritDoc\n\t */ destroy() {\n        super.destroy();\n        this.focusTracker.destroy();\n        this.keystrokes.destroy();\n    }\n    /**\n\t * Creates the button view.\n\t *\n\t * @param label The button label\n\t * @param icon The button's icon.\n\t * @param className The additional button CSS class name.\n\t * @param eventName The event name that the ButtonView#execute event will be delegated to.\n\t * @returns The button view instance.\n\t */ _createButton(label, icon, className, eventName) {\n        const button = new ButtonView(this.locale);\n        button.set({\n            label,\n            icon,\n            tooltip: true\n        });\n        button.extendTemplate({\n            attributes: {\n                class: className\n            }\n        });\n        if (eventName) {\n            button.delegate('execute').to(this, eventName);\n        }\n        return button;\n    }\n    /**\n\t * Creates an input with a label.\n\t *\n\t * @returns Labeled field view instance.\n\t */ _createLabeledInputView() {\n        const t = this.locale.t;\n        const labeledInput = new LabeledFieldView(this.locale, createLabeledInputText);\n        labeledInput.label = t('Text alternative');\n        return labeledInput;\n    }\n}\n\n/**\n * A helper utility that positions the\n * {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon contextual balloon} instance\n * with respect to the image in the editor content, if one is selected.\n *\n * @param editor The editor instance.\n */ function repositionContextualBalloon(editor) {\n    const balloon = editor.plugins.get('ContextualBalloon');\n    const imageUtils = editor.plugins.get('ImageUtils');\n    if (imageUtils.getClosestSelectedImageWidget(editor.editing.view.document.selection)) {\n        const position = getBalloonPositionData(editor);\n        balloon.updatePosition(position);\n    }\n}\n/**\n * Returns the positioning options that control the geometry of the\n * {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon contextual balloon} with respect\n * to the selected element in the editor content.\n *\n * @param editor The editor instance.\n */ function getBalloonPositionData(editor) {\n    const editingView = editor.editing.view;\n    const defaultPositions = BalloonPanelView.defaultPositions;\n    const imageUtils = editor.plugins.get('ImageUtils');\n    return {\n        target: editingView.domConverter.mapViewToDom(imageUtils.getClosestSelectedImageWidget(editingView.document.selection)),\n        positions: [\n            defaultPositions.northArrowSouth,\n            defaultPositions.northArrowSouthWest,\n            defaultPositions.northArrowSouthEast,\n            defaultPositions.southArrowNorth,\n            defaultPositions.southArrowNorthWest,\n            defaultPositions.southArrowNorthEast,\n            defaultPositions.viewportStickyNorth\n        ]\n    };\n}\n\n/**\n * The image text alternative UI plugin.\n *\n * The plugin uses the {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon}.\n */ class ImageTextAlternativeUI extends Plugin {\n    /**\n\t * The contextual balloon plugin instance.\n\t */ _balloon;\n    /**\n\t * A form containing a textarea and buttons, used to change the `alt` text value.\n\t */ _form;\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ContextualBalloon\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageTextAlternativeUI';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        this._createButton();\n    }\n    /**\n\t * @inheritDoc\n\t */ destroy() {\n        super.destroy();\n        // Destroy created UI components as they are not automatically destroyed (see ckeditor5#1341).\n        if (this._form) {\n            this._form.destroy();\n        }\n    }\n    /**\n\t * Creates a button showing the balloon panel for changing the image text alternative and\n\t * registers it in the editor {@link module:ui/componentfactory~ComponentFactory ComponentFactory}.\n\t */ _createButton() {\n        const editor = this.editor;\n        const t = editor.t;\n        editor.ui.componentFactory.add('imageTextAlternative', (locale)=>{\n            const command = editor.commands.get('imageTextAlternative');\n            const view = new ButtonView(locale);\n            view.set({\n                label: t('Change image text alternative'),\n                icon: icons.textAlternative,\n                tooltip: true\n            });\n            view.bind('isEnabled').to(command, 'isEnabled');\n            view.bind('isOn').to(command, 'value', (value)=>!!value);\n            this.listenTo(view, 'execute', ()=>{\n                this._showForm();\n            });\n            return view;\n        });\n    }\n    /**\n\t * Creates the {@link module:image/imagetextalternative/ui/textalternativeformview~TextAlternativeFormView}\n\t * form.\n\t */ _createForm() {\n        const editor = this.editor;\n        const view = editor.editing.view;\n        const viewDocument = view.document;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        this._balloon = this.editor.plugins.get('ContextualBalloon');\n        this._form = new (CssTransitionDisablerMixin(TextAlternativeFormView))(editor.locale);\n        // Render the form so its #element is available for clickOutsideHandler.\n        this._form.render();\n        this.listenTo(this._form, 'submit', ()=>{\n            editor.execute('imageTextAlternative', {\n                newValue: this._form.labeledInput.fieldView.element.value\n            });\n            this._hideForm(true);\n        });\n        this.listenTo(this._form, 'cancel', ()=>{\n            this._hideForm(true);\n        });\n        // Close the form on Esc key press.\n        this._form.keystrokes.set('Esc', (data, cancel)=>{\n            this._hideForm(true);\n            cancel();\n        });\n        // Reposition the balloon or hide the form if an image widget is no longer selected.\n        this.listenTo(editor.ui, 'update', ()=>{\n            if (!imageUtils.getClosestSelectedImageWidget(viewDocument.selection)) {\n                this._hideForm(true);\n            } else if (this._isVisible) {\n                repositionContextualBalloon(editor);\n            }\n        });\n        // Close on click outside of balloon panel element.\n        clickOutsideHandler({\n            emitter: this._form,\n            activator: ()=>this._isVisible,\n            contextElements: ()=>[\n                    this._balloon.view.element\n                ],\n            callback: ()=>this._hideForm()\n        });\n    }\n    /**\n\t * Shows the {@link #_form} in the {@link #_balloon}.\n\t */ _showForm() {\n        if (this._isVisible) {\n            return;\n        }\n        if (!this._form) {\n            this._createForm();\n        }\n        const editor = this.editor;\n        const command = editor.commands.get('imageTextAlternative');\n        const labeledInput = this._form.labeledInput;\n        this._form.disableCssTransitions();\n        if (!this._isInBalloon) {\n            this._balloon.add({\n                view: this._form,\n                position: getBalloonPositionData(editor)\n            });\n        }\n        // Make sure that each time the panel shows up, the field remains in sync with the value of\n        // the command. If the user typed in the input, then canceled the balloon (`labeledInput#value`\n        // stays unaltered) and re-opened it without changing the value of the command, they would see the\n        // old value instead of the actual value of the command.\n        // https://github.com/ckeditor/ckeditor5-image/issues/114\n        labeledInput.fieldView.value = labeledInput.fieldView.element.value = command.value || '';\n        this._form.labeledInput.fieldView.select();\n        this._form.enableCssTransitions();\n    }\n    /**\n\t * Removes the {@link #_form} from the {@link #_balloon}.\n\t *\n\t * @param focusEditable Controls whether the editing view is focused afterwards.\n\t */ _hideForm(focusEditable = false) {\n        if (!this._isInBalloon) {\n            return;\n        }\n        // Blur the input element before removing it from DOM to prevent issues in some browsers.\n        // See https://github.com/ckeditor/ckeditor5/issues/1501.\n        if (this._form.focusTracker.isFocused) {\n            this._form.saveButtonView.focus();\n        }\n        this._balloon.remove(this._form);\n        if (focusEditable) {\n            this.editor.editing.view.focus();\n        }\n    }\n    /**\n\t * Returns `true` when the {@link #_form} is the visible view in the {@link #_balloon}.\n\t */ get _isVisible() {\n        return !!this._balloon && this._balloon.visibleView === this._form;\n    }\n    /**\n\t * Returns `true` when the {@link #_form} is in the {@link #_balloon}.\n\t */ get _isInBalloon() {\n        return !!this._balloon && this._balloon.hasView(this._form);\n    }\n}\n\n/**\n * The image text alternative plugin.\n *\n * For a detailed overview, check the {@glink features/images/images-styles image styles} documentation.\n *\n * This is a \"glue\" plugin which loads the\n *  {@link module:image/imagetextalternative/imagetextalternativeediting~ImageTextAlternativeEditing}\n * and {@link module:image/imagetextalternative/imagetextalternativeui~ImageTextAlternativeUI} plugins.\n */ class ImageTextAlternative extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageTextAlternativeEditing,\n            ImageTextAlternativeUI\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageTextAlternative';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n}\n\n/**\n * Returns a function that converts the image view representation:\n *\n * ```html\n * <figure class=\"image\"><img src=\"...\" alt=\"...\"></img></figure>\n * ```\n *\n * to the model representation:\n *\n * ```html\n * <imageBlock src=\"...\" alt=\"...\"></imageBlock>\n * ```\n *\n * The entire content of the `<figure>` element except the first `<img>` is being converted as children\n * of the `<imageBlock>` model element.\n *\n * @internal\n */ function upcastImageFigure(imageUtils) {\n    const converter = (evt, data, conversionApi)=>{\n        // Do not convert if this is not an \"image figure\".\n        if (!conversionApi.consumable.test(data.viewItem, {\n            name: true,\n            classes: 'image'\n        })) {\n            return;\n        }\n        // Find an image element inside the figure element.\n        const viewImage = imageUtils.findViewImgElement(data.viewItem);\n        // Do not convert if image element is absent or was already converted.\n        if (!viewImage || !conversionApi.consumable.test(viewImage, {\n            name: true\n        })) {\n            return;\n        }\n        // Consume the figure to prevent other converters from processing it again.\n        conversionApi.consumable.consume(data.viewItem, {\n            name: true,\n            classes: 'image'\n        });\n        // Convert view image to model image.\n        const conversionResult = conversionApi.convertItem(viewImage, data.modelCursor);\n        // Get image element from conversion result.\n        const modelImage = first(conversionResult.modelRange.getItems());\n        // When image wasn't successfully converted then finish conversion.\n        if (!modelImage) {\n            // Revert consumed figure so other features can convert it.\n            conversionApi.consumable.revert(data.viewItem, {\n                name: true,\n                classes: 'image'\n            });\n            return;\n        }\n        // Convert rest of the figure element's children as an image children.\n        conversionApi.convertChildren(data.viewItem, modelImage);\n        conversionApi.updateConversionResult(modelImage, data);\n    };\n    return (dispatcher)=>{\n        dispatcher.on('element:figure', converter);\n    };\n}\n/**\n * Returns a function that converts the image view representation:\n *\n * ```html\n * <picture><source ... /><source ... />...<img ... /></picture>\n * ```\n *\n * to the model representation as the `sources` attribute:\n *\n * ```html\n * <image[Block|Inline] ... sources=\"...\"></image[Block|Inline]>\n * ```\n *\n * @internal\n */ function upcastPicture(imageUtils) {\n    const sourceAttributeNames = [\n        'srcset',\n        'media',\n        'type',\n        'sizes'\n    ];\n    const converter = (evt, data, conversionApi)=>{\n        const pictureViewElement = data.viewItem;\n        // Do not convert <picture> if already consumed.\n        if (!conversionApi.consumable.test(pictureViewElement, {\n            name: true\n        })) {\n            return;\n        }\n        const sources = new Map();\n        // Collect all <source /> elements attribute values.\n        for (const childSourceElement of pictureViewElement.getChildren()){\n            if (childSourceElement.is('element', 'source')) {\n                const attributes = {};\n                for (const name of sourceAttributeNames){\n                    if (childSourceElement.hasAttribute(name)) {\n                        // Don't collect <source /> attribute if already consumed somewhere else.\n                        if (conversionApi.consumable.test(childSourceElement, {\n                            attributes: name\n                        })) {\n                            attributes[name] = childSourceElement.getAttribute(name);\n                        }\n                    }\n                }\n                if (Object.keys(attributes).length) {\n                    sources.set(childSourceElement, attributes);\n                }\n            }\n        }\n        const imgViewElement = imageUtils.findViewImgElement(pictureViewElement);\n        // Don't convert when a picture has no <img/> inside (it is broken).\n        if (!imgViewElement) {\n            return;\n        }\n        let modelImage = data.modelCursor.parent;\n        // - In case of an inline image (cursor parent in a <paragraph>), the <img/> must be converted right away\n        // because no converter handled it yet and otherwise there would be no model element to set the sources attribute on.\n        // - In case of a block image, the <figure class=\"image\"> converter (in ImageBlockEditing) converts the\n        // <img/> right away on its own and the modelCursor is already inside an imageBlock and there's nothing special\n        // to do here.\n        if (!modelImage.is('element', 'imageBlock')) {\n            const conversionResult = conversionApi.convertItem(imgViewElement, data.modelCursor);\n            // Set image range as conversion result.\n            data.modelRange = conversionResult.modelRange;\n            // Continue conversion where image conversion ends.\n            data.modelCursor = conversionResult.modelCursor;\n            modelImage = first(conversionResult.modelRange.getItems());\n        }\n        conversionApi.consumable.consume(pictureViewElement, {\n            name: true\n        });\n        // Consume only these <source/> attributes that were actually collected and will be passed on\n        // to the image model element.\n        for (const [sourceElement, attributes] of sources){\n            conversionApi.consumable.consume(sourceElement, {\n                attributes: Object.keys(attributes)\n            });\n        }\n        if (sources.size) {\n            conversionApi.writer.setAttribute('sources', Array.from(sources.values()), modelImage);\n        }\n        // Convert rest of the <picture> children as an image children. Other converters may want to consume them.\n        conversionApi.convertChildren(pictureViewElement, modelImage);\n    };\n    return (dispatcher)=>{\n        dispatcher.on('element:picture', converter);\n    };\n}\n/**\n * Converter used to convert the `srcset` model image attribute to the `srcset` and `sizes` attributes in the view.\n *\n * @internal\n * @param imageType The type of the image.\n */ function downcastSrcsetAttribute(imageUtils, imageType) {\n    const converter = (evt, data, conversionApi)=>{\n        if (!conversionApi.consumable.consume(data.item, evt.name)) {\n            return;\n        }\n        const writer = conversionApi.writer;\n        const element = conversionApi.mapper.toViewElement(data.item);\n        const img = imageUtils.findViewImgElement(element);\n        if (data.attributeNewValue === null) {\n            writer.removeAttribute('srcset', img);\n            writer.removeAttribute('sizes', img);\n        } else {\n            if (data.attributeNewValue) {\n                writer.setAttribute('srcset', data.attributeNewValue, img);\n                // Always outputting `100vw`. See https://github.com/ckeditor/ckeditor5-image/issues/2.\n                writer.setAttribute('sizes', '100vw', img);\n            }\n        }\n    };\n    return (dispatcher)=>{\n        dispatcher.on(`attribute:srcset:${imageType}`, converter);\n    };\n}\n/**\n * Converts the `source` model attribute to the `<picture><source /><source />...<img /></picture>`\n * view structure.\n *\n * @internal\n */ function downcastSourcesAttribute(imageUtils) {\n    const converter = (evt, data, conversionApi)=>{\n        if (!conversionApi.consumable.consume(data.item, evt.name)) {\n            return;\n        }\n        const viewWriter = conversionApi.writer;\n        const element = conversionApi.mapper.toViewElement(data.item);\n        const imgElement = imageUtils.findViewImgElement(element);\n        const attributeNewValue = data.attributeNewValue;\n        if (attributeNewValue && attributeNewValue.length) {\n            // Collect all wrapping attribute elements.\n            const attributeElements = [];\n            let viewElement = imgElement.parent;\n            while(viewElement && viewElement.is('attributeElement')){\n                const parentElement = viewElement.parent;\n                viewWriter.unwrap(viewWriter.createRangeOn(imgElement), viewElement);\n                attributeElements.unshift(viewElement);\n                viewElement = parentElement;\n            }\n            const hasPictureElement = imgElement.parent.is('element', 'picture');\n            // Reuse existing <picture> element (ckeditor5#17192) or create a new one.\n            const pictureElement = hasPictureElement ? imgElement.parent : viewWriter.createContainerElement('picture', null);\n            if (!hasPictureElement) {\n                viewWriter.insert(viewWriter.createPositionBefore(imgElement), pictureElement);\n            }\n            viewWriter.remove(viewWriter.createRangeIn(pictureElement));\n            viewWriter.insert(viewWriter.createPositionAt(pictureElement, 'end'), attributeNewValue.map((sourceAttributes)=>{\n                return viewWriter.createEmptyElement('source', sourceAttributes);\n            }));\n            viewWriter.move(viewWriter.createRangeOn(imgElement), viewWriter.createPositionAt(pictureElement, 'end'));\n            // Apply collected attribute elements over the new picture element.\n            for (const attributeElement of attributeElements){\n                viewWriter.wrap(viewWriter.createRangeOn(pictureElement), attributeElement);\n            }\n        } else if (imgElement.parent.is('element', 'picture')) {\n            const pictureElement = imgElement.parent;\n            viewWriter.move(viewWriter.createRangeOn(imgElement), viewWriter.createPositionBefore(pictureElement));\n            viewWriter.remove(pictureElement);\n        }\n    };\n    return (dispatcher)=>{\n        dispatcher.on('attribute:sources:imageBlock', converter);\n        dispatcher.on('attribute:sources:imageInline', converter);\n    };\n}\n/**\n * Converter used to convert a given image attribute from the model to the view.\n *\n * @internal\n * @param imageType The type of the image.\n * @param attributeKey The name of the attribute to convert.\n */ function downcastImageAttribute(imageUtils, imageType, attributeKey) {\n    const converter = (evt, data, conversionApi)=>{\n        if (!conversionApi.consumable.consume(data.item, evt.name)) {\n            return;\n        }\n        const viewWriter = conversionApi.writer;\n        const element = conversionApi.mapper.toViewElement(data.item);\n        const img = imageUtils.findViewImgElement(element);\n        viewWriter.setAttribute(data.attributeKey, data.attributeNewValue || '', img);\n    };\n    return (dispatcher)=>{\n        dispatcher.on(`attribute:${attributeKey}:${imageType}`, converter);\n    };\n}\n\n/**\n * Observes all new images added to the {@link module:engine/view/document~Document},\n * fires {@link module:engine/view/document~Document#event:imageLoaded} and\n * {@link module:engine/view/document~Document#event:layoutChanged} event every time when the new image\n * has been loaded.\n *\n * **Note:** This event is not fired for images that has been added to the document and rendered as `complete` (already loaded).\n */ class ImageLoadObserver extends Observer {\n    /**\n\t * @inheritDoc\n\t */ observe(domRoot) {\n        this.listenTo(domRoot, 'load', (event, domEvent)=>{\n            const domElement = domEvent.target;\n            if (this.checkShouldIgnoreEventFromTarget(domElement)) {\n                return;\n            }\n            if (domElement.tagName == 'IMG') {\n                this._fireEvents(domEvent);\n            }\n        // Use capture phase for better performance (#4504).\n        }, {\n            useCapture: true\n        });\n    }\n    /**\n\t * @inheritDoc\n\t */ stopObserving(domRoot) {\n        this.stopListening(domRoot);\n    }\n    /**\n\t * Fires {@link module:engine/view/document~Document#event:layoutChanged} and\n\t * {@link module:engine/view/document~Document#event:imageLoaded}\n\t * if observer {@link #isEnabled is enabled}.\n\t *\n\t * @param domEvent The DOM event.\n\t */ _fireEvents(domEvent) {\n        if (this.isEnabled) {\n            this.document.fire('layoutChanged');\n            this.document.fire('imageLoaded', domEvent);\n        }\n    }\n}\n\n/**\n * Insert image command.\n *\n * The command is registered by the {@link module:image/image/imageediting~ImageEditing} plugin as `insertImage`\n * and it is also available via aliased `imageInsert` name.\n *\n * In order to insert an image at the current selection position\n * (according to the {@link module:widget/utils~findOptimalInsertionRange} algorithm),\n * execute the command and specify the image source:\n *\n * ```ts\n * editor.execute( 'insertImage', { source: 'http://url.to.the/image' } );\n * ```\n *\n * It is also possible to insert multiple images at once:\n *\n * ```ts\n * editor.execute( 'insertImage', {\n * \tsource:  [\n * \t\t'path/to/image.jpg',\n * \t\t'path/to/other-image.jpg'\n * \t]\n * } );\n * ```\n *\n * If you want to take the full control over the process, you can specify individual model attributes:\n *\n * ```ts\n * editor.execute( 'insertImage', {\n * \tsource:  [\n * \t\t{ src: 'path/to/image.jpg', alt: 'First alt text' },\n * \t\t{ src: 'path/to/other-image.jpg', alt: 'Second alt text', customAttribute: 'My attribute value' }\n * \t]\n * } );\n * ```\n */ class InsertImageCommand extends Command {\n    /**\n\t * @inheritDoc\n\t */ constructor(editor){\n        super(editor);\n        const configImageInsertType = editor.config.get('image.insert.type');\n        if (!editor.plugins.has('ImageBlockEditing')) {\n            if (configImageInsertType === 'block') {\n                /**\n\t\t\t\t * The {@link module:image/imageblock~ImageBlock} plugin must be enabled to allow inserting block images. See\n\t\t\t\t * {@link module:image/imageconfig~ImageInsertConfig#type} to learn more.\n\t\t\t\t *\n\t\t\t\t * @error image-block-plugin-required\n\t\t\t\t */ logWarning('image-block-plugin-required');\n            }\n        }\n        if (!editor.plugins.has('ImageInlineEditing')) {\n            if (configImageInsertType === 'inline') {\n                /**\n\t\t\t\t * The {@link module:image/imageinline~ImageInline} plugin must be enabled to allow inserting inline images. See\n\t\t\t\t * {@link module:image/imageconfig~ImageInsertConfig#type} to learn more.\n\t\t\t\t *\n\t\t\t\t * @error image-inline-plugin-required\n\t\t\t\t */ logWarning('image-inline-plugin-required');\n            }\n        }\n    }\n    /**\n\t * @inheritDoc\n\t */ refresh() {\n        const imageUtils = this.editor.plugins.get('ImageUtils');\n        this.isEnabled = imageUtils.isImageAllowed();\n    }\n    /**\n\t * Executes the command.\n\t *\n\t * @fires execute\n\t * @param options Options for the executed command.\n\t * @param options.imageType The type of the image to insert. If not specified, the type will be determined automatically.\n\t * @param options.source The image source or an array of image sources to insert.\n\t * @param options.breakBlock If set to `true`, the block at the selection start will be broken before inserting the image.\n\t * See the documentation of the command to learn more about accepted formats.\n\t */ execute(options) {\n        const sourceDefinitions = toArray(options.source);\n        const selection = this.editor.model.document.selection;\n        const imageUtils = this.editor.plugins.get('ImageUtils');\n        // In case of multiple images, each image (starting from the 2nd) will be inserted at a position that\n        // follows the previous one. That will move the selection and, to stay on the safe side and make sure\n        // all images inherit the same selection attributes, they are collected beforehand.\n        //\n        // Applying these attributes ensures, for instance, that inserting an (inline) image into a link does\n        // not split that link but preserves its continuity.\n        //\n        // Note: Selection attributes that do not make sense for images will be filtered out by insertImage() anyway.\n        const selectionAttributes = Object.fromEntries(selection.getAttributes());\n        sourceDefinitions.forEach((sourceDefinition, index)=>{\n            const selectedElement = selection.getSelectedElement();\n            if (typeof sourceDefinition === 'string') {\n                sourceDefinition = {\n                    src: sourceDefinition\n                };\n            }\n            // Inserting of an inline image replace the selected element and make a selection on the inserted image.\n            // Therefore inserting multiple inline images requires creating position after each element.\n            if (index && selectedElement && imageUtils.isImage(selectedElement)) {\n                const position = this.editor.model.createPositionAfter(selectedElement);\n                imageUtils.insertImage({\n                    ...sourceDefinition,\n                    ...selectionAttributes\n                }, position, options.imageType);\n            } else if (options.breakBlock) {\n                imageUtils.insertImage({\n                    ...sourceDefinition,\n                    ...selectionAttributes\n                }, selection.getFirstPosition(), options.imageType);\n            } else {\n                imageUtils.insertImage({\n                    ...sourceDefinition,\n                    ...selectionAttributes\n                }, null, options.imageType);\n            }\n        });\n    }\n}\n\n/**\n * @module image/image/replaceimagesourcecommand\n */ /**\n * Replace image source command.\n *\n * Changes image source to the one provided. Can be executed as follows:\n *\n * ```ts\n * editor.execute( 'replaceImageSource', { source: 'http://url.to.the/image' } );\n * ```\n */ class ReplaceImageSourceCommand extends Command {\n    constructor(editor){\n        super(editor);\n        this.decorate('cleanupImage');\n    }\n    /**\n\t * @inheritDoc\n\t */ refresh() {\n        const editor = this.editor;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const element = this.editor.model.document.selection.getSelectedElement();\n        this.isEnabled = imageUtils.isImage(element);\n        this.value = this.isEnabled ? element.getAttribute('src') : null;\n    }\n    /**\n\t * Executes the command.\n\t *\n\t * @fires execute\n\t * @param options Options for the executed command.\n\t * @param options.source The image source to replace.\n\t */ execute(options) {\n        const image = this.editor.model.document.selection.getSelectedElement();\n        const imageUtils = this.editor.plugins.get('ImageUtils');\n        this.editor.model.change((writer)=>{\n            writer.setAttribute('src', options.source, image);\n            this.cleanupImage(writer, image);\n            imageUtils.setImageNaturalSizeAttributes(image);\n        });\n    }\n    /**\n\t * Cleanup image attributes that are not relevant to the new source.\n\t *\n\t * Removed attributes are: 'srcset', 'sizes', 'sources', 'width', 'height', 'alt'.\n\t *\n\t * This method is decorated, to allow custom cleanup logic.\n\t * For example, to remove 'myImageId' attribute after 'src' has changed:\n\t *\n\t * ```ts\n\t * replaceImageSourceCommand.on( 'cleanupImage', ( eventInfo, [ writer, image ] ) => {\n\t * \twriter.removeAttribute( 'myImageId', image );\n\t * } );\n\t * ```\n\t */ cleanupImage(writer, image) {\n        writer.removeAttribute('srcset', image);\n        writer.removeAttribute('sizes', image);\n        /**\n\t\t * In case responsive images some attributes should be cleaned up.\n\t\t * Check: https://github.com/ckeditor/ckeditor5/issues/15093\n\t\t */ writer.removeAttribute('sources', image);\n        writer.removeAttribute('width', image);\n        writer.removeAttribute('height', image);\n        writer.removeAttribute('alt', image);\n    }\n}\n\n/**\n * The image engine plugin. This module loads common code shared between\n * {@link module:image/image/imageinlineediting~ImageInlineEditing} and\n * {@link module:image/image/imageblockediting~ImageBlockEditing} plugins.\n *\n * This plugin registers the {@link module:image/image/insertimagecommand~InsertImageCommand 'insertImage'} command.\n */ class ImageEditing extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageUtils\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageEditing';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const editor = this.editor;\n        const conversion = editor.conversion;\n        // See https://github.com/ckeditor/ckeditor5-image/issues/142.\n        editor.editing.view.addObserver(ImageLoadObserver);\n        conversion.for('upcast').attributeToAttribute({\n            view: {\n                name: 'img',\n                key: 'alt'\n            },\n            model: 'alt'\n        }).attributeToAttribute({\n            view: {\n                name: 'img',\n                key: 'srcset'\n            },\n            model: 'srcset'\n        });\n        const insertImageCommand = new InsertImageCommand(editor);\n        const replaceImageSourceCommand = new ReplaceImageSourceCommand(editor);\n        editor.commands.add('insertImage', insertImageCommand);\n        editor.commands.add('replaceImageSource', replaceImageSourceCommand);\n        // `imageInsert` is an alias for backward compatibility.\n        editor.commands.add('imageInsert', insertImageCommand);\n    }\n}\n\n/**\n * This plugin enables `width` and `height` attributes in inline and block image elements.\n */ class ImageSizeAttributes extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageUtils\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageSizeAttributes';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ afterInit() {\n        this._registerSchema();\n        this._registerConverters('imageBlock');\n        this._registerConverters('imageInline');\n    }\n    /**\n\t * Registers the `width` and `height` attributes for inline and block images.\n\t */ _registerSchema() {\n        if (this.editor.plugins.has('ImageBlockEditing')) {\n            this.editor.model.schema.extend('imageBlock', {\n                allowAttributes: [\n                    'width',\n                    'height'\n                ]\n            });\n        }\n        if (this.editor.plugins.has('ImageInlineEditing')) {\n            this.editor.model.schema.extend('imageInline', {\n                allowAttributes: [\n                    'width',\n                    'height'\n                ]\n            });\n        }\n    }\n    /**\n\t * Registers converters for `width` and `height` attributes.\n\t */ _registerConverters(imageType) {\n        const editor = this.editor;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const viewElementName = imageType === 'imageBlock' ? 'figure' : 'img';\n        editor.conversion.for('upcast').attributeToAttribute({\n            view: {\n                name: viewElementName,\n                styles: {\n                    width: /.+/\n                }\n            },\n            model: {\n                key: 'width',\n                value: (viewElement)=>{\n                    if (widthAndHeightStylesAreBothSet(viewElement)) {\n                        return getSizeValueIfInPx(viewElement.getStyle('width'));\n                    }\n                    return null;\n                }\n            }\n        }).attributeToAttribute({\n            view: {\n                name: viewElementName,\n                key: 'width'\n            },\n            model: 'width'\n        }).attributeToAttribute({\n            view: {\n                name: viewElementName,\n                styles: {\n                    height: /.+/\n                }\n            },\n            model: {\n                key: 'height',\n                value: (viewElement)=>{\n                    if (widthAndHeightStylesAreBothSet(viewElement)) {\n                        return getSizeValueIfInPx(viewElement.getStyle('height'));\n                    }\n                    return null;\n                }\n            }\n        }).attributeToAttribute({\n            view: {\n                name: viewElementName,\n                key: 'height'\n            },\n            model: 'height'\n        });\n        // Dedicated converters to propagate attributes to the <img> element.\n        editor.conversion.for('editingDowncast').add((dispatcher)=>{\n            attachDowncastConverter(dispatcher, 'width', 'width', true, true);\n            attachDowncastConverter(dispatcher, 'height', 'height', true, true);\n        });\n        editor.conversion.for('dataDowncast').add((dispatcher)=>{\n            attachDowncastConverter(dispatcher, 'width', 'width', false);\n            attachDowncastConverter(dispatcher, 'height', 'height', false);\n        });\n        function attachDowncastConverter(dispatcher, modelAttributeName, viewAttributeName, setRatioForInlineImage, isEditingDowncast = false) {\n            dispatcher.on(`attribute:${modelAttributeName}:${imageType}`, (evt, data, conversionApi)=>{\n                if (!conversionApi.consumable.consume(data.item, evt.name)) {\n                    return;\n                }\n                const viewWriter = conversionApi.writer;\n                const viewElement = conversionApi.mapper.toViewElement(data.item);\n                const img = imageUtils.findViewImgElement(viewElement);\n                if (data.attributeNewValue !== null) {\n                    viewWriter.setAttribute(viewAttributeName, data.attributeNewValue, img);\n                } else {\n                    viewWriter.removeAttribute(viewAttributeName, img);\n                }\n                const width = data.item.getAttribute('width');\n                const height = data.item.getAttribute('height');\n                const hasSizes = width && height;\n                if (hasSizes && isEditingDowncast) {\n                    viewWriter.setAttribute('loading', 'lazy', img);\n                }\n                // Do not set aspect-ratio for pictures. See https://github.com/ckeditor/ckeditor5/issues/14579.\n                if (data.item.hasAttribute('sources')) {\n                    return;\n                }\n                const isResized = data.item.hasAttribute('resizedWidth');\n                // Do not set aspect ratio for inline images which are not resized (data pipeline).\n                if (imageType === 'imageInline' && !isResized && !setRatioForInlineImage) {\n                    return;\n                }\n                if (hasSizes) {\n                    viewWriter.setStyle('aspect-ratio', `${width}/${height}`, img);\n                }\n            });\n        }\n    }\n}\n\n/**\n * The image type command. It changes the type of a selected image, depending on the configuration.\n */ class ImageTypeCommand extends Command {\n    /**\n\t * Model element name the command converts to.\n\t */ _modelElementName;\n    /**\n\t * @inheritDoc\n\t *\n\t * @param modelElementName Model element name the command converts to.\n\t */ constructor(editor, modelElementName){\n        super(editor);\n        this._modelElementName = modelElementName;\n    }\n    /**\n\t * @inheritDoc\n\t */ refresh() {\n        const editor = this.editor;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const element = imageUtils.getClosestSelectedImageElement(this.editor.model.document.selection);\n        if (this._modelElementName === 'imageBlock') {\n            this.isEnabled = imageUtils.isInlineImage(element);\n        } else {\n            this.isEnabled = imageUtils.isBlockImage(element);\n        }\n    }\n    /**\n\t * Executes the command and changes the type of a selected image.\n\t *\n\t * @fires execute\n\t * @param options.setImageSizes Specifies whether the image `width` and `height` attributes should be set automatically.\n\t * The default is `true`.\n\t * @returns An object containing references to old and new model image elements\n\t * (for before and after the change) so external integrations can hook into the decorated\n\t * `execute` event and handle this change. `null` if the type change failed.\n\t */ execute(options = {}) {\n        const editor = this.editor;\n        const model = this.editor.model;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const oldElement = imageUtils.getClosestSelectedImageElement(model.document.selection);\n        const attributes = Object.fromEntries(oldElement.getAttributes());\n        // Don't change image type if \"src\" is missing (a broken image), unless there's \"uploadId\" set.\n        // This state may happen during image upload (before it finishes) and it should be possible to change type\n        // of the image in the meantime.\n        if (!attributes.src && !attributes.uploadId) {\n            return null;\n        }\n        return model.change((writer)=>{\n            const { setImageSizes = true } = options;\n            // Get all markers that contain the old image element.\n            const markers = Array.from(model.markers).filter((marker)=>marker.getRange().containsItem(oldElement));\n            const newElement = imageUtils.insertImage(attributes, model.createSelection(oldElement, 'on'), this._modelElementName, {\n                setImageSizes\n            });\n            if (!newElement) {\n                return null;\n            }\n            const newElementRange = writer.createRangeOn(newElement);\n            // Expand the previously intersecting markers' ranges to include the new image element.\n            for (const marker of markers){\n                const markerRange = marker.getRange();\n                // Join the survived part of the old marker range with the new element range\n                // (loosely because there could be some new paragraph or the existing one might got split).\n                const range = markerRange.root.rootName != '$graveyard' ? markerRange.getJoined(newElementRange, true) : newElementRange;\n                writer.updateMarker(marker, {\n                    range\n                });\n            }\n            return {\n                oldElement,\n                newElement\n            };\n        });\n    }\n}\n\n/**\n * Adds support for image placeholder that is automatically removed when the image is loaded.\n */ class ImagePlaceholder extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageUtils\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImagePlaceholder';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ afterInit() {\n        this._setupSchema();\n        this._setupConversion();\n        this._setupLoadListener();\n    }\n    /**\n\t * Extends model schema.\n\t */ _setupSchema() {\n        const schema = this.editor.model.schema;\n        // Wait for ImageBlockEditing or ImageInlineEditing to register their elements first,\n        // that's why doing this in afterInit() instead of init().\n        if (schema.isRegistered('imageBlock')) {\n            schema.extend('imageBlock', {\n                allowAttributes: [\n                    'placeholder'\n                ]\n            });\n        }\n        if (schema.isRegistered('imageInline')) {\n            schema.extend('imageInline', {\n                allowAttributes: [\n                    'placeholder'\n                ]\n            });\n        }\n    }\n    /**\n\t * Registers converters.\n\t */ _setupConversion() {\n        const editor = this.editor;\n        const conversion = editor.conversion;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        conversion.for('editingDowncast').add((dispatcher)=>{\n            dispatcher.on('attribute:placeholder', (evt, data, conversionApi)=>{\n                if (!conversionApi.consumable.test(data.item, evt.name)) {\n                    return;\n                }\n                if (!data.item.is('element', 'imageBlock') && !data.item.is('element', 'imageInline')) {\n                    return;\n                }\n                conversionApi.consumable.consume(data.item, evt.name);\n                const viewWriter = conversionApi.writer;\n                const element = conversionApi.mapper.toViewElement(data.item);\n                const img = imageUtils.findViewImgElement(element);\n                if (data.attributeNewValue) {\n                    viewWriter.addClass('image_placeholder', img);\n                    viewWriter.setStyle('background-image', `url(${data.attributeNewValue})`, img);\n                    viewWriter.setCustomProperty('editingPipeline:doNotReuseOnce', true, img);\n                } else {\n                    viewWriter.removeClass('image_placeholder', img);\n                    viewWriter.removeStyle('background-image', img);\n                }\n            });\n        });\n    }\n    /**\n\t * Prepares listener for image load.\n\t */ _setupLoadListener() {\n        const editor = this.editor;\n        const model = editor.model;\n        const editing = editor.editing;\n        const editingView = editing.view;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        editingView.addObserver(ImageLoadObserver);\n        this.listenTo(editingView.document, 'imageLoaded', (evt, domEvent)=>{\n            const imgViewElement = editingView.domConverter.mapDomToView(domEvent.target);\n            if (!imgViewElement) {\n                return;\n            }\n            const viewElement = imageUtils.getImageWidgetFromImageView(imgViewElement);\n            if (!viewElement) {\n                return;\n            }\n            const modelElement = editing.mapper.toModelElement(viewElement);\n            if (!modelElement || !modelElement.hasAttribute('placeholder')) {\n                return;\n            }\n            model.enqueueChange({\n                isUndoable: false\n            }, (writer)=>{\n                writer.removeAttribute('placeholder', modelElement);\n            });\n        });\n    }\n}\n\n/**\n * The image block plugin.\n *\n * It registers:\n *\n * * `<imageBlock>` as a block element in the document schema, and allows `alt`, `src` and `srcset` attributes.\n * * converters for editing and data pipelines.,\n * * {@link module:image/image/imagetypecommand~ImageTypeCommand `'imageTypeBlock'`} command that converts inline images into\n * block images.\n */ class ImageBlockEditing extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageEditing,\n            ImageSizeAttributes,\n            ImageUtils,\n            ImagePlaceholder,\n            ClipboardPipeline\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageBlockEditing';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const editor = this.editor;\n        const schema = editor.model.schema;\n        // Converters 'alt' and 'srcset' are added in 'ImageEditing' plugin.\n        schema.register('imageBlock', {\n            inheritAllFrom: '$blockObject',\n            allowAttributes: [\n                'alt',\n                'src',\n                'srcset'\n            ]\n        });\n        this._setupConversion();\n        if (editor.plugins.has('ImageInlineEditing')) {\n            editor.commands.add('imageTypeBlock', new ImageTypeCommand(this.editor, 'imageBlock'));\n            this._setupClipboardIntegration();\n        }\n    }\n    /**\n\t * Configures conversion pipelines to support upcasting and downcasting\n\t * block images (block image widgets) and their attributes.\n\t */ _setupConversion() {\n        const editor = this.editor;\n        const t = editor.t;\n        const conversion = editor.conversion;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        conversion.for('dataDowncast').elementToStructure({\n            model: 'imageBlock',\n            view: (modelElement, { writer })=>createBlockImageViewElement(writer)\n        });\n        conversion.for('editingDowncast').elementToStructure({\n            model: 'imageBlock',\n            view: (modelElement, { writer })=>imageUtils.toImageWidget(createBlockImageViewElement(writer), writer, t('image widget'))\n        });\n        conversion.for('downcast').add(downcastImageAttribute(imageUtils, 'imageBlock', 'src')).add(downcastImageAttribute(imageUtils, 'imageBlock', 'alt')).add(downcastSrcsetAttribute(imageUtils, 'imageBlock'));\n        // More image related upcasts are in 'ImageEditing' plugin.\n        conversion.for('upcast').elementToElement({\n            view: getImgViewElementMatcher(editor, 'imageBlock'),\n            model: (viewImage, { writer })=>writer.createElement('imageBlock', viewImage.hasAttribute('src') ? {\n                    src: viewImage.getAttribute('src')\n                } : undefined)\n        }).add(upcastImageFigure(imageUtils));\n    }\n    /**\n\t * Integrates the plugin with the clipboard pipeline.\n\t *\n\t * Idea is that the feature should recognize the user's intent when an **inline** image is\n\t * pasted or dropped. If such an image is pasted/dropped:\n\t *\n\t * * into an empty block (e.g. an empty paragraph),\n\t * * on another object (e.g. some block widget).\n\t *\n\t * it gets converted into a block image on the fly. We assume this is the user's intent\n\t * if they decided to put their image there.\n\t *\n\t * See the `ImageInlineEditing` for the similar integration that works in the opposite direction.\n\t *\n\t * The feature also sets image `width` and `height` attributes on paste.\n\t */ _setupClipboardIntegration() {\n        const editor = this.editor;\n        const model = editor.model;\n        const editingView = editor.editing.view;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const clipboardPipeline = editor.plugins.get('ClipboardPipeline');\n        this.listenTo(clipboardPipeline, 'inputTransformation', (evt, data)=>{\n            const docFragmentChildren = Array.from(data.content.getChildren());\n            let modelRange;\n            // Make sure only <img> elements are dropped or pasted. Otherwise, if there some other HTML\n            // mixed up, this should be handled as a regular paste.\n            if (!docFragmentChildren.every(imageUtils.isInlineImageView)) {\n                return;\n            }\n            // When drag and dropping, data.targetRanges specifies where to drop because\n            // this is usually a different place than the current model selection (the user\n            // uses a drop marker to specify the drop location).\n            if (data.targetRanges) {\n                modelRange = editor.editing.mapper.toModelRange(data.targetRanges[0]);\n            } else {\n                modelRange = model.document.selection.getFirstRange();\n            }\n            const selection = model.createSelection(modelRange);\n            // Convert inline images into block images only when the currently selected block is empty\n            // (e.g. an empty paragraph) or some object is selected (to replace it).\n            if (determineImageTypeForInsertionAtSelection(model.schema, selection) === 'imageBlock') {\n                const writer = new UpcastWriter(editingView.document);\n                // Wrap <img ... /> -> <figure class=\"image\"><img .../></figure>\n                const blockViewImages = docFragmentChildren.map((inlineViewImage)=>writer.createElement('figure', {\n                        class: 'image'\n                    }, inlineViewImage));\n                data.content = writer.createDocumentFragment(blockViewImages);\n            }\n        });\n        this.listenTo(clipboardPipeline, 'contentInsertion', (evt, data)=>{\n            if (data.method !== 'paste') {\n                return;\n            }\n            model.change((writer)=>{\n                const range = writer.createRangeIn(data.content);\n                for (const item of range.getItems()){\n                    if (item.is('element', 'imageBlock')) {\n                        imageUtils.setImageNaturalSizeAttributes(item);\n                    }\n                }\n            });\n        });\n    }\n}\n\n/**\n * The view displayed in the insert image dropdown.\n *\n * See {@link module:image/imageinsert/imageinsertui~ImageInsertUI}.\n */ class ImageInsertFormView extends View {\n    /**\n\t * Tracks information about DOM focus in the form.\n\t */ focusTracker;\n    /**\n\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\n\t */ keystrokes;\n    /**\n\t * A collection of views that can be focused in the form.\n\t */ _focusables;\n    /**\n\t * Helps cycling over {@link #_focusables} in the form.\n\t */ _focusCycler;\n    /**\n\t * A collection of the defined integrations for inserting the images.\n\t */ children;\n    /**\n\t * Creates a view for the dropdown panel of {@link module:image/imageinsert/imageinsertui~ImageInsertUI}.\n\t *\n\t * @param locale The localization services instance.\n\t * @param integrations An integrations object that contains components (or tokens for components) to be shown in the panel view.\n\t */ constructor(locale, integrations = []){\n        super(locale);\n        this.focusTracker = new FocusTracker();\n        this.keystrokes = new KeystrokeHandler();\n        this._focusables = new ViewCollection();\n        this.children = this.createCollection();\n        this._focusCycler = new FocusCycler({\n            focusables: this._focusables,\n            focusTracker: this.focusTracker,\n            keystrokeHandler: this.keystrokes,\n            actions: {\n                // Navigate form fields backwards using the Shift + Tab keystroke.\n                focusPrevious: 'shift + tab',\n                // Navigate form fields forwards using the Tab key.\n                focusNext: 'tab'\n            }\n        });\n        for (const view of integrations){\n            this.children.add(view);\n            this._focusables.add(view);\n            if (view instanceof CollapsibleView) {\n                this._focusables.addMany(view.children);\n            }\n        }\n        this.setTemplate({\n            tag: 'form',\n            attributes: {\n                class: [\n                    'ck',\n                    'ck-image-insert-form'\n                ],\n                tabindex: -1\n            },\n            children: this.children\n        });\n    }\n    /**\n\t * @inheritDoc\n\t */ render() {\n        super.render();\n        submitHandler({\n            view: this\n        });\n        for (const view of this._focusables){\n            this.focusTracker.add(view.element);\n        }\n        // Start listening for the keystrokes coming from #element.\n        this.keystrokes.listenTo(this.element);\n        const stopPropagation = (data)=>data.stopPropagation();\n        // Since the form is in the dropdown panel which is a child of the toolbar, the toolbar's\n        // keystroke handler would take over the key management in the URL input. We need to prevent\n        // this ASAP. Otherwise, the basic caret movement using the arrow keys will be impossible.\n        this.keystrokes.set('arrowright', stopPropagation);\n        this.keystrokes.set('arrowleft', stopPropagation);\n        this.keystrokes.set('arrowup', stopPropagation);\n        this.keystrokes.set('arrowdown', stopPropagation);\n    }\n    /**\n\t * @inheritDoc\n\t */ destroy() {\n        super.destroy();\n        this.focusTracker.destroy();\n        this.keystrokes.destroy();\n    }\n    /**\n\t * Focuses the first {@link #_focusables focusable} in the form.\n\t */ focus() {\n        this._focusCycler.focusFirst();\n    }\n}\n\n/**\n * The image insert dropdown plugin.\n *\n * For a detailed overview, check the {@glink features/images/image-upload/image-upload Image upload feature}\n * and {@glink features/images/images-inserting Insert images via source URL} documentation.\n *\n * Adds the `'insertImage'` dropdown to the {@link module:ui/componentfactory~ComponentFactory UI component factory}\n * and also the `imageInsert` dropdown as an alias for backward compatibility.\n *\n * Adds the `'menuBar:insertImage'` sub-menu to the {@link module:ui/componentfactory~ComponentFactory UI component factory}, which is\n * by default added to the `'Insert'` menu.\n */ class ImageInsertUI extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageInsertUI';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageUtils\n        ];\n    }\n    /**\n\t * The dropdown view responsible for displaying the image insert UI.\n\t */ dropdownView;\n    /**\n\t * Registered integrations map.\n\t */ _integrations = new Map();\n    /**\n\t * @inheritDoc\n\t */ constructor(editor){\n        super(editor);\n        editor.config.define('image.insert.integrations', [\n            'upload',\n            'assetManager',\n            'url'\n        ]);\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const editor = this.editor;\n        const selection = editor.model.document.selection;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        this.set('isImageSelected', false);\n        this.listenTo(editor.model.document, 'change', ()=>{\n            this.isImageSelected = imageUtils.isImage(selection.getSelectedElement());\n        });\n        const componentCreator = (locale)=>this._createToolbarComponent(locale);\n        const menuBarComponentCreator = (locale)=>this._createMenuBarComponent(locale);\n        // Register `insertImage` dropdown and add `imageInsert` dropdown as an alias for backward compatibility.\n        editor.ui.componentFactory.add('insertImage', componentCreator);\n        editor.ui.componentFactory.add('imageInsert', componentCreator);\n        editor.ui.componentFactory.add('menuBar:insertImage', menuBarComponentCreator);\n    }\n    /**\n\t * Registers the insert image dropdown integration.\n\t */ registerIntegration({ name, observable, buttonViewCreator, formViewCreator, menuBarButtonViewCreator, requiresForm = false, override = false }) {\n        if (this._integrations.has(name) && !override) {\n            /**\n\t\t\t * There are two insert-image integrations registered with the same name.\n\t\t\t *\n\t\t\t * Make sure that you do not load multiple asset manager plugins.\n\t\t\t *\n\t\t\t * @error image-insert-integration-exists\n\t\t\t */ logWarning('image-insert-integration-exists', {\n                name\n            });\n        }\n        this._integrations.set(name, {\n            observable,\n            buttonViewCreator,\n            menuBarButtonViewCreator,\n            formViewCreator,\n            requiresForm\n        });\n    }\n    /**\n\t * Creates the toolbar component.\n\t */ _createToolbarComponent(locale) {\n        const editor = this.editor;\n        const t = locale.t;\n        const integrations = this._prepareIntegrations();\n        if (!integrations.length) {\n            return null;\n        }\n        let dropdownButton;\n        const firstIntegration = integrations[0];\n        if (integrations.length == 1) {\n            // Do not use dropdown for a single integration button (integration that does not require form view).\n            if (!firstIntegration.requiresForm) {\n                return firstIntegration.buttonViewCreator(true);\n            }\n            dropdownButton = firstIntegration.buttonViewCreator(true);\n        } else {\n            const actionButton = firstIntegration.buttonViewCreator(false);\n            dropdownButton = new SplitButtonView(locale, actionButton);\n            dropdownButton.tooltip = true;\n            dropdownButton.bind('label').to(this, 'isImageSelected', (isImageSelected)=>isImageSelected ? t('Replace image') : t('Insert image'));\n        }\n        const dropdownView = this.dropdownView = createDropdown(locale, dropdownButton);\n        const observables = integrations.map(({ observable })=>typeof observable == 'function' ? observable() : observable);\n        dropdownView.bind('isEnabled').toMany(observables, 'isEnabled', (...isEnabled)=>isEnabled.some((isEnabled)=>isEnabled));\n        dropdownView.once('change:isOpen', ()=>{\n            const integrationViews = integrations.flatMap(({ formViewCreator })=>formViewCreator(integrations.length == 1));\n            const imageInsertFormView = new ImageInsertFormView(editor.locale, integrationViews);\n            dropdownView.panelView.children.add(imageInsertFormView);\n        });\n        return dropdownView;\n    }\n    /**\n\t * Creates the menu bar component.\n\t */ _createMenuBarComponent(locale) {\n        const t = locale.t;\n        const integrations = this._prepareIntegrations();\n        if (!integrations.length) {\n            return null;\n        }\n        const integrationViews = integrations.flatMap(({ menuBarButtonViewCreator })=>menuBarButtonViewCreator(integrations.length == 1));\n        const resultView = new MenuBarMenuView(locale);\n        const listView = new MenuBarMenuListView(locale);\n        resultView.panelView.children.add(listView);\n        resultView.buttonView.set({\n            icon: icons.image,\n            label: t('Image')\n        });\n        for (const integrationView of integrationViews){\n            const listItemView = new MenuBarMenuListItemView(locale, resultView);\n            listItemView.children.add(integrationView);\n            listView.items.add(listItemView);\n            integrationView.delegate('execute').to(resultView);\n        }\n        return resultView;\n    }\n    /**\n\t * Validates the integrations list.\n\t */ _prepareIntegrations() {\n        const editor = this.editor;\n        const items = editor.config.get('image.insert.integrations');\n        const result = [];\n        if (!items.length) {\n            /**\n\t\t\t * The insert image feature requires a list of integrations to be provided in the editor configuration.\n\t\t\t *\n\t\t\t * The default list of integrations is `upload`, `assetManager`, `url`. Those integrations are included\n\t\t\t * in the insert image dropdown if the given feature plugin is loaded. You should omit the `integrations`\n\t\t\t * configuration key to use the default set or provide a selected list of integrations that should be used.\n\t\t\t *\n\t\t\t * @error image-insert-integrations-not-specified\n\t\t\t */ logWarning('image-insert-integrations-not-specified');\n            return result;\n        }\n        for (const item of items){\n            if (!this._integrations.has(item)) {\n                if (![\n                    'upload',\n                    'assetManager',\n                    'url'\n                ].includes(item)) {\n                    /**\n\t\t\t\t\t * The specified insert image integration name is unknown or the providing plugin is not loaded in the editor.\n\t\t\t\t\t *\n\t\t\t\t\t * @error image-insert-unknown-integration\n\t\t\t\t\t */ logWarning('image-insert-unknown-integration', {\n                        item\n                    });\n                }\n                continue;\n            }\n            result.push(this._integrations.get(item));\n        }\n        if (!result.length) {\n            /**\n\t\t\t * The image insert feature requires integrations to be registered by separate features.\n\t\t\t *\n\t\t\t * The `insertImage` toolbar button requires integrations to be registered by other features.\n\t\t\t * For example {@link module:image/imageupload~ImageUpload ImageUpload},\n\t\t\t * {@link module:image/imageinsert~ImageInsert ImageInsert},\n\t\t\t * {@link module:image/imageinsertviaurl~ImageInsertViaUrl ImageInsertViaUrl},\n\t\t\t * {@link module:ckbox/ckbox~CKBox CKBox}\n\t\t\t *\n\t\t\t * @error image-insert-integrations-not-registered\n\t\t\t */ logWarning('image-insert-integrations-not-registered');\n        }\n        return result;\n    }\n}\n\n/**\n * The image block plugin.\n *\n * This is a \"glue\" plugin which loads the following plugins:\n *\n * * {@link module:image/image/imageblockediting~ImageBlockEditing},\n * * {@link module:image/imagetextalternative~ImageTextAlternative}.\n *\n * Usually, it is used in conjunction with other plugins from this package. See the {@glink api/image package page}\n * for more information.\n */ class ImageBlock extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageBlockEditing,\n            Widget,\n            ImageTextAlternative,\n            ImageInsertUI\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageBlock';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n}\n\n/**\n * The image inline plugin.\n *\n * It registers:\n *\n * * `<imageInline>` as an inline element in the document schema, and allows `alt`, `src` and `srcset` attributes.\n * * converters for editing and data pipelines.\n * * {@link module:image/image/imagetypecommand~ImageTypeCommand `'imageTypeInline'`} command that converts block images into\n * inline images.\n */ class ImageInlineEditing extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageEditing,\n            ImageSizeAttributes,\n            ImageUtils,\n            ImagePlaceholder,\n            ClipboardPipeline\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageInlineEditing';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const editor = this.editor;\n        const schema = editor.model.schema;\n        // Converters 'alt' and 'srcset' are added in 'ImageEditing' plugin.\n        schema.register('imageInline', {\n            inheritAllFrom: '$inlineObject',\n            allowAttributes: [\n                'alt',\n                'src',\n                'srcset'\n            ],\n            // Disallow inline images in captions (at least for now).\n            // This is the best spot to do that because independent packages can introduce captions (ImageCaption, TableCaption, etc.).\n            disallowIn: [\n                'caption'\n            ]\n        });\n        this._setupConversion();\n        if (editor.plugins.has('ImageBlockEditing')) {\n            editor.commands.add('imageTypeInline', new ImageTypeCommand(this.editor, 'imageInline'));\n            this._setupClipboardIntegration();\n        }\n    }\n    /**\n\t * Configures conversion pipelines to support upcasting and downcasting\n\t * inline images (inline image widgets) and their attributes.\n\t */ _setupConversion() {\n        const editor = this.editor;\n        const t = editor.t;\n        const conversion = editor.conversion;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        conversion.for('dataDowncast').elementToElement({\n            model: 'imageInline',\n            view: (modelElement, { writer })=>writer.createEmptyElement('img')\n        });\n        conversion.for('editingDowncast').elementToStructure({\n            model: 'imageInline',\n            view: (modelElement, { writer })=>imageUtils.toImageWidget(createInlineImageViewElement(writer), writer, t('image widget'))\n        });\n        conversion.for('downcast').add(downcastImageAttribute(imageUtils, 'imageInline', 'src')).add(downcastImageAttribute(imageUtils, 'imageInline', 'alt')).add(downcastSrcsetAttribute(imageUtils, 'imageInline'));\n        // More image related upcasts are in 'ImageEditing' plugin.\n        conversion.for('upcast').elementToElement({\n            view: getImgViewElementMatcher(editor, 'imageInline'),\n            model: (viewImage, { writer })=>writer.createElement('imageInline', viewImage.hasAttribute('src') ? {\n                    src: viewImage.getAttribute('src')\n                } : undefined)\n        });\n    }\n    /**\n\t * Integrates the plugin with the clipboard pipeline.\n\t *\n\t * Idea is that the feature should recognize the user's intent when an **block** image is\n\t * pasted or dropped. If such an image is pasted/dropped into a non-empty block\n\t * (e.g. a paragraph with some text) it gets converted into an inline image on the fly.\n\t *\n\t * We assume this is the user's intent if they decided to put their image there.\n\t *\n\t * **Note**: If a block image has a caption, it will not be converted to an inline image\n\t * to avoid the confusion. Captions are added on purpose and they should never be lost\n\t * in the clipboard pipeline.\n\t *\n\t * See the `ImageBlockEditing` for the similar integration that works in the opposite direction.\n\t *\n\t * The feature also sets image `width` and `height` attributes when pasting.\n\t */ _setupClipboardIntegration() {\n        const editor = this.editor;\n        const model = editor.model;\n        const editingView = editor.editing.view;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const clipboardPipeline = editor.plugins.get('ClipboardPipeline');\n        this.listenTo(clipboardPipeline, 'inputTransformation', (evt, data)=>{\n            const docFragmentChildren = Array.from(data.content.getChildren());\n            let modelRange;\n            // Make sure only <figure class=\"image\"></figure> elements are dropped or pasted. Otherwise, if there some other HTML\n            // mixed up, this should be handled as a regular paste.\n            if (!docFragmentChildren.every(imageUtils.isBlockImageView)) {\n                return;\n            }\n            // When drag and dropping, data.targetRanges specifies where to drop because\n            // this is usually a different place than the current model selection (the user\n            // uses a drop marker to specify the drop location).\n            if (data.targetRanges) {\n                modelRange = editor.editing.mapper.toModelRange(data.targetRanges[0]);\n            } else {\n                modelRange = model.document.selection.getFirstRange();\n            }\n            const selection = model.createSelection(modelRange);\n            // Convert block images into inline images only when pasting or dropping into non-empty blocks\n            // and when the block is not an object (e.g. pasting to replace another widget).\n            if (determineImageTypeForInsertionAtSelection(model.schema, selection) === 'imageInline') {\n                const writer = new UpcastWriter(editingView.document);\n                // Unwrap <figure class=\"image\"><img .../></figure> -> <img ... />\n                // but <figure class=\"image\"><img .../><figcaption>...</figcaption></figure> -> stays the same\n                const inlineViewImages = docFragmentChildren.map((blockViewImage)=>{\n                    // If there's just one child, it can be either <img /> or <a><img></a>.\n                    // If there are other children than <img>, this means that the block image\n                    // has a caption or some other features and this kind of image should be\n                    // pasted/dropped without modifications.\n                    if (blockViewImage.childCount === 1) {\n                        // Pass the attributes which are present only in the <figure> to the <img>\n                        // (e.g. the style=\"width:10%\" attribute applied by the ImageResize plugin).\n                        Array.from(blockViewImage.getAttributes()).forEach((attribute)=>writer.setAttribute(...attribute, imageUtils.findViewImgElement(blockViewImage)));\n                        return blockViewImage.getChild(0);\n                    } else {\n                        return blockViewImage;\n                    }\n                });\n                data.content = writer.createDocumentFragment(inlineViewImages);\n            }\n        });\n        this.listenTo(clipboardPipeline, 'contentInsertion', (evt, data)=>{\n            if (data.method !== 'paste') {\n                return;\n            }\n            model.change((writer)=>{\n                const range = writer.createRangeIn(data.content);\n                for (const item of range.getItems()){\n                    if (item.is('element', 'imageInline')) {\n                        imageUtils.setImageNaturalSizeAttributes(item);\n                    }\n                }\n            });\n        });\n    }\n}\n\n/**\n * The image inline plugin.\n *\n * This is a \"glue\" plugin which loads the following plugins:\n *\n * * {@link module:image/image/imageinlineediting~ImageInlineEditing},\n * * {@link module:image/imagetextalternative~ImageTextAlternative}.\n *\n * Usually, it is used in conjunction with other plugins from this package. See the {@glink api/image package page}\n * for more information.\n */ class ImageInline extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageInlineEditing,\n            Widget,\n            ImageTextAlternative,\n            ImageInsertUI\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageInline';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n}\n\n/**\n * The image plugin.\n *\n * For a detailed overview, check the {@glink features/images/images-overview image feature} documentation.\n *\n * This is a \"glue\" plugin which loads the following plugins:\n *\n * * {@link module:image/imageblock~ImageBlock},\n * * {@link module:image/imageinline~ImageInline},\n *\n * Usually, it is used in conjunction with other plugins from this package. See the {@glink api/image package page}\n * for more information.\n */ class Image extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageBlock,\n            ImageInline\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'Image';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n}\n\n/**\n * The image caption utilities plugin.\n */ class ImageCaptionUtils extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageCaptionUtils';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageUtils\n        ];\n    }\n    /**\n\t * Returns the caption model element from a given image element. Returns `null` if no caption is found.\n\t */ getCaptionFromImageModelElement(imageModelElement) {\n        for (const node of imageModelElement.getChildren()){\n            if (!!node && node.is('element', 'caption')) {\n                return node;\n            }\n        }\n        return null;\n    }\n    /**\n\t * Returns the caption model element for a model selection. Returns `null` if the selection has no caption element ancestor.\n\t */ getCaptionFromModelSelection(selection) {\n        const imageUtils = this.editor.plugins.get('ImageUtils');\n        const captionElement = selection.getFirstPosition().findAncestor('caption');\n        if (!captionElement) {\n            return null;\n        }\n        if (imageUtils.isBlockImage(captionElement.parent)) {\n            return captionElement;\n        }\n        return null;\n    }\n    /**\n\t * {@link module:engine/view/matcher~Matcher} pattern. Checks if a given element is a `<figcaption>` element that is placed\n\t * inside the image `<figure>` element.\n\t * @returns Returns the object accepted by {@link module:engine/view/matcher~Matcher} or `null` if the element\n\t * cannot be matched.\n\t */ matchImageCaptionViewElement(element) {\n        const imageUtils = this.editor.plugins.get('ImageUtils');\n        // Convert only captions for images.\n        if (element.name == 'figcaption' && imageUtils.isBlockImageView(element.parent)) {\n            return {\n                name: true\n            };\n        }\n        return null;\n    }\n}\n\n/**\n * The toggle image caption command.\n *\n * This command is registered by {@link module:image/imagecaption/imagecaptionediting~ImageCaptionEditing} as the\n * `'toggleImageCaption'` editor command.\n *\n * Executing this command:\n *\n * * either adds or removes the image caption of a selected image (depending on whether the caption is present or not),\n * * removes the image caption if the selection is anchored in one.\n *\n * ```ts\n * // Toggle the presence of the caption.\n * editor.execute( 'toggleImageCaption' );\n * ```\n *\n * **Note**: Upon executing this command, the selection will be set on the image if previously anchored in the caption element.\n *\n * **Note**: You can move the selection to the caption right away as it shows up upon executing this command by using\n * the `focusCaptionOnShow` option:\n *\n * ```ts\n * editor.execute( 'toggleImageCaption', { focusCaptionOnShow: true } );\n * ```\n */ class ToggleImageCaptionCommand extends Command {\n    /**\n\t * @inheritDoc\n\t */ refresh() {\n        const editor = this.editor;\n        const imageCaptionUtils = editor.plugins.get('ImageCaptionUtils');\n        const imageUtils = editor.plugins.get('ImageUtils');\n        // Only block images can get captions.\n        if (!editor.plugins.has(ImageBlockEditing)) {\n            this.isEnabled = false;\n            this.value = false;\n            return;\n        }\n        const selection = editor.model.document.selection;\n        const selectedElement = selection.getSelectedElement();\n        if (!selectedElement) {\n            const ancestorCaptionElement = imageCaptionUtils.getCaptionFromModelSelection(selection);\n            this.isEnabled = !!ancestorCaptionElement;\n            this.value = !!ancestorCaptionElement;\n            return;\n        }\n        // Block images support captions by default but the command should also be enabled for inline\n        // images because toggling the caption when one is selected should convert it into a block image.\n        this.isEnabled = imageUtils.isImage(selectedElement);\n        if (!this.isEnabled) {\n            this.value = false;\n        } else {\n            this.value = !!imageCaptionUtils.getCaptionFromImageModelElement(selectedElement);\n        }\n    }\n    /**\n\t * Executes the command.\n\t *\n\t * ```ts\n\t * editor.execute( 'toggleImageCaption' );\n\t * ```\n\t *\n\t * @param options Options for the executed command.\n\t * @param options.focusCaptionOnShow When true and the caption shows up, the selection will be moved into it straight away.\n\t * @fires execute\n\t */ execute(options = {}) {\n        const { focusCaptionOnShow } = options;\n        this.editor.model.change((writer)=>{\n            if (this.value) {\n                this._hideImageCaption(writer);\n            } else {\n                this._showImageCaption(writer, focusCaptionOnShow);\n            }\n        });\n    }\n    /**\n\t * Shows the caption of the `<imageBlock>` or `<imageInline>`. Also:\n\t *\n\t * * it converts `<imageInline>` to `<imageBlock>` to show the caption,\n\t * * it attempts to restore the caption content from the `ImageCaptionEditing` caption registry,\n\t * * it moves the selection to the caption right away, it the `focusCaptionOnShow` option was set.\n\t */ _showImageCaption(writer, focusCaptionOnShow) {\n        const model = this.editor.model;\n        const selection = model.document.selection;\n        const imageCaptionEditing = this.editor.plugins.get('ImageCaptionEditing');\n        const imageUtils = this.editor.plugins.get('ImageUtils');\n        let selectedImage = selection.getSelectedElement();\n        const savedCaption = imageCaptionEditing._getSavedCaption(selectedImage);\n        // Convert imageInline -> image first.\n        if (imageUtils.isInlineImage(selectedImage)) {\n            this.editor.execute('imageTypeBlock');\n            // Executing the command created a new model element. Let's pick it again.\n            selectedImage = selection.getSelectedElement();\n        }\n        // Try restoring the caption from the ImageCaptionEditing plugin storage.\n        const newCaptionElement = savedCaption || writer.createElement('caption');\n        writer.append(newCaptionElement, selectedImage);\n        if (focusCaptionOnShow) {\n            writer.setSelection(newCaptionElement, 'in');\n        }\n    }\n    /**\n\t * Hides the caption of a selected image (or an image caption the selection is anchored to).\n\t *\n\t * The content of the caption is stored in the `ImageCaptionEditing` caption registry to make this\n\t * a reversible action.\n\t */ _hideImageCaption(writer) {\n        const editor = this.editor;\n        const selection = editor.model.document.selection;\n        const imageCaptionEditing = editor.plugins.get('ImageCaptionEditing');\n        const imageCaptionUtils = editor.plugins.get('ImageCaptionUtils');\n        let selectedImage = selection.getSelectedElement();\n        let captionElement;\n        if (selectedImage) {\n            captionElement = imageCaptionUtils.getCaptionFromImageModelElement(selectedImage);\n        } else {\n            captionElement = imageCaptionUtils.getCaptionFromModelSelection(selection);\n            selectedImage = captionElement.parent;\n        }\n        // Store the caption content so it can be restored quickly if the user changes their mind even if they toggle image<->imageInline.\n        imageCaptionEditing._saveCaption(selectedImage, captionElement);\n        writer.setSelection(selectedImage, 'on');\n        writer.remove(captionElement);\n    }\n}\n\n/**\n * The image caption engine plugin. It is responsible for:\n *\n * * registering converters for the caption element,\n * * registering converters for the caption model attribute,\n * * registering the {@link module:image/imagecaption/toggleimagecaptioncommand~ToggleImageCaptionCommand `toggleImageCaption`} command.\n */ class ImageCaptionEditing extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageUtils,\n            ImageCaptionUtils\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageCaptionEditing';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * A map that keeps saved JSONified image captions and image model elements they are\n\t * associated with.\n\t *\n\t * To learn more about this system, see {@link #_saveCaption}.\n\t */ _savedCaptionsMap;\n    /**\n\t * @inheritDoc\n\t */ constructor(editor){\n        super(editor);\n        this._savedCaptionsMap = new WeakMap();\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const editor = this.editor;\n        const schema = editor.model.schema;\n        // Schema configuration.\n        if (!schema.isRegistered('caption')) {\n            schema.register('caption', {\n                allowIn: 'imageBlock',\n                allowContentOf: '$block',\n                isLimit: true\n            });\n        } else {\n            schema.extend('caption', {\n                allowIn: 'imageBlock'\n            });\n        }\n        editor.commands.add('toggleImageCaption', new ToggleImageCaptionCommand(this.editor));\n        this._setupConversion();\n        this._setupImageTypeCommandsIntegration();\n        this._registerCaptionReconversion();\n    }\n    /**\n\t * Configures conversion pipelines to support upcasting and downcasting\n\t * image captions.\n\t */ _setupConversion() {\n        const editor = this.editor;\n        const view = editor.editing.view;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const imageCaptionUtils = editor.plugins.get('ImageCaptionUtils');\n        const t = editor.t;\n        // View -> model converter for the data pipeline.\n        editor.conversion.for('upcast').elementToElement({\n            view: (element)=>imageCaptionUtils.matchImageCaptionViewElement(element),\n            model: 'caption'\n        });\n        // Model -> view converter for the data pipeline.\n        editor.conversion.for('dataDowncast').elementToElement({\n            model: 'caption',\n            view: (modelElement, { writer })=>{\n                if (!imageUtils.isBlockImage(modelElement.parent)) {\n                    return null;\n                }\n                return writer.createContainerElement('figcaption');\n            }\n        });\n        // Model -> view converter for the editing pipeline.\n        editor.conversion.for('editingDowncast').elementToElement({\n            model: 'caption',\n            view: (modelElement, { writer })=>{\n                if (!imageUtils.isBlockImage(modelElement.parent)) {\n                    return null;\n                }\n                const figcaptionElement = writer.createEditableElement('figcaption');\n                writer.setCustomProperty('imageCaption', true, figcaptionElement);\n                figcaptionElement.placeholder = t('Enter image caption');\n                enablePlaceholder({\n                    view,\n                    element: figcaptionElement,\n                    keepOnFocus: true\n                });\n                const imageAlt = modelElement.parent.getAttribute('alt');\n                const label = imageAlt ? t('Caption for image: %0', [\n                    imageAlt\n                ]) : t('Caption for the image');\n                return toWidgetEditable(figcaptionElement, writer, {\n                    label\n                });\n            }\n        });\n    }\n    /**\n\t * Integrates with {@link module:image/image/imagetypecommand~ImageTypeCommand image type commands}\n\t * to make sure the caption is preserved when the type of an image changes so it can be restored\n\t * in the future if the user decides they want their caption back.\n\t */ _setupImageTypeCommandsIntegration() {\n        const editor = this.editor;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const imageCaptionUtils = editor.plugins.get('ImageCaptionUtils');\n        const imageTypeInlineCommand = editor.commands.get('imageTypeInline');\n        const imageTypeBlockCommand = editor.commands.get('imageTypeBlock');\n        const handleImageTypeChange = (evt)=>{\n            // The image type command execution can be unsuccessful.\n            if (!evt.return) {\n                return;\n            }\n            const { oldElement, newElement } = evt.return;\n            /* istanbul ignore if: paranoid check -- @preserve */ if (!oldElement) {\n                return;\n            }\n            if (imageUtils.isBlockImage(oldElement)) {\n                const oldCaptionElement = imageCaptionUtils.getCaptionFromImageModelElement(oldElement);\n                // If the old element was a captioned block image (the caption was visible),\n                // simply save it so it can be restored.\n                if (oldCaptionElement) {\n                    this._saveCaption(newElement, oldCaptionElement);\n                    return;\n                }\n            }\n            const savedOldElementCaption = this._getSavedCaption(oldElement);\n            // If either:\n            //\n            // * the block image didn't have a visible caption,\n            // * the block image caption was hidden (and already saved),\n            // * the inline image was passed\n            //\n            // just try to \"pass\" the saved caption from the old image to the new image\n            // so it can be retrieved in the future if the user wants it back.\n            if (savedOldElementCaption) {\n                // Note: Since we're writing to a WeakMap, we don't bother with removing the\n                // [ oldElement, savedOldElementCaption ] pair from it.\n                this._saveCaption(newElement, savedOldElementCaption);\n            }\n        };\n        // Presence of the commands depends on the Image(Inline|Block)Editing plugins loaded in the editor.\n        if (imageTypeInlineCommand) {\n            this.listenTo(imageTypeInlineCommand, 'execute', handleImageTypeChange, {\n                priority: 'low'\n            });\n        }\n        if (imageTypeBlockCommand) {\n            this.listenTo(imageTypeBlockCommand, 'execute', handleImageTypeChange, {\n                priority: 'low'\n            });\n        }\n    }\n    /**\n\t * Returns the saved {@link module:engine/model/element~Element#toJSON JSONified} caption\n\t * of an image model element.\n\t *\n\t * See {@link #_saveCaption}.\n\t *\n\t * @internal\n\t * @param imageModelElement The model element the caption should be returned for.\n\t * @returns The model caption element or `null` if there is none.\n\t */ _getSavedCaption(imageModelElement) {\n        const jsonObject = this._savedCaptionsMap.get(imageModelElement);\n        return jsonObject ? Element.fromJSON(jsonObject) : null;\n    }\n    /**\n\t * Saves a {@link module:engine/model/element~Element#toJSON JSONified} caption for\n\t * an image element to allow restoring it in the future.\n\t *\n\t * A caption is saved every time it gets hidden and/or the type of an image changes. The\n\t * user should be able to restore it on demand.\n\t *\n\t * **Note**: The caption cannot be stored in the image model element attribute because,\n\t * for instance, when the model state propagates to collaborators, the attribute would get\n\t * lost (mainly because it does not convert to anything when the caption is hidden) and\n\t * the states of collaborators' models would de-synchronize causing numerous issues.\n\t *\n\t * See {@link #_getSavedCaption}.\n\t *\n\t * @internal\n\t * @param imageModelElement The model element the caption is saved for.\n\t * @param caption The caption model element to be saved.\n\t */ _saveCaption(imageModelElement, caption) {\n        this._savedCaptionsMap.set(imageModelElement, caption.toJSON());\n    }\n    /**\n\t * Reconverts image caption when image alt attribute changes.\n\t * The change of alt attribute is reflected in caption's aria-label attribute.\n\t */ _registerCaptionReconversion() {\n        const editor = this.editor;\n        const model = editor.model;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const imageCaptionUtils = editor.plugins.get('ImageCaptionUtils');\n        model.document.on('change:data', ()=>{\n            const changes = model.document.differ.getChanges();\n            for (const change of changes){\n                if (change.attributeKey !== 'alt') {\n                    continue;\n                }\n                const image = change.range.start.nodeAfter;\n                if (imageUtils.isBlockImage(image)) {\n                    const caption = imageCaptionUtils.getCaptionFromImageModelElement(image);\n                    if (!caption) {\n                        return;\n                    }\n                    editor.editing.reconvertItem(caption);\n                }\n            }\n        });\n    }\n}\n\n/**\n * The image caption UI plugin. It introduces the `'toggleImageCaption'` UI button.\n */ class ImageCaptionUI extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageCaptionUtils\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageCaptionUI';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const editor = this.editor;\n        const editingView = editor.editing.view;\n        const imageCaptionUtils = editor.plugins.get('ImageCaptionUtils');\n        const t = editor.t;\n        editor.ui.componentFactory.add('toggleImageCaption', (locale)=>{\n            const command = editor.commands.get('toggleImageCaption');\n            const view = new ButtonView(locale);\n            view.set({\n                icon: icons.caption,\n                tooltip: true,\n                isToggleable: true\n            });\n            view.bind('isOn', 'isEnabled').to(command, 'value', 'isEnabled');\n            view.bind('label').to(command, 'value', (value)=>value ? t('Toggle caption off') : t('Toggle caption on'));\n            this.listenTo(view, 'execute', ()=>{\n                editor.execute('toggleImageCaption', {\n                    focusCaptionOnShow: true\n                });\n                // Scroll to the selection and highlight the caption if the caption showed up.\n                const modelCaptionElement = imageCaptionUtils.getCaptionFromModelSelection(editor.model.document.selection);\n                if (modelCaptionElement) {\n                    const figcaptionElement = editor.editing.mapper.toViewElement(modelCaptionElement);\n                    editingView.scrollToTheSelection();\n                    editingView.change((writer)=>{\n                        writer.addClass('image__caption_highlighted', figcaptionElement);\n                    });\n                }\n                editor.editing.view.focus();\n            });\n            return view;\n        });\n    }\n}\n\n/**\n * The image caption plugin.\n *\n * For a detailed overview, check the {@glink features/images/images-captions image caption} documentation.\n */ class ImageCaption extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageCaptionEditing,\n            ImageCaptionUI\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageCaption';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n}\n\n/**\n * Creates a regular expression used to test for image files.\n *\n * ```ts\n * const imageType = createImageTypeRegExp( [ 'png', 'jpeg', 'svg+xml', 'vnd.microsoft.icon' ] );\n *\n * console.log( 'is supported image', imageType.test( file.type ) );\n * ```\n */ function createImageTypeRegExp(types) {\n    // Sanitize the MIME type name which may include: \"+\", \"-\" or \".\".\n    const regExpSafeNames = types.map((type)=>type.replace('+', '\\\\+'));\n    return new RegExp(`^image\\\\/(${regExpSafeNames.join('|')})$`);\n}\n/**\n * Creates a promise that fetches the image local source (Base64 or blob) and resolves with a `File` object.\n *\n * @param image Image whose source to fetch.\n * @returns A promise which resolves when an image source is fetched and converted to a `File` instance.\n * It resolves with a `File` object. If there were any errors during file processing, the promise will be rejected.\n */ function fetchLocalImage(image) {\n    return new Promise((resolve, reject)=>{\n        const imageSrc = image.getAttribute('src');\n        // Fetch works asynchronously and so does not block browser UI when processing data.\n        fetch(imageSrc).then((resource)=>resource.blob()).then((blob)=>{\n            const mimeType = getImageMimeType(blob, imageSrc);\n            const ext = mimeType.replace('image/', '');\n            const filename = `image.${ext}`;\n            const file = new File([\n                blob\n            ], filename, {\n                type: mimeType\n            });\n            resolve(file);\n        }).catch((err)=>{\n            // Fetch fails only, if it can't make a request due to a network failure or if anything prevented the request\n            // from completing, i.e. the Content Security Policy rules. It is not possible to detect the exact cause of failure,\n            // so we are just trying the fallback solution, if general TypeError is thrown.\n            return err && err.name === 'TypeError' ? convertLocalImageOnCanvas(imageSrc).then(resolve).catch(reject) : reject(err);\n        });\n    });\n}\n/**\n * Checks whether a given node is an image element with a local source (Base64 or blob).\n *\n * @param node The node to check.\n */ function isLocalImage(imageUtils, node) {\n    if (!imageUtils.isInlineImageView(node) || !node.getAttribute('src')) {\n        return false;\n    }\n    return !!node.getAttribute('src').match(/^data:image\\/\\w+;base64,/g) || !!node.getAttribute('src').match(/^blob:/g);\n}\n/**\n * Extracts an image type based on its blob representation or its source.\n * @param blob Image blob representation.\n * @param src Image `src` attribute value.\n */ function getImageMimeType(blob, src) {\n    if (blob.type) {\n        return blob.type;\n    } else if (src.match(/data:(image\\/\\w+);base64/)) {\n        return src.match(/data:(image\\/\\w+);base64/)[1].toLowerCase();\n    } else {\n        // Fallback to 'jpeg' as common extension.\n        return 'image/jpeg';\n    }\n}\n/**\n * Creates a promise that converts the image local source (Base64 or blob) to a blob using canvas and resolves\n * with a `File` object.\n * @param imageSrc Image `src` attribute value.\n * @returns A promise which resolves when an image source is converted to a `File` instance.\n * It resolves with a `File` object. If there were any errors during file processing, the promise will be rejected.\n */ function convertLocalImageOnCanvas(imageSrc) {\n    return getBlobFromCanvas(imageSrc).then((blob)=>{\n        const mimeType = getImageMimeType(blob, imageSrc);\n        const ext = mimeType.replace('image/', '');\n        const filename = `image.${ext}`;\n        return new File([\n            blob\n        ], filename, {\n            type: mimeType\n        });\n    });\n}\n/**\n * Creates a promise that resolves with a `Blob` object converted from the image source (Base64 or blob).\n * @param imageSrc Image `src` attribute value.\n */ function getBlobFromCanvas(imageSrc) {\n    return new Promise((resolve, reject)=>{\n        const image = global.document.createElement('img');\n        image.addEventListener('load', ()=>{\n            const canvas = global.document.createElement('canvas');\n            canvas.width = image.width;\n            canvas.height = image.height;\n            const ctx = canvas.getContext('2d');\n            ctx.drawImage(image, 0, 0);\n            canvas.toBlob((blob)=>blob ? resolve(blob) : reject());\n        });\n        image.addEventListener('error', ()=>reject());\n        image.src = imageSrc;\n    });\n}\n\n/**\n * The image upload button plugin.\n *\n * For a detailed overview, check the {@glink features/images/image-upload/image-upload Image upload feature} documentation.\n *\n * Adds the `'uploadImage'` button to the {@link module:ui/componentfactory~ComponentFactory UI component factory}\n * and also the `imageUpload` button as an alias for backward compatibility.\n *\n * Adds the `'menuBar:uploadImage'` menu button to the {@link module:ui/componentfactory~ComponentFactory UI component factory}.\n *\n * It also integrates with the `insertImage` toolbar component and `menuBar:insertImage` menu component, which are the default components\n * through which image upload is available.\n */ class ImageUploadUI extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageUploadUI';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const editor = this.editor;\n        // Setup `uploadImage` button and add `imageUpload` button as an alias for backward compatibility.\n        editor.ui.componentFactory.add('uploadImage', ()=>this._createToolbarButton());\n        editor.ui.componentFactory.add('imageUpload', ()=>this._createToolbarButton());\n        editor.ui.componentFactory.add('menuBar:uploadImage', ()=>this._createMenuBarButton('standalone'));\n        if (editor.plugins.has('ImageInsertUI')) {\n            editor.plugins.get('ImageInsertUI').registerIntegration({\n                name: 'upload',\n                observable: ()=>editor.commands.get('uploadImage'),\n                buttonViewCreator: ()=>this._createToolbarButton(),\n                formViewCreator: ()=>this._createDropdownButton(),\n                menuBarButtonViewCreator: (isOnly)=>this._createMenuBarButton(isOnly ? 'insertOnly' : 'insertNested')\n            });\n        }\n    }\n    /**\n\t * Creates the base for various kinds of the button component provided by this feature.\n\t */ _createButton(ButtonClass) {\n        const editor = this.editor;\n        const locale = editor.locale;\n        const command = editor.commands.get('uploadImage');\n        const imageTypes = editor.config.get('image.upload.types');\n        const imageTypesRegExp = createImageTypeRegExp(imageTypes);\n        const view = new ButtonClass(editor.locale);\n        const t = locale.t;\n        view.set({\n            acceptedType: imageTypes.map((type)=>`image/${type}`).join(','),\n            allowMultipleFiles: true,\n            label: t('Upload from computer'),\n            icon: icons.imageUpload\n        });\n        view.bind('isEnabled').to(command);\n        view.on('done', (evt, files)=>{\n            const imagesToUpload = Array.from(files).filter((file)=>imageTypesRegExp.test(file.type));\n            if (imagesToUpload.length) {\n                editor.execute('uploadImage', {\n                    file: imagesToUpload\n                });\n                editor.editing.view.focus();\n            }\n        });\n        return view;\n    }\n    /**\n\t * Creates a simple toolbar button, with an icon and a tooltip.\n\t */ _createToolbarButton() {\n        const t = this.editor.locale.t;\n        const imageInsertUI = this.editor.plugins.get('ImageInsertUI');\n        const uploadImageCommand = this.editor.commands.get('uploadImage');\n        const button = this._createButton(FileDialogButtonView);\n        button.tooltip = true;\n        button.bind('label').to(imageInsertUI, 'isImageSelected', uploadImageCommand, 'isAccessAllowed', (isImageSelected, isAccessAllowed)=>{\n            if (!isAccessAllowed) {\n                return t('You have no image upload permissions.');\n            }\n            return isImageSelected ? t('Replace image from computer') : t('Upload image from computer');\n        });\n        return button;\n    }\n    /**\n\t * Creates a button for the dropdown view, with an icon, text and no tooltip.\n\t */ _createDropdownButton() {\n        const t = this.editor.locale.t;\n        const imageInsertUI = this.editor.plugins.get('ImageInsertUI');\n        const button = this._createButton(FileDialogButtonView);\n        button.withText = true;\n        button.bind('label').to(imageInsertUI, 'isImageSelected', (isImageSelected)=>isImageSelected ? t('Replace from computer') : t('Upload from computer'));\n        button.on('execute', ()=>{\n            imageInsertUI.dropdownView.isOpen = false;\n        });\n        return button;\n    }\n    /**\n\t * Creates a button for the menu bar.\n\t */ _createMenuBarButton(type) {\n        const t = this.editor.locale.t;\n        const button = this._createButton(MenuBarMenuListItemFileDialogButtonView);\n        button.withText = true;\n        switch(type){\n            case 'standalone':\n                button.label = t('Image from computer');\n                break;\n            case 'insertOnly':\n                button.label = t('Image');\n                break;\n            case 'insertNested':\n                button.label = t('From computer');\n                break;\n        }\n        return button;\n    }\n}\n\n/**\n * The image upload progress plugin.\n * It shows a placeholder when the image is read from the disk and a progress bar while the image is uploading.\n */ class ImageUploadProgress extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageUploadProgress';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * The image placeholder that is displayed before real image data can be accessed.\n\t *\n\t * For the record, this image is a 1x1 px GIF with an aspect ratio set by CSS.\n\t */ placeholder;\n    /**\n\t * @inheritDoc\n\t */ constructor(editor){\n        super(editor);\n        this.placeholder = 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const editor = this.editor;\n        // Upload status change - update image's view according to that status.\n        if (editor.plugins.has('ImageBlockEditing')) {\n            editor.editing.downcastDispatcher.on('attribute:uploadStatus:imageBlock', this.uploadStatusChange);\n        }\n        if (editor.plugins.has('ImageInlineEditing')) {\n            editor.editing.downcastDispatcher.on('attribute:uploadStatus:imageInline', this.uploadStatusChange);\n        }\n    }\n    /**\n\t * This method is called each time the image `uploadStatus` attribute is changed.\n\t *\n\t * @param evt An object containing information about the fired event.\n\t * @param data Additional information about the change.\n\t */ uploadStatusChange = (evt, data, conversionApi)=>{\n        const editor = this.editor;\n        const modelImage = data.item;\n        const uploadId = modelImage.getAttribute('uploadId');\n        if (!conversionApi.consumable.consume(data.item, evt.name)) {\n            return;\n        }\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const fileRepository = editor.plugins.get(FileRepository);\n        const status = uploadId ? data.attributeNewValue : null;\n        const placeholder = this.placeholder;\n        const viewFigure = editor.editing.mapper.toViewElement(modelImage);\n        const viewWriter = conversionApi.writer;\n        if (status == 'reading') {\n            // Start \"appearing\" effect and show placeholder with infinite progress bar on the top\n            // while image is read from disk.\n            _startAppearEffect(viewFigure, viewWriter);\n            _showPlaceholder(imageUtils, placeholder, viewFigure, viewWriter);\n            return;\n        }\n        // Show progress bar on the top of the image when image is uploading.\n        if (status == 'uploading') {\n            const loader = fileRepository.loaders.get(uploadId);\n            // Start appear effect if needed - see https://github.com/ckeditor/ckeditor5-image/issues/191.\n            _startAppearEffect(viewFigure, viewWriter);\n            if (!loader) {\n                // There is no loader associated with uploadId - this means that image came from external changes.\n                // In such cases we still want to show the placeholder until image is fully uploaded.\n                // Show placeholder if needed - see https://github.com/ckeditor/ckeditor5-image/issues/191.\n                _showPlaceholder(imageUtils, placeholder, viewFigure, viewWriter);\n            } else {\n                // Hide placeholder and initialize progress bar showing upload progress.\n                _hidePlaceholder(viewFigure, viewWriter);\n                _showProgressBar(viewFigure, viewWriter, loader, editor.editing.view);\n                _displayLocalImage(imageUtils, viewFigure, viewWriter, loader);\n            }\n            return;\n        }\n        if (status == 'complete' && fileRepository.loaders.get(uploadId)) {\n            _showCompleteIcon(viewFigure, viewWriter, editor.editing.view);\n        }\n        // Clean up.\n        _hideProgressBar(viewFigure, viewWriter);\n        _hidePlaceholder(viewFigure, viewWriter);\n        _stopAppearEffect(viewFigure, viewWriter);\n    };\n}\n/**\n * Adds ck-appear class to the image figure if one is not already applied.\n */ function _startAppearEffect(viewFigure, writer) {\n    if (!viewFigure.hasClass('ck-appear')) {\n        writer.addClass('ck-appear', viewFigure);\n    }\n}\n/**\n * Removes ck-appear class to the image figure if one is not already removed.\n */ function _stopAppearEffect(viewFigure, writer) {\n    writer.removeClass('ck-appear', viewFigure);\n}\n/**\n * Shows placeholder together with infinite progress bar on given image figure.\n */ function _showPlaceholder(imageUtils, placeholder, viewFigure, writer) {\n    if (!viewFigure.hasClass('ck-image-upload-placeholder')) {\n        writer.addClass('ck-image-upload-placeholder', viewFigure);\n    }\n    const viewImg = imageUtils.findViewImgElement(viewFigure);\n    if (viewImg.getAttribute('src') !== placeholder) {\n        writer.setAttribute('src', placeholder, viewImg);\n    }\n    if (!_getUIElement(viewFigure, 'placeholder')) {\n        writer.insert(writer.createPositionAfter(viewImg), _createPlaceholder(writer));\n    }\n}\n/**\n * Removes placeholder together with infinite progress bar on given image figure.\n */ function _hidePlaceholder(viewFigure, writer) {\n    if (viewFigure.hasClass('ck-image-upload-placeholder')) {\n        writer.removeClass('ck-image-upload-placeholder', viewFigure);\n    }\n    _removeUIElement(viewFigure, writer, 'placeholder');\n}\n/**\n * Shows progress bar displaying upload progress.\n * Attaches it to the file loader to update when upload percentace is changed.\n */ function _showProgressBar(viewFigure, writer, loader, view) {\n    const progressBar = _createProgressBar(writer);\n    writer.insert(writer.createPositionAt(viewFigure, 'end'), progressBar);\n    // Update progress bar width when uploadedPercent is changed.\n    loader.on('change:uploadedPercent', (evt, name, value)=>{\n        view.change((writer)=>{\n            writer.setStyle('width', value + '%', progressBar);\n        });\n    });\n}\n/**\n * Hides upload progress bar.\n */ function _hideProgressBar(viewFigure, writer) {\n    _removeUIElement(viewFigure, writer, 'progressBar');\n}\n/**\n * Shows complete icon and hides after a certain amount of time.\n */ function _showCompleteIcon(viewFigure, writer, view) {\n    const completeIcon = writer.createUIElement('div', {\n        class: 'ck-image-upload-complete-icon'\n    });\n    writer.insert(writer.createPositionAt(viewFigure, 'end'), completeIcon);\n    setTimeout(()=>{\n        view.change((writer)=>writer.remove(writer.createRangeOn(completeIcon)));\n    }, 3000);\n}\n/**\n * Create progress bar element using {@link module:engine/view/uielement~UIElement}.\n */ function _createProgressBar(writer) {\n    const progressBar = writer.createUIElement('div', {\n        class: 'ck-progress-bar'\n    });\n    writer.setCustomProperty('progressBar', true, progressBar);\n    return progressBar;\n}\n/**\n * Create placeholder element using {@link module:engine/view/uielement~UIElement}.\n */ function _createPlaceholder(writer) {\n    const placeholder = writer.createUIElement('div', {\n        class: 'ck-upload-placeholder-loader'\n    });\n    writer.setCustomProperty('placeholder', true, placeholder);\n    return placeholder;\n}\n/**\n * Returns {@link module:engine/view/uielement~UIElement} of given unique property from image figure element.\n * Returns `undefined` if element is not found.\n */ function _getUIElement(imageFigure, uniqueProperty) {\n    for (const child of imageFigure.getChildren()){\n        if (child.getCustomProperty(uniqueProperty)) {\n            return child;\n        }\n    }\n}\n/**\n * Removes {@link module:engine/view/uielement~UIElement} of given unique property from image figure element.\n */ function _removeUIElement(viewFigure, writer, uniqueProperty) {\n    const element = _getUIElement(viewFigure, uniqueProperty);\n    if (element) {\n        writer.remove(writer.createRangeOn(element));\n    }\n}\n/**\n * Displays local data from file loader.\n */ function _displayLocalImage(imageUtils, viewFigure, writer, loader) {\n    if (loader.data) {\n        const viewImg = imageUtils.findViewImgElement(viewFigure);\n        writer.setAttribute('src', loader.data, viewImg);\n    }\n}\n\n/**\n * @module image/imageupload/uploadimagecommand\n */ /**\n * The upload image command.\n *\n * The command is registered by the {@link module:image/imageupload/imageuploadediting~ImageUploadEditing} plugin as `uploadImage`\n * and it is also available via aliased `imageUpload` name.\n *\n * In order to upload an image at the current selection position\n * (according to the {@link module:widget/utils~findOptimalInsertionRange} algorithm),\n * execute the command and pass the native image file instance:\n *\n * ```ts\n * this.listenTo( editor.editing.view.document, 'clipboardInput', ( evt, data ) => {\n * \t// Assuming that only images were pasted:\n * \tconst images = Array.from( data.dataTransfer.files );\n *\n * \t// Upload the first image:\n * \teditor.execute( 'uploadImage', { file: images[ 0 ] } );\n * } );\n * ```\n *\n * It is also possible to insert multiple images at once:\n *\n * ```ts\n * editor.execute( 'uploadImage', {\n * \tfile: [\n * \t\tfile1,\n * \t\tfile2\n * \t]\n * } );\n * ```\n */ class UploadImageCommand extends Command {\n    /**\n\t * Creates an instance of the `imageUlpoad` command. When executed, the command upload one of\n\t * the currently selected image from computer.\n\t *\n\t * @param editor The editor instance.\n\t */ constructor(editor){\n        super(editor);\n        this.set('isAccessAllowed', true);\n    }\n    /**\n\t * @inheritDoc\n\t */ refresh() {\n        const editor = this.editor;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const selectedElement = editor.model.document.selection.getSelectedElement();\n        // TODO: This needs refactoring.\n        this.isEnabled = imageUtils.isImageAllowed() || imageUtils.isImage(selectedElement);\n    }\n    /**\n\t * Executes the command.\n\t *\n\t * @fires execute\n\t * @param options Options for the executed command.\n\t * @param options.file The image file or an array of image files to upload.\n\t */ execute(options) {\n        const files = toArray(options.file);\n        const selection = this.editor.model.document.selection;\n        const imageUtils = this.editor.plugins.get('ImageUtils');\n        // In case of multiple files, each file (starting from the 2nd) will be inserted at a position that\n        // follows the previous one. That will move the selection and, to stay on the safe side and make sure\n        // all images inherit the same selection attributes, they are collected beforehand.\n        //\n        // Applying these attributes ensures, for instance, that inserting an (inline) image into a link does\n        // not split that link but preserves its continuity.\n        //\n        // Note: Selection attributes that do not make sense for images will be filtered out by insertImage() anyway.\n        const selectionAttributes = Object.fromEntries(selection.getAttributes());\n        files.forEach((file, index)=>{\n            const selectedElement = selection.getSelectedElement();\n            // Inserting of an inline image replace the selected element and make a selection on the inserted image.\n            // Therefore inserting multiple inline images requires creating position after each element.\n            if (index && selectedElement && imageUtils.isImage(selectedElement)) {\n                const position = this.editor.model.createPositionAfter(selectedElement);\n                this._uploadImage(file, selectionAttributes, position);\n            } else {\n                this._uploadImage(file, selectionAttributes);\n            }\n        });\n    }\n    /**\n\t * Handles uploading single file.\n\t */ _uploadImage(file, attributes, position) {\n        const editor = this.editor;\n        const fileRepository = editor.plugins.get(FileRepository);\n        const loader = fileRepository.createLoader(file);\n        const imageUtils = editor.plugins.get('ImageUtils');\n        // Do not throw when upload adapter is not set. FileRepository will log an error anyway.\n        if (!loader) {\n            return;\n        }\n        imageUtils.insertImage({\n            ...attributes,\n            uploadId: loader.id\n        }, position);\n    }\n}\n\n/**\n * The editing part of the image upload feature. It registers the `'uploadImage'` command\n * and the `imageUpload` command as an aliased name.\n *\n * When an image is uploaded, it fires the {@link ~ImageUploadEditing#event:uploadComplete `uploadComplete`} event\n * that allows adding custom attributes to the {@link module:engine/model/element~Element image element}.\n */ class ImageUploadEditing extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            FileRepository,\n            Notification,\n            ClipboardPipeline,\n            ImageUtils\n        ];\n    }\n    static get pluginName() {\n        return 'ImageUploadEditing';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * An internal mapping of {@link module:upload/filerepository~FileLoader#id file loader UIDs} and\n\t * model elements during the upload.\n\t *\n\t * Model element of the uploaded image can change, for instance, when {@link module:image/image/imagetypecommand~ImageTypeCommand}\n\t * is executed as a result of adding caption or changing image style. As a result, the upload logic must keep track of the model\n\t * element (reference) and resolve the upload for the correct model element (instead of the one that landed in the `$graveyard`\n\t * after image type changed).\n\t */ _uploadImageElements;\n    /**\n\t * An internal mapping of {@link module:upload/filerepository~FileLoader#id file loader UIDs} and\n\t * upload responses for handling images dragged during their upload process. When such images are later\n\t * dropped, their original upload IDs no longer exist in the registry (as the original upload completed).\n\t * This map preserves the upload responses to properly handle such cases.\n\t */ _uploadedImages = new Map();\n    /**\n\t * @inheritDoc\n\t */ constructor(editor){\n        super(editor);\n        editor.config.define('image', {\n            upload: {\n                types: [\n                    'jpeg',\n                    'png',\n                    'gif',\n                    'bmp',\n                    'webp',\n                    'tiff'\n                ]\n            }\n        });\n        this._uploadImageElements = new Map();\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const editor = this.editor;\n        const doc = editor.model.document;\n        const conversion = editor.conversion;\n        const fileRepository = editor.plugins.get(FileRepository);\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const clipboardPipeline = editor.plugins.get('ClipboardPipeline');\n        const imageTypes = createImageTypeRegExp(editor.config.get('image.upload.types'));\n        const uploadImageCommand = new UploadImageCommand(editor);\n        // Register `uploadImage` command and add `imageUpload` command as an alias for backward compatibility.\n        editor.commands.add('uploadImage', uploadImageCommand);\n        editor.commands.add('imageUpload', uploadImageCommand);\n        // Register upcast converter for uploadId.\n        conversion.for('upcast').attributeToAttribute({\n            view: {\n                name: 'img',\n                key: 'uploadId'\n            },\n            model: 'uploadId'\n        })// Handle the case when the image is not fully uploaded yet but it's being moved.\n        // See more: https://github.com/ckeditor/ckeditor5/pull/17327\n        .add((dispatcher)=>dispatcher.on('element:img', (evt, data, conversionApi)=>{\n                if (!conversionApi.consumable.test(data.viewItem, {\n                    attributes: [\n                        'data-ck-upload-id'\n                    ]\n                })) {\n                    return;\n                }\n                const uploadId = data.viewItem.getAttribute('data-ck-upload-id');\n                if (!uploadId) {\n                    return;\n                }\n                const [modelElement] = Array.from(data.modelRange.getItems({\n                    shallow: true\n                }));\n                const loader = fileRepository.loaders.get(uploadId);\n                if (modelElement) {\n                    // Handle case when `uploadId` is set on the image element but the loader is not present in the registry.\n                    // It may happen when the image was successfully uploaded and the loader was removed from the registry.\n                    // It's still present in the `_uploadedImages` map though. It's why we do not place this line in the condition below.\n                    conversionApi.writer.setAttribute('uploadId', uploadId, modelElement);\n                    conversionApi.consumable.consume(data.viewItem, {\n                        attributes: [\n                            'data-ck-upload-id'\n                        ]\n                    });\n                    if (loader && loader.data) {\n                        conversionApi.writer.setAttribute('uploadStatus', loader.status, modelElement);\n                    }\n                }\n            }, {\n                priority: 'low'\n            }));\n        // Handle pasted images.\n        // For every image file, a new file loader is created and a placeholder image is\n        // inserted into the content. Then, those images are uploaded once they appear in the model\n        // (see Document#change listener below).\n        this.listenTo(editor.editing.view.document, 'clipboardInput', (evt, data)=>{\n            // Skip if non empty HTML data is included.\n            // https://github.com/ckeditor/ckeditor5-upload/issues/68\n            if (isHtmlIncluded(data.dataTransfer)) {\n                return;\n            }\n            const images = Array.from(data.dataTransfer.files).filter((file)=>{\n                // See https://github.com/ckeditor/ckeditor5-image/pull/254.\n                if (!file) {\n                    return false;\n                }\n                return imageTypes.test(file.type);\n            });\n            if (!images.length) {\n                return;\n            }\n            evt.stop();\n            editor.model.change((writer)=>{\n                // Set selection to paste target.\n                if (data.targetRanges) {\n                    writer.setSelection(data.targetRanges.map((viewRange)=>editor.editing.mapper.toModelRange(viewRange)));\n                }\n                editor.execute('uploadImage', {\n                    file: images\n                });\n            });\n            const uploadImageCommand = editor.commands.get('uploadImage');\n            if (!uploadImageCommand.isAccessAllowed) {\n                const notification = editor.plugins.get('Notification');\n                const t = editor.locale.t;\n                // eslint-disable-next-line max-len\n                notification.showWarning(t('You have no image upload permissions.'), {\n                    namespace: 'image'\n                });\n            }\n        });\n        // Handle HTML pasted with images with base64 or blob sources.\n        // For every image file, a new file loader is created and a placeholder image is\n        // inserted into the content. Then, those images are uploaded once they appear in the model\n        // (see Document#change listener below).\n        this.listenTo(clipboardPipeline, 'inputTransformation', (evt, data)=>{\n            const fetchableImages = Array.from(editor.editing.view.createRangeIn(data.content)).map((value)=>value.item).filter((viewElement)=>isLocalImage(imageUtils, viewElement) && !viewElement.getAttribute('uploadProcessed')).map((viewElement)=>{\n                return {\n                    promise: fetchLocalImage(viewElement),\n                    imageElement: viewElement\n                };\n            });\n            if (!fetchableImages.length) {\n                return;\n            }\n            const writer = new UpcastWriter(editor.editing.view.document);\n            for (const fetchableImage of fetchableImages){\n                // Set attribute marking that the image was processed already.\n                writer.setAttribute('uploadProcessed', true, fetchableImage.imageElement);\n                const loader = fileRepository.createLoader(fetchableImage.promise);\n                if (loader) {\n                    writer.setAttribute('src', '', fetchableImage.imageElement);\n                    writer.setAttribute('uploadId', loader.id, fetchableImage.imageElement);\n                }\n            }\n        });\n        // Prevents from the browser redirecting to the dropped image.\n        editor.editing.view.document.on('dragover', (evt, data)=>{\n            data.preventDefault();\n        });\n        // Upload placeholder images that appeared in the model.\n        doc.on('change', ()=>{\n            // Note: Reversing changes to start with insertions and only then handle removals. If it was the other way around,\n            // loaders for **all** images that land in the $graveyard would abort while in fact only those that were **not** replaced\n            // by other images should be aborted.\n            const changes = doc.differ.getChanges({\n                includeChangesInGraveyard: true\n            }).reverse();\n            const insertedImagesIds = new Set();\n            for (const entry of changes){\n                if (entry.type == 'insert' && entry.name != '$text') {\n                    const item = entry.position.nodeAfter;\n                    const isInsertedInGraveyard = entry.position.root.rootName == '$graveyard';\n                    for (const imageElement of getImagesFromChangeItem(editor, item)){\n                        // Check if the image element still has upload id.\n                        const uploadId = imageElement.getAttribute('uploadId');\n                        if (!uploadId) {\n                            continue;\n                        }\n                        // Check if the image is loaded on this client.\n                        const loader = fileRepository.loaders.get(uploadId);\n                        if (!loader) {\n                            // If the loader does not exist, it means that the image was already uploaded\n                            // and the loader promise was removed from the registry. In that scenario we need\n                            // to restore response object from the internal map.\n                            if (!isInsertedInGraveyard && this._uploadedImages.has(uploadId)) {\n                                // Fire `uploadComplete` to set proper attributes on the image element.\n                                editor.model.enqueueChange({\n                                    isUndoable: false\n                                }, (writer)=>{\n                                    writer.setAttribute('uploadStatus', 'complete', imageElement);\n                                    this.fire('uploadComplete', {\n                                        data: this._uploadedImages.get(uploadId),\n                                        imageElement: imageElement\n                                    });\n                                });\n                            // While it makes sense to remove the image from the `_uploadedImages` map here,\n                            // it's counterintuitive for the user that pastes image in uploading several times.\n                            // It'll work the first time, but the next time the image will be empty because the\n                            // `_uploadedImages` no longer contain the response.\n                            }\n                            continue;\n                        }\n                        if (isInsertedInGraveyard) {\n                            // If the image was inserted to the graveyard for good (**not** replaced by another image),\n                            // only then abort the loading process.\n                            if (!insertedImagesIds.has(uploadId)) {\n                                // ... but abort it only if all remain images that share the same loader are in the graveyard too.\n                                // This is to prevent situation when we have two images in uploading state and one of them is being\n                                // placed in the graveyard (e.g. using undo). The other one should not be aborted.\n                                const allImagesThatShareUploaderInGraveyard = Array.from(this._uploadImageElements.get(uploadId)).every((element)=>element.root.rootName == '$graveyard');\n                                if (allImagesThatShareUploaderInGraveyard) {\n                                    loader.abort();\n                                }\n                            }\n                        } else {\n                            // Remember the upload id of the inserted image. If it acted as a replacement for another\n                            // image (which landed in the $graveyard), the related loader will not be aborted because\n                            // this is still the same image upload.\n                            insertedImagesIds.add(uploadId);\n                            // Keep the mapping between the upload ID and the image model element so the upload\n                            // can later resolve in the context of the correct model element. The model element could\n                            // change for the same upload if one image was replaced by another (e.g. image type was changed),\n                            // so this may also replace an existing mapping.\n                            if (!this._uploadImageElements.has(uploadId)) {\n                                this._uploadImageElements.set(uploadId, new Set([\n                                    imageElement\n                                ]));\n                            } else {\n                                this._uploadImageElements.get(uploadId).add(imageElement);\n                            }\n                            if (loader.status == 'idle') {\n                                // If the image was inserted into content and has not been loaded yet, start loading it.\n                                this._readAndUpload(loader);\n                            }\n                        }\n                    }\n                }\n            }\n        });\n        // Set the default handler for feeding the image element with `src` and `srcset` attributes.\n        // Also set the natural `width` and `height` attributes (if not already set).\n        this.on('uploadComplete', (evt, { imageElement, data })=>{\n            const urls = data.urls ? data.urls : data;\n            this.editor.model.change((writer)=>{\n                writer.setAttribute('src', urls.default, imageElement);\n                this._parseAndSetSrcsetAttributeOnImage(urls, imageElement, writer);\n                imageUtils.setImageNaturalSizeAttributes(imageElement);\n            });\n        }, {\n            priority: 'low'\n        });\n    }\n    /**\n\t * @inheritDoc\n\t */ afterInit() {\n        const schema = this.editor.model.schema;\n        // Setup schema to allow uploadId and uploadStatus for images.\n        // Wait for ImageBlockEditing or ImageInlineEditing to register their elements first,\n        // that's why doing this in afterInit() instead of init().\n        if (this.editor.plugins.has('ImageBlockEditing')) {\n            schema.extend('imageBlock', {\n                allowAttributes: [\n                    'uploadId',\n                    'uploadStatus'\n                ]\n            });\n            this._registerConverters('imageBlock');\n        }\n        if (this.editor.plugins.has('ImageInlineEditing')) {\n            schema.extend('imageInline', {\n                allowAttributes: [\n                    'uploadId',\n                    'uploadStatus'\n                ]\n            });\n            this._registerConverters('imageInline');\n        }\n    }\n    /**\n\t * Reads and uploads an image.\n\t *\n\t * The image is read from the disk and as a Base64-encoded string it is set temporarily to\n\t * `image[src]`. When the image is successfully uploaded, the temporary data is replaced with the target\n\t * image's URL (the URL to the uploaded image on the server).\n\t */ _readAndUpload(loader) {\n        const editor = this.editor;\n        const model = editor.model;\n        const t = editor.locale.t;\n        const fileRepository = editor.plugins.get(FileRepository);\n        const notification = editor.plugins.get(Notification);\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const imageUploadElements = this._uploadImageElements;\n        model.enqueueChange({\n            isUndoable: false\n        }, (writer)=>{\n            const elements = imageUploadElements.get(loader.id);\n            for (const element of elements){\n                writer.setAttribute('uploadStatus', 'reading', element);\n            }\n        });\n        return loader.read().then(()=>{\n            const promise = loader.upload();\n            if (editor.ui) {\n                editor.ui.ariaLiveAnnouncer.announce(t('Uploading image'));\n            }\n            for (const imageElement of imageUploadElements.get(loader.id)){\n                // Force re–paint in Safari. Without it, the image will display with a wrong size.\n                // https://github.com/ckeditor/ckeditor5/issues/1975\n                /* istanbul ignore next -- @preserve */ if (env.isSafari) {\n                    const viewFigure = editor.editing.mapper.toViewElement(imageElement);\n                    const viewImg = imageUtils.findViewImgElement(viewFigure);\n                    editor.editing.view.once('render', ()=>{\n                        // Early returns just to be safe. There might be some code ran\n                        // in between the outer scope and this callback.\n                        if (!viewImg.parent) {\n                            return;\n                        }\n                        const domFigure = editor.editing.view.domConverter.mapViewToDom(viewImg.parent);\n                        if (!domFigure) {\n                            return;\n                        }\n                        const originalDisplay = domFigure.style.display;\n                        domFigure.style.display = 'none';\n                        // Make sure this line will never be removed during minification for having \"no effect\".\n                        domFigure._ckHack = domFigure.offsetHeight;\n                        domFigure.style.display = originalDisplay;\n                    });\n                }\n                model.enqueueChange({\n                    isUndoable: false\n                }, (writer)=>{\n                    writer.setAttribute('uploadStatus', 'uploading', imageElement);\n                });\n            }\n            return promise;\n        }).then((data)=>{\n            model.enqueueChange({\n                isUndoable: false\n            }, (writer)=>{\n                for (const imageElement of imageUploadElements.get(loader.id)){\n                    writer.setAttribute('uploadStatus', 'complete', imageElement);\n                    this.fire('uploadComplete', {\n                        data,\n                        imageElement\n                    });\n                }\n                if (editor.ui) {\n                    editor.ui.ariaLiveAnnouncer.announce(t('Image upload complete'));\n                }\n                this._uploadedImages.set(loader.id, data);\n            });\n            clean();\n        }).catch((error)=>{\n            if (editor.ui) {\n                editor.ui.ariaLiveAnnouncer.announce(t('Error during image upload'));\n            }\n            // If status is not 'error' nor 'aborted' - throw error because it means that something else went wrong,\n            // it might be generic error and it would be real pain to find what is going on.\n            if (loader.status !== 'error' && loader.status !== 'aborted') {\n                throw error;\n            }\n            // Might be 'aborted'.\n            if (loader.status == 'error' && error) {\n                notification.showWarning(error, {\n                    title: t('Upload failed'),\n                    namespace: 'upload'\n                });\n            }\n            // Permanently remove image from insertion batch.\n            model.enqueueChange({\n                isUndoable: false\n            }, (writer)=>{\n                for (const imageElement of imageUploadElements.get(loader.id)){\n                    // Handle situation when the image has been removed and then `abort` exception was thrown.\n                    // See: https://github.com/cksource/ckeditor5-commercial/issues/6817\n                    if (imageElement.root.rootName !== '$graveyard') {\n                        writer.remove(imageElement);\n                    }\n                }\n            });\n            clean();\n        });\n        function clean() {\n            model.enqueueChange({\n                isUndoable: false\n            }, (writer)=>{\n                for (const imageElement of imageUploadElements.get(loader.id)){\n                    writer.removeAttribute('uploadId', imageElement);\n                    writer.removeAttribute('uploadStatus', imageElement);\n                }\n                imageUploadElements.delete(loader.id);\n            });\n            fileRepository.destroyLoader(loader);\n        }\n    }\n    /**\n\t * Creates the `srcset` attribute based on a given file upload response and sets it as an attribute to a specific image element.\n\t *\n\t * @param data Data object from which `srcset` will be created.\n\t * @param image The image element on which the `srcset` attribute will be set.\n\t */ _parseAndSetSrcsetAttributeOnImage(data, image, writer) {\n        // Srcset attribute for responsive images support.\n        let maxWidth = 0;\n        const srcsetAttribute = Object.keys(data)// Filter out keys that are not integers.\n        .filter((key)=>{\n            const width = parseInt(key, 10);\n            if (!isNaN(width)) {\n                maxWidth = Math.max(maxWidth, width);\n                return true;\n            }\n        })// Convert each key to srcset entry.\n        .map((key)=>`${data[key]} ${key}w`)// Join all entries.\n        .join(', ');\n        if (srcsetAttribute != '') {\n            const attributes = {\n                srcset: srcsetAttribute\n            };\n            if (!image.hasAttribute('width') && !image.hasAttribute('height')) {\n                attributes.width = maxWidth;\n            }\n            writer.setAttributes(attributes, image);\n        }\n    }\n    /**\n\t * Registers image upload converters.\n\t *\n\t * @param imageType The type of the image.\n\t */ _registerConverters(imageType) {\n        const { conversion, plugins } = this.editor;\n        const fileRepository = plugins.get(FileRepository);\n        const imageUtils = plugins.get(ImageUtils);\n        // It sets `data-ck-upload-id` attribute on the view image elements that are not fully uploaded.\n        // It avoids the situation when image disappears when it's being moved and upload is not finished yet.\n        // See more: https://github.com/ckeditor/ckeditor5/issues/16967\n        conversion.for('dataDowncast').add((dispatcher)=>{\n            dispatcher.on(`attribute:uploadId:${imageType}`, (evt, data, conversionApi)=>{\n                if (!conversionApi.consumable.test(data.item, evt.name)) {\n                    return;\n                }\n                const loader = fileRepository.loaders.get(data.attributeNewValue);\n                if (!loader || !loader.data) {\n                    return null;\n                }\n                const viewElement = conversionApi.mapper.toViewElement(data.item);\n                const img = imageUtils.findViewImgElement(viewElement);\n                if (img) {\n                    conversionApi.consumable.consume(data.item, evt.name);\n                    conversionApi.writer.setAttribute('data-ck-upload-id', loader.id, img);\n                }\n            });\n        });\n    }\n}\n/**\n * Returns `true` if non-empty `text/html` is included in the data transfer.\n */ function isHtmlIncluded(dataTransfer) {\n    return Array.from(dataTransfer.types).includes('text/html') && dataTransfer.getData('text/html') !== '';\n}\nfunction getImagesFromChangeItem(editor, item) {\n    const imageUtils = editor.plugins.get('ImageUtils');\n    return Array.from(editor.model.createRangeOn(item)).filter((value)=>imageUtils.isImage(value.item)).map((value)=>value.item);\n}\n\n/**\n * The image upload plugin.\n *\n * For a detailed overview, check the {@glink features/images/image-upload/image-upload image upload feature} documentation.\n *\n * This plugin does not do anything directly, but it loads a set of specific plugins to enable image uploading:\n *\n * * {@link module:image/imageupload/imageuploadediting~ImageUploadEditing},\n * * {@link module:image/imageupload/imageuploadui~ImageUploadUI},\n * * {@link module:image/imageupload/imageuploadprogress~ImageUploadProgress}.\n */ class ImageUpload extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageUpload';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageUploadEditing,\n            ImageUploadUI,\n            ImageUploadProgress\n        ];\n    }\n}\n\n/**\n * The insert an image via URL view.\n *\n * See {@link module:image/imageinsert/imageinsertviaurlui~ImageInsertViaUrlUI}.\n */ class ImageInsertUrlView extends View {\n    /**\n\t * The URL input field view.\n\t */ urlInputView;\n    /**\n\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\n\t */ keystrokes;\n    /**\n\t * Creates a view for the dropdown panel of {@link module:image/imageinsert/imageinsertui~ImageInsertUI}.\n\t *\n\t * @param locale The localization services instance.\n\t */ constructor(locale){\n        super(locale);\n        this.set('imageURLInputValue', '');\n        this.set('isImageSelected', false);\n        this.set('isEnabled', true);\n        this.keystrokes = new KeystrokeHandler();\n        this.urlInputView = this._createUrlInputView();\n        this.setTemplate({\n            tag: 'form',\n            attributes: {\n                class: [\n                    'ck',\n                    'ck-image-insert-url'\n                ],\n                tabindex: '-1'\n            },\n            children: [\n                this.urlInputView,\n                {\n                    tag: 'div',\n                    attributes: {\n                        class: [\n                            'ck',\n                            'ck-image-insert-url__action-row'\n                        ]\n                    }\n                }\n            ]\n        });\n    }\n    /**\n\t * @inheritDoc\n\t */ render() {\n        super.render();\n        submitHandler({\n            view: this\n        });\n        // Start listening for the keystrokes coming from #element.\n        this.keystrokes.listenTo(this.element);\n    }\n    /**\n\t * @inheritDoc\n\t */ destroy() {\n        super.destroy();\n        this.keystrokes.destroy();\n    }\n    /**\n\t * Creates the {@link #urlInputView}.\n\t */ _createUrlInputView() {\n        const locale = this.locale;\n        const t = locale.t;\n        const urlInputView = new LabeledFieldView(locale, createLabeledInputText);\n        urlInputView.bind('label').to(this, 'isImageSelected', (value)=>value ? t('Update image URL') : t('Insert image via URL'));\n        urlInputView.bind('isEnabled').to(this);\n        urlInputView.fieldView.inputMode = 'url';\n        urlInputView.fieldView.placeholder = 'https://example.com/image.png';\n        urlInputView.fieldView.bind('value').to(this, 'imageURLInputValue', (value)=>value || '');\n        urlInputView.fieldView.on('input', ()=>{\n            this.imageURLInputValue = urlInputView.fieldView.element.value.trim();\n        });\n        return urlInputView;\n    }\n    /**\n\t * Focuses the view.\n\t */ focus() {\n        this.urlInputView.focus();\n    }\n}\n\n/**\n * The image insert via URL plugin (UI part).\n *\n * The plugin introduces two UI components to the {@link module:ui/componentfactory~ComponentFactory UI component factory}:\n *\n * * the `'insertImageViaUrl'` toolbar button,\n * * the `'menuBar:insertImageViaUrl'` menu bar component.\n *\n * It also integrates with the `insertImage` toolbar component and `menuBar:insertImage` menu component, which are default components\n * through which inserting image via URL is available.\n */ class ImageInsertViaUrlUI extends Plugin {\n    _imageInsertUI;\n    _formView;\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageInsertViaUrlUI';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageInsertUI,\n            Dialog\n        ];\n    }\n    init() {\n        this.editor.ui.componentFactory.add('insertImageViaUrl', ()=>this._createToolbarButton());\n        this.editor.ui.componentFactory.add('menuBar:insertImageViaUrl', ()=>this._createMenuBarButton('standalone'));\n    }\n    /**\n\t * @inheritDoc\n\t */ afterInit() {\n        this._imageInsertUI = this.editor.plugins.get('ImageInsertUI');\n        this._imageInsertUI.registerIntegration({\n            name: 'url',\n            observable: ()=>this.editor.commands.get('insertImage'),\n            buttonViewCreator: ()=>this._createToolbarButton(),\n            formViewCreator: ()=>this._createDropdownButton(),\n            menuBarButtonViewCreator: (isOnly)=>this._createMenuBarButton(isOnly ? 'insertOnly' : 'insertNested')\n        });\n    }\n    /**\n\t * Creates the base for various kinds of the button component provided by this feature.\n\t */ _createInsertUrlButton(ButtonClass) {\n        const button = new ButtonClass(this.editor.locale);\n        button.icon = icons.imageUrl;\n        button.on('execute', ()=>{\n            this._showModal();\n        });\n        return button;\n    }\n    /**\n\t * Creates a simple toolbar button, with an icon and a tooltip.\n\t */ _createToolbarButton() {\n        const t = this.editor.locale.t;\n        const button = this._createInsertUrlButton(ButtonView);\n        button.tooltip = true;\n        button.bind('label').to(this._imageInsertUI, 'isImageSelected', (isImageSelected)=>isImageSelected ? t('Update image URL') : t('Insert image via URL'));\n        return button;\n    }\n    /**\n\t * Creates a button for the dropdown view, with an icon, text and no tooltip.\n\t */ _createDropdownButton() {\n        const t = this.editor.locale.t;\n        const button = this._createInsertUrlButton(ButtonView);\n        button.withText = true;\n        button.bind('label').to(this._imageInsertUI, 'isImageSelected', (isImageSelected)=>isImageSelected ? t('Update image URL') : t('Insert via URL'));\n        return button;\n    }\n    /**\n\t * Creates a button for the menu bar.\n\t */ _createMenuBarButton(type) {\n        const t = this.editor.locale.t;\n        const button = this._createInsertUrlButton(MenuBarMenuListItemButtonView);\n        button.withText = true;\n        switch(type){\n            case 'standalone':\n                button.label = t('Image via URL');\n                break;\n            case 'insertOnly':\n                button.label = t('Image');\n                break;\n            case 'insertNested':\n                button.label = t('Via URL');\n                break;\n        }\n        return button;\n    }\n    /**\n\t * Creates the form view used to submit the image URL.\n\t */ _createInsertUrlView() {\n        const editor = this.editor;\n        const locale = editor.locale;\n        const replaceImageSourceCommand = editor.commands.get('replaceImageSource');\n        const insertImageCommand = editor.commands.get('insertImage');\n        const imageInsertUrlView = new ImageInsertUrlView(locale);\n        imageInsertUrlView.bind('isImageSelected').to(this._imageInsertUI);\n        imageInsertUrlView.bind('isEnabled').toMany([\n            insertImageCommand,\n            replaceImageSourceCommand\n        ], 'isEnabled', (...isEnabled)=>isEnabled.some((isCommandEnabled)=>isCommandEnabled));\n        return imageInsertUrlView;\n    }\n    /**\n\t * Shows the insert image via URL form view in a modal.\n\t */ _showModal() {\n        const editor = this.editor;\n        const locale = editor.locale;\n        const t = locale.t;\n        const dialog = editor.plugins.get('Dialog');\n        if (!this._formView) {\n            this._formView = this._createInsertUrlView();\n            this._formView.on('submit', ()=>this._handleSave());\n        }\n        const replaceImageSourceCommand = editor.commands.get('replaceImageSource');\n        this._formView.imageURLInputValue = replaceImageSourceCommand.value || '';\n        dialog.show({\n            id: 'insertImageViaUrl',\n            title: this._imageInsertUI.isImageSelected ? t('Update image URL') : t('Insert image via URL'),\n            isModal: true,\n            content: this._formView,\n            actionButtons: [\n                {\n                    label: t('Cancel'),\n                    withText: true,\n                    onExecute: ()=>dialog.hide()\n                },\n                {\n                    label: t('Accept'),\n                    class: 'ck-button-action',\n                    withText: true,\n                    onExecute: ()=>this._handleSave()\n                }\n            ]\n        });\n    }\n    /**\n\t * Executes appropriate command depending on selection and form value.\n\t */ _handleSave() {\n        const replaceImageSourceCommand = this.editor.commands.get('replaceImageSource');\n        // If an image element is currently selected, we want to replace its source attribute (instead of inserting a new image).\n        // We detect if an image is selected by checking `replaceImageSource` command state.\n        if (replaceImageSourceCommand.isEnabled) {\n            this.editor.execute('replaceImageSource', {\n                source: this._formView.imageURLInputValue\n            });\n        } else {\n            this.editor.execute('insertImage', {\n                source: this._formView.imageURLInputValue\n            });\n        }\n        this.editor.plugins.get('Dialog').hide();\n    }\n}\n\n/**\n * The image insert via URL plugin.\n *\n * For a detailed overview, check the {@glink features/images/images-inserting\n * Insert images via source URL} documentation.\n *\n * This plugin does not do anything directly, but it loads a set of specific plugins\n * to enable image inserting via implemented integrations:\n *\n * * {@link module:image/imageinsert/imageinsertui~ImageInsertUI},\n */ class ImageInsertViaUrl extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageInsertViaUrl';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageInsertViaUrlUI,\n            ImageInsertUI\n        ];\n    }\n}\n\n/**\n * The image insert plugin.\n *\n * For a detailed overview, check the {@glink features/images/image-upload/image-upload Image upload feature}\n * and {@glink features/images/images-inserting Insert images via source URL} documentation.\n *\n * This plugin does not do anything directly, but it loads a set of specific plugins\n * to enable image uploading or inserting via implemented integrations:\n *\n * * {@link module:image/imageupload~ImageUpload}\n * * {@link module:image/imageinsert/imageinsertui~ImageInsertUI}\n */ class ImageInsert extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageInsert';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageUpload,\n            ImageInsertViaUrl,\n            ImageInsertUI\n        ];\n    }\n}\n\n/**\n * The resize image command. Currently, it only supports the width attribute.\n */ class ResizeImageCommand extends Command {\n    /**\n\t * @inheritDoc\n\t */ refresh() {\n        const editor = this.editor;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const element = imageUtils.getClosestSelectedImageElement(editor.model.document.selection);\n        this.isEnabled = !!element;\n        if (!element || !element.hasAttribute('resizedWidth')) {\n            this.value = null;\n        } else {\n            this.value = {\n                width: element.getAttribute('resizedWidth'),\n                height: null\n            };\n        }\n    }\n    /**\n\t * Executes the command.\n\t *\n\t * ```ts\n\t * // Sets the width to 50%:\n\t * editor.execute( 'resizeImage', { width: '50%' } );\n\t *\n\t * // Removes the width attribute:\n\t * editor.execute( 'resizeImage', { width: null } );\n\t * ```\n\t *\n\t * @param options\n\t * @param options.width The new width of the image.\n\t * @fires execute\n\t */ execute(options) {\n        const editor = this.editor;\n        const model = editor.model;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const imageElement = imageUtils.getClosestSelectedImageElement(model.document.selection);\n        this.value = {\n            width: options.width,\n            height: null\n        };\n        if (imageElement) {\n            model.change((writer)=>{\n                writer.setAttribute('resizedWidth', options.width, imageElement);\n                writer.removeAttribute('resizedHeight', imageElement);\n                imageUtils.setImageNaturalSizeAttributes(imageElement);\n            });\n        }\n    }\n}\n\n/**\n * The image resize editing feature.\n *\n * It adds the ability to resize each image using handles or manually by\n * {@link module:image/imageresize/imageresizebuttons~ImageResizeButtons} buttons.\n */ class ImageResizeEditing extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageUtils\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageResizeEditing';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ constructor(editor){\n        super(editor);\n        editor.config.define('image', {\n            resizeUnit: '%',\n            resizeOptions: [\n                {\n                    name: 'resizeImage:original',\n                    value: null,\n                    icon: 'original'\n                },\n                {\n                    name: 'resizeImage:custom',\n                    value: 'custom',\n                    icon: 'custom'\n                },\n                {\n                    name: 'resizeImage:25',\n                    value: '25',\n                    icon: 'small'\n                },\n                {\n                    name: 'resizeImage:50',\n                    value: '50',\n                    icon: 'medium'\n                },\n                {\n                    name: 'resizeImage:75',\n                    value: '75',\n                    icon: 'large'\n                }\n            ]\n        });\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const editor = this.editor;\n        const resizeImageCommand = new ResizeImageCommand(editor);\n        this._registerConverters('imageBlock');\n        this._registerConverters('imageInline');\n        // Register `resizeImage` command and add `imageResize` command as an alias for backward compatibility.\n        editor.commands.add('resizeImage', resizeImageCommand);\n        editor.commands.add('imageResize', resizeImageCommand);\n    }\n    /**\n\t * @inheritDoc\n\t */ afterInit() {\n        this._registerSchema();\n    }\n    _registerSchema() {\n        if (this.editor.plugins.has('ImageBlockEditing')) {\n            this.editor.model.schema.extend('imageBlock', {\n                allowAttributes: [\n                    'resizedWidth',\n                    'resizedHeight'\n                ]\n            });\n        }\n        if (this.editor.plugins.has('ImageInlineEditing')) {\n            this.editor.model.schema.extend('imageInline', {\n                allowAttributes: [\n                    'resizedWidth',\n                    'resizedHeight'\n                ]\n            });\n        }\n    }\n    /**\n\t * Registers image resize converters.\n\t *\n\t * @param imageType The type of the image.\n\t */ _registerConverters(imageType) {\n        const editor = this.editor;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        // Dedicated converter to propagate image's attribute to the img tag.\n        editor.conversion.for('downcast').add((dispatcher)=>dispatcher.on(`attribute:resizedWidth:${imageType}`, (evt, data, conversionApi)=>{\n                if (!conversionApi.consumable.consume(data.item, evt.name)) {\n                    return;\n                }\n                const viewWriter = conversionApi.writer;\n                const viewImg = conversionApi.mapper.toViewElement(data.item);\n                if (data.attributeNewValue !== null) {\n                    viewWriter.setStyle('width', data.attributeNewValue, viewImg);\n                    viewWriter.addClass('image_resized', viewImg);\n                } else {\n                    viewWriter.removeStyle('width', viewImg);\n                    viewWriter.removeClass('image_resized', viewImg);\n                }\n            }));\n        editor.conversion.for('dataDowncast').attributeToAttribute({\n            model: {\n                name: imageType,\n                key: 'resizedHeight'\n            },\n            view: (modelAttributeValue)=>({\n                    key: 'style',\n                    value: {\n                        'height': modelAttributeValue\n                    }\n                })\n        });\n        editor.conversion.for('editingDowncast').add((dispatcher)=>dispatcher.on(`attribute:resizedHeight:${imageType}`, (evt, data, conversionApi)=>{\n                if (!conversionApi.consumable.consume(data.item, evt.name)) {\n                    return;\n                }\n                const viewWriter = conversionApi.writer;\n                const viewImg = conversionApi.mapper.toViewElement(data.item);\n                const target = imageType === 'imageInline' ? imageUtils.findViewImgElement(viewImg) : viewImg;\n                if (data.attributeNewValue !== null) {\n                    viewWriter.setStyle('height', data.attributeNewValue, target);\n                } else {\n                    viewWriter.removeStyle('height', target);\n                }\n            }));\n        editor.conversion.for('upcast').attributeToAttribute({\n            view: {\n                name: imageType === 'imageBlock' ? 'figure' : 'img',\n                styles: {\n                    width: /.+/\n                }\n            },\n            model: {\n                key: 'resizedWidth',\n                value: (viewElement)=>{\n                    if (widthAndHeightStylesAreBothSet(viewElement)) {\n                        return null;\n                    }\n                    return viewElement.getStyle('width');\n                }\n            }\n        });\n        editor.conversion.for('upcast').attributeToAttribute({\n            view: {\n                name: imageType === 'imageBlock' ? 'figure' : 'img',\n                styles: {\n                    height: /.+/\n                }\n            },\n            model: {\n                key: 'resizedHeight',\n                value: (viewElement)=>{\n                    if (widthAndHeightStylesAreBothSet(viewElement)) {\n                        return null;\n                    }\n                    return viewElement.getStyle('height');\n                }\n            }\n        });\n    }\n}\n\nconst RESIZE_ICONS = /* #__PURE__ */ (()=>({\n        small: icons.objectSizeSmall,\n        medium: icons.objectSizeMedium,\n        large: icons.objectSizeLarge,\n        custom: icons.objectSizeCustom,\n        original: icons.objectSizeFull\n    }))();\n/**\n * The image resize buttons plugin.\n *\n * It adds a possibility to resize images using the toolbar dropdown or individual buttons, depending on the plugin configuration.\n */ class ImageResizeButtons extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageResizeEditing\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageResizeButtons';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * The resize unit.\n\t * @default '%'\n\t */ _resizeUnit;\n    /**\n\t * @inheritDoc\n\t */ constructor(editor){\n        super(editor);\n        this._resizeUnit = editor.config.get('image.resizeUnit');\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const editor = this.editor;\n        const options = editor.config.get('image.resizeOptions');\n        const command = editor.commands.get('resizeImage');\n        this.bind('isEnabled').to(command);\n        for (const option of options){\n            this._registerImageResizeButton(option);\n        }\n        this._registerImageResizeDropdown(options);\n    }\n    /**\n\t * A helper function that creates a standalone button component for the plugin.\n\t *\n\t * @param resizeOption A model of the resize option.\n\t */ _registerImageResizeButton(option) {\n        const editor = this.editor;\n        const { name, value, icon } = option;\n        editor.ui.componentFactory.add(name, (locale)=>{\n            const button = new ButtonView(locale);\n            const command = editor.commands.get('resizeImage');\n            const labelText = this._getOptionLabelValue(option, true);\n            if (!RESIZE_ICONS[icon]) {\n                /**\n\t\t\t\t * When configuring {@link module:image/imageconfig~ImageConfig#resizeOptions `config.image.resizeOptions`} for standalone\n\t\t\t\t * buttons, a valid `icon` token must be set for each option.\n\t\t\t\t *\n\t\t\t\t * See all valid options described in the\n\t\t\t\t * {@link module:image/imageconfig~ImageResizeOption plugin configuration}.\n\t\t\t\t *\n\t\t\t\t * @error imageresizebuttons-missing-icon\n\t\t\t\t * @param option Invalid image resize option.\n\t\t\t\t*/ throw new CKEditorError('imageresizebuttons-missing-icon', editor, option);\n            }\n            button.set({\n                // Use the `label` property for a verbose description (because of ARIA).\n                label: labelText,\n                icon: RESIZE_ICONS[icon],\n                tooltip: labelText,\n                isToggleable: true\n            });\n            // Bind button to the command.\n            button.bind('isEnabled').to(this);\n            if (editor.plugins.has('ImageCustomResizeUI') && isCustomImageResizeOption(option)) {\n                const customResizeUI = editor.plugins.get('ImageCustomResizeUI');\n                this.listenTo(button, 'execute', ()=>{\n                    customResizeUI._showForm(this._resizeUnit);\n                });\n            } else {\n                const optionValueWithUnit = value ? value + this._resizeUnit : null;\n                button.bind('isOn').to(command, 'value', getIsOnButtonCallback(optionValueWithUnit));\n                this.listenTo(button, 'execute', ()=>{\n                    editor.execute('resizeImage', {\n                        width: optionValueWithUnit\n                    });\n                });\n            }\n            return button;\n        });\n    }\n    /**\n\t * A helper function that creates a dropdown component for the plugin containing all the resize options defined in\n\t * the editor configuration.\n\t *\n\t * @param options An array of configured options.\n\t */ _registerImageResizeDropdown(options) {\n        const editor = this.editor;\n        const t = editor.t;\n        const originalSizeOption = options.find((option)=>!option.value);\n        const componentCreator = (locale)=>{\n            const command = editor.commands.get('resizeImage');\n            const dropdownView = createDropdown(locale, DropdownButtonView);\n            const dropdownButton = dropdownView.buttonView;\n            const accessibleLabel = t('Resize image');\n            dropdownButton.set({\n                tooltip: accessibleLabel,\n                commandValue: originalSizeOption.value,\n                icon: RESIZE_ICONS.medium,\n                isToggleable: true,\n                label: this._getOptionLabelValue(originalSizeOption),\n                withText: true,\n                class: 'ck-resize-image-button',\n                ariaLabel: accessibleLabel,\n                ariaLabelledBy: undefined\n            });\n            dropdownButton.bind('label').to(command, 'value', (commandValue)=>{\n                if (commandValue && commandValue.width) {\n                    return commandValue.width;\n                } else {\n                    return this._getOptionLabelValue(originalSizeOption);\n                }\n            });\n            dropdownView.bind('isEnabled').to(this);\n            addListToDropdown(dropdownView, ()=>this._getResizeDropdownListItemDefinitions(options, command), {\n                ariaLabel: t('Image resize list'),\n                role: 'menu'\n            });\n            // Execute command when an item from the dropdown is selected.\n            this.listenTo(dropdownView, 'execute', (evt)=>{\n                if ('onClick' in evt.source) {\n                    evt.source.onClick();\n                } else {\n                    editor.execute(evt.source.commandName, {\n                        width: evt.source.commandValue\n                    });\n                    editor.editing.view.focus();\n                }\n            });\n            return dropdownView;\n        };\n        // Register `resizeImage` dropdown and add `imageResize` dropdown as an alias for backward compatibility.\n        editor.ui.componentFactory.add('resizeImage', componentCreator);\n        editor.ui.componentFactory.add('imageResize', componentCreator);\n    }\n    /**\n\t * A helper function for creating an option label value string.\n\t *\n\t * @param option A resize option object.\n\t * @param forTooltip An optional flag for creating a tooltip label.\n\t * @returns A user-defined label combined from the numeric value and the resize unit or the default label\n\t * for reset options (`Original`).\n\t */ _getOptionLabelValue(option, forTooltip = false) {\n        const t = this.editor.t;\n        if (option.label) {\n            return option.label;\n        } else if (forTooltip) {\n            if (isCustomImageResizeOption(option)) {\n                return t('Custom image size');\n            } else if (option.value) {\n                return t('Resize image to %0', option.value + this._resizeUnit);\n            } else {\n                return t('Resize image to the original size');\n            }\n        } else {\n            if (isCustomImageResizeOption(option)) {\n                return t('Custom');\n            } else if (option.value) {\n                return option.value + this._resizeUnit;\n            } else {\n                return t('Original');\n            }\n        }\n    }\n    /**\n\t * A helper function that parses the resize options and returns list item definitions ready for use in the dropdown.\n\t *\n\t * @param options The resize options.\n\t * @param command The resize image command.\n\t * @returns Dropdown item definitions.\n\t */ _getResizeDropdownListItemDefinitions(options, command) {\n        const { editor } = this;\n        const itemDefinitions = new Collection();\n        const optionsWithSerializedValues = options.map((option)=>{\n            if (isCustomImageResizeOption(option)) {\n                return {\n                    ...option,\n                    valueWithUnits: 'custom'\n                };\n            }\n            if (!option.value) {\n                return {\n                    ...option,\n                    valueWithUnits: null\n                };\n            }\n            return {\n                ...option,\n                valueWithUnits: `${option.value}${this._resizeUnit}`\n            };\n        });\n        for (const option of optionsWithSerializedValues){\n            let definition = null;\n            if (editor.plugins.has('ImageCustomResizeUI') && isCustomImageResizeOption(option)) {\n                const customResizeUI = editor.plugins.get('ImageCustomResizeUI');\n                definition = {\n                    type: 'button',\n                    model: new ViewModel({\n                        label: this._getOptionLabelValue(option),\n                        role: 'menuitemradio',\n                        withText: true,\n                        icon: null,\n                        onClick: ()=>{\n                            customResizeUI._showForm(this._resizeUnit);\n                        }\n                    })\n                };\n                const allDropdownValues = map(optionsWithSerializedValues, 'valueWithUnits');\n                definition.model.bind('isOn').to(command, 'value', getIsOnCustomButtonCallback(allDropdownValues));\n            } else {\n                definition = {\n                    type: 'button',\n                    model: new ViewModel({\n                        commandName: 'resizeImage',\n                        commandValue: option.valueWithUnits,\n                        label: this._getOptionLabelValue(option),\n                        role: 'menuitemradio',\n                        withText: true,\n                        icon: null\n                    })\n                };\n                definition.model.bind('isOn').to(command, 'value', getIsOnButtonCallback(option.valueWithUnits));\n            }\n            definition.model.bind('isEnabled').to(command, 'isEnabled');\n            itemDefinitions.add(definition);\n        }\n        return itemDefinitions;\n    }\n}\n/**\n * A helper that checks if provided option triggers custom resize balloon.\n */ function isCustomImageResizeOption(option) {\n    return option.value === 'custom';\n}\n/**\n * A helper function for setting the `isOn` state of buttons in value bindings.\n */ function getIsOnButtonCallback(value) {\n    return (commandValue)=>{\n        const objectCommandValue = commandValue;\n        if (value === null && objectCommandValue === value) {\n            return true;\n        }\n        return objectCommandValue !== null && objectCommandValue.width === value;\n    };\n}\n/**\n * A helper function for setting the `isOn` state of custom size button in value bindings.\n */ function getIsOnCustomButtonCallback(allDropdownValues) {\n    return (commandValue)=>!allDropdownValues.some((dropdownValue)=>getIsOnButtonCallback(dropdownValue)(commandValue));\n}\n\nconst RESIZABLE_IMAGES_CSS_SELECTOR = 'figure.image.ck-widget > img,' + 'figure.image.ck-widget > picture > img,' + 'figure.image.ck-widget > a > img,' + 'figure.image.ck-widget > a > picture > img,' + 'span.image-inline.ck-widget > img,' + 'span.image-inline.ck-widget > picture > img';\nconst RESIZED_IMAGE_CLASS = 'image_resized';\n/**\n * The image resize by handles feature.\n *\n * It adds the ability to resize each image using handles or manually by\n * {@link module:image/imageresize/imageresizebuttons~ImageResizeButtons} buttons.\n */ class ImageResizeHandles extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            WidgetResize,\n            ImageUtils\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageResizeHandles';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const command = this.editor.commands.get('resizeImage');\n        this.bind('isEnabled').to(command);\n        this._setupResizerCreator();\n    }\n    /**\n\t * Attaches the listeners responsible for creating a resizer for each image, except for images inside the HTML embed preview.\n\t */ _setupResizerCreator() {\n        const editor = this.editor;\n        const editingView = editor.editing.view;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        editingView.addObserver(ImageLoadObserver);\n        this.listenTo(editingView.document, 'imageLoaded', (evt, domEvent)=>{\n            // The resizer must be attached only to images loaded by the `ImageInsert`, `ImageUpload` or `LinkImage` plugins.\n            if (!domEvent.target.matches(RESIZABLE_IMAGES_CSS_SELECTOR)) {\n                return;\n            }\n            const domConverter = editor.editing.view.domConverter;\n            const imageView = domConverter.domToView(domEvent.target);\n            const widgetView = imageUtils.getImageWidgetFromImageView(imageView);\n            let resizer = this.editor.plugins.get(WidgetResize).getResizerByViewElement(widgetView);\n            if (resizer) {\n                // There are rare cases when the image will be triggered multiple times for the same widget, e.g. when\n                // the image's source was changed after upload (https://github.com/ckeditor/ckeditor5/pull/8108#issuecomment-708302992).\n                resizer.redraw();\n                return;\n            }\n            const mapper = editor.editing.mapper;\n            const imageModel = mapper.toModelElement(widgetView);\n            resizer = editor.plugins.get(WidgetResize).attachTo({\n                unit: editor.config.get('image.resizeUnit'),\n                modelElement: imageModel,\n                viewElement: widgetView,\n                editor,\n                getHandleHost (domWidgetElement) {\n                    return domWidgetElement.querySelector('img');\n                },\n                getResizeHost () {\n                    return domConverter.mapViewToDom(mapper.toViewElement(imageModel));\n                },\n                isCentered () {\n                    const imageStyle = imageModel.getAttribute('imageStyle');\n                    return imageStyle == 'alignCenter';\n                },\n                onCommit (newValue) {\n                    // Get rid of the CSS class in case the command execution that follows is unsuccessful\n                    // (e.g. Track Changes can override it and the new dimensions will not apply). Otherwise,\n                    // the presence of the class and the absence of the width style will cause it to take 100%\n                    // of the horizontal space.\n                    editingView.change((writer)=>{\n                        writer.removeClass(RESIZED_IMAGE_CLASS, widgetView);\n                    });\n                    editor.execute('resizeImage', {\n                        width: newValue\n                    });\n                }\n            });\n            resizer.on('updateSize', ()=>{\n                if (!widgetView.hasClass(RESIZED_IMAGE_CLASS)) {\n                    editingView.change((writer)=>{\n                        writer.addClass(RESIZED_IMAGE_CLASS, widgetView);\n                    });\n                }\n                const target = imageModel.name === 'imageInline' ? imageView : widgetView;\n                if (target.getStyle('height')) {\n                    editingView.change((writer)=>{\n                        writer.removeStyle('height', target);\n                    });\n                }\n            });\n            resizer.bind('isEnabled').to(this);\n        });\n    }\n}\n\n/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */ /**\n * @module image/imageresize/utils/tryparsedimensionwithunit\n */ /**\n * Parses provided string with dimension value and returns extracted numeric value and unit.\n *\n * \t* If non-string dimension is passed then `null` value is returned.\n * \t* If unit is missing then `null` is returned.\n * \t* If numeric value part of string is not a number then `null` is returned.\n *\n * Example:\n * \t`\"222px\"` => `{ value: 222, unit: \"px\" }`\n *\t`\"99%\"` => `{ value: 99, unit: \"%\" }`\n\n * @param dimension Unsafe string with dimension.\n * @returns Parsed dimension with extracted numeric value and units.\n */ function tryParseDimensionWithUnit(dimension) {\n    if (!dimension) {\n        return null;\n    }\n    const [, rawValue, unit] = dimension.trim().match(/([.,\\d]+)(%|px)$/) || [];\n    const parsedValue = Number.parseFloat(rawValue);\n    if (Number.isNaN(parsedValue)) {\n        return null;\n    }\n    return {\n        value: parsedValue,\n        unit\n    };\n}\n/**\n * Converts dimension between `px` -> `%` and `%` -> `px`.\n *\n * @param parentDimensionPx\tDimension of parent element that contains measured element.\n * @param dimension Measured element dimension.\n * @returns Casted dimension.\n */ function tryCastDimensionsToUnit(parentDimensionPx, dimension, targetUnit) {\n    // \"%\" -> \"px\" conversion\n    if (targetUnit === 'px') {\n        return {\n            value: dimension.value,\n            unit: 'px'\n        };\n    }\n    // \"px\" -> \"%\" conversion\n    return {\n        value: dimension.value / parentDimensionPx * 100,\n        unit: '%'\n    };\n}\n\n/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */ /**\n * @module image/imageresize/utils/getselectedimageeditornodes\n */ /**\n * Finds model, view and DOM element for selected image element. Returns `null` if there is no image selected.\n *\n * @param editor Editor instance.\n */ function getSelectedImageEditorNodes(editor) {\n    const { editing } = editor;\n    const imageUtils = editor.plugins.get('ImageUtils');\n    const imageModelElement = imageUtils.getClosestSelectedImageElement(editor.model.document.selection);\n    if (!imageModelElement) {\n        return null;\n    }\n    const imageViewElement = editing.mapper.toViewElement(imageModelElement);\n    const imageDOMElement = editing.view.domConverter.mapViewToDom(imageViewElement);\n    return {\n        model: imageModelElement,\n        view: imageViewElement,\n        dom: imageDOMElement\n    };\n}\n\n/**\n * Returns image width in specified units. It is width of image after resize.\n *\n * \t* If image is not selected or command is disabled then `null` will be returned.\n * \t* If image is not fully loaded (and it is impossible to determine its natural size) then `null` will be returned.\n *\t* If `targetUnit` percentage is passed then it will return width percentage of image related to its accessors.\n *\n * @param editor Editor instance.\n * @param targetUnit Unit in which dimension will be returned.\n * @returns Parsed image width after resize (with unit).\n */ function getSelectedImageWidthInUnits(editor, targetUnit) {\n    const imageNodes = getSelectedImageEditorNodes(editor);\n    if (!imageNodes) {\n        return null;\n    }\n    const parsedResizedWidth = tryParseDimensionWithUnit(imageNodes.model.getAttribute('resizedWidth') || null);\n    if (!parsedResizedWidth) {\n        return null;\n    }\n    if (parsedResizedWidth.unit === targetUnit) {\n        return parsedResizedWidth;\n    }\n    const imageParentWidthPx = calculateResizeHostAncestorWidth(imageNodes.dom);\n    const imageHolderDimension = {\n        value: new Rect(imageNodes.dom).width\n    };\n    return tryCastDimensionsToUnit(imageParentWidthPx, imageHolderDimension, targetUnit);\n}\n\n/**\n * The ImageCustomResizeFormView class.\n */ class ImageCustomResizeFormView extends View {\n    /**\n\t * Tracks information about the DOM focus in the form.\n\t */ focusTracker;\n    /**\n\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\n\t */ keystrokes;\n    /**\n\t * Resize unit shortcut.\n\t */ unit;\n    /**\n\t * An input with a label.\n\t */ labeledInput;\n    /**\n\t * A button used to submit the form.\n\t */ saveButtonView;\n    /**\n\t * A button used to cancel the form.\n\t */ cancelButtonView;\n    /**\n\t * A collection of views which can be focused in the form.\n\t */ _focusables;\n    /**\n\t * Helps cycling over {@link #_focusables} in the form.\n\t */ _focusCycler;\n    /**\n\t * An array of form validators used by {@link #isValid}.\n\t */ _validators;\n    /**\n\t * @inheritDoc\n\t */ constructor(locale, unit, validators){\n        super(locale);\n        const t = this.locale.t;\n        this.focusTracker = new FocusTracker();\n        this.keystrokes = new KeystrokeHandler();\n        this.unit = unit;\n        this.labeledInput = this._createLabeledInputView();\n        this.saveButtonView = this._createButton(t('Save'), icons.check, 'ck-button-save');\n        this.saveButtonView.type = 'submit';\n        this.cancelButtonView = this._createButton(t('Cancel'), icons.cancel, 'ck-button-cancel', 'cancel');\n        this._focusables = new ViewCollection();\n        this._validators = validators;\n        this._focusCycler = new FocusCycler({\n            focusables: this._focusables,\n            focusTracker: this.focusTracker,\n            keystrokeHandler: this.keystrokes,\n            actions: {\n                // Navigate form fields backwards using the Shift + Tab keystroke.\n                focusPrevious: 'shift + tab',\n                // Navigate form fields forwards using the Tab key.\n                focusNext: 'tab'\n            }\n        });\n        this.setTemplate({\n            tag: 'form',\n            attributes: {\n                class: [\n                    'ck',\n                    'ck-image-custom-resize-form',\n                    'ck-responsive-form'\n                ],\n                // https://github.com/ckeditor/ckeditor5-image/issues/40\n                tabindex: '-1'\n            },\n            children: [\n                this.labeledInput,\n                this.saveButtonView,\n                this.cancelButtonView\n            ]\n        });\n    }\n    /**\n\t * @inheritDoc\n\t */ render() {\n        super.render();\n        this.keystrokes.listenTo(this.element);\n        submitHandler({\n            view: this\n        });\n        [\n            this.labeledInput,\n            this.saveButtonView,\n            this.cancelButtonView\n        ].forEach((v)=>{\n            // Register the view as focusable.\n            this._focusables.add(v);\n            // Register the view in the focus tracker.\n            this.focusTracker.add(v.element);\n        });\n    }\n    /**\n\t * @inheritDoc\n\t */ destroy() {\n        super.destroy();\n        this.focusTracker.destroy();\n        this.keystrokes.destroy();\n    }\n    /**\n\t * Creates the button view.\n\t *\n\t * @param label The button label\n\t * @param icon The button's icon.\n\t * @param className The additional button CSS class name.\n\t * @param eventName The event name that the ButtonView#execute event will be delegated to.\n\t * @returns The button view instance.\n\t */ _createButton(label, icon, className, eventName) {\n        const button = new ButtonView(this.locale);\n        button.set({\n            label,\n            icon,\n            tooltip: true\n        });\n        button.extendTemplate({\n            attributes: {\n                class: className\n            }\n        });\n        if (eventName) {\n            button.delegate('execute').to(this, eventName);\n        }\n        return button;\n    }\n    /**\n\t * Creates an input with a label.\n\t *\n\t * @returns Labeled field view instance.\n\t */ _createLabeledInputView() {\n        const t = this.locale.t;\n        const labeledInput = new LabeledFieldView(this.locale, createLabeledInputNumber);\n        labeledInput.label = t('Resize image (in %0)', this.unit);\n        labeledInput.fieldView.set({\n            step: 0.1\n        });\n        return labeledInput;\n    }\n    /**\n\t * Validates the form and returns `false` when some fields are invalid.\n\t */ isValid() {\n        this.resetFormStatus();\n        for (const validator of this._validators){\n            const errorText = validator(this);\n            // One error per field is enough.\n            if (errorText) {\n                // Apply updated error.\n                this.labeledInput.errorText = errorText;\n                return false;\n            }\n        }\n        return true;\n    }\n    /**\n\t * Cleans up the supplementary error and information text of the {@link #labeledInput}\n\t * bringing them back to the state when the form has been displayed for the first time.\n\t *\n\t * See {@link #isValid}.\n\t */ resetFormStatus() {\n        this.labeledInput.errorText = null;\n    }\n    /**\n\t * The native DOM `value` of the input element of {@link #labeledInput}.\n\t */ get rawSize() {\n        const { element } = this.labeledInput.fieldView;\n        if (!element) {\n            return null;\n        }\n        return element.value;\n    }\n    /**\n\t * Get numeric value of size. Returns `null` if value of size input element in {@link #labeledInput}.is not a number.\n\t */ get parsedSize() {\n        const { rawSize } = this;\n        if (rawSize === null) {\n            return null;\n        }\n        const parsed = Number.parseFloat(rawSize);\n        if (Number.isNaN(parsed)) {\n            return null;\n        }\n        return parsed;\n    }\n    /**\n\t * Returns serialized image input size with unit.\n\t * Returns `null` if value of size input element in {@link #labeledInput}.is not a number.\n\t */ get sizeWithUnits() {\n        const { parsedSize, unit } = this;\n        if (parsedSize === null) {\n            return null;\n        }\n        return `${parsedSize}${unit}`;\n    }\n}\n\n/**\n * Returns min and max value of resize image in specified unit.\n *\n * @param editor Editor instance.\n * @param targetUnit Unit in which dimension will be returned.\n * @returns Possible resize range in numeric form.\n */ function getSelectedImagePossibleResizeRange(editor, targetUnit) {\n    const imageNodes = getSelectedImageEditorNodes(editor);\n    if (!imageNodes) {\n        return null;\n    }\n    const imageParentWidthPx = calculateResizeHostAncestorWidth(imageNodes.dom);\n    const minimumImageWidth = tryParseDimensionWithUnit(window.getComputedStyle(imageNodes.dom).minWidth) || {\n        value: 1};\n    const lower = Math.max(0.1, tryCastDimensionsToUnit(imageParentWidthPx, minimumImageWidth, targetUnit).value);\n    const upper = targetUnit === 'px' ? imageParentWidthPx : 100;\n    return {\n        unit: targetUnit,\n        lower,\n        upper\n    };\n}\n\n/**\n * The custom resize image UI plugin.\n *\n * The plugin uses the {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon}.\n */ class ImageCustomResizeUI extends Plugin {\n    /**\n\t * The contextual balloon plugin instance.\n\t */ _balloon;\n    /**\n\t * A form containing a textarea and buttons, used to change the `alt` text value.\n\t */ _form;\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ContextualBalloon\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageCustomResizeUI';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ destroy() {\n        super.destroy();\n        // Destroy created UI components as they are not automatically destroyed (see ckeditor5#1341).\n        if (this._form) {\n            this._form.destroy();\n        }\n    }\n    /**\n\t * Creates the {@link module:image/imageresize/ui/imagecustomresizeformview~ImageCustomResizeFormView}\n\t * form.\n\t */ _createForm(unit) {\n        const editor = this.editor;\n        this._balloon = this.editor.plugins.get('ContextualBalloon');\n        this._form = new (CssTransitionDisablerMixin(ImageCustomResizeFormView))(editor.locale, unit, getFormValidators(editor));\n        // Render the form so its #element is available for clickOutsideHandler.\n        this._form.render();\n        this.listenTo(this._form, 'submit', ()=>{\n            if (this._form.isValid()) {\n                editor.execute('resizeImage', {\n                    width: this._form.sizeWithUnits\n                });\n                this._hideForm(true);\n            }\n        });\n        // Update balloon position when form error label is added .\n        this.listenTo(this._form.labeledInput, 'change:errorText', ()=>{\n            editor.ui.update();\n        });\n        this.listenTo(this._form, 'cancel', ()=>{\n            this._hideForm(true);\n        });\n        // Close the form on Esc key press.\n        this._form.keystrokes.set('Esc', (data, cancel)=>{\n            this._hideForm(true);\n            cancel();\n        });\n        // Close on click outside of balloon panel element.\n        clickOutsideHandler({\n            emitter: this._form,\n            activator: ()=>this._isVisible,\n            contextElements: ()=>[\n                    this._balloon.view.element\n                ],\n            callback: ()=>this._hideForm()\n        });\n    }\n    /**\n\t * Shows the {@link #_form} in the {@link #_balloon}.\n\t *\n\t * @internal\n\t */ _showForm(unit) {\n        if (this._isVisible) {\n            return;\n        }\n        if (!this._form) {\n            this._createForm(unit);\n        }\n        const editor = this.editor;\n        const labeledInput = this._form.labeledInput;\n        this._form.disableCssTransitions();\n        this._form.resetFormStatus();\n        if (!this._isInBalloon) {\n            this._balloon.add({\n                view: this._form,\n                position: getBalloonPositionData(editor)\n            });\n        }\n        // Make sure that each time the panel shows up, the field remains in sync with the value of\n        // the command. If the user typed in the input, then canceled the balloon (`labeledInput#value`\n        // stays unaltered) and re-opened it without changing the value of the command, they would see the\n        // old value instead of the actual value of the command.\n        const currentParsedWidth = getSelectedImageWidthInUnits(editor, unit);\n        const initialInputValue = currentParsedWidth ? currentParsedWidth.value.toFixed(1) : '';\n        const possibleRange = getSelectedImagePossibleResizeRange(editor, unit);\n        labeledInput.fieldView.value = labeledInput.fieldView.element.value = initialInputValue;\n        if (possibleRange) {\n            Object.assign(labeledInput.fieldView, {\n                min: possibleRange.lower.toFixed(1),\n                max: Math.ceil(possibleRange.upper).toFixed(1)\n            });\n        }\n        this._form.labeledInput.fieldView.select();\n        this._form.enableCssTransitions();\n    }\n    /**\n\t * Removes the {@link #_form} from the {@link #_balloon}.\n\t *\n\t * @param focusEditable Controls whether the editing view is focused afterwards.\n\t */ _hideForm(focusEditable = false) {\n        if (!this._isInBalloon) {\n            return;\n        }\n        // Blur the input element before removing it from DOM to prevent issues in some browsers.\n        // See https://github.com/ckeditor/ckeditor5/issues/1501.\n        if (this._form.focusTracker.isFocused) {\n            this._form.saveButtonView.focus();\n        }\n        this._balloon.remove(this._form);\n        if (focusEditable) {\n            this.editor.editing.view.focus();\n        }\n    }\n    /**\n\t * Returns `true` when the {@link #_form} is the visible view in the {@link #_balloon}.\n\t */ get _isVisible() {\n        return !!this._balloon && this._balloon.visibleView === this._form;\n    }\n    /**\n\t * Returns `true` when the {@link #_form} is in the {@link #_balloon}.\n\t */ get _isInBalloon() {\n        return !!this._balloon && this._balloon.hasView(this._form);\n    }\n}\n/**\n * Returns image resize form validation callbacks.\n *\n * @param editor Editor instance.\n */ function getFormValidators(editor) {\n    const t = editor.t;\n    return [\n        (form)=>{\n            if (form.rawSize.trim() === '') {\n                return t('The value must not be empty.');\n            }\n            if (form.parsedSize === null) {\n                return t('The value should be a plain number.');\n            }\n        }\n    ];\n}\n\n/**\n * The image resize plugin.\n *\n * It adds a possibility to resize each image using handles.\n */ class ImageResize extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageResizeEditing,\n            ImageResizeHandles,\n            ImageCustomResizeUI,\n            ImageResizeButtons\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageResize';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n}\n\n/**\n * The image style command. It is used to apply {@link module:image/imageconfig~ImageStyleConfig#options image style option}\n * to a selected image.\n *\n * **Note**: Executing this command may change the image model element if the desired style requires an image of a different\n * type. See {@link module:image/imagestyle/imagestylecommand~ImageStyleCommand#execute} to learn more.\n */ class ImageStyleCommand extends Command {\n    /**\n\t * An object containing names of default style options for the inline and block images.\n\t * If there is no default style option for the given image type in the configuration,\n\t * the name will be `false`.\n\t */ _defaultStyles;\n    /**\n\t * The styles handled by this command.\n\t */ _styles;\n    /**\n\t * Creates an instance of the image style command. When executed, the command applies one of\n\t * {@link module:image/imageconfig~ImageStyleConfig#options style options} to the currently selected image.\n\t *\n\t * @param editor The editor instance.\n\t * @param styles The style options that this command supports.\n\t */ constructor(editor, styles){\n        super(editor);\n        this._defaultStyles = {\n            imageBlock: false,\n            imageInline: false\n        };\n        this._styles = new Map(styles.map((style)=>{\n            if (style.isDefault) {\n                for (const modelElementName of style.modelElements){\n                    this._defaultStyles[modelElementName] = style.name;\n                }\n            }\n            return [\n                style.name,\n                style\n            ];\n        }));\n    }\n    /**\n\t * @inheritDoc\n\t */ refresh() {\n        const editor = this.editor;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        const element = imageUtils.getClosestSelectedImageElement(this.editor.model.document.selection);\n        this.isEnabled = !!element;\n        if (!this.isEnabled) {\n            this.value = false;\n        } else if (element.hasAttribute('imageStyle')) {\n            this.value = element.getAttribute('imageStyle');\n        } else {\n            this.value = this._defaultStyles[element.name];\n        }\n    }\n    /**\n\t * Executes the command and applies the style to the currently selected image:\n\t *\n\t * ```ts\n\t * editor.execute( 'imageStyle', { value: 'side' } );\n\t * ```\n\t *\n\t * **Note**: Executing this command may change the image model element if the desired style requires an image\n\t * of a different type. Learn more about {@link module:image/imageconfig~ImageStyleOptionDefinition#modelElements model element}\n\t * configuration for the style option.\n\t *\n\t * @param options.value The name of the style (as configured in {@link module:image/imageconfig~ImageStyleConfig#options}).\n\t * @param options.setImageSizes Specifies whether the image `width` and `height` attributes should be set automatically.\n\t * The default is `true`.\n\t * @fires execute\n\t */ execute(options = {}) {\n        const editor = this.editor;\n        const model = editor.model;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        model.change((writer)=>{\n            const requestedStyle = options.value;\n            const { setImageSizes = true } = options;\n            let imageElement = imageUtils.getClosestSelectedImageElement(model.document.selection);\n            // Change the image type if a style requires it.\n            if (requestedStyle && this.shouldConvertImageType(requestedStyle, imageElement)) {\n                this.editor.execute(imageUtils.isBlockImage(imageElement) ? 'imageTypeInline' : 'imageTypeBlock', {\n                    setImageSizes\n                });\n                // Update the imageElement to the newly created image.\n                imageElement = imageUtils.getClosestSelectedImageElement(model.document.selection);\n            }\n            // Default style means that there is no `imageStyle` attribute in the model.\n            // https://github.com/ckeditor/ckeditor5-image/issues/147\n            if (!requestedStyle || this._styles.get(requestedStyle).isDefault) {\n                writer.removeAttribute('imageStyle', imageElement);\n            } else {\n                writer.setAttribute('imageStyle', requestedStyle, imageElement);\n            }\n            if (setImageSizes) {\n                imageUtils.setImageNaturalSizeAttributes(imageElement);\n            }\n        });\n    }\n    /**\n\t * Returns `true` if requested style change would trigger the image type change.\n\t *\n\t * @param requestedStyle The name of the style (as configured in {@link module:image/imageconfig~ImageStyleConfig#options}).\n\t * @param imageElement The image model element.\n\t */ shouldConvertImageType(requestedStyle, imageElement) {\n        const supportedTypes = this._styles.get(requestedStyle).modelElements;\n        return !supportedTypes.includes(imageElement.name);\n    }\n}\n\n/**\n * Default image style options provided by the plugin that can be referred in the {@link module:image/imageconfig~ImageConfig#styles}\n * configuration.\n *\n * There are available 5 styles focused on formatting:\n *\n * * **`'alignLeft'`** aligns the inline or block image to the left and wraps it with the text using the `image-style-align-left` class,\n * * **`'alignRight'`** aligns the inline or block image to the right and wraps it with the text using the `image-style-align-right` class,\n * * **`'alignCenter'`** centers the block image using the `image-style-align-center` class,\n * * **`'alignBlockLeft'`** aligns the block image to the left using the `image-style-block-align-left` class,\n * * **`'alignBlockRight'`** aligns the block image to the right using the `image-style-block-align-right` class,\n *\n * and 3 semantic styles:\n *\n * * **`'inline'`** is an inline image without any CSS class,\n * * **`'block'`** is a block image without any CSS class,\n * * **`'side'`** is a block image styled with the `image-style-side` CSS class.\n */ const DEFAULT_OPTIONS = {\n    // This style represents an image placed in the line of text.\n    get inline () {\n        return {\n            name: 'inline',\n            title: 'In line',\n            icon: icons.objectInline,\n            modelElements: [\n                'imageInline'\n            ],\n            isDefault: true\n        };\n    },\n    // This style represents an image aligned to the left and wrapped with text.\n    get alignLeft () {\n        return {\n            name: 'alignLeft',\n            title: 'Left aligned image',\n            icon: icons.objectLeft,\n            modelElements: [\n                'imageBlock',\n                'imageInline'\n            ],\n            className: 'image-style-align-left'\n        };\n    },\n    // This style represents an image aligned to the left.\n    get alignBlockLeft () {\n        return {\n            name: 'alignBlockLeft',\n            title: 'Left aligned image',\n            icon: icons.objectBlockLeft,\n            modelElements: [\n                'imageBlock'\n            ],\n            className: 'image-style-block-align-left'\n        };\n    },\n    // This style represents a centered image.\n    get alignCenter () {\n        return {\n            name: 'alignCenter',\n            title: 'Centered image',\n            icon: icons.objectCenter,\n            modelElements: [\n                'imageBlock'\n            ],\n            className: 'image-style-align-center'\n        };\n    },\n    // This style represents an image aligned to the right and wrapped with text.\n    get alignRight () {\n        return {\n            name: 'alignRight',\n            title: 'Right aligned image',\n            icon: icons.objectRight,\n            modelElements: [\n                'imageBlock',\n                'imageInline'\n            ],\n            className: 'image-style-align-right'\n        };\n    },\n    // This style represents an image aligned to the right.\n    get alignBlockRight () {\n        return {\n            name: 'alignBlockRight',\n            title: 'Right aligned image',\n            icon: icons.objectBlockRight,\n            modelElements: [\n                'imageBlock'\n            ],\n            className: 'image-style-block-align-right'\n        };\n    },\n    // This option is equal to the situation when no style is applied.\n    get block () {\n        return {\n            name: 'block',\n            title: 'Centered image',\n            icon: icons.objectCenter,\n            modelElements: [\n                'imageBlock'\n            ],\n            isDefault: true\n        };\n    },\n    // This represents a side image.\n    get side () {\n        return {\n            name: 'side',\n            title: 'Side image',\n            icon: icons.objectRight,\n            modelElements: [\n                'imageBlock'\n            ],\n            className: 'image-style-side'\n        };\n    }\n};\n/**\n * Default image style icons provided by the plugin that can be referred in the {@link module:image/imageconfig~ImageConfig#styles}\n * configuration.\n *\n * See {@link module:image/imageconfig~ImageStyleOptionDefinition#icon} to learn more.\n *\n * There are 7 default icons available: `'full'`, `'left'`, `'inlineLeft'`, `'center'`, `'right'`, `'inlineRight'`, and `'inline'`.\n */ const DEFAULT_ICONS = /* #__PURE__ */ (()=>({\n        full: icons.objectFullWidth,\n        left: icons.objectBlockLeft,\n        right: icons.objectBlockRight,\n        center: icons.objectCenter,\n        inlineLeft: icons.objectLeft,\n        inlineRight: icons.objectRight,\n        inline: icons.objectInline\n    }))();\n/**\n * Default drop-downs provided by the plugin that can be referred in the {@link module:image/imageconfig~ImageConfig#toolbar}\n * configuration. The drop-downs are containers for the {@link module:image/imageconfig~ImageStyleConfig#options image style options}.\n *\n * If both of the `ImageEditing` plugins are loaded, there are 2 predefined drop-downs available:\n *\n * * **`'imageStyle:wrapText'`**, which contains the `alignLeft` and `alignRight` options, that is,\n * those that wraps the text around the image,\n * * **`'imageStyle:breakText'`**, which contains the `alignBlockLeft`, `alignCenter` and `alignBlockRight` options, that is,\n * those that breaks the text around the image.\n */ const DEFAULT_DROPDOWN_DEFINITIONS = [\n    {\n        name: 'imageStyle:wrapText',\n        title: 'Wrap text',\n        defaultItem: 'imageStyle:alignLeft',\n        items: [\n            'imageStyle:alignLeft',\n            'imageStyle:alignRight'\n        ]\n    },\n    {\n        name: 'imageStyle:breakText',\n        title: 'Break text',\n        defaultItem: 'imageStyle:block',\n        items: [\n            'imageStyle:alignBlockLeft',\n            'imageStyle:block',\n            'imageStyle:alignBlockRight'\n        ]\n    }\n];\n/**\n * Returns a list of the normalized and validated image style options.\n *\n * @param config\n * @param config.isInlinePluginLoaded\n * Determines whether the {@link module:image/image/imageblockediting~ImageBlockEditing `ImageBlockEditing`} plugin has been loaded.\n * @param config.isBlockPluginLoaded\n * Determines whether the {@link module:image/image/imageinlineediting~ImageInlineEditing `ImageInlineEditing`} plugin has been loaded.\n * @param config.configuredStyles\n * The image styles configuration provided in the image styles {@link module:image/imageconfig~ImageConfig#styles configuration}\n * as a default or custom value.\n * @returns\n * * Each of options contains a complete icon markup.\n * * The image style options not supported by any of the loaded plugins are filtered out.\n */ function normalizeStyles(config) {\n    const configuredStyles = config.configuredStyles.options || [];\n    const styles = configuredStyles.map((arrangement)=>normalizeDefinition(arrangement)).filter((arrangement)=>isValidOption(arrangement, config));\n    return styles;\n}\n/**\n * Returns the default image styles configuration depending on the loaded image editing plugins.\n *\n * @param isInlinePluginLoaded\n * Determines whether the {@link module:image/image/imageblockediting~ImageBlockEditing `ImageBlockEditing`} plugin has been loaded.\n *\n * @param isBlockPluginLoaded\n * Determines whether the {@link module:image/image/imageinlineediting~ImageInlineEditing `ImageInlineEditing`} plugin has been loaded.\n *\n * @returns\n * It returns an object with the lists of the image style options and groups defined as strings related to the\n * {@link module:image/imagestyle/utils#DEFAULT_OPTIONS default options}\n */ function getDefaultStylesConfiguration(isBlockPluginLoaded, isInlinePluginLoaded) {\n    if (isBlockPluginLoaded && isInlinePluginLoaded) {\n        return {\n            options: [\n                'inline',\n                'alignLeft',\n                'alignRight',\n                'alignCenter',\n                'alignBlockLeft',\n                'alignBlockRight',\n                'block',\n                'side'\n            ]\n        };\n    } else if (isBlockPluginLoaded) {\n        return {\n            options: [\n                'block',\n                'side'\n            ]\n        };\n    } else if (isInlinePluginLoaded) {\n        return {\n            options: [\n                'inline',\n                'alignLeft',\n                'alignRight'\n            ]\n        };\n    }\n    return {};\n}\n/**\n * Returns a list of the available predefined drop-downs' definitions depending on the loaded image editing plugins.\n */ function getDefaultDropdownDefinitions(pluginCollection) {\n    if (pluginCollection.has('ImageBlockEditing') && pluginCollection.has('ImageInlineEditing')) {\n        return [\n            ...DEFAULT_DROPDOWN_DEFINITIONS\n        ];\n    } else {\n        return [];\n    }\n}\n/**\n * Normalizes an image style option or group provided in the {@link module:image/imageconfig~ImageConfig#styles}\n * and returns it in a {@link module:image/imageconfig~ImageStyleOptionDefinition}/\n */ function normalizeDefinition(definition) {\n    if (typeof definition === 'string') {\n        // Just the name of the style has been passed, but none of the defaults.\n        if (!DEFAULT_OPTIONS[definition]) {\n            // Normalize the style anyway to prevent errors.\n            definition = {\n                name: definition\n            };\n        } else {\n            definition = {\n                ...DEFAULT_OPTIONS[definition]\n            };\n        }\n    } else {\n        // If an object style has been passed and if the name matches one of the defaults,\n        // extend it with defaults – the user wants to customize a default style.\n        // Note: Don't override the user–defined style object, clone it instead.\n        definition = extendStyle(DEFAULT_OPTIONS[definition.name], definition);\n    }\n    // If an icon is defined as a string and correspond with a name\n    // in default icons, use the default icon provided by the plugin.\n    if (typeof definition.icon === 'string') {\n        definition.icon = DEFAULT_ICONS[definition.icon] || definition.icon;\n    }\n    return definition;\n}\n/**\n * Checks if the image style option is valid:\n * * if it has the modelElements fields defined and filled,\n * * if the defined modelElements are supported by any of the loaded image editing plugins.\n * It also displays a console warning these conditions are not met.\n *\n * @param option image style option\n */ function isValidOption(option, { isBlockPluginLoaded, isInlinePluginLoaded }) {\n    const { modelElements, name } = option;\n    if (!modelElements || !modelElements.length || !name) {\n        warnInvalidStyle({\n            style: option\n        });\n        return false;\n    } else {\n        const supportedElements = [\n            isBlockPluginLoaded ? 'imageBlock' : null,\n            isInlinePluginLoaded ? 'imageInline' : null\n        ];\n        // Check if the option is supported by any of the loaded plugins.\n        if (!modelElements.some((elementName)=>supportedElements.includes(elementName))) {\n            /**\n\t\t\t * In order to work correctly, each image style {@link module:image/imageconfig~ImageStyleOptionDefinition option}\n\t\t\t * requires specific model elements (also: types of images) to be supported by the editor.\n\t\t\t *\n\t\t\t * Model element names to which the image style option can be applied are defined in the\n\t\t\t * {@link module:image/imageconfig~ImageStyleOptionDefinition#modelElements} property of the style option\n\t\t\t * definition.\n\t\t\t *\n\t\t\t * Explore the warning in the console to find out precisely which option is not supported and which editor plugins\n\t\t\t * are missing. Make sure these plugins are loaded in your editor to get this image style option working.\n\t\t\t *\n\t\t\t * @error image-style-missing-dependency\n\t\t\t * @param {String} [option] The name of the unsupported option.\n\t\t\t * @param {String} [missingPlugins] The names of the plugins one of which has to be loaded for the particular option.\n\t\t\t */ logWarning('image-style-missing-dependency', {\n                style: option,\n                missingPlugins: modelElements.map((name)=>name === 'imageBlock' ? 'ImageBlockEditing' : 'ImageInlineEditing')\n            });\n            return false;\n        }\n    }\n    return true;\n}\n/**\n * Extends the default style with a style provided by the developer.\n * Note: Don't override the custom–defined style object, clone it instead.\n */ function extendStyle(source, style) {\n    const extendedStyle = {\n        ...style\n    };\n    for(const prop in source){\n        if (!Object.prototype.hasOwnProperty.call(style, prop)) {\n            extendedStyle[prop] = source[prop];\n        }\n    }\n    return extendedStyle;\n}\n/**\n * Displays a console warning with the 'image-style-configuration-definition-invalid' error.\n */ function warnInvalidStyle(info) {\n    /**\n\t * The image style definition provided in the configuration is invalid.\n\t *\n\t * Please make sure the definition implements properly one of the following:\n\t *\n\t * * {@link module:image/imageconfig~ImageStyleOptionDefinition image style option definition},\n\t * * {@link module:image/imageconfig~ImageStyleDropdownDefinition image style dropdown definition}\n\t *\n\t * @error image-style-configuration-definition-invalid\n\t * @param {String} [dropdown] The name of the invalid drop-down\n\t * @param {String} [style] The name of the invalid image style option\n\t */ logWarning('image-style-configuration-definition-invalid', info);\n}\nvar utils = {\n    normalizeStyles,\n    getDefaultStylesConfiguration,\n    getDefaultDropdownDefinitions,\n    warnInvalidStyle,\n    DEFAULT_OPTIONS,\n    DEFAULT_ICONS,\n    DEFAULT_DROPDOWN_DEFINITIONS\n};\n\n/**\n * @module image/imagestyle/converters\n */ /**\n * Returns a converter for the `imageStyle` attribute. It can be used for adding, changing and removing the attribute.\n *\n * @param styles An array containing available image style options.\n * @returns A model-to-view attribute converter.\n */ function modelToViewStyleAttribute(styles) {\n    return (evt, data, conversionApi)=>{\n        if (!conversionApi.consumable.consume(data.item, evt.name)) {\n            return;\n        }\n        // Check if there is class name associated with given value.\n        const newStyle = getStyleDefinitionByName(data.attributeNewValue, styles);\n        const oldStyle = getStyleDefinitionByName(data.attributeOldValue, styles);\n        const viewElement = conversionApi.mapper.toViewElement(data.item);\n        const viewWriter = conversionApi.writer;\n        if (oldStyle) {\n            viewWriter.removeClass(oldStyle.className, viewElement);\n        }\n        if (newStyle) {\n            viewWriter.addClass(newStyle.className, viewElement);\n        }\n    };\n}\n/**\n * Returns a view-to-model converter converting image CSS classes to a proper value in the model.\n *\n * @param styles Image style options for which the converter is created.\n * @returns A view-to-model converter.\n */ function viewToModelStyleAttribute(styles) {\n    // Convert only non–default styles.\n    const nonDefaultStyles = {\n        imageInline: styles.filter((style)=>!style.isDefault && style.modelElements.includes('imageInline')),\n        imageBlock: styles.filter((style)=>!style.isDefault && style.modelElements.includes('imageBlock'))\n    };\n    return (evt, data, conversionApi)=>{\n        if (!data.modelRange) {\n            return;\n        }\n        const viewElement = data.viewItem;\n        const modelImageElement = first(data.modelRange.getItems());\n        // Run this converter only if an image has been found in the model.\n        // In some cases it may not be found (for example if we run this on a figure with different type than image).\n        if (!modelImageElement) {\n            return;\n        }\n        // ...and the `imageStyle` attribute is allowed for that element, otherwise stop conversion early.\n        if (!conversionApi.schema.checkAttribute(modelImageElement, 'imageStyle')) {\n            return;\n        }\n        // Convert styles one by one.\n        for (const style of nonDefaultStyles[modelImageElement.name]){\n            // Try to consume class corresponding with the style.\n            if (conversionApi.consumable.consume(viewElement, {\n                classes: style.className\n            })) {\n                // And convert this style to model attribute.\n                conversionApi.writer.setAttribute('imageStyle', style.name, modelImageElement);\n            }\n        }\n    };\n}\n/**\n * Returns the style with a given `name` from an array of styles.\n */ function getStyleDefinitionByName(name, styles) {\n    for (const style of styles){\n        if (style.name === name) {\n            return style;\n        }\n    }\n}\n\n/**\n * The image style engine plugin. It sets the default configuration, creates converters and registers\n * {@link module:image/imagestyle/imagestylecommand~ImageStyleCommand ImageStyleCommand}.\n */ class ImageStyleEditing extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageStyleEditing';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageUtils\n        ];\n    }\n    /**\n\t * It contains a list of the normalized and validated style options.\n\t *\n\t * * Each option contains a complete icon markup.\n\t * * The style options not supported by any of the loaded image editing plugins (\n\t * {@link module:image/image/imageinlineediting~ImageInlineEditing `ImageInlineEditing`} or\n\t * {@link module:image/image/imageblockediting~ImageBlockEditing `ImageBlockEditing`}) are filtered out.\n\t *\n\t * @internal\n\t * @readonly\n\t */ normalizedStyles;\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const { normalizeStyles, getDefaultStylesConfiguration } = utils;\n        const editor = this.editor;\n        const isBlockPluginLoaded = editor.plugins.has('ImageBlockEditing');\n        const isInlinePluginLoaded = editor.plugins.has('ImageInlineEditing');\n        editor.config.define('image.styles', getDefaultStylesConfiguration(isBlockPluginLoaded, isInlinePluginLoaded));\n        this.normalizedStyles = normalizeStyles({\n            configuredStyles: editor.config.get('image.styles'),\n            isBlockPluginLoaded,\n            isInlinePluginLoaded\n        });\n        this._setupConversion(isBlockPluginLoaded, isInlinePluginLoaded);\n        this._setupPostFixer();\n        // Register imageStyle command.\n        editor.commands.add('imageStyle', new ImageStyleCommand(editor, this.normalizedStyles));\n    }\n    /**\n\t * Sets the editor conversion taking the presence of\n\t * {@link module:image/image/imageinlineediting~ImageInlineEditing `ImageInlineEditing`}\n\t * and {@link module:image/image/imageblockediting~ImageBlockEditing `ImageBlockEditing`} plugins into consideration.\n\t */ _setupConversion(isBlockPluginLoaded, isInlinePluginLoaded) {\n        const editor = this.editor;\n        const schema = editor.model.schema;\n        const modelToViewConverter = modelToViewStyleAttribute(this.normalizedStyles);\n        const viewToModelConverter = viewToModelStyleAttribute(this.normalizedStyles);\n        editor.editing.downcastDispatcher.on('attribute:imageStyle', modelToViewConverter);\n        editor.data.downcastDispatcher.on('attribute:imageStyle', modelToViewConverter);\n        // Allow imageStyle attribute in image and imageInline.\n        // We could call it 'style' but https://github.com/ckeditor/ckeditor5-engine/issues/559.\n        if (isBlockPluginLoaded) {\n            schema.extend('imageBlock', {\n                allowAttributes: 'imageStyle'\n            });\n            // Converter for figure element from view to model.\n            editor.data.upcastDispatcher.on('element:figure', viewToModelConverter, {\n                priority: 'low'\n            });\n        }\n        if (isInlinePluginLoaded) {\n            schema.extend('imageInline', {\n                allowAttributes: 'imageStyle'\n            });\n            // Converter for the img element from view to model.\n            editor.data.upcastDispatcher.on('element:img', viewToModelConverter, {\n                priority: 'low'\n            });\n        }\n    }\n    /**\n\t * Registers a post-fixer that will make sure that the style attribute value is correct for a specific image type (block vs inline).\n\t */ _setupPostFixer() {\n        const editor = this.editor;\n        const document = editor.model.document;\n        const imageUtils = editor.plugins.get(ImageUtils);\n        const stylesMap = new Map(this.normalizedStyles.map((style)=>[\n                style.name,\n                style\n            ]));\n        // Make sure that style attribute is valid for the image type.\n        document.registerPostFixer((writer)=>{\n            let changed = false;\n            for (const change of document.differ.getChanges()){\n                if (change.type == 'insert' || change.type == 'attribute' && change.attributeKey == 'imageStyle') {\n                    let element = change.type == 'insert' ? change.position.nodeAfter : change.range.start.nodeAfter;\n                    if (element && element.is('element', 'paragraph') && element.childCount > 0) {\n                        element = element.getChild(0);\n                    }\n                    if (!imageUtils.isImage(element)) {\n                        continue;\n                    }\n                    const imageStyle = element.getAttribute('imageStyle');\n                    if (!imageStyle) {\n                        continue;\n                    }\n                    const imageStyleDefinition = stylesMap.get(imageStyle);\n                    if (!imageStyleDefinition || !imageStyleDefinition.modelElements.includes(element.name)) {\n                        writer.removeAttribute('imageStyle', element);\n                        changed = true;\n                    }\n                }\n            }\n            return changed;\n        });\n    }\n}\n\n/**\n * The image style UI plugin.\n *\n * It registers buttons corresponding to the {@link module:image/imageconfig~ImageConfig#styles} configuration.\n * It also registers the {@link module:image/imagestyle/utils#DEFAULT_DROPDOWN_DEFINITIONS default drop-downs} and the\n * custom drop-downs defined by the developer in the {@link module:image/imageconfig~ImageConfig#toolbar} configuration.\n */ class ImageStyleUI extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageStyleEditing\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageStyleUI';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * Returns the default localized style titles provided by the plugin.\n\t *\n\t * The following localized titles corresponding with\n\t * {@link module:image/imagestyle/utils#DEFAULT_OPTIONS} are available:\n\t *\n\t * * `'Wrap text'`,\n\t * * `'Break text'`,\n\t * * `'In line'`,\n\t * * `'Full size image'`,\n\t * * `'Side image'`,\n\t * * `'Left aligned image'`,\n\t * * `'Centered image'`,\n\t * * `'Right aligned image'`\n\t */ get localizedDefaultStylesTitles() {\n        const t = this.editor.t;\n        return {\n            'Wrap text': t('Wrap text'),\n            'Break text': t('Break text'),\n            'In line': t('In line'),\n            'Full size image': t('Full size image'),\n            'Side image': t('Side image'),\n            'Left aligned image': t('Left aligned image'),\n            'Centered image': t('Centered image'),\n            'Right aligned image': t('Right aligned image')\n        };\n    }\n    /**\n\t * @inheritDoc\n\t */ init() {\n        const plugins = this.editor.plugins;\n        const toolbarConfig = this.editor.config.get('image.toolbar') || [];\n        const imageStyleEditing = plugins.get('ImageStyleEditing');\n        const definedStyles = translateStyles(imageStyleEditing.normalizedStyles, this.localizedDefaultStylesTitles);\n        for (const styleConfig of definedStyles){\n            this._createButton(styleConfig);\n        }\n        const definedDropdowns = translateStyles([\n            ...toolbarConfig.filter(isObject),\n            ...utils.getDefaultDropdownDefinitions(plugins)\n        ], this.localizedDefaultStylesTitles);\n        for (const dropdownConfig of definedDropdowns){\n            this._createDropdown(dropdownConfig, definedStyles);\n        }\n    }\n    /**\n\t * Creates a dropdown and stores it in the editor {@link module:ui/componentfactory~ComponentFactory}.\n\t */ _createDropdown(dropdownConfig, definedStyles) {\n        const factory = this.editor.ui.componentFactory;\n        factory.add(dropdownConfig.name, (locale)=>{\n            let defaultButton;\n            const { defaultItem, items, title } = dropdownConfig;\n            const buttonViews = items.filter((itemName)=>definedStyles.find(({ name })=>getUIComponentName(name) === itemName)).map((buttonName)=>{\n                const button = factory.create(buttonName);\n                if (buttonName === defaultItem) {\n                    defaultButton = button;\n                }\n                return button;\n            });\n            if (items.length !== buttonViews.length) {\n                utils.warnInvalidStyle({\n                    dropdown: dropdownConfig\n                });\n            }\n            const dropdownView = createDropdown(locale, SplitButtonView);\n            const splitButtonView = dropdownView.buttonView;\n            const splitButtonViewArrow = splitButtonView.arrowView;\n            addToolbarToDropdown(dropdownView, buttonViews, {\n                enableActiveItemFocusOnDropdownOpen: true\n            });\n            splitButtonView.set({\n                label: getDropdownButtonTitle(title, defaultButton.label),\n                class: null,\n                tooltip: true\n            });\n            splitButtonViewArrow.unbind('label');\n            splitButtonViewArrow.set({\n                label: title\n            });\n            splitButtonView.bind('icon').toMany(buttonViews, 'isOn', (...areOn)=>{\n                const index = areOn.findIndex(identity);\n                return index < 0 ? defaultButton.icon : buttonViews[index].icon;\n            });\n            splitButtonView.bind('label').toMany(buttonViews, 'isOn', (...areOn)=>{\n                const index = areOn.findIndex(identity);\n                return getDropdownButtonTitle(title, index < 0 ? defaultButton.label : buttonViews[index].label);\n            });\n            splitButtonView.bind('isOn').toMany(buttonViews, 'isOn', (...areOn)=>areOn.some(identity));\n            splitButtonView.bind('class').toMany(buttonViews, 'isOn', (...areOn)=>areOn.some(identity) ? 'ck-splitbutton_flatten' : undefined);\n            splitButtonView.on('execute', ()=>{\n                if (!buttonViews.some(({ isOn })=>isOn)) {\n                    defaultButton.fire('execute');\n                } else {\n                    dropdownView.isOpen = !dropdownView.isOpen;\n                }\n            });\n            dropdownView.bind('isEnabled').toMany(buttonViews, 'isEnabled', (...areEnabled)=>areEnabled.some(identity));\n            // Focus the editable after executing the command.\n            // Overrides a default behaviour where the focus is moved to the dropdown button (#12125).\n            this.listenTo(dropdownView, 'execute', ()=>{\n                this.editor.editing.view.focus();\n            });\n            return dropdownView;\n        });\n    }\n    /**\n\t * Creates a button and stores it in the editor {@link module:ui/componentfactory~ComponentFactory}.\n\t */ _createButton(buttonConfig) {\n        const buttonName = buttonConfig.name;\n        this.editor.ui.componentFactory.add(getUIComponentName(buttonName), (locale)=>{\n            const command = this.editor.commands.get('imageStyle');\n            const view = new ButtonView(locale);\n            view.set({\n                label: buttonConfig.title,\n                icon: buttonConfig.icon,\n                tooltip: true,\n                isToggleable: true\n            });\n            view.bind('isEnabled').to(command, 'isEnabled');\n            view.bind('isOn').to(command, 'value', (value)=>value === buttonName);\n            view.on('execute', this._executeCommand.bind(this, buttonName));\n            return view;\n        });\n    }\n    _executeCommand(name) {\n        this.editor.execute('imageStyle', {\n            value: name\n        });\n        this.editor.editing.view.focus();\n    }\n}\n/**\n * Returns the translated `title` from the passed styles array.\n */ function translateStyles(styles, titles) {\n    for (const style of styles){\n        // Localize the titles of the styles, if a title corresponds with\n        // a localized default provided by the plugin.\n        if (titles[style.title]) {\n            style.title = titles[style.title];\n        }\n    }\n    return styles;\n}\n/**\n * Returns the image style component name with the \"imageStyle:\" prefix.\n */ function getUIComponentName(name) {\n    return `imageStyle:${name}`;\n}\n/**\n * Returns title for the splitbutton containing the dropdown title and default action item title.\n */ function getDropdownButtonTitle(dropdownTitle, buttonTitle) {\n    return (dropdownTitle ? dropdownTitle + ': ' : '') + buttonTitle;\n}\n\n/**\n * The image style plugin.\n *\n * For a detailed overview of the image styles feature, check the {@glink features/images/images-styles documentation}.\n *\n * This is a \"glue\" plugin which loads the following plugins:\n * * {@link module:image/imagestyle/imagestyleediting~ImageStyleEditing},\n * * {@link module:image/imagestyle/imagestyleui~ImageStyleUI}\n *\n * It provides a default configuration, which can be extended or overwritten.\n * Read more about the {@link module:image/imageconfig~ImageConfig#styles image styles configuration}.\n */ class ImageStyle extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageStyleEditing,\n            ImageStyleUI\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageStyle';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n}\n\n/**\n * The image toolbar plugin. It creates and manages the image toolbar (the toolbar displayed when an image is selected).\n *\n * For an overview, check the {@glink features/images/images-overview#image-contextual-toolbar image contextual toolbar} documentation.\n *\n * Instances of toolbar components (e.g. buttons) are created using the editor's\n * {@link module:ui/componentfactory~ComponentFactory component factory}\n * based on the {@link module:image/imageconfig~ImageConfig#toolbar `image.toolbar` configuration option}.\n *\n * The toolbar uses the {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon}.\n */ class ImageToolbar extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            WidgetToolbarRepository,\n            ImageUtils\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'ImageToolbar';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ afterInit() {\n        const editor = this.editor;\n        const t = editor.t;\n        const widgetToolbarRepository = editor.plugins.get(WidgetToolbarRepository);\n        const imageUtils = editor.plugins.get('ImageUtils');\n        widgetToolbarRepository.register('image', {\n            ariaLabel: t('Image toolbar'),\n            items: normalizeDeclarativeConfig(editor.config.get('image.toolbar') || []),\n            getRelatedElement: (selection)=>imageUtils.getClosestSelectedImageWidget(selection)\n        });\n    }\n}\n/**\n * Convert the dropdown definitions to their keys registered in the ComponentFactory.\n * The registration precess should be handled by the plugin which handles the UI of a particular feature.\n */ function normalizeDeclarativeConfig(config) {\n    return config.map((item)=>isObject(item) ? item.name : item);\n}\n\n/**\n * This plugin enables the [`<picture>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/picture) element support in the editor.\n *\n * * It enables the `sources` model attribute on `imageBlock` and `imageInline` model elements\n * (brought by {@link module:image/imageblock~ImageBlock} and {@link module:image/imageinline~ImageInline}, respectively).\n * * It translates the `sources` model element to the view (also: data) structure that may look as follows:\n *\n * ```html\n * <p>Inline image using picture:\n * \t<picture>\n * \t\t<source media=\"(min-width: 800px)\" srcset=\"image-large.webp\" type=\"image/webp\">\n * \t\t<source media=\"(max-width: 800px)\" srcset=\"image-small.webp\" type=\"image/webp\">\n * \t\t<!-- Other sources as specified in the \"sources\" model attribute... -->\n * \t\t<img src=\"image.png\" alt=\"An image using picture\" />\n * \t</picture>\n * </p>\n *\n * <p>Block image using picture:</p>\n * <figure class=\"image\">\n * \t<picture>\n * \t\t<source media=\"(min-width: 800px)\" srcset=\"image-large.webp\" type=\"image/webp\">\n * \t\t<source media=\"(max-width: 800px)\" srcset=\"image-small.webp\" type=\"image/webp\">\n * \t\t<!-- Other sources as specified in the \"sources\" model attribute... -->\n * \t\t<img src=\"image.png\" alt=\"An image using picture\" />\n * \t</picture>\n * \t<figcaption>Caption of the image</figcaption>\n * </figure>\n * ```\n *\n * **Note:** The value of the `sources` {@glink framework/architecture/editing-engine#changing-the-model model attribute}\n * in both examples equals:\n *\n * ```css\n * [\n * \t{\n * \t\tmedia: '(min-width: 800px)',\n * \t\tsrcset: 'image-large.webp',\n * \t\ttype: 'image/webp'\n * \t},\n * \t{\n * \t\tmedia: '(max-width: 800px)',\n * \t\tsrcset: 'image-small.webp',\n * \t\ttype: 'image/webp'\n * \t}\n * ]\n * ```\n *\n * * It integrates with the {@link module:image/imageupload~ImageUpload} plugin so images uploaded in the editor\n * automatically render using `<picture>` if the {@glink features/images/image-upload/image-upload upload adapter}\n * supports image sources and provides neccessary data.\n *\n * @private\n */ class PictureEditing extends Plugin {\n    /**\n\t * @inheritDoc\n\t */ static get requires() {\n        return [\n            ImageEditing,\n            ImageUtils\n        ];\n    }\n    /**\n\t * @inheritDoc\n\t */ static get pluginName() {\n        return 'PictureEditing';\n    }\n    /**\n\t * @inheritDoc\n\t */ static get isOfficialPlugin() {\n        return true;\n    }\n    /**\n\t * @inheritDoc\n\t */ afterInit() {\n        const editor = this.editor;\n        if (editor.plugins.has('ImageBlockEditing')) {\n            editor.model.schema.extend('imageBlock', {\n                allowAttributes: [\n                    'sources'\n                ]\n            });\n        }\n        if (editor.plugins.has('ImageInlineEditing')) {\n            editor.model.schema.extend('imageInline', {\n                allowAttributes: [\n                    'sources'\n                ]\n            });\n        }\n        this._setupConversion();\n        this._setupImageUploadEditingIntegration();\n    }\n    /**\n\t * Configures conversion pipelines to support upcasting and downcasting images using the `<picture>` view element\n\t * and the model `sources` attribute.\n\t */ _setupConversion() {\n        const editor = this.editor;\n        const conversion = editor.conversion;\n        const imageUtils = editor.plugins.get('ImageUtils');\n        conversion.for('upcast').add(upcastPicture(imageUtils));\n        conversion.for('downcast').add(downcastSourcesAttribute(imageUtils));\n    }\n    /**\n\t * Makes it possible for uploaded images to get the `sources` model attribute and the `<picture>...</picture>`\n\t * view structure out-of-the-box if relevant data is provided along the\n\t * {@link module:image/imageupload/imageuploadediting~ImageUploadEditing#event:uploadComplete} event.\n\t */ _setupImageUploadEditingIntegration() {\n        const editor = this.editor;\n        if (!editor.plugins.has('ImageUploadEditing')) {\n            return;\n        }\n        const imageUploadEditing = editor.plugins.get('ImageUploadEditing');\n        this.listenTo(imageUploadEditing, 'uploadComplete', (evt, { imageElement, data })=>{\n            const sources = data.sources;\n            if (!sources) {\n                return;\n            }\n            editor.model.change((writer)=>{\n                writer.setAttributes({\n                    sources\n                }, imageElement);\n            });\n        });\n    }\n}\n\nexport { AutoImage, Image, ImageBlock, ImageBlockEditing, ImageCaption, ImageCaptionEditing, ImageCaptionUI, ImageCaptionUtils, ImageCustomResizeUI, ImageEditing, ImageInline, ImageInsert, ImageInsertUI, ImageInsertViaUrl, ImageResize, ImageResizeButtons, ImageResizeEditing, ImageResizeHandles, ImageSizeAttributes, ImageStyle, ImageStyleEditing, ImageStyleUI, ImageTextAlternative, ImageTextAlternativeEditing, ImageTextAlternativeUI, ImageToolbar, ImageUpload, ImageUploadEditing, ImageUploadProgress, ImageUploadUI, ImageUtils, PictureEditing, createImageTypeRegExp };\n//# sourceMappingURL=index.js.map\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/image/utils\n */\n\nimport type {\n\tDocumentSelection,\n\tMatcherPattern,\n\tSchema,\n\tSelection,\n\tViewContainerElement,\n\tDowncastWriter,\n\tViewElement\n} from 'ckeditor5/src/engine.js';\nimport type { Editor } from 'ckeditor5/src/core.js';\nimport { first } from 'ckeditor5/src/utils.js';\n\nimport type ImageUtils from '../imageutils.js';\n\n/**\n * Creates a view element representing the inline image.\n *\n * ```html\n * <span class=\"image-inline\"><img></img></span>\n * ```\n *\n * Note that `alt` and `src` attributes are converted separately, so they are not included.\n *\n * @internal\n */\nexport function createInlineImageViewElement( writer: DowncastWriter ): ViewContainerElement {\n\treturn writer.createContainerElement( 'span', { class: 'image-inline' },\n\t\twriter.createEmptyElement( 'img' )\n\t);\n}\n\n/**\n * Creates a view element representing the block image.\n *\n * ```html\n * <figure class=\"image\"><img></img></figure>\n * ```\n *\n * Note that `alt` and `src` attributes are converted separately, so they are not included.\n *\n * @internal\n */\nexport function createBlockImageViewElement( writer: DowncastWriter ): ViewContainerElement {\n\treturn writer.createContainerElement( 'figure', { class: 'image' }, [\n\t\twriter.createEmptyElement( 'img' ),\n\t\twriter.createSlot( 'children' )\n\t] );\n}\n\n/**\n * A function returning a `MatcherPattern` for a particular type of View images.\n *\n * @internal\n * @param matchImageType The type of created image.\n */\nexport function getImgViewElementMatcher( editor: Editor, matchImageType: 'imageBlock' | 'imageInline' ): MatcherPattern {\n\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\tconst areBothImagePluginsLoaded = editor.plugins.has( 'ImageInlineEditing' ) && editor.plugins.has( 'ImageBlockEditing' );\n\n\treturn element => {\n\t\t// Check if the matched view element is an <img>.\n\t\tif ( !imageUtils.isInlineImageView( element ) ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// If just one of the plugins is loaded (block or inline), it will match all kinds of images.\n\t\tif ( !areBothImagePluginsLoaded ) {\n\t\t\treturn getPositiveMatchPattern( element );\n\t\t}\n\n\t\t// The <img> can be standalone, wrapped in <figure>...</figure> (ImageBlock plugin) or\n\t\t// wrapped in <figure><a>...</a></figure> (LinkImage plugin).\n\t\tconst imageType = element.getStyle( 'display' ) == 'block' || element.findAncestor( imageUtils.isBlockImageView ) ?\n\t\t\t'imageBlock' :\n\t\t\t'imageInline';\n\n\t\tif ( imageType !== matchImageType ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn getPositiveMatchPattern( element );\n\t};\n\n\tfunction getPositiveMatchPattern( element: ViewElement ) {\n\t\tconst pattern: Record<string, unknown> = {\n\t\t\tname: true\n\t\t};\n\n\t\t// This will trigger src consumption (See https://github.com/ckeditor/ckeditor5/issues/11530).\n\t\tif ( element.hasAttribute( 'src' ) ) {\n\t\t\tpattern.attributes = [ 'src' ];\n\t\t}\n\n\t\treturn pattern;\n\t}\n}\n\n/**\n * Considering the current model selection, it returns the name of the model image element\n * (`'imageBlock'` or `'imageInline'`) that will make most sense from the UX perspective if a new\n * image was inserted (also: uploaded, dropped, pasted) at that selection.\n *\n * The assumption is that inserting images into empty blocks or on other block widgets should\n * produce block images. Inline images should be inserted in other cases, e.g. in paragraphs\n * that already contain some text.\n *\n * @internal\n */\nexport function determineImageTypeForInsertionAtSelection(\n\tschema: Schema,\n\tselection: Selection | DocumentSelection\n): 'imageBlock' | 'imageInline' {\n\tconst firstBlock = first( selection.getSelectedBlocks() );\n\n\t// Insert a block image if the selection is not in/on block elements or it's on a block widget.\n\tif ( !firstBlock || schema.isObject( firstBlock ) ) {\n\t\treturn 'imageBlock';\n\t}\n\n\t// A block image should also be inserted into an empty block element\n\t// (that is not an empty list item so the list won't get split).\n\tif ( firstBlock.isEmpty && firstBlock.name != 'listItem' ) {\n\t\treturn 'imageBlock';\n\t}\n\n\t// Otherwise insert an inline image.\n\treturn 'imageInline';\n}\n\n/**\n * Returns parsed value of the size, but only if it contains unit: px.\n */\nexport function getSizeValueIfInPx( size: string | undefined ): number | null {\n\tif ( size && size.endsWith( 'px' ) ) {\n\t\treturn parseInt( size );\n\t}\n\n\treturn null;\n}\n\n/**\n * Returns true if both styles (width and height) are set.\n *\n * If both image styles: width & height are set, they will override the image width & height attributes in the\n * browser. In this case, the image looks the same as if these styles were applied to attributes instead of styles.\n * That's why we can upcast these styles to width & height attributes instead of resizedWidth and resizedHeight.\n */\nexport function widthAndHeightStylesAreBothSet( viewElement: ViewElement ): boolean {\n\tconst widthStyle = getSizeValueIfInPx( viewElement.getStyle( 'width' ) );\n\tconst heightStyle = getSizeValueIfInPx( viewElement.getStyle( 'height' ) );\n\n\treturn !!( widthStyle && heightStyle );\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageutils\n */\n\nimport type {\n\tElement,\n\tViewElement,\n\tViewNode,\n\tDocumentSelection,\n\tViewDocumentSelection,\n\tSelection,\n\tViewSelection,\n\tDocumentFragment,\n\tViewDocumentFragment,\n\tDowncastWriter,\n\tModel,\n\tPosition,\n\tViewContainerElement\n} from 'ckeditor5/src/engine.js';\nimport { Plugin, type Editor } from 'ckeditor5/src/core.js';\nimport { findOptimalInsertionRange, isWidget, toWidget } from 'ckeditor5/src/widget.js';\nimport { determineImageTypeForInsertionAtSelection } from './image/utils.js';\nimport { DomEmitterMixin, type DomEmitter, global } from 'ckeditor5/src/utils.js';\n\nconst IMAGE_WIDGETS_CLASSES_MATCH_REGEXP = /^(image|image-inline)$/;\n\n/**\n * A set of helpers related to images.\n */\nexport default class ImageUtils extends Plugin {\n\t/**\n\t * DOM Emitter.\n\t */\n\tprivate _domEmitter: DomEmitter = new ( DomEmitterMixin() )();\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageUtils' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * Checks if the provided model element is an `image` or `imageInline`.\n\t */\n\tpublic isImage( modelElement?: Element | null ): modelElement is Element & { name: 'imageInline' | 'imageBlock' } {\n\t\treturn this.isInlineImage( modelElement ) || this.isBlockImage( modelElement );\n\t}\n\n\t/**\n\t * Checks if the provided view element represents an inline image.\n\t *\n\t * Also, see {@link module:image/imageutils~ImageUtils#isImageWidget}.\n\t */\n\tpublic isInlineImageView( element?: ViewElement | null ): boolean {\n\t\treturn !!element && element.is( 'element', 'img' );\n\t}\n\n\t/**\n\t * Checks if the provided view element represents a block image.\n\t *\n\t * Also, see {@link module:image/imageutils~ImageUtils#isImageWidget}.\n\t */\n\tpublic isBlockImageView( element?: ViewElement | null ): boolean {\n\t\treturn !!element && element.is( 'element', 'figure' ) && element.hasClass( 'image' );\n\t}\n\n\t/**\n\t * Handles inserting single file. This method unifies image insertion using {@link module:widget/utils~findOptimalInsertionRange}\n\t * method.\n\t *\n\t * ```ts\n\t * const imageUtils = editor.plugins.get( 'ImageUtils' );\n\t *\n\t * imageUtils.insertImage( { src: 'path/to/image.jpg' } );\n\t * ```\n\t *\n\t * @param attributes Attributes of the inserted image.\n\t * This method filters out the attributes which are disallowed by the {@link module:engine/model/schema~Schema}.\n\t * @param selectable Place to insert the image. If not specified,\n\t * the {@link module:widget/utils~findOptimalInsertionRange} logic will be applied for the block images\n\t * and `model.document.selection` for the inline images.\n\t *\n\t * **Note**: If `selectable` is passed, this helper will not be able to set selection attributes (such as `linkHref`)\n\t * and apply them to the new image. In this case, make sure all selection attributes are passed in `attributes`.\n\t *\n\t * @param imageType Image type of inserted image. If not specified,\n\t * it will be determined automatically depending of editor config or place of the insertion.\n\t * @param options.setImageSizes Specifies whether the image `width` and `height` attributes should be set automatically.\n\t * The default is `true`.\n\t * @return The inserted model image element.\n\t */\n\tpublic insertImage(\n\t\tattributes: Record<string, unknown> = {},\n\t\tselectable: Selection | Position | null = null,\n\t\timageType: ( 'imageBlock' | 'imageInline' | null ) = null,\n\t\toptions: { setImageSizes?: boolean } = {}\n\t): Element | null {\n\t\tconst editor = this.editor;\n\t\tconst model = editor.model;\n\t\tconst selection = model.document.selection;\n\n\t\tconst determinedImageType = determineImageTypeForInsertion( editor, selectable || selection, imageType );\n\n\t\t// Mix declarative attributes with selection attributes because the new image should \"inherit\"\n\t\t// the latter for best UX. For instance, inline images inserted into existing links\n\t\t// should not split them. To do that, they need to have \"linkHref\" inherited from the selection.\n\t\tattributes = {\n\t\t\t...Object.fromEntries( selection.getAttributes() ),\n\t\t\t...attributes\n\t\t};\n\n\t\tfor ( const attributeName in attributes ) {\n\t\t\tif ( !model.schema.checkAttribute( determinedImageType, attributeName ) ) {\n\t\t\t\tdelete attributes[ attributeName ];\n\t\t\t}\n\t\t}\n\n\t\treturn model.change( writer => {\n\t\t\tconst { setImageSizes = true } = options;\n\t\t\tconst imageElement = writer.createElement( determinedImageType, attributes );\n\n\t\t\tmodel.insertObject( imageElement, selectable, null, {\n\t\t\t\tsetSelection: 'on',\n\t\t\t\t// If we want to insert a block image (for whatever reason) then we don't want to split text blocks.\n\t\t\t\t// This applies only when we don't have the selectable specified (i.e., we insert multiple block images at once).\n\t\t\t\tfindOptimalPosition: !selectable && determinedImageType != 'imageInline' ? 'auto' : undefined\n\t\t\t} );\n\n\t\t\t// Inserting an image might've failed due to schema regulations.\n\t\t\tif ( imageElement.parent ) {\n\t\t\t\tif ( setImageSizes ) {\n\t\t\t\t\tthis.setImageNaturalSizeAttributes( imageElement );\n\t\t\t\t}\n\n\t\t\t\treturn imageElement;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t} );\n\t}\n\n\t/**\n\t * Reads original image sizes and sets them as `width` and `height`.\n\t *\n\t * The `src` attribute may not be available if the user is using an upload adapter. In such a case,\n\t * this method is called again after the upload process is complete and the `src` attribute is available.\n\t */\n\tpublic setImageNaturalSizeAttributes( imageElement: Element ): void {\n\t\tconst src = imageElement.getAttribute( 'src' ) as string;\n\n\t\tif ( !src ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( imageElement.getAttribute( 'width' ) || imageElement.getAttribute( 'height' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.editor.model.change( writer => {\n\t\t\tconst img = new global.window.Image();\n\n\t\t\tthis._domEmitter.listenTo( img, 'load', () => {\n\t\t\t\tif ( !imageElement.getAttribute( 'width' ) && !imageElement.getAttribute( 'height' ) ) {\n\t\t\t\t\t// We use writer.batch to be able to undo (in a single step) width and height setting\n\t\t\t\t\t// along with any change that triggered this action (e.g. image resize or image style change).\n\t\t\t\t\tthis.editor.model.enqueueChange( writer.batch, writer => {\n\t\t\t\t\t\twriter.setAttribute( 'width', img.naturalWidth, imageElement );\n\t\t\t\t\t\twriter.setAttribute( 'height', img.naturalHeight, imageElement );\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\tthis._domEmitter.stopListening( img, 'load' );\n\t\t\t} );\n\n\t\t\timg.src = src;\n\t\t} );\n\t}\n\n\t/**\n\t * Returns an image widget editing view element if one is selected or is among the selection's ancestors.\n\t */\n\tpublic getClosestSelectedImageWidget( selection: ViewSelection | ViewDocumentSelection ): ViewElement | null {\n\t\tconst selectionPosition = selection.getFirstPosition();\n\n\t\tif ( !selectionPosition ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst viewElement = selection.getSelectedElement();\n\n\t\tif ( viewElement && this.isImageWidget( viewElement ) ) {\n\t\t\treturn viewElement;\n\t\t}\n\n\t\tlet parent: ViewNode | ViewDocumentFragment | null = selectionPosition.parent;\n\n\t\twhile ( parent ) {\n\t\t\tif ( parent.is( 'element' ) && this.isImageWidget( parent ) ) {\n\t\t\t\treturn parent;\n\t\t\t}\n\n\t\t\tparent = parent.parent;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns a image model element if one is selected or is among the selection's ancestors.\n\t */\n\tpublic getClosestSelectedImageElement( selection: Selection | DocumentSelection ): Element | null {\n\t\tconst selectedElement = selection.getSelectedElement();\n\n\t\treturn this.isImage( selectedElement ) ? selectedElement : selection.getFirstPosition()!.findAncestor( 'imageBlock' );\n\t}\n\n\t/**\n\t * Returns an image widget editing view based on the passed image view.\n\t */\n\tpublic getImageWidgetFromImageView( imageView: ViewElement ): ViewContainerElement | null {\n\t\treturn imageView.findAncestor( { classes: IMAGE_WIDGETS_CLASSES_MATCH_REGEXP } ) as ( ViewContainerElement | null );\n\t}\n\n\t/**\n\t * Checks if image can be inserted at current model selection.\n\t *\n\t * @internal\n\t */\n\tpublic isImageAllowed(): boolean {\n\t\tconst model = this.editor.model;\n\t\tconst selection = model.document.selection;\n\n\t\treturn isImageAllowedInParent( this.editor, selection ) && isNotInsideImage( selection );\n\t}\n\n\t/**\n\t * Converts a given {@link module:engine/view/element~Element} to an image widget:\n\t * * Adds a {@link module:engine/view/element~Element#_setCustomProperty custom property} allowing to recognize the image widget\n\t * element.\n\t * * Calls the {@link module:widget/utils~toWidget} function with the proper element's label creator.\n\t *\n\t * @param writer An instance of the view writer.\n\t * @param label The element's label. It will be concatenated with the image `alt` attribute if one is present.\n\t */\n\tpublic toImageWidget( viewElement: ViewElement, writer: DowncastWriter, label: string ): ViewElement {\n\t\twriter.setCustomProperty( 'image', true, viewElement );\n\n\t\tconst labelCreator = () => {\n\t\t\tconst imgElement = this.findViewImgElement( viewElement )!;\n\t\t\tconst altText = imgElement.getAttribute( 'alt' );\n\n\t\t\treturn altText ? `${ altText } ${ label }` : label;\n\t\t};\n\n\t\treturn toWidget( viewElement, writer, { label: labelCreator } );\n\t}\n\n\t/**\n\t * Checks if a given view element is an image widget.\n\t */\n\tprotected isImageWidget( viewElement: ViewElement ): boolean {\n\t\treturn !!viewElement.getCustomProperty( 'image' ) && isWidget( viewElement );\n\t}\n\n\t/**\n\t * Checks if the provided model element is an `image`.\n\t */\n\tpublic isBlockImage( modelElement?: Element | null ): boolean {\n\t\treturn !!modelElement && modelElement.is( 'element', 'imageBlock' );\n\t}\n\n\t/**\n\t * Checks if the provided model element is an `imageInline`.\n\t */\n\tpublic isInlineImage( modelElement?: Element | null ): boolean {\n\t\treturn !!modelElement && modelElement.is( 'element', 'imageInline' );\n\t}\n\n\t/**\n\t * Get the view `<img>` from another view element, e.g. a widget (`<figure class=\"image\">`), a link (`<a>`).\n\t *\n\t * The `<img>` can be located deep in other elements, so this helper performs a deep tree search.\n\t */\n\tpublic findViewImgElement( figureView: ViewElement ): ViewElement | undefined {\n\t\tif ( this.isInlineImageView( figureView ) ) {\n\t\t\treturn figureView;\n\t\t}\n\n\t\tconst editingView = this.editor.editing.view;\n\n\t\tfor ( const { item } of editingView.createRangeIn( figureView ) ) {\n\t\t\tif ( this.isInlineImageView( item as ViewElement ) ) {\n\t\t\t\treturn item as ViewElement;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override destroy(): void {\n\t\tthis._domEmitter.stopListening();\n\n\t\treturn super.destroy();\n\t}\n}\n\n/**\n * Checks if image is allowed by schema in optimal insertion parent.\n */\nfunction isImageAllowedInParent( editor: Editor, selection: Selection | DocumentSelection ): boolean {\n\tconst imageType = determineImageTypeForInsertion( editor, selection, null );\n\n\tif ( imageType == 'imageBlock' ) {\n\t\tconst parent = getInsertImageParent( selection, editor.model );\n\n\t\tif ( editor.model.schema.checkChild( parent as Element, 'imageBlock' ) ) {\n\t\t\treturn true;\n\t\t}\n\t} else if ( editor.model.schema.checkChild( selection.focus!, 'imageInline' ) ) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n/**\n * Checks if selection is not placed inside an image (e.g. its caption).\n */\nfunction isNotInsideImage( selection: DocumentSelection ): boolean {\n\treturn [ ...selection.focus!.getAncestors() ].every( ancestor => !ancestor.is( 'element', 'imageBlock' ) );\n}\n\n/**\n * Returns a node that will be used to insert image with `model.insertContent`.\n */\nfunction getInsertImageParent( selection: Selection | DocumentSelection, model: Model ): Element | DocumentFragment {\n\tconst insertionRange = findOptimalInsertionRange( selection, model );\n\tconst parent = insertionRange.start.parent;\n\n\tif ( parent.isEmpty && !parent.is( 'element', '$root' ) ) {\n\t\treturn parent.parent!;\n\t}\n\n\treturn parent;\n}\n\n/**\n * Determine image element type name depending on editor config or place of insertion.\n *\n * @param imageType Image element type name. Used to force return of provided element name,\n * but only if there is proper plugin enabled.\n */\nfunction determineImageTypeForInsertion(\n\teditor: Editor,\n\tselectable: Position | Selection | DocumentSelection,\n\timageType: 'imageBlock' | 'imageInline' | null\n): 'imageBlock' | 'imageInline' {\n\tconst schema = editor.model.schema;\n\tconst configImageInsertType = editor.config.get( 'image.insert.type' );\n\n\tif ( !editor.plugins.has( 'ImageBlockEditing' ) ) {\n\t\treturn 'imageInline';\n\t}\n\n\tif ( !editor.plugins.has( 'ImageInlineEditing' ) ) {\n\t\treturn 'imageBlock';\n\t}\n\n\tif ( imageType ) {\n\t\treturn imageType;\n\t}\n\n\tif ( configImageInsertType === 'inline' ) {\n\t\treturn 'imageInline';\n\t}\n\n\tif ( configImageInsertType !== 'auto' ) {\n\t\treturn 'imageBlock';\n\t}\n\n\t// Try to replace the selected widget (e.g. another image).\n\tif ( selectable.is( 'selection' ) ) {\n\t\treturn determineImageTypeForInsertionAtSelection( schema, selectable );\n\t}\n\n\treturn schema.checkChild( selectable, 'imageInline' ) ? 'imageInline' : 'imageBlock';\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/autoimage\n */\n\nimport { Plugin, type Editor } from 'ckeditor5/src/core.js';\nimport { Clipboard, type ClipboardPipeline } from 'ckeditor5/src/clipboard.js';\nimport { LivePosition, LiveRange } from 'ckeditor5/src/engine.js';\nimport { Undo } from 'ckeditor5/src/undo.js';\nimport { Delete } from 'ckeditor5/src/typing.js';\nimport { global } from 'ckeditor5/src/utils.js';\n\nimport ImageUtils from './imageutils.js';\n\n// Implements the pattern: http(s)://(www.)example.com/path/to/resource.ext?query=params&maybe=too.\nconst IMAGE_URL_REGEXP = new RegExp( String( /^(http(s)?:\\/\\/)?[\\w-]+\\.[\\w.~:/[\\]@!$&'()*+,;=%-]+/.source +\n\t/\\.(jpg|jpeg|png|gif|ico|webp|JPG|JPEG|PNG|GIF|ICO|WEBP)/.source +\n\t/(\\?[\\w.~:/[\\]@!$&'()*+,;=%-]*)?/.source +\n\t/(#[\\w.~:/[\\]@!$&'()*+,;=%-]*)?$/.source ) );\n\n/**\n * The auto-image plugin. It recognizes image links in the pasted content and embeds\n * them shortly after they are injected into the document.\n */\nexport default class AutoImage extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ Clipboard, ImageUtils, Undo, Delete ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'AutoImage' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * The paste–to–embed `setTimeout` ID. Stored as a property to allow\n\t * cleaning of the timeout.\n\t */\n\tprivate _timeoutId: ReturnType<typeof setTimeout> | null;\n\n\t/**\n\t * The position where the `<imageBlock>` element will be inserted after the timeout,\n\t * determined each time a new content is pasted into the document.\n\t */\n\tprivate _positionToInsert: LivePosition | null;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( editor: Editor ) {\n\t\tsuper( editor );\n\n\t\tthis._timeoutId = null;\n\n\t\tthis._positionToInsert = null;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst editor = this.editor;\n\t\tconst modelDocument = editor.model.document;\n\t\tconst clipboardPipeline: ClipboardPipeline = editor.plugins.get( 'ClipboardPipeline' );\n\n\t\t// We need to listen on `Clipboard#inputTransformation` because we need to save positions of selection.\n\t\t// After pasting, the content between those positions will be checked for a URL that could be transformed\n\t\t// into an image.\n\t\tthis.listenTo( clipboardPipeline, 'inputTransformation', () => {\n\t\t\tconst firstRange = modelDocument.selection.getFirstRange()!;\n\n\t\t\tconst leftLivePosition = LivePosition.fromPosition( firstRange.start );\n\t\t\tleftLivePosition.stickiness = 'toPrevious';\n\n\t\t\tconst rightLivePosition = LivePosition.fromPosition( firstRange.end );\n\t\t\trightLivePosition.stickiness = 'toNext';\n\n\t\t\tmodelDocument.once( 'change:data', () => {\n\t\t\t\tthis._embedImageBetweenPositions( leftLivePosition, rightLivePosition );\n\n\t\t\t\tleftLivePosition.detach();\n\t\t\t\trightLivePosition.detach();\n\t\t\t}, { priority: 'high' } );\n\t\t} );\n\n\t\teditor.commands.get( 'undo' )!.on( 'execute', () => {\n\t\t\tif ( this._timeoutId ) {\n\t\t\t\tglobal.window.clearTimeout( this._timeoutId );\n\t\t\t\tthis._positionToInsert!.detach();\n\n\t\t\t\tthis._timeoutId = null;\n\t\t\t\tthis._positionToInsert = null;\n\t\t\t}\n\t\t}, { priority: 'high' } );\n\t}\n\n\t/**\n\t * Analyzes the part of the document between provided positions in search for a URL representing an image.\n\t * When the URL is found, it is automatically converted into an image.\n\t *\n\t * @param leftPosition Left position of the selection.\n\t * @param rightPosition Right position of the selection.\n\t */\n\tprivate _embedImageBetweenPositions( leftPosition: LivePosition, rightPosition: LivePosition ): void {\n\t\tconst editor = this.editor;\n\t\t// TODO: Use a marker instead of LiveRange & LivePositions.\n\t\tconst urlRange = new LiveRange( leftPosition, rightPosition );\n\t\tconst walker = urlRange.getWalker( { ignoreElementEnd: true } );\n\t\tconst selectionAttributes = Object.fromEntries( editor.model.document.selection.getAttributes() );\n\t\tconst imageUtils: ImageUtils = this.editor.plugins.get( 'ImageUtils' );\n\n\t\tlet src = '';\n\n\t\tfor ( const node of walker ) {\n\t\t\tif ( node.item.is( '$textProxy' ) ) {\n\t\t\t\tsrc += node.item.data;\n\t\t\t}\n\t\t}\n\n\t\tsrc = src.trim();\n\n\t\t// If the URL does not match the image URL regexp, let's skip that.\n\t\tif ( !src.match( IMAGE_URL_REGEXP ) ) {\n\t\t\turlRange.detach();\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Position will not be available in the `setTimeout` function so let's clone it.\n\t\tthis._positionToInsert = LivePosition.fromPosition( leftPosition );\n\n\t\t// This action mustn't be executed if undo was called between pasting and auto-embedding.\n\t\tthis._timeoutId = setTimeout( () => {\n\t\t\t// Do nothing if image element cannot be inserted at the current position.\n\t\t\t// See https://github.com/ckeditor/ckeditor5/issues/2763.\n\t\t\t// Condition must be checked after timeout - pasting may take place on an element, replacing it. The final position matters.\n\t\t\tconst imageCommand = editor.commands.get( 'insertImage' )!;\n\n\t\t\tif ( !imageCommand.isEnabled ) {\n\t\t\t\turlRange.detach();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\teditor.model.change( writer => {\n\t\t\t\tthis._timeoutId = null;\n\n\t\t\t\twriter.remove( urlRange );\n\t\t\t\turlRange.detach();\n\n\t\t\t\tlet insertionPosition;\n\n\t\t\t\t// Check if the position where the element should be inserted is still valid.\n\t\t\t\t// Otherwise leave it as undefined to use the logic of insertImage().\n\t\t\t\tif ( this._positionToInsert!.root.rootName !== '$graveyard' ) {\n\t\t\t\t\tinsertionPosition = this._positionToInsert!.toPosition();\n\t\t\t\t}\n\n\t\t\t\timageUtils.insertImage( { ...selectionAttributes, src }, insertionPosition );\n\n\t\t\t\tthis._positionToInsert!.detach();\n\t\t\t\tthis._positionToInsert = null;\n\t\t\t} );\n\n\t\t\tconst deletePlugin: Delete = editor.plugins.get( 'Delete' );\n\n\t\t\tdeletePlugin.requestUndoOnBackspace();\n\t\t}, 100 );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagetextalternative/imagetextalternativecommand\n */\n\nimport { Command } from 'ckeditor5/src/core.js';\nimport type ImageUtils from '../imageutils.js';\n\n/**\n * The image text alternative command. It is used to change the `alt` attribute of `<imageBlock>` and `<imageInline>` model elements.\n */\nexport default class ImageTextAlternativeCommand extends Command {\n\t/**\n\t * The command value: `false` if there is no `alt` attribute, otherwise the value of the `alt` attribute.\n\t *\n\t * @readonly\n\t * @observable\n\t */\n\tdeclare public value: string | false;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override refresh(): void {\n\t\tconst editor = this.editor;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst element = imageUtils.getClosestSelectedImageElement( this.editor.model.document.selection )!;\n\n\t\tthis.isEnabled = !!element;\n\n\t\tif ( this.isEnabled && element.hasAttribute( 'alt' ) ) {\n\t\t\tthis.value = element.getAttribute( 'alt' ) as string | false;\n\t\t} else {\n\t\t\tthis.value = false;\n\t\t}\n\t}\n\n\t/**\n\t * Executes the command.\n\t *\n\t * @fires execute\n\t * @param options\n\t * @param options.newValue The new value of the `alt` attribute to set.\n\t */\n\tpublic override execute( options: { newValue: string } ): void {\n\t\tconst editor = this.editor;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst model = editor.model;\n\t\tconst imageElement = imageUtils.getClosestSelectedImageElement( model.document.selection );\n\n\t\tmodel.change( writer => {\n\t\t\twriter.setAttribute( 'alt', options.newValue, imageElement! );\n\t\t} );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagetextalternative/imagetextalternativeediting\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport ImageTextAlternativeCommand from './imagetextalternativecommand.js';\nimport ImageUtils from '../imageutils.js';\n\n/**\n * The image text alternative editing plugin.\n *\n * Registers the `'imageTextAlternative'` command.\n */\nexport default class ImageTextAlternativeEditing extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageUtils ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageTextAlternativeEditing' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tthis.editor.commands.add( 'imageTextAlternative', new ImageTextAlternativeCommand( this.editor ) );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagetextalternative/ui/textalternativeformview\n */\n\nimport {\n\tButtonView,\n\tFocusCycler,\n\tLabeledFieldView,\n\tView,\n\tViewCollection,\n\tcreateLabeledInputText,\n\tsubmitHandler,\n\ttype InputView,\n\ttype FocusableView\n} from 'ckeditor5/src/ui.js';\nimport { FocusTracker, KeystrokeHandler, type Locale } from 'ckeditor5/src/utils.js';\nimport { icons } from 'ckeditor5/src/core.js';\n\nimport '../../../theme/textalternativeform.css';\n\n// See: #8833.\n// eslint-disable-next-line ckeditor5-rules/ckeditor-imports\nimport '@ckeditor/ckeditor5-ui/theme/components/responsive-form/responsiveform.css';\n\n/**\n * The TextAlternativeFormView class.\n */\nexport default class TextAlternativeFormView extends View {\n\t/**\n\t * Tracks information about the DOM focus in the form.\n\t */\n\tpublic readonly focusTracker: FocusTracker;\n\n\t/**\n\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\n\t */\n\tpublic readonly keystrokes: KeystrokeHandler;\n\n\t/**\n\t * An input with a label.\n\t */\n\tpublic labeledInput: LabeledFieldView<InputView>;\n\n\t/**\n\t * A button used to submit the form.\n\t */\n\tpublic saveButtonView: ButtonView;\n\n\t/**\n\t * A button used to cancel the form.\n\t */\n\tpublic cancelButtonView: ButtonView;\n\n\t/**\n\t * A collection of views which can be focused in the form.\n\t */\n\tprotected readonly _focusables: ViewCollection<FocusableView>;\n\n\t/**\n\t * Helps cycling over {@link #_focusables} in the form.\n\t */\n\tprotected readonly _focusCycler: FocusCycler;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( locale: Locale ) {\n\t\tsuper( locale );\n\t\tconst t = this.locale!.t;\n\n\t\tthis.focusTracker = new FocusTracker();\n\n\t\tthis.keystrokes = new KeystrokeHandler();\n\n\t\tthis.labeledInput = this._createLabeledInputView();\n\n\t\tthis.saveButtonView = this._createButton( t( 'Save' ), icons.check, 'ck-button-save' );\n\t\tthis.saveButtonView.type = 'submit';\n\n\t\tthis.cancelButtonView = this._createButton( t( 'Cancel' ), icons.cancel, 'ck-button-cancel', 'cancel' );\n\n\t\tthis._focusables = new ViewCollection();\n\n\t\tthis._focusCycler = new FocusCycler( {\n\t\t\tfocusables: this._focusables,\n\t\t\tfocusTracker: this.focusTracker,\n\t\t\tkeystrokeHandler: this.keystrokes,\n\t\t\tactions: {\n\t\t\t\t// Navigate form fields backwards using the Shift + Tab keystroke.\n\t\t\t\tfocusPrevious: 'shift + tab',\n\n\t\t\t\t// Navigate form fields forwards using the Tab key.\n\t\t\t\tfocusNext: 'tab'\n\t\t\t}\n\t\t} );\n\n\t\tthis.setTemplate( {\n\t\t\ttag: 'form',\n\n\t\t\tattributes: {\n\t\t\t\tclass: [\n\t\t\t\t\t'ck',\n\t\t\t\t\t'ck-text-alternative-form',\n\t\t\t\t\t'ck-responsive-form'\n\t\t\t\t],\n\n\t\t\t\t// https://github.com/ckeditor/ckeditor5-image/issues/40\n\t\t\t\ttabindex: '-1'\n\t\t\t},\n\n\t\t\tchildren: [\n\t\t\t\tthis.labeledInput,\n\t\t\t\tthis.saveButtonView,\n\t\t\t\tthis.cancelButtonView\n\t\t\t]\n\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override render(): void {\n\t\tsuper.render();\n\n\t\tthis.keystrokes.listenTo( this.element! );\n\n\t\tsubmitHandler( { view: this } );\n\n\t\t[ this.labeledInput, this.saveButtonView, this.cancelButtonView ]\n\t\t\t.forEach( v => {\n\t\t\t\t// Register the view as focusable.\n\t\t\t\tthis._focusables.add( v );\n\n\t\t\t\t// Register the view in the focus tracker.\n\t\t\t\tthis.focusTracker.add( v.element! );\n\t\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override destroy(): void {\n\t\tsuper.destroy();\n\n\t\tthis.focusTracker.destroy();\n\t\tthis.keystrokes.destroy();\n\t}\n\n\t/**\n\t * Creates the button view.\n\t *\n\t * @param label The button label\n\t * @param icon The button's icon.\n\t * @param className The additional button CSS class name.\n\t * @param eventName The event name that the ButtonView#execute event will be delegated to.\n\t * @returns The button view instance.\n\t */\n\tprivate _createButton( label: string, icon: string, className: string, eventName?: string ): ButtonView {\n\t\tconst button = new ButtonView( this.locale );\n\n\t\tbutton.set( {\n\t\t\tlabel,\n\t\t\ticon,\n\t\t\ttooltip: true\n\t\t} );\n\n\t\tbutton.extendTemplate( {\n\t\t\tattributes: {\n\t\t\t\tclass: className\n\t\t\t}\n\t\t} );\n\n\t\tif ( eventName ) {\n\t\t\tbutton.delegate( 'execute' ).to( this, eventName );\n\t\t}\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Creates an input with a label.\n\t *\n\t * @returns Labeled field view instance.\n\t */\n\tprivate _createLabeledInputView(): LabeledFieldView<InputView> {\n\t\tconst t = this.locale!.t;\n\t\tconst labeledInput = new LabeledFieldView<InputView>( this.locale, createLabeledInputText );\n\n\t\tlabeledInput.label = t( 'Text alternative' );\n\n\t\treturn labeledInput;\n\t}\n}\n\n/**\n * Fired when the form view is submitted.\n *\n * @eventName ~TextAlternativeFormView#submit\n */\nexport type TextAlternativeFormViewSubmitEvent = {\n\tname: 'submit';\n\targs: [];\n};\n\n/**\n * Fired when the form view is canceled.\n *\n * @eventName ~TextAlternativeFormView#cancel\n */\nexport type TextAlternativeFormViewCancelEvent = {\n\tname: 'cancel';\n\targs: [];\n};\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/image/ui/utils\n */\n\nimport type { PositionOptions } from 'ckeditor5/src/utils.js';\nimport type { Editor } from 'ckeditor5/src/core.js';\nimport { BalloonPanelView, type ContextualBalloon } from 'ckeditor5/src/ui.js';\n\nimport type ImageUtils from '../../imageutils.js';\n\n/**\n * A helper utility that positions the\n * {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon contextual balloon} instance\n * with respect to the image in the editor content, if one is selected.\n *\n * @param editor The editor instance.\n */\nexport function repositionContextualBalloon( editor: Editor ): void {\n\tconst balloon: ContextualBalloon = editor.plugins.get( 'ContextualBalloon' );\n\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\tif ( imageUtils.getClosestSelectedImageWidget( editor.editing.view.document.selection ) ) {\n\t\tconst position = getBalloonPositionData( editor );\n\n\t\tballoon.updatePosition( position );\n\t}\n}\n\n/**\n * Returns the positioning options that control the geometry of the\n * {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon contextual balloon} with respect\n * to the selected element in the editor content.\n *\n * @param editor The editor instance.\n */\nexport function getBalloonPositionData( editor: Editor ): Partial<PositionOptions> {\n\tconst editingView = editor.editing.view;\n\tconst defaultPositions = BalloonPanelView.defaultPositions;\n\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\treturn {\n\t\ttarget: editingView.domConverter.mapViewToDom(\n\t\t\timageUtils.getClosestSelectedImageWidget( editingView.document.selection )!\n\t\t) as HTMLElement,\n\t\tpositions: [\n\t\t\tdefaultPositions.northArrowSouth,\n\t\t\tdefaultPositions.northArrowSouthWest,\n\t\t\tdefaultPositions.northArrowSouthEast,\n\t\t\tdefaultPositions.southArrowNorth,\n\t\t\tdefaultPositions.southArrowNorthWest,\n\t\t\tdefaultPositions.southArrowNorthEast,\n\t\t\tdefaultPositions.viewportStickyNorth\n\t\t]\n\t};\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagetextalternative/imagetextalternativeui\n */\n\nimport { Plugin, icons } from 'ckeditor5/src/core.js';\nimport {\n\tButtonView,\n\tContextualBalloon,\n\tclickOutsideHandler,\n\tCssTransitionDisablerMixin,\n\ttype ViewWithCssTransitionDisabler\n} from 'ckeditor5/src/ui.js';\n\nimport TextAlternativeFormView, {\n\ttype TextAlternativeFormViewCancelEvent,\n\ttype TextAlternativeFormViewSubmitEvent\n} from './ui/textalternativeformview.js';\nimport { repositionContextualBalloon, getBalloonPositionData } from '../image/ui/utils.js';\nimport type ImageTextAlternativeCommand from './imagetextalternativecommand.js';\nimport type ImageUtils from '../imageutils.js';\n\n/**\n * The image text alternative UI plugin.\n *\n * The plugin uses the {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon}.\n */\nexport default class ImageTextAlternativeUI extends Plugin {\n\t/**\n\t * The contextual balloon plugin instance.\n\t */\n\tprivate _balloon?: ContextualBalloon;\n\n\t/**\n\t * A form containing a textarea and buttons, used to change the `alt` text value.\n\t */\n\tprivate _form?: TextAlternativeFormView & ViewWithCssTransitionDisabler;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ContextualBalloon ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageTextAlternativeUI' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tthis._createButton();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override destroy(): void {\n\t\tsuper.destroy();\n\n\t\t// Destroy created UI components as they are not automatically destroyed (see ckeditor5#1341).\n\t\tif ( this._form ) {\n\t\t\tthis._form.destroy();\n\t\t}\n\t}\n\n\t/**\n\t * Creates a button showing the balloon panel for changing the image text alternative and\n\t * registers it in the editor {@link module:ui/componentfactory~ComponentFactory ComponentFactory}.\n\t */\n\tprivate _createButton(): void {\n\t\tconst editor = this.editor;\n\t\tconst t = editor.t;\n\n\t\teditor.ui.componentFactory.add( 'imageTextAlternative', locale => {\n\t\t\tconst command: ImageTextAlternativeCommand = editor.commands.get( 'imageTextAlternative' )!;\n\t\t\tconst view = new ButtonView( locale );\n\n\t\t\tview.set( {\n\t\t\t\tlabel: t( 'Change image text alternative' ),\n\t\t\t\ticon: icons.textAlternative,\n\t\t\t\ttooltip: true\n\t\t\t} );\n\n\t\t\tview.bind( 'isEnabled' ).to( command, 'isEnabled' );\n\t\t\tview.bind( 'isOn' ).to( command, 'value', value => !!value );\n\n\t\t\tthis.listenTo( view, 'execute', () => {\n\t\t\t\tthis._showForm();\n\t\t\t} );\n\n\t\t\treturn view;\n\t\t} );\n\t}\n\n\t/**\n\t * Creates the {@link module:image/imagetextalternative/ui/textalternativeformview~TextAlternativeFormView}\n\t * form.\n\t */\n\tprivate _createForm(): void {\n\t\tconst editor = this.editor;\n\t\tconst view = editor.editing.view;\n\t\tconst viewDocument = view.document;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\tthis._balloon = this.editor.plugins.get( 'ContextualBalloon' );\n\n\t\tthis._form = new ( CssTransitionDisablerMixin( TextAlternativeFormView ) )( editor.locale );\n\n\t\t// Render the form so its #element is available for clickOutsideHandler.\n\t\tthis._form.render();\n\n\t\tthis.listenTo<TextAlternativeFormViewSubmitEvent>( this._form, 'submit', () => {\n\t\t\teditor.execute( 'imageTextAlternative', {\n\t\t\t\tnewValue: this._form!.labeledInput.fieldView.element!.value\n\t\t\t} );\n\n\t\t\tthis._hideForm( true );\n\t\t} );\n\n\t\tthis.listenTo<TextAlternativeFormViewCancelEvent>( this._form, 'cancel', () => {\n\t\t\tthis._hideForm( true );\n\t\t} );\n\n\t\t// Close the form on Esc key press.\n\t\tthis._form.keystrokes.set( 'Esc', ( data, cancel ) => {\n\t\t\tthis._hideForm( true );\n\t\t\tcancel();\n\t\t} );\n\n\t\t// Reposition the balloon or hide the form if an image widget is no longer selected.\n\t\tthis.listenTo( editor.ui, 'update', () => {\n\t\t\tif ( !imageUtils.getClosestSelectedImageWidget( viewDocument.selection ) ) {\n\t\t\t\tthis._hideForm( true );\n\t\t\t} else if ( this._isVisible ) {\n\t\t\t\trepositionContextualBalloon( editor );\n\t\t\t}\n\t\t} );\n\n\t\t// Close on click outside of balloon panel element.\n\t\tclickOutsideHandler( {\n\t\t\temitter: this._form,\n\t\t\tactivator: () => this._isVisible,\n\t\t\tcontextElements: () => [ this._balloon!.view.element! ],\n\t\t\tcallback: () => this._hideForm()\n\t\t} );\n\t}\n\n\t/**\n\t * Shows the {@link #_form} in the {@link #_balloon}.\n\t */\n\tprivate _showForm(): void {\n\t\tif ( this._isVisible ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( !this._form ) {\n\t\t\tthis._createForm();\n\t\t}\n\n\t\tconst editor = this.editor;\n\t\tconst command: ImageTextAlternativeCommand = editor.commands.get( 'imageTextAlternative' )!;\n\t\tconst labeledInput = this._form!.labeledInput;\n\n\t\tthis._form!.disableCssTransitions();\n\n\t\tif ( !this._isInBalloon ) {\n\t\t\tthis._balloon!.add( {\n\t\t\t\tview: this._form!,\n\t\t\t\tposition: getBalloonPositionData( editor )\n\t\t\t} );\n\t\t}\n\n\t\t// Make sure that each time the panel shows up, the field remains in sync with the value of\n\t\t// the command. If the user typed in the input, then canceled the balloon (`labeledInput#value`\n\t\t// stays unaltered) and re-opened it without changing the value of the command, they would see the\n\t\t// old value instead of the actual value of the command.\n\t\t// https://github.com/ckeditor/ckeditor5-image/issues/114\n\t\tlabeledInput.fieldView.value = labeledInput.fieldView.element!.value = command.value || '';\n\n\t\tthis._form!.labeledInput.fieldView.select();\n\n\t\tthis._form!.enableCssTransitions();\n\t}\n\n\t/**\n\t * Removes the {@link #_form} from the {@link #_balloon}.\n\t *\n\t * @param focusEditable Controls whether the editing view is focused afterwards.\n\t */\n\tprivate _hideForm( focusEditable: boolean = false ): void {\n\t\tif ( !this._isInBalloon ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Blur the input element before removing it from DOM to prevent issues in some browsers.\n\t\t// See https://github.com/ckeditor/ckeditor5/issues/1501.\n\t\tif ( this._form!.focusTracker.isFocused ) {\n\t\t\tthis._form!.saveButtonView.focus();\n\t\t}\n\n\t\tthis._balloon!.remove( this._form! );\n\n\t\tif ( focusEditable ) {\n\t\t\tthis.editor.editing.view.focus();\n\t\t}\n\t}\n\n\t/**\n\t * Returns `true` when the {@link #_form} is the visible view in the {@link #_balloon}.\n\t */\n\tprivate get _isVisible(): boolean {\n\t\treturn !!this._balloon && this._balloon.visibleView === this._form;\n\t}\n\n\t/**\n\t * Returns `true` when the {@link #_form} is in the {@link #_balloon}.\n\t */\n\tprivate get _isInBalloon(): boolean {\n\t\treturn !!this._balloon && this._balloon.hasView( this._form! );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagetextalternative\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport ImageTextAlternativeEditing from './imagetextalternative/imagetextalternativeediting.js';\nimport ImageTextAlternativeUI from './imagetextalternative/imagetextalternativeui.js';\n\n/**\n * The image text alternative plugin.\n *\n * For a detailed overview, check the {@glink features/images/images-styles image styles} documentation.\n *\n * This is a \"glue\" plugin which loads the\n *  {@link module:image/imagetextalternative/imagetextalternativeediting~ImageTextAlternativeEditing}\n * and {@link module:image/imagetextalternative/imagetextalternativeui~ImageTextAlternativeUI} plugins.\n */\nexport default class ImageTextAlternative extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageTextAlternativeEditing, ImageTextAlternativeUI ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageTextAlternative' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/image/converters\n */\n\nimport type {\n\tDowncastDispatcher,\n\tElement,\n\tUpcastDispatcher,\n\tUpcastElementEvent,\n\tViewElement,\n\tViewElementAttributes,\n\tDowncastAttributeEvent\n} from 'ckeditor5/src/engine.js';\nimport { first, type GetCallback } from 'ckeditor5/src/utils.js';\nimport type ImageUtils from '../imageutils.js';\n\n/**\n * Returns a function that converts the image view representation:\n *\n * ```html\n * <figure class=\"image\"><img src=\"...\" alt=\"...\"></img></figure>\n * ```\n *\n * to the model representation:\n *\n * ```html\n * <imageBlock src=\"...\" alt=\"...\"></imageBlock>\n * ```\n *\n * The entire content of the `<figure>` element except the first `<img>` is being converted as children\n * of the `<imageBlock>` model element.\n *\n * @internal\n */\nexport function upcastImageFigure( imageUtils: ImageUtils ): ( dispatcher: UpcastDispatcher ) => void {\n\tconst converter: GetCallback<UpcastElementEvent> = ( evt, data, conversionApi ) => {\n\t\t// Do not convert if this is not an \"image figure\".\n\t\tif ( !conversionApi.consumable.test( data.viewItem, { name: true, classes: 'image' } ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Find an image element inside the figure element.\n\t\tconst viewImage = imageUtils.findViewImgElement( data.viewItem );\n\n\t\t// Do not convert if image element is absent or was already converted.\n\t\tif ( !viewImage || !conversionApi.consumable.test( viewImage, { name: true } ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Consume the figure to prevent other converters from processing it again.\n\t\tconversionApi.consumable.consume( data.viewItem, { name: true, classes: 'image' } );\n\n\t\t// Convert view image to model image.\n\t\tconst conversionResult = conversionApi.convertItem( viewImage, data.modelCursor );\n\n\t\t// Get image element from conversion result.\n\t\tconst modelImage = first( conversionResult.modelRange!.getItems() ) as Element;\n\n\t\t// When image wasn't successfully converted then finish conversion.\n\t\tif ( !modelImage ) {\n\t\t\t// Revert consumed figure so other features can convert it.\n\t\t\tconversionApi.consumable.revert( data.viewItem, { name: true, classes: 'image' } );\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Convert rest of the figure element's children as an image children.\n\t\tconversionApi.convertChildren( data.viewItem, modelImage );\n\n\t\tconversionApi.updateConversionResult( modelImage, data );\n\t};\n\n\treturn dispatcher => {\n\t\tdispatcher.on<UpcastElementEvent>( 'element:figure', converter );\n\t};\n}\n\n/**\n * Returns a function that converts the image view representation:\n *\n * ```html\n * <picture><source ... /><source ... />...<img ... /></picture>\n * ```\n *\n * to the model representation as the `sources` attribute:\n *\n * ```html\n * <image[Block|Inline] ... sources=\"...\"></image[Block|Inline]>\n * ```\n *\n * @internal\n */\nexport function upcastPicture( imageUtils: ImageUtils ): ( dispatcher: UpcastDispatcher ) => void {\n\tconst sourceAttributeNames = [ 'srcset', 'media', 'type', 'sizes' ];\n\n\tconst converter: GetCallback<UpcastElementEvent> = ( evt, data, conversionApi ) => {\n\t\tconst pictureViewElement = data.viewItem;\n\n\t\t// Do not convert <picture> if already consumed.\n\t\tif ( !conversionApi.consumable.test( pictureViewElement, { name: true } ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sources = new Map<ViewElement, Record<string, string | undefined>>();\n\n\t\t// Collect all <source /> elements attribute values.\n\t\tfor ( const childSourceElement of pictureViewElement.getChildren() ) {\n\t\t\tif ( childSourceElement.is( 'element', 'source' ) ) {\n\t\t\t\tconst attributes: Record<string, string | undefined> = {};\n\n\t\t\t\tfor ( const name of sourceAttributeNames ) {\n\t\t\t\t\tif ( childSourceElement.hasAttribute( name ) ) {\n\t\t\t\t\t\t// Don't collect <source /> attribute if already consumed somewhere else.\n\t\t\t\t\t\tif ( conversionApi.consumable.test( childSourceElement, { attributes: name } ) ) {\n\t\t\t\t\t\t\tattributes[ name ] = childSourceElement.getAttribute( name );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( Object.keys( attributes ).length ) {\n\t\t\t\t\tsources.set( childSourceElement, attributes );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst imgViewElement = imageUtils.findViewImgElement( pictureViewElement );\n\n\t\t// Don't convert when a picture has no <img/> inside (it is broken).\n\t\tif ( !imgViewElement ) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet modelImage = data.modelCursor.parent;\n\n\t\t// - In case of an inline image (cursor parent in a <paragraph>), the <img/> must be converted right away\n\t\t// because no converter handled it yet and otherwise there would be no model element to set the sources attribute on.\n\t\t// - In case of a block image, the <figure class=\"image\"> converter (in ImageBlockEditing) converts the\n\t\t// <img/> right away on its own and the modelCursor is already inside an imageBlock and there's nothing special\n\t\t// to do here.\n\t\tif ( !modelImage.is( 'element', 'imageBlock' ) ) {\n\t\t\tconst conversionResult = conversionApi.convertItem( imgViewElement, data.modelCursor );\n\n\t\t\t// Set image range as conversion result.\n\t\t\tdata.modelRange = conversionResult.modelRange;\n\n\t\t\t// Continue conversion where image conversion ends.\n\t\t\tdata.modelCursor = conversionResult.modelCursor;\n\n\t\t\tmodelImage = first( conversionResult.modelRange!.getItems() ) as Element;\n\t\t}\n\n\t\tconversionApi.consumable.consume( pictureViewElement, { name: true } );\n\n\t\t// Consume only these <source/> attributes that were actually collected and will be passed on\n\t\t// to the image model element.\n\t\tfor ( const [ sourceElement, attributes ] of sources ) {\n\t\t\tconversionApi.consumable.consume( sourceElement, { attributes: Object.keys( attributes ) } );\n\t\t}\n\n\t\tif ( sources.size ) {\n\t\t\tconversionApi.writer.setAttribute( 'sources', Array.from( sources.values() ), modelImage );\n\t\t}\n\n\t\t// Convert rest of the <picture> children as an image children. Other converters may want to consume them.\n\t\tconversionApi.convertChildren( pictureViewElement, modelImage );\n\t};\n\n\treturn dispatcher => {\n\t\tdispatcher.on<UpcastElementEvent>( 'element:picture', converter );\n\t};\n}\n\n/**\n * Converter used to convert the `srcset` model image attribute to the `srcset` and `sizes` attributes in the view.\n *\n * @internal\n * @param imageType The type of the image.\n */\nexport function downcastSrcsetAttribute(\n\timageUtils: ImageUtils,\n\timageType: 'imageBlock' | 'imageInline'\n): ( dispatcher: DowncastDispatcher ) => void {\n\tconst converter: GetCallback<DowncastAttributeEvent<Element>> = ( evt, data, conversionApi\t) => {\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst writer = conversionApi.writer;\n\t\tconst element = conversionApi.mapper.toViewElement( data.item )!;\n\t\tconst img = imageUtils.findViewImgElement( element )!;\n\n\t\tif ( data.attributeNewValue === null ) {\n\t\t\twriter.removeAttribute( 'srcset', img );\n\t\t\twriter.removeAttribute( 'sizes', img );\n\t\t} else {\n\t\t\tif ( data.attributeNewValue ) {\n\t\t\t\twriter.setAttribute( 'srcset', data.attributeNewValue, img );\n\t\t\t\t// Always outputting `100vw`. See https://github.com/ckeditor/ckeditor5-image/issues/2.\n\t\t\t\twriter.setAttribute( 'sizes', '100vw', img );\n\t\t\t}\n\t\t}\n\t};\n\n\treturn dispatcher => {\n\t\tdispatcher.on<DowncastAttributeEvent<Element>>( `attribute:srcset:${ imageType }`, converter );\n\t};\n}\n\n/**\n * Converts the `source` model attribute to the `<picture><source /><source />...<img /></picture>`\n * view structure.\n *\n * @internal\n */\nexport function downcastSourcesAttribute( imageUtils: ImageUtils ): ( dispatcher: DowncastDispatcher ) => void {\n\tconst converter: GetCallback<DowncastAttributeEvent<Element>> = ( evt, data, conversionApi\t) => {\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewWriter = conversionApi.writer;\n\t\tconst element = conversionApi.mapper.toViewElement( data.item )!;\n\t\tconst imgElement = imageUtils.findViewImgElement( element )!;\n\t\tconst attributeNewValue = data.attributeNewValue as null | Array<ViewElementAttributes>;\n\n\t\tif ( attributeNewValue && attributeNewValue.length ) {\n\t\t\t// Collect all wrapping attribute elements.\n\t\t\tconst attributeElements = [];\n\t\t\tlet viewElement = imgElement.parent;\n\n\t\t\twhile ( viewElement && viewElement.is( 'attributeElement' ) ) {\n\t\t\t\tconst parentElement = viewElement.parent;\n\n\t\t\t\tviewWriter.unwrap( viewWriter.createRangeOn( imgElement ), viewElement );\n\n\t\t\t\tattributeElements.unshift( viewElement );\n\t\t\t\tviewElement = parentElement;\n\t\t\t}\n\n\t\t\tconst hasPictureElement = imgElement.parent!.is( 'element', 'picture' );\n\n\t\t\t// Reuse existing <picture> element (ckeditor5#17192) or create a new one.\n\t\t\tconst pictureElement = hasPictureElement ? imgElement.parent : viewWriter.createContainerElement( 'picture', null );\n\n\t\t\tif ( !hasPictureElement ) {\n\t\t\t\tviewWriter.insert( viewWriter.createPositionBefore( imgElement ), pictureElement );\n\t\t\t}\n\n\t\t\tviewWriter.remove( viewWriter.createRangeIn( pictureElement ) );\n\n\t\t\tviewWriter.insert( viewWriter.createPositionAt( pictureElement, 'end' ),\n\t\t\t\tattributeNewValue.map( sourceAttributes => {\n\t\t\t\t\treturn viewWriter.createEmptyElement( 'source', sourceAttributes );\n\t\t\t\t} )\n\t\t\t);\n\n\t\t\tviewWriter.move( viewWriter.createRangeOn( imgElement ), viewWriter.createPositionAt( pictureElement, 'end' ) );\n\n\t\t\t// Apply collected attribute elements over the new picture element.\n\t\t\tfor ( const attributeElement of attributeElements ) {\n\t\t\t\tviewWriter.wrap( viewWriter.createRangeOn( pictureElement ), attributeElement );\n\t\t\t}\n\t\t}\n\t\t// Both setting \"sources\" to an empty array and removing the attribute should unwrap the <img />.\n\t\t// Unwrap once if the latter followed the former, though.\n\t\telse if ( imgElement.parent!.is( 'element', 'picture' ) ) {\n\t\t\tconst pictureElement = imgElement.parent;\n\n\t\t\tviewWriter.move( viewWriter.createRangeOn( imgElement ), viewWriter.createPositionBefore( pictureElement ) );\n\t\t\tviewWriter.remove( pictureElement );\n\t\t}\n\t};\n\n\treturn dispatcher => {\n\t\tdispatcher.on<DowncastAttributeEvent<Element>>( 'attribute:sources:imageBlock', converter );\n\t\tdispatcher.on<DowncastAttributeEvent<Element>>( 'attribute:sources:imageInline', converter );\n\t};\n}\n\n/**\n * Converter used to convert a given image attribute from the model to the view.\n *\n * @internal\n * @param imageType The type of the image.\n * @param attributeKey The name of the attribute to convert.\n */\nexport function downcastImageAttribute(\n\timageUtils: ImageUtils,\n\timageType: 'imageBlock' | 'imageInline',\n\tattributeKey: string\n): ( dispatcher: DowncastDispatcher ) => void {\n\tconst converter: GetCallback<DowncastAttributeEvent<Element>> = ( evt, data, conversionApi ) => {\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewWriter = conversionApi.writer;\n\t\tconst element = conversionApi.mapper.toViewElement( data.item )!;\n\t\tconst img = imageUtils.findViewImgElement( element )!;\n\n\t\tviewWriter.setAttribute( data.attributeKey, data.attributeNewValue || '', img );\n\t};\n\n\treturn dispatcher => {\n\t\tdispatcher.on<DowncastAttributeEvent<Element>>( `attribute:${ attributeKey }:${ imageType }`, converter );\n\t};\n}\n\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/image/imageloadobserver\n */\n\nimport { Observer } from 'ckeditor5/src/engine.js';\n\n/**\n * Observes all new images added to the {@link module:engine/view/document~Document},\n * fires {@link module:engine/view/document~Document#event:imageLoaded} and\n * {@link module:engine/view/document~Document#event:layoutChanged} event every time when the new image\n * has been loaded.\n *\n * **Note:** This event is not fired for images that has been added to the document and rendered as `complete` (already loaded).\n */\nexport default class ImageLoadObserver extends Observer {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic observe( domRoot: HTMLElement ): void {\n\t\tthis.listenTo( domRoot, 'load', ( event, domEvent ) => {\n\t\t\tconst domElement = domEvent.target as HTMLElement;\n\n\t\t\tif ( this.checkShouldIgnoreEventFromTarget( domElement ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( domElement.tagName == 'IMG' ) {\n\t\t\t\tthis._fireEvents( domEvent );\n\t\t\t}\n\t\t\t// Use capture phase for better performance (#4504).\n\t\t}, { useCapture: true } );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override stopObserving( domRoot: HTMLElement ): void {\n\t\tthis.stopListening( domRoot );\n\t}\n\n\t/**\n\t * Fires {@link module:engine/view/document~Document#event:layoutChanged} and\n\t * {@link module:engine/view/document~Document#event:imageLoaded}\n\t * if observer {@link #isEnabled is enabled}.\n\t *\n\t * @param domEvent The DOM event.\n\t */\n\tprivate _fireEvents( domEvent: Event ): void {\n\t\tif ( this.isEnabled ) {\n\t\t\tthis.document.fire( 'layoutChanged' );\n\t\t\tthis.document.fire<ImageLoadedEvent>( 'imageLoaded', domEvent );\n\t\t}\n\t}\n}\n\n/**\n * Fired when an <img/> DOM element has been loaded in the DOM root.\n *\n * Introduced by {@link module:image/image/imageloadobserver~ImageLoadObserver}.\n *\n * @see module:image/image/imageloadobserver~ImageLoadObserver\n *\n * @eventName module:engine/view/document~Document#imageLoaded\n * @param data Event data.\n */\nexport type ImageLoadedEvent = {\n\tname: 'imageLoaded';\n\targs: [ Event ];\n};\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/image/insertimagecommand\n */\n\nimport { Command, type Editor } from 'ckeditor5/src/core.js';\nimport { logWarning, toArray, type ArrayOrItem } from 'ckeditor5/src/utils.js';\nimport type ImageUtils from '../imageutils.js';\n\n/**\n * Insert image command.\n *\n * The command is registered by the {@link module:image/image/imageediting~ImageEditing} plugin as `insertImage`\n * and it is also available via aliased `imageInsert` name.\n *\n * In order to insert an image at the current selection position\n * (according to the {@link module:widget/utils~findOptimalInsertionRange} algorithm),\n * execute the command and specify the image source:\n *\n * ```ts\n * editor.execute( 'insertImage', { source: 'http://url.to.the/image' } );\n * ```\n *\n * It is also possible to insert multiple images at once:\n *\n * ```ts\n * editor.execute( 'insertImage', {\n * \tsource:  [\n * \t\t'path/to/image.jpg',\n * \t\t'path/to/other-image.jpg'\n * \t]\n * } );\n * ```\n *\n * If you want to take the full control over the process, you can specify individual model attributes:\n *\n * ```ts\n * editor.execute( 'insertImage', {\n * \tsource:  [\n * \t\t{ src: 'path/to/image.jpg', alt: 'First alt text' },\n * \t\t{ src: 'path/to/other-image.jpg', alt: 'Second alt text', customAttribute: 'My attribute value' }\n * \t]\n * } );\n * ```\n */\nexport default class InsertImageCommand extends Command {\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( editor: Editor ) {\n\t\tsuper( editor );\n\n\t\tconst configImageInsertType = editor.config.get( 'image.insert.type' );\n\n\t\tif ( !editor.plugins.has( 'ImageBlockEditing' ) ) {\n\t\t\tif ( configImageInsertType === 'block' ) {\n\t\t\t\t/**\n\t\t\t\t * The {@link module:image/imageblock~ImageBlock} plugin must be enabled to allow inserting block images. See\n\t\t\t\t * {@link module:image/imageconfig~ImageInsertConfig#type} to learn more.\n\t\t\t\t *\n\t\t\t\t * @error image-block-plugin-required\n\t\t\t\t */\n\t\t\t\tlogWarning( 'image-block-plugin-required' );\n\t\t\t}\n\t\t}\n\n\t\tif ( !editor.plugins.has( 'ImageInlineEditing' ) ) {\n\t\t\tif ( configImageInsertType === 'inline' ) {\n\t\t\t\t/**\n\t\t\t\t * The {@link module:image/imageinline~ImageInline} plugin must be enabled to allow inserting inline images. See\n\t\t\t\t * {@link module:image/imageconfig~ImageInsertConfig#type} to learn more.\n\t\t\t\t *\n\t\t\t\t * @error image-inline-plugin-required\n\t\t\t\t */\n\t\t\t\tlogWarning( 'image-inline-plugin-required' );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override refresh(): void {\n\t\tconst imageUtils: ImageUtils = this.editor.plugins.get( 'ImageUtils' );\n\n\t\tthis.isEnabled = imageUtils.isImageAllowed();\n\t}\n\n\t/**\n\t * Executes the command.\n\t *\n\t * @fires execute\n\t * @param options Options for the executed command.\n\t * @param options.imageType The type of the image to insert. If not specified, the type will be determined automatically.\n\t * @param options.source The image source or an array of image sources to insert.\n\t * @param options.breakBlock If set to `true`, the block at the selection start will be broken before inserting the image.\n\t * See the documentation of the command to learn more about accepted formats.\n\t */\n\tpublic override execute(\n\t\toptions: {\n\t\t\tsource: ArrayOrItem<string | Record<string, unknown>>;\n\t\t\timageType?: 'imageBlock' | 'imageInline' | null;\n\t\t\tbreakBlock?: boolean;\n\t\t}\n\t): void {\n\t\tconst sourceDefinitions = toArray<string | Record<string, unknown>>( options.source );\n\t\tconst selection = this.editor.model.document.selection;\n\t\tconst imageUtils: ImageUtils = this.editor.plugins.get( 'ImageUtils' );\n\n\t\t// In case of multiple images, each image (starting from the 2nd) will be inserted at a position that\n\t\t// follows the previous one. That will move the selection and, to stay on the safe side and make sure\n\t\t// all images inherit the same selection attributes, they are collected beforehand.\n\t\t//\n\t\t// Applying these attributes ensures, for instance, that inserting an (inline) image into a link does\n\t\t// not split that link but preserves its continuity.\n\t\t//\n\t\t// Note: Selection attributes that do not make sense for images will be filtered out by insertImage() anyway.\n\t\tconst selectionAttributes = Object.fromEntries( selection.getAttributes() );\n\n\t\tsourceDefinitions.forEach( ( sourceDefinition, index ) => {\n\t\t\tconst selectedElement = selection.getSelectedElement();\n\n\t\t\tif ( typeof sourceDefinition === 'string' ) {\n\t\t\t\tsourceDefinition = { src: sourceDefinition };\n\t\t\t}\n\n\t\t\t// Inserting of an inline image replace the selected element and make a selection on the inserted image.\n\t\t\t// Therefore inserting multiple inline images requires creating position after each element.\n\t\t\tif ( index && selectedElement && imageUtils.isImage( selectedElement ) ) {\n\t\t\t\tconst position = this.editor.model.createPositionAfter( selectedElement );\n\n\t\t\t\timageUtils.insertImage( { ...sourceDefinition, ...selectionAttributes }, position, options.imageType );\n\t\t\t} else if ( options.breakBlock ) {\n\t\t\t\timageUtils.insertImage( { ...sourceDefinition, ...selectionAttributes }, selection.getFirstPosition(), options.imageType );\n\t\t\t} else {\n\t\t\t\timageUtils.insertImage( { ...sourceDefinition, ...selectionAttributes }, null, options.imageType );\n\t\t\t}\n\t\t} );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\nimport { Command, type Editor } from 'ckeditor5/src/core.js';\nimport type ImageUtils from '../imageutils.js';\nimport type { Writer, Element } from 'ckeditor5/src/engine.js';\n\n/**\n * @module image/image/replaceimagesourcecommand\n */\n\n/**\n * Replace image source command.\n *\n * Changes image source to the one provided. Can be executed as follows:\n *\n * ```ts\n * editor.execute( 'replaceImageSource', { source: 'http://url.to.the/image' } );\n * ```\n */\nexport default class ReplaceImageSourceCommand extends Command {\n\tdeclare public value: string | null;\n\n\tconstructor( editor: Editor ) {\n\t\tsuper( editor );\n\n\t\tthis.decorate( 'cleanupImage' );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override refresh(): void {\n\t\tconst editor = this.editor;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst element = this.editor.model.document.selection.getSelectedElement()!;\n\n\t\tthis.isEnabled = imageUtils.isImage( element );\n\t\tthis.value = this.isEnabled ? element.getAttribute( 'src' ) as string : null;\n\t}\n\n\t/**\n\t * Executes the command.\n\t *\n\t * @fires execute\n\t * @param options Options for the executed command.\n\t * @param options.source The image source to replace.\n\t */\n\tpublic override execute( options: { source: string } ): void {\n\t\tconst image = this.editor.model.document.selection.getSelectedElement()!;\n\t\tconst imageUtils: ImageUtils = this.editor.plugins.get( 'ImageUtils' );\n\n\t\tthis.editor.model.change( writer => {\n\t\t\twriter.setAttribute( 'src', options.source, image );\n\n\t\t\tthis.cleanupImage( writer, image );\n\n\t\t\timageUtils.setImageNaturalSizeAttributes( image );\n\t\t} );\n\t}\n\n\t/**\n\t * Cleanup image attributes that are not relevant to the new source.\n\t *\n\t * Removed attributes are: 'srcset', 'sizes', 'sources', 'width', 'height', 'alt'.\n\t *\n\t * This method is decorated, to allow custom cleanup logic.\n\t * For example, to remove 'myImageId' attribute after 'src' has changed:\n\t *\n\t * ```ts\n\t * replaceImageSourceCommand.on( 'cleanupImage', ( eventInfo, [ writer, image ] ) => {\n\t * \twriter.removeAttribute( 'myImageId', image );\n\t * } );\n\t * ```\n\t */\n\tpublic cleanupImage( writer: Writer, image: Element ): void {\n\t\twriter.removeAttribute( 'srcset', image );\n\t\twriter.removeAttribute( 'sizes', image );\n\n\t\t/**\n\t\t * In case responsive images some attributes should be cleaned up.\n\t\t * Check: https://github.com/ckeditor/ckeditor5/issues/15093\n\t\t */\n\t\twriter.removeAttribute( 'sources', image );\n\t\twriter.removeAttribute( 'width', image );\n\t\twriter.removeAttribute( 'height', image );\n\t\twriter.removeAttribute( 'alt', image );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/image/imageediting\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport ImageLoadObserver from './imageloadobserver.js';\nimport InsertImageCommand from './insertimagecommand.js';\nimport ReplaceImageSourceCommand from './replaceimagesourcecommand.js';\nimport ImageUtils from '../imageutils.js';\n\n/**\n * The image engine plugin. This module loads common code shared between\n * {@link module:image/image/imageinlineediting~ImageInlineEditing} and\n * {@link module:image/image/imageblockediting~ImageBlockEditing} plugins.\n *\n * This plugin registers the {@link module:image/image/insertimagecommand~InsertImageCommand 'insertImage'} command.\n */\nexport default class ImageEditing extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageUtils ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageEditing' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst editor = this.editor;\n\t\tconst conversion = editor.conversion;\n\n\t\t// See https://github.com/ckeditor/ckeditor5-image/issues/142.\n\t\teditor.editing.view.addObserver( ImageLoadObserver );\n\n\t\tconversion.for( 'upcast' )\n\t\t\t.attributeToAttribute( {\n\t\t\t\tview: {\n\t\t\t\t\tname: 'img',\n\t\t\t\t\tkey: 'alt'\n\t\t\t\t},\n\t\t\t\tmodel: 'alt'\n\t\t\t} )\n\t\t\t.attributeToAttribute( {\n\t\t\t\tview: {\n\t\t\t\t\tname: 'img',\n\t\t\t\t\tkey: 'srcset'\n\t\t\t\t},\n\t\t\t\tmodel: 'srcset'\n\t\t\t} );\n\n\t\tconst insertImageCommand = new InsertImageCommand( editor );\n\t\tconst replaceImageSourceCommand = new ReplaceImageSourceCommand( editor );\n\n\t\teditor.commands.add( 'insertImage', insertImageCommand );\n\t\teditor.commands.add( 'replaceImageSource', replaceImageSourceCommand );\n\n\t\t// `imageInsert` is an alias for backward compatibility.\n\t\teditor.commands.add( 'imageInsert', insertImageCommand );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagesizeattributes\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport type { DowncastDispatcher, DowncastAttributeEvent, ViewElement, Element } from 'ckeditor5/src/engine.js';\nimport ImageUtils from './imageutils.js';\nimport { widthAndHeightStylesAreBothSet, getSizeValueIfInPx } from './image/utils.js';\n\n/**\n * This plugin enables `width` and `height` attributes in inline and block image elements.\n */\nexport default class ImageSizeAttributes extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageUtils ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageSizeAttributes' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic afterInit(): void {\n\t\tthis._registerSchema();\n\t\tthis._registerConverters( 'imageBlock' );\n\t\tthis._registerConverters( 'imageInline' );\n\t}\n\n\t/**\n\t * Registers the `width` and `height` attributes for inline and block images.\n\t */\n\tprivate _registerSchema(): void {\n\t\tif ( this.editor.plugins.has( 'ImageBlockEditing' ) ) {\n\t\t\tthis.editor.model.schema.extend( 'imageBlock', { allowAttributes: [ 'width', 'height' ] } );\n\t\t}\n\n\t\tif ( this.editor.plugins.has( 'ImageInlineEditing' ) ) {\n\t\t\tthis.editor.model.schema.extend( 'imageInline', { allowAttributes: [ 'width', 'height' ] } );\n\t\t}\n\t}\n\n\t/**\n\t * Registers converters for `width` and `height` attributes.\n\t */\n\tprivate _registerConverters( imageType: 'imageBlock' | 'imageInline' ): void {\n\t\tconst editor = this.editor;\n\t\tconst imageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst viewElementName = imageType === 'imageBlock' ? 'figure' : 'img';\n\n\t\teditor.conversion.for( 'upcast' )\n\t\t\t.attributeToAttribute( {\n\t\t\t\tview: {\n\t\t\t\t\tname: viewElementName,\n\t\t\t\t\tstyles: {\n\t\t\t\t\t\twidth: /.+/\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmodel: {\n\t\t\t\t\tkey: 'width',\n\t\t\t\t\tvalue: ( viewElement: ViewElement ) => {\n\t\t\t\t\t\tif ( widthAndHeightStylesAreBothSet( viewElement ) ) {\n\t\t\t\t\t\t\treturn getSizeValueIfInPx( viewElement.getStyle( 'width' ) );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\t\t\t.attributeToAttribute( {\n\t\t\t\tview: {\n\t\t\t\t\tname: viewElementName,\n\t\t\t\t\tkey: 'width'\n\t\t\t\t},\n\t\t\t\tmodel: 'width'\n\t\t\t} )\n\t\t\t.attributeToAttribute( {\n\t\t\t\tview: {\n\t\t\t\t\tname: viewElementName,\n\t\t\t\t\tstyles: {\n\t\t\t\t\t\theight: /.+/\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmodel: {\n\t\t\t\t\tkey: 'height',\n\t\t\t\t\tvalue: ( viewElement: ViewElement ) => {\n\t\t\t\t\t\tif ( widthAndHeightStylesAreBothSet( viewElement ) ) {\n\t\t\t\t\t\t\treturn getSizeValueIfInPx( viewElement.getStyle( 'height' ) );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\t\t\t.attributeToAttribute( {\n\t\t\t\tview: {\n\t\t\t\t\tname: viewElementName,\n\t\t\t\t\tkey: 'height'\n\t\t\t\t},\n\t\t\t\tmodel: 'height'\n\t\t\t} );\n\n\t\t// Dedicated converters to propagate attributes to the <img> element.\n\t\teditor.conversion.for( 'editingDowncast' ).add( dispatcher => {\n\t\t\tattachDowncastConverter( dispatcher, 'width', 'width', true, true );\n\t\t\tattachDowncastConverter( dispatcher, 'height', 'height', true, true );\n\t\t} );\n\n\t\teditor.conversion.for( 'dataDowncast' ).add( dispatcher => {\n\t\t\tattachDowncastConverter( dispatcher, 'width', 'width', false );\n\t\t\tattachDowncastConverter( dispatcher, 'height', 'height', false );\n\t\t} );\n\n\t\tfunction attachDowncastConverter(\n\t\t\tdispatcher: DowncastDispatcher,\n\t\t\tmodelAttributeName: string,\n\t\t\tviewAttributeName: string,\n\t\t\tsetRatioForInlineImage: boolean,\n\t\t\tisEditingDowncast: boolean = false\n\t\t) {\n\t\t\tdispatcher.on<DowncastAttributeEvent>( `attribute:${ modelAttributeName }:${ imageType }`, ( evt, data, conversionApi ) => {\n\t\t\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst viewWriter = conversionApi.writer;\n\t\t\t\tconst viewElement = conversionApi.mapper.toViewElement( data.item as Element )!;\n\t\t\t\tconst img = imageUtils.findViewImgElement( viewElement )!;\n\n\t\t\t\tif ( data.attributeNewValue !== null ) {\n\t\t\t\t\tviewWriter.setAttribute( viewAttributeName, data.attributeNewValue, img );\n\t\t\t\t} else {\n\t\t\t\t\tviewWriter.removeAttribute( viewAttributeName, img );\n\t\t\t\t}\n\n\t\t\t\tconst width = data.item.getAttribute( 'width' );\n\t\t\t\tconst height = data.item.getAttribute( 'height' );\n\t\t\t\tconst hasSizes = width && height;\n\n\t\t\t\tif ( hasSizes && isEditingDowncast ) {\n\t\t\t\t\tviewWriter.setAttribute( 'loading', 'lazy', img );\n\t\t\t\t}\n\n\t\t\t\t// Do not set aspect-ratio for pictures. See https://github.com/ckeditor/ckeditor5/issues/14579.\n\t\t\t\tif ( data.item.hasAttribute( 'sources' ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst isResized = data.item.hasAttribute( 'resizedWidth' );\n\n\t\t\t\t// Do not set aspect ratio for inline images which are not resized (data pipeline).\n\t\t\t\tif ( imageType === 'imageInline' && !isResized && !setRatioForInlineImage ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( hasSizes ) {\n\t\t\t\t\tviewWriter.setStyle( 'aspect-ratio', `${ width }/${ height }`, img );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n}\n\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/image/imagetypecommand\n */\n\nimport type { Element } from 'ckeditor5/src/engine.js';\nimport { Command, type Editor } from 'ckeditor5/src/core.js';\nimport type ImageUtils from '../imageutils.js';\n\n/**\n * The image type command. It changes the type of a selected image, depending on the configuration.\n */\nexport default class ImageTypeCommand extends Command {\n\t/**\n\t * Model element name the command converts to.\n\t */\n\tprivate readonly _modelElementName: 'imageBlock' | 'imageInline';\n\n\t/**\n\t * @inheritDoc\n\t *\n\t * @param modelElementName Model element name the command converts to.\n\t */\n\tconstructor( editor: Editor, modelElementName: 'imageBlock' | 'imageInline' ) {\n\t\tsuper( editor );\n\n\t\tthis._modelElementName = modelElementName;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override refresh(): void {\n\t\tconst editor = this.editor;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst element = imageUtils.getClosestSelectedImageElement( this.editor.model.document.selection );\n\n\t\tif ( this._modelElementName === 'imageBlock' ) {\n\t\t\tthis.isEnabled = imageUtils.isInlineImage( element );\n\t\t} else {\n\t\t\tthis.isEnabled = imageUtils.isBlockImage( element );\n\t\t}\n\t}\n\n\t/**\n\t * Executes the command and changes the type of a selected image.\n\t *\n\t * @fires execute\n\t * @param options.setImageSizes Specifies whether the image `width` and `height` attributes should be set automatically.\n\t * The default is `true`.\n\t * @returns An object containing references to old and new model image elements\n\t * (for before and after the change) so external integrations can hook into the decorated\n\t * `execute` event and handle this change. `null` if the type change failed.\n\t */\n\tpublic override execute( options: { setImageSizes?: boolean } = {} ): { oldElement: Element; newElement: Element } | null {\n\t\tconst editor = this.editor;\n\t\tconst model = this.editor.model;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst oldElement = imageUtils.getClosestSelectedImageElement( model.document.selection )!;\n\t\tconst attributes = Object.fromEntries( oldElement.getAttributes() );\n\n\t\t// Don't change image type if \"src\" is missing (a broken image), unless there's \"uploadId\" set.\n\t\t// This state may happen during image upload (before it finishes) and it should be possible to change type\n\t\t// of the image in the meantime.\n\t\tif ( !attributes.src && !attributes.uploadId ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn model.change( writer => {\n\t\t\tconst { setImageSizes = true } = options;\n\n\t\t\t// Get all markers that contain the old image element.\n\t\t\tconst markers = Array.from( model.markers )\n\t\t\t\t.filter( marker => marker.getRange().containsItem( oldElement ) );\n\n\t\t\tconst newElement = imageUtils.insertImage(\n\t\t\t\tattributes,\n\t\t\t\tmodel.createSelection( oldElement, 'on' ),\n\t\t\t\tthis._modelElementName,\n\t\t\t\t{ setImageSizes }\n\t\t\t);\n\n\t\t\tif ( !newElement ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst newElementRange = writer.createRangeOn( newElement );\n\n\t\t\t// Expand the previously intersecting markers' ranges to include the new image element.\n\t\t\tfor ( const marker of markers ) {\n\t\t\t\tconst markerRange = marker.getRange();\n\n\t\t\t\t// Join the survived part of the old marker range with the new element range\n\t\t\t\t// (loosely because there could be some new paragraph or the existing one might got split).\n\t\t\t\tconst range = markerRange.root.rootName != '$graveyard' ?\n\t\t\t\t\tmarkerRange.getJoined( newElementRange, true )! : newElementRange;\n\n\t\t\t\twriter.updateMarker( marker, { range } );\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\toldElement,\n\t\t\t\tnewElement\n\t\t\t};\n\t\t} );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/image/imageplaceholder\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport type {\n\tDowncastAttributeEvent,\n\tElement,\n\tViewElement\n} from 'ckeditor5/src/engine.js';\n\nimport ImageUtils from '../imageutils.js';\nimport ImageLoadObserver, { type ImageLoadedEvent } from './imageloadobserver.js';\n\nimport '../../theme/imageplaceholder.css';\n\n/**\n * Adds support for image placeholder that is automatically removed when the image is loaded.\n */\nexport default class ImagePlaceholder extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageUtils ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImagePlaceholder' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic afterInit(): void {\n\t\tthis._setupSchema();\n\t\tthis._setupConversion();\n\t\tthis._setupLoadListener();\n\t}\n\n\t/**\n\t * Extends model schema.\n\t */\n\tprivate _setupSchema(): void {\n\t\tconst schema = this.editor.model.schema;\n\n\t\t// Wait for ImageBlockEditing or ImageInlineEditing to register their elements first,\n\t\t// that's why doing this in afterInit() instead of init().\n\t\tif ( schema.isRegistered( 'imageBlock' ) ) {\n\t\t\tschema.extend( 'imageBlock', {\n\t\t\t\tallowAttributes: [ 'placeholder' ]\n\t\t\t} );\n\t\t}\n\n\t\tif ( schema.isRegistered( 'imageInline' ) ) {\n\t\t\tschema.extend( 'imageInline', {\n\t\t\t\tallowAttributes: [ 'placeholder' ]\n\t\t\t} );\n\t\t}\n\t}\n\n\t/**\n\t * Registers converters.\n\t */\n\tprivate _setupConversion(): void {\n\t\tconst editor = this.editor;\n\t\tconst conversion = editor.conversion;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\tconversion.for( 'editingDowncast' ).add( dispatcher => {\n\t\t\tdispatcher.on<DowncastAttributeEvent<Element>>( 'attribute:placeholder', ( evt, data, conversionApi ) => {\n\t\t\t\tif ( !conversionApi.consumable.test( data.item, evt.name ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( !data.item.is( 'element', 'imageBlock' ) && !data.item.is( 'element', 'imageInline' ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconversionApi.consumable.consume( data.item, evt.name );\n\n\t\t\t\tconst viewWriter = conversionApi.writer;\n\t\t\t\tconst element = conversionApi.mapper.toViewElement( data.item )!;\n\t\t\t\tconst img = imageUtils.findViewImgElement( element )!;\n\n\t\t\t\tif ( data.attributeNewValue ) {\n\t\t\t\t\tviewWriter.addClass( 'image_placeholder', img );\n\t\t\t\t\tviewWriter.setStyle( 'background-image', `url(${ data.attributeNewValue })`, img );\n\t\t\t\t\tviewWriter.setCustomProperty( 'editingPipeline:doNotReuseOnce', true, img );\n\t\t\t\t} else {\n\t\t\t\t\tviewWriter.removeClass( 'image_placeholder', img );\n\t\t\t\t\tviewWriter.removeStyle( 'background-image', img );\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\t}\n\n\t/**\n\t * Prepares listener for image load.\n\t */\n\tprivate _setupLoadListener(): void {\n\t\tconst editor = this.editor;\n\t\tconst model = editor.model;\n\t\tconst editing = editor.editing;\n\t\tconst editingView = editing.view;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\teditingView.addObserver( ImageLoadObserver );\n\n\t\tthis.listenTo<ImageLoadedEvent>( editingView.document, 'imageLoaded', ( evt, domEvent ) => {\n\t\t\tconst imgViewElement = editingView.domConverter.mapDomToView( domEvent.target as HTMLElement );\n\n\t\t\tif ( !imgViewElement ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst viewElement = imageUtils.getImageWidgetFromImageView( imgViewElement as ViewElement );\n\n\t\t\tif ( !viewElement ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst modelElement = editing.mapper.toModelElement( viewElement );\n\n\t\t\tif ( !modelElement || !modelElement.hasAttribute( 'placeholder' ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmodel.enqueueChange( { isUndoable: false }, writer => {\n\t\t\t\twriter.removeAttribute( 'placeholder', modelElement );\n\t\t\t} );\n\t\t} );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/image/imageblockediting\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport { ClipboardPipeline, type ClipboardInputTransformationEvent, type ClipboardContentInsertionEvent } from 'ckeditor5/src/clipboard.js';\nimport { UpcastWriter, type ViewElement } from 'ckeditor5/src/engine.js';\n\nimport {\n\tdowncastImageAttribute,\n\tdowncastSrcsetAttribute,\n\tupcastImageFigure\n} from './converters.js';\n\nimport ImageEditing from './imageediting.js';\nimport ImageSizeAttributes from '../imagesizeattributes.js';\nimport ImageTypeCommand from './imagetypecommand.js';\nimport ImageUtils from '../imageutils.js';\nimport {\n\tgetImgViewElementMatcher,\n\tcreateBlockImageViewElement,\n\tdetermineImageTypeForInsertionAtSelection\n} from './utils.js';\nimport ImagePlaceholder from './imageplaceholder.js';\n\n/**\n * The image block plugin.\n *\n * It registers:\n *\n * * `<imageBlock>` as a block element in the document schema, and allows `alt`, `src` and `srcset` attributes.\n * * converters for editing and data pipelines.,\n * * {@link module:image/image/imagetypecommand~ImageTypeCommand `'imageTypeBlock'`} command that converts inline images into\n * block images.\n */\nexport default class ImageBlockEditing extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageEditing, ImageSizeAttributes, ImageUtils, ImagePlaceholder, ClipboardPipeline ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageBlockEditing' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst editor = this.editor;\n\t\tconst schema = editor.model.schema;\n\n\t\t// Converters 'alt' and 'srcset' are added in 'ImageEditing' plugin.\n\t\tschema.register( 'imageBlock', {\n\t\t\tinheritAllFrom: '$blockObject',\n\t\t\tallowAttributes: [ 'alt', 'src', 'srcset' ]\n\t\t} );\n\n\t\tthis._setupConversion();\n\n\t\tif ( editor.plugins.has( 'ImageInlineEditing' ) ) {\n\t\t\teditor.commands.add( 'imageTypeBlock', new ImageTypeCommand( this.editor, 'imageBlock' ) );\n\n\t\t\tthis._setupClipboardIntegration();\n\t\t}\n\t}\n\n\t/**\n\t * Configures conversion pipelines to support upcasting and downcasting\n\t * block images (block image widgets) and their attributes.\n\t */\n\tprivate _setupConversion(): void {\n\t\tconst editor = this.editor;\n\t\tconst t = editor.t;\n\t\tconst conversion = editor.conversion;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\tconversion.for( 'dataDowncast' )\n\t\t\t.elementToStructure( {\n\t\t\t\tmodel: 'imageBlock',\n\t\t\t\tview: ( modelElement, { writer } ) => createBlockImageViewElement( writer )\n\t\t\t} );\n\n\t\tconversion.for( 'editingDowncast' )\n\t\t\t.elementToStructure( {\n\t\t\t\tmodel: 'imageBlock',\n\t\t\t\tview: ( modelElement, { writer } ) => imageUtils.toImageWidget(\n\t\t\t\t\tcreateBlockImageViewElement( writer ), writer, t( 'image widget' )\n\t\t\t\t)\n\t\t\t} );\n\n\t\tconversion.for( 'downcast' )\n\t\t\t.add( downcastImageAttribute( imageUtils, 'imageBlock', 'src' ) )\n\t\t\t.add( downcastImageAttribute( imageUtils, 'imageBlock', 'alt' ) )\n\t\t\t.add( downcastSrcsetAttribute( imageUtils, 'imageBlock' ) );\n\n\t\t// More image related upcasts are in 'ImageEditing' plugin.\n\t\tconversion.for( 'upcast' )\n\t\t\t.elementToElement( {\n\t\t\t\tview: getImgViewElementMatcher( editor, 'imageBlock' ),\n\t\t\t\tmodel: ( viewImage, { writer } ) => writer.createElement(\n\t\t\t\t\t'imageBlock',\n\t\t\t\t\tviewImage.hasAttribute( 'src' ) ? { src: viewImage.getAttribute( 'src' ) } : undefined\n\t\t\t\t)\n\t\t\t} )\n\t\t\t.add( upcastImageFigure( imageUtils ) );\n\t}\n\n\t/**\n\t * Integrates the plugin with the clipboard pipeline.\n\t *\n\t * Idea is that the feature should recognize the user's intent when an **inline** image is\n\t * pasted or dropped. If such an image is pasted/dropped:\n\t *\n\t * * into an empty block (e.g. an empty paragraph),\n\t * * on another object (e.g. some block widget).\n\t *\n\t * it gets converted into a block image on the fly. We assume this is the user's intent\n\t * if they decided to put their image there.\n\t *\n\t * See the `ImageInlineEditing` for the similar integration that works in the opposite direction.\n\t *\n\t * The feature also sets image `width` and `height` attributes on paste.\n\t */\n\tprivate _setupClipboardIntegration(): void {\n\t\tconst editor = this.editor;\n\t\tconst model = editor.model;\n\t\tconst editingView = editor.editing.view;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst clipboardPipeline: ClipboardPipeline = editor.plugins.get( 'ClipboardPipeline' );\n\n\t\tthis.listenTo<ClipboardInputTransformationEvent>(\n\t\t\tclipboardPipeline,\n\t\t\t'inputTransformation',\n\t\t\t( evt, data ) => {\n\t\t\t\tconst docFragmentChildren = Array.from( data.content.getChildren() as IterableIterator<ViewElement> );\n\t\t\t\tlet modelRange;\n\n\t\t\t\t// Make sure only <img> elements are dropped or pasted. Otherwise, if there some other HTML\n\t\t\t\t// mixed up, this should be handled as a regular paste.\n\t\t\t\tif ( !docFragmentChildren.every( imageUtils.isInlineImageView ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// When drag and dropping, data.targetRanges specifies where to drop because\n\t\t\t\t// this is usually a different place than the current model selection (the user\n\t\t\t\t// uses a drop marker to specify the drop location).\n\t\t\t\tif ( data.targetRanges ) {\n\t\t\t\t\tmodelRange = editor.editing.mapper.toModelRange( data.targetRanges[ 0 ] );\n\t\t\t\t}\n\t\t\t\t// Pasting, however, always occurs at the current model selection.\n\t\t\t\telse {\n\t\t\t\t\tmodelRange = model.document.selection.getFirstRange();\n\t\t\t\t}\n\n\t\t\t\tconst selection = model.createSelection( modelRange );\n\n\t\t\t\t// Convert inline images into block images only when the currently selected block is empty\n\t\t\t\t// (e.g. an empty paragraph) or some object is selected (to replace it).\n\t\t\t\tif ( determineImageTypeForInsertionAtSelection( model.schema, selection ) === 'imageBlock' ) {\n\t\t\t\t\tconst writer = new UpcastWriter( editingView.document );\n\n\t\t\t\t\t// Wrap <img ... /> -> <figure class=\"image\"><img .../></figure>\n\t\t\t\t\tconst blockViewImages = docFragmentChildren.map(\n\t\t\t\t\t\tinlineViewImage => writer.createElement( 'figure', { class: 'image' }, inlineViewImage )\n\t\t\t\t\t);\n\n\t\t\t\t\tdata.content = writer.createDocumentFragment( blockViewImages );\n\t\t\t\t}\n\t\t\t} );\n\n\t\tthis.listenTo<ClipboardContentInsertionEvent>(\n\t\t\tclipboardPipeline,\n\t\t\t'contentInsertion',\n\t\t\t( evt, data ) => {\n\t\t\t\tif ( data.method !== 'paste' ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tmodel.change( writer => {\n\t\t\t\t\tconst range = writer.createRangeIn( data.content );\n\n\t\t\t\t\tfor ( const item of range.getItems() ) {\n\t\t\t\t\t\tif ( item.is( 'element', 'imageBlock' ) ) {\n\t\t\t\t\t\t\timageUtils.setImageNaturalSizeAttributes( item );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageinsert/ui/imageinsertformview\n */\n\nimport {\n\tView,\n\tViewCollection,\n\tsubmitHandler,\n\tFocusCycler,\n\tCollapsibleView,\n\ttype FocusableView\n} from 'ckeditor5/src/ui.js';\nimport { FocusTracker, KeystrokeHandler, type Locale } from 'ckeditor5/src/utils.js';\n\nimport '../../../theme/imageinsert.css';\n\n/**\n * The view displayed in the insert image dropdown.\n *\n * See {@link module:image/imageinsert/imageinsertui~ImageInsertUI}.\n */\nexport default class ImageInsertFormView extends View {\n\t/**\n\t * Tracks information about DOM focus in the form.\n\t */\n\tpublic readonly focusTracker: FocusTracker;\n\n\t/**\n\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\n\t */\n\tpublic readonly keystrokes: KeystrokeHandler;\n\n\t/**\n\t * A collection of views that can be focused in the form.\n\t */\n\tprotected readonly _focusables: ViewCollection<FocusableView>;\n\n\t/**\n\t * Helps cycling over {@link #_focusables} in the form.\n\t */\n\tprotected readonly _focusCycler: FocusCycler;\n\n\t/**\n\t * A collection of the defined integrations for inserting the images.\n\t */\n\tprivate readonly children: ViewCollection<FocusableView>;\n\n\t/**\n\t * Creates a view for the dropdown panel of {@link module:image/imageinsert/imageinsertui~ImageInsertUI}.\n\t *\n\t * @param locale The localization services instance.\n\t * @param integrations An integrations object that contains components (or tokens for components) to be shown in the panel view.\n\t */\n\tconstructor( locale: Locale, integrations: Array<FocusableView> = [] ) {\n\t\tsuper( locale );\n\n\t\tthis.focusTracker = new FocusTracker();\n\t\tthis.keystrokes = new KeystrokeHandler();\n\t\tthis._focusables = new ViewCollection();\n\t\tthis.children = this.createCollection();\n\n\t\tthis._focusCycler = new FocusCycler( {\n\t\t\tfocusables: this._focusables,\n\t\t\tfocusTracker: this.focusTracker,\n\t\t\tkeystrokeHandler: this.keystrokes,\n\t\t\tactions: {\n\t\t\t\t// Navigate form fields backwards using the Shift + Tab keystroke.\n\t\t\t\tfocusPrevious: 'shift + tab',\n\n\t\t\t\t// Navigate form fields forwards using the Tab key.\n\t\t\t\tfocusNext: 'tab'\n\t\t\t}\n\t\t} );\n\n\t\tfor ( const view of integrations ) {\n\t\t\tthis.children.add( view );\n\t\t\tthis._focusables.add( view );\n\n\t\t\tif ( view instanceof CollapsibleView ) {\n\t\t\t\tthis._focusables.addMany( view.children );\n\t\t\t}\n\t\t}\n\n\t\tthis.setTemplate( {\n\t\t\ttag: 'form',\n\n\t\t\tattributes: {\n\t\t\t\tclass: [\n\t\t\t\t\t'ck',\n\t\t\t\t\t'ck-image-insert-form'\n\t\t\t\t],\n\t\t\t\ttabindex: -1\n\t\t\t},\n\n\t\t\tchildren: this.children\n\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override render(): void {\n\t\tsuper.render();\n\n\t\tsubmitHandler( {\n\t\t\tview: this\n\t\t} );\n\n\t\tfor ( const view of this._focusables ) {\n\t\t\tthis.focusTracker.add( view.element! );\n\t\t}\n\n\t\t// Start listening for the keystrokes coming from #element.\n\t\tthis.keystrokes.listenTo( this.element! );\n\n\t\tconst stopPropagation = ( data: KeyboardEvent ) => data.stopPropagation();\n\n\t\t// Since the form is in the dropdown panel which is a child of the toolbar, the toolbar's\n\t\t// keystroke handler would take over the key management in the URL input. We need to prevent\n\t\t// this ASAP. Otherwise, the basic caret movement using the arrow keys will be impossible.\n\t\tthis.keystrokes.set( 'arrowright', stopPropagation );\n\t\tthis.keystrokes.set( 'arrowleft', stopPropagation );\n\t\tthis.keystrokes.set( 'arrowup', stopPropagation );\n\t\tthis.keystrokes.set( 'arrowdown', stopPropagation );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override destroy(): void {\n\t\tsuper.destroy();\n\n\t\tthis.focusTracker.destroy();\n\t\tthis.keystrokes.destroy();\n\t}\n\n\t/**\n\t * Focuses the first {@link #_focusables focusable} in the form.\n\t */\n\tpublic focus(): void {\n\t\tthis._focusCycler.focusFirst();\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageinsert/imageinsertui\n */\n\nimport {\n\tPlugin,\n\ttype Editor,\n\ticons\n} from 'ckeditor5/src/core.js';\nimport {\n\tlogWarning,\n\ttype Locale,\n\ttype Observable\n} from 'ckeditor5/src/utils.js';\nimport {\n\tcreateDropdown,\n\ttype ButtonView,\n\ttype DropdownButtonView,\n\ttype DropdownView,\n\ttype FocusableView,\n\ttype MenuBarMenuListItemButtonView,\n\tMenuBarMenuListItemView,\n\tMenuBarMenuListView,\n\tMenuBarMenuView,\n\tSplitButtonView,\n\ttype View\n} from 'ckeditor5/src/ui.js';\n\nimport ImageInsertFormView from './ui/imageinsertformview.js';\nimport ImageUtils from '../imageutils.js';\n\n/**\n * The image insert dropdown plugin.\n *\n * For a detailed overview, check the {@glink features/images/image-upload/image-upload Image upload feature}\n * and {@glink features/images/images-inserting Insert images via source URL} documentation.\n *\n * Adds the `'insertImage'` dropdown to the {@link module:ui/componentfactory~ComponentFactory UI component factory}\n * and also the `imageInsert` dropdown as an alias for backward compatibility.\n *\n * Adds the `'menuBar:insertImage'` sub-menu to the {@link module:ui/componentfactory~ComponentFactory UI component factory}, which is\n * by default added to the `'Insert'` menu.\n */\nexport default class ImageInsertUI extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageInsertUI' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageUtils ] as const;\n\t}\n\n\t/**\n\t * The dropdown view responsible for displaying the image insert UI.\n\t */\n\tpublic dropdownView?: DropdownView;\n\n\t/**\n\t * Observable property used to alter labels while some image is selected and when it is not.\n\t *\n\t * @observable\n\t */\n\tdeclare public isImageSelected: boolean;\n\n\t/**\n\t * Registered integrations map.\n\t */\n\tprivate _integrations = new Map<string, IntegrationData>();\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( editor: Editor ) {\n\t\tsuper( editor );\n\n\t\teditor.config.define( 'image.insert.integrations', [\n\t\t\t'upload',\n\t\t\t'assetManager',\n\t\t\t'url'\n\t\t] );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst editor = this.editor;\n\t\tconst selection = editor.model.document.selection;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\tthis.set( 'isImageSelected', false );\n\n\t\tthis.listenTo( editor.model.document, 'change', () => {\n\t\t\tthis.isImageSelected = imageUtils.isImage( selection.getSelectedElement() );\n\t\t} );\n\n\t\tconst componentCreator = ( locale: Locale ) => this._createToolbarComponent( locale );\n\t\tconst menuBarComponentCreator = ( locale: Locale ) => this._createMenuBarComponent( locale );\n\n\t\t// Register `insertImage` dropdown and add `imageInsert` dropdown as an alias for backward compatibility.\n\t\teditor.ui.componentFactory.add( 'insertImage', componentCreator );\n\t\teditor.ui.componentFactory.add( 'imageInsert', componentCreator );\n\n\t\teditor.ui.componentFactory.add( 'menuBar:insertImage', menuBarComponentCreator );\n\t}\n\n\t/**\n\t * Registers the insert image dropdown integration.\n\t */\n\tpublic registerIntegration( {\n\t\tname,\n\t\tobservable,\n\t\tbuttonViewCreator,\n\t\tformViewCreator,\n\t\tmenuBarButtonViewCreator,\n\t\trequiresForm = false,\n\t\toverride = false\n\t}: {\n\t\tname: string;\n\t\tobservable: Observable & { isEnabled: boolean } | ( () => Observable & { isEnabled: boolean } );\n\t\tbuttonViewCreator: ( isOnlyOne: boolean ) => ButtonView;\n\t\tformViewCreator: ( isOnlyOne: boolean ) => FocusableView | Array<FocusableView>;\n\t\tmenuBarButtonViewCreator: ( isOnlyOne: boolean ) => MenuBarMenuListItemButtonView | Array<MenuBarMenuListItemButtonView>;\n\t\trequiresForm?: boolean;\n\t\toverride?: boolean;\n\t} ): void {\n\t\tif ( this._integrations.has( name ) && !override ) {\n\t\t\t/**\n\t\t\t * There are two insert-image integrations registered with the same name.\n\t\t\t *\n\t\t\t * Make sure that you do not load multiple asset manager plugins.\n\t\t\t *\n\t\t\t * @error image-insert-integration-exists\n\t\t\t */\n\t\t\tlogWarning( 'image-insert-integration-exists', { name } );\n\t\t}\n\n\t\tthis._integrations.set( name, {\n\t\t\tobservable,\n\t\t\tbuttonViewCreator,\n\t\t\tmenuBarButtonViewCreator,\n\t\t\tformViewCreator,\n\t\t\trequiresForm\n\t\t} );\n\t}\n\n\t/**\n\t * Creates the toolbar component.\n\t */\n\tprivate _createToolbarComponent( locale: Locale ): DropdownView | FocusableView {\n\t\tconst editor = this.editor;\n\t\tconst t = locale.t;\n\n\t\tconst integrations = this._prepareIntegrations();\n\n\t\tif ( !integrations.length ) {\n\t\t\treturn null as any;\n\t\t}\n\n\t\tlet dropdownButton: SplitButtonView | DropdownButtonView | undefined;\n\t\tconst firstIntegration = integrations[ 0 ];\n\n\t\tif ( integrations.length == 1 ) {\n\t\t\t// Do not use dropdown for a single integration button (integration that does not require form view).\n\t\t\tif ( !firstIntegration.requiresForm ) {\n\t\t\t\treturn firstIntegration.buttonViewCreator( true );\n\t\t\t}\n\n\t\t\tdropdownButton = firstIntegration.buttonViewCreator( true ) as DropdownButtonView;\n\t\t} else {\n\t\t\tconst actionButton = firstIntegration.buttonViewCreator( false ) as ButtonView & FocusableView;\n\n\t\t\tdropdownButton = new SplitButtonView( locale, actionButton );\n\t\t\tdropdownButton.tooltip = true;\n\n\t\t\tdropdownButton.bind( 'label' ).to( this, 'isImageSelected', isImageSelected => isImageSelected ?\n\t\t\t\tt( 'Replace image' ) :\n\t\t\t\tt( 'Insert image' )\n\t\t\t);\n\t\t}\n\n\t\tconst dropdownView = this.dropdownView = createDropdown( locale, dropdownButton );\n\t\tconst observables = integrations.map( ( { observable } ) => typeof observable == 'function' ? observable() : observable );\n\n\t\tdropdownView.bind( 'isEnabled' ).toMany( observables, 'isEnabled', ( ...isEnabled ) => (\n\t\t\tisEnabled.some( isEnabled => isEnabled )\n\t\t) );\n\n\t\tdropdownView.once( 'change:isOpen', () => {\n\t\t\tconst integrationViews = integrations.flatMap( ( { formViewCreator } ) => formViewCreator( integrations.length == 1 ) );\n\t\t\tconst imageInsertFormView = new ImageInsertFormView( editor.locale, integrationViews );\n\n\t\t\tdropdownView.panelView.children.add( imageInsertFormView );\n\t\t} );\n\n\t\treturn dropdownView;\n\t}\n\n\t/**\n\t * Creates the menu bar component.\n\t */\n\tprivate _createMenuBarComponent( locale: Locale ): View {\n\t\tconst t = locale.t;\n\n\t\tconst integrations = this._prepareIntegrations();\n\n\t\tif ( !integrations.length ) {\n\t\t\treturn null as any;\n\t\t}\n\n\t\tconst integrationViews = integrations.flatMap( ( {\n\t\t\tmenuBarButtonViewCreator\n\t\t} ) => menuBarButtonViewCreator( integrations.length == 1 ) );\n\n\t\tconst resultView = new MenuBarMenuView( locale );\n\t\tconst listView = new MenuBarMenuListView( locale );\n\t\tresultView.panelView.children.add( listView );\n\n\t\tresultView.buttonView.set( {\n\t\t\ticon: icons.image,\n\t\t\tlabel: t( 'Image' )\n\t\t} );\n\n\t\tfor ( const integrationView of integrationViews ) {\n\t\t\tconst listItemView = new MenuBarMenuListItemView( locale, resultView );\n\n\t\t\tlistItemView.children.add( integrationView );\n\t\t\tlistView.items.add( listItemView );\n\n\t\t\tintegrationView.delegate( 'execute' ).to( resultView );\n\t\t}\n\n\t\treturn resultView;\n\t}\n\n\t/**\n\t * Validates the integrations list.\n\t */\n\tprivate _prepareIntegrations(): Array<IntegrationData> {\n\t\tconst editor = this.editor;\n\t\tconst items = editor.config.get( 'image.insert.integrations' )!;\n\t\tconst result: Array<IntegrationData> = [];\n\n\t\tif ( !items.length ) {\n\t\t\t/**\n\t\t\t * The insert image feature requires a list of integrations to be provided in the editor configuration.\n\t\t\t *\n\t\t\t * The default list of integrations is `upload`, `assetManager`, `url`. Those integrations are included\n\t\t\t * in the insert image dropdown if the given feature plugin is loaded. You should omit the `integrations`\n\t\t\t * configuration key to use the default set or provide a selected list of integrations that should be used.\n\t\t\t *\n\t\t\t * @error image-insert-integrations-not-specified\n\t\t\t */\n\t\t\tlogWarning( 'image-insert-integrations-not-specified' );\n\n\t\t\treturn result;\n\t\t}\n\n\t\tfor ( const item of items ) {\n\t\t\tif ( !this._integrations.has( item ) ) {\n\t\t\t\tif ( ![ 'upload', 'assetManager', 'url' ].includes( item ) ) {\n\t\t\t\t\t/**\n\t\t\t\t\t * The specified insert image integration name is unknown or the providing plugin is not loaded in the editor.\n\t\t\t\t\t *\n\t\t\t\t\t * @error image-insert-unknown-integration\n\t\t\t\t\t */\n\t\t\t\t\tlogWarning( 'image-insert-unknown-integration', { item } );\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tresult.push( this._integrations.get( item )! );\n\t\t}\n\n\t\tif ( !result.length ) {\n\t\t\t/**\n\t\t\t * The image insert feature requires integrations to be registered by separate features.\n\t\t\t *\n\t\t\t * The `insertImage` toolbar button requires integrations to be registered by other features.\n\t\t\t * For example {@link module:image/imageupload~ImageUpload ImageUpload},\n\t\t\t * {@link module:image/imageinsert~ImageInsert ImageInsert},\n\t\t\t * {@link module:image/imageinsertviaurl~ImageInsertViaUrl ImageInsertViaUrl},\n\t\t\t * {@link module:ckbox/ckbox~CKBox CKBox}\n\t\t\t *\n\t\t\t * @error image-insert-integrations-not-registered\n\t\t\t */\n\t\t\tlogWarning( 'image-insert-integrations-not-registered' );\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\ntype IntegrationData = {\n\tobservable: Observable & { isEnabled: boolean } | ( () => Observable & { isEnabled: boolean } );\n\tbuttonViewCreator: ( isOnlyOne: boolean ) => ButtonView;\n\tmenuBarButtonViewCreator: ( isOnlyOne: boolean ) => MenuBarMenuListItemButtonView | Array<MenuBarMenuListItemButtonView>;\n\tformViewCreator: ( isOnlyOne: boolean ) => FocusableView | Array<FocusableView>;\n\trequiresForm: boolean;\n};\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageblock\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport { Widget } from 'ckeditor5/src/widget.js';\n\nimport ImageTextAlternative from './imagetextalternative.js';\nimport ImageBlockEditing from './image/imageblockediting.js';\nimport ImageInsertUI from './imageinsert/imageinsertui.js';\n\nimport '../theme/image.css';\n\n/**\n * The image block plugin.\n *\n * This is a \"glue\" plugin which loads the following plugins:\n *\n * * {@link module:image/image/imageblockediting~ImageBlockEditing},\n * * {@link module:image/imagetextalternative~ImageTextAlternative}.\n *\n * Usually, it is used in conjunction with other plugins from this package. See the {@glink api/image package page}\n * for more information.\n */\nexport default class ImageBlock extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageBlockEditing, Widget, ImageTextAlternative, ImageInsertUI ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageBlock' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/image/imageinlineediting\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport { ClipboardPipeline, type ClipboardInputTransformationEvent, type ClipboardContentInsertionEvent } from 'ckeditor5/src/clipboard.js';\nimport { UpcastWriter, type ViewElement } from 'ckeditor5/src/engine.js';\n\nimport {\n\tdowncastImageAttribute,\n\tdowncastSrcsetAttribute\n} from './converters.js';\n\nimport ImageEditing from './imageediting.js';\nimport ImageSizeAttributes from '../imagesizeattributes.js';\nimport ImageTypeCommand from './imagetypecommand.js';\nimport ImageUtils from '../imageutils.js';\nimport {\n\tgetImgViewElementMatcher,\n\tcreateInlineImageViewElement,\n\tdetermineImageTypeForInsertionAtSelection\n} from './utils.js';\nimport ImagePlaceholder from './imageplaceholder.js';\n\n/**\n * The image inline plugin.\n *\n * It registers:\n *\n * * `<imageInline>` as an inline element in the document schema, and allows `alt`, `src` and `srcset` attributes.\n * * converters for editing and data pipelines.\n * * {@link module:image/image/imagetypecommand~ImageTypeCommand `'imageTypeInline'`} command that converts block images into\n * inline images.\n */\nexport default class ImageInlineEditing extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageEditing, ImageSizeAttributes, ImageUtils, ImagePlaceholder, ClipboardPipeline ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageInlineEditing' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst editor = this.editor;\n\t\tconst schema = editor.model.schema;\n\n\t\t// Converters 'alt' and 'srcset' are added in 'ImageEditing' plugin.\n\t\tschema.register( 'imageInline', {\n\t\t\tinheritAllFrom: '$inlineObject',\n\t\t\tallowAttributes: [ 'alt', 'src', 'srcset' ],\n\t\t\t// Disallow inline images in captions (at least for now).\n\t\t\t// This is the best spot to do that because independent packages can introduce captions (ImageCaption, TableCaption, etc.).\n\t\t\tdisallowIn: [ 'caption' ]\n\t\t} );\n\n\t\tthis._setupConversion();\n\n\t\tif ( editor.plugins.has( 'ImageBlockEditing' ) ) {\n\t\t\teditor.commands.add( 'imageTypeInline', new ImageTypeCommand( this.editor, 'imageInline' ) );\n\n\t\t\tthis._setupClipboardIntegration();\n\t\t}\n\t}\n\n\t/**\n\t * Configures conversion pipelines to support upcasting and downcasting\n\t * inline images (inline image widgets) and their attributes.\n\t */\n\tprivate _setupConversion(): void {\n\t\tconst editor = this.editor;\n\t\tconst t = editor.t;\n\t\tconst conversion = editor.conversion;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\tconversion.for( 'dataDowncast' )\n\t\t\t.elementToElement( {\n\t\t\t\tmodel: 'imageInline',\n\t\t\t\tview: ( modelElement, { writer } ) => writer.createEmptyElement( 'img' )\n\t\t\t} );\n\n\t\tconversion.for( 'editingDowncast' )\n\t\t\t.elementToStructure( {\n\t\t\t\tmodel: 'imageInline',\n\t\t\t\tview: ( modelElement, { writer } ) => imageUtils.toImageWidget(\n\t\t\t\t\tcreateInlineImageViewElement( writer ), writer, t( 'image widget' )\n\t\t\t\t)\n\t\t\t} );\n\n\t\tconversion.for( 'downcast' )\n\t\t\t.add( downcastImageAttribute( imageUtils, 'imageInline', 'src' ) )\n\t\t\t.add( downcastImageAttribute( imageUtils, 'imageInline', 'alt' ) )\n\t\t\t.add( downcastSrcsetAttribute( imageUtils, 'imageInline' ) );\n\n\t\t// More image related upcasts are in 'ImageEditing' plugin.\n\t\tconversion.for( 'upcast' )\n\t\t\t.elementToElement( {\n\t\t\t\tview: getImgViewElementMatcher( editor, 'imageInline' ),\n\t\t\t\tmodel: ( viewImage, { writer } ) => writer.createElement(\n\t\t\t\t\t'imageInline',\n\t\t\t\t\tviewImage.hasAttribute( 'src' ) ? { src: viewImage.getAttribute( 'src' ) } : undefined\n\t\t\t\t)\n\t\t\t} );\n\t}\n\n\t/**\n\t * Integrates the plugin with the clipboard pipeline.\n\t *\n\t * Idea is that the feature should recognize the user's intent when an **block** image is\n\t * pasted or dropped. If such an image is pasted/dropped into a non-empty block\n\t * (e.g. a paragraph with some text) it gets converted into an inline image on the fly.\n\t *\n\t * We assume this is the user's intent if they decided to put their image there.\n\t *\n\t * **Note**: If a block image has a caption, it will not be converted to an inline image\n\t * to avoid the confusion. Captions are added on purpose and they should never be lost\n\t * in the clipboard pipeline.\n\t *\n\t * See the `ImageBlockEditing` for the similar integration that works in the opposite direction.\n\t *\n\t * The feature also sets image `width` and `height` attributes when pasting.\n\t */\n\tprivate _setupClipboardIntegration(): void {\n\t\tconst editor = this.editor;\n\t\tconst model = editor.model;\n\t\tconst editingView = editor.editing.view;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst clipboardPipeline: ClipboardPipeline = editor.plugins.get( 'ClipboardPipeline' );\n\n\t\tthis.listenTo<ClipboardInputTransformationEvent>(\n\t\t\tclipboardPipeline,\n\t\t\t'inputTransformation',\n\t\t\t( evt, data ) => {\n\t\t\t\tconst docFragmentChildren = Array.from( data.content.getChildren() as IterableIterator<ViewElement> );\n\t\t\t\tlet modelRange;\n\n\t\t\t\t// Make sure only <figure class=\"image\"></figure> elements are dropped or pasted. Otherwise, if there some other HTML\n\t\t\t\t// mixed up, this should be handled as a regular paste.\n\t\t\t\tif ( !docFragmentChildren.every( imageUtils.isBlockImageView ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// When drag and dropping, data.targetRanges specifies where to drop because\n\t\t\t\t// this is usually a different place than the current model selection (the user\n\t\t\t\t// uses a drop marker to specify the drop location).\n\t\t\t\tif ( data.targetRanges ) {\n\t\t\t\t\tmodelRange = editor.editing.mapper.toModelRange( data.targetRanges[ 0 ] );\n\t\t\t\t}\n\t\t\t\t// Pasting, however, always occurs at the current model selection.\n\t\t\t\telse {\n\t\t\t\t\tmodelRange = model.document.selection.getFirstRange();\n\t\t\t\t}\n\n\t\t\t\tconst selection = model.createSelection( modelRange );\n\n\t\t\t\t// Convert block images into inline images only when pasting or dropping into non-empty blocks\n\t\t\t\t// and when the block is not an object (e.g. pasting to replace another widget).\n\t\t\t\tif ( determineImageTypeForInsertionAtSelection( model.schema, selection ) === 'imageInline' ) {\n\t\t\t\t\tconst writer = new UpcastWriter( editingView.document );\n\n\t\t\t\t\t// Unwrap <figure class=\"image\"><img .../></figure> -> <img ... />\n\t\t\t\t\t// but <figure class=\"image\"><img .../><figcaption>...</figcaption></figure> -> stays the same\n\t\t\t\t\tconst inlineViewImages = docFragmentChildren.map( blockViewImage => {\n\t\t\t\t\t// If there's just one child, it can be either <img /> or <a><img></a>.\n\t\t\t\t\t// If there are other children than <img>, this means that the block image\n\t\t\t\t\t// has a caption or some other features and this kind of image should be\n\t\t\t\t\t// pasted/dropped without modifications.\n\t\t\t\t\t\tif ( blockViewImage.childCount === 1 ) {\n\t\t\t\t\t\t// Pass the attributes which are present only in the <figure> to the <img>\n\t\t\t\t\t\t// (e.g. the style=\"width:10%\" attribute applied by the ImageResize plugin).\n\t\t\t\t\t\t\tArray.from( blockViewImage.getAttributes() )\n\t\t\t\t\t\t\t\t.forEach( attribute => writer.setAttribute(\n\t\t\t\t\t\t\t\t\t...attribute,\n\t\t\t\t\t\t\t\t\timageUtils.findViewImgElement( blockViewImage )!\n\t\t\t\t\t\t\t\t) );\n\n\t\t\t\t\t\t\treturn blockViewImage.getChild( 0 )!;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn blockViewImage;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t\tdata.content = writer.createDocumentFragment( inlineViewImages );\n\t\t\t\t}\n\t\t\t} );\n\n\t\tthis.listenTo<ClipboardContentInsertionEvent>(\n\t\t\tclipboardPipeline,\n\t\t\t'contentInsertion',\n\t\t\t( evt, data ) => {\n\t\t\t\tif ( data.method !== 'paste' ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tmodel.change( writer => {\n\t\t\t\t\tconst range = writer.createRangeIn( data.content );\n\n\t\t\t\t\tfor ( const item of range.getItems() ) {\n\t\t\t\t\t\tif ( item.is( 'element', 'imageInline' ) ) {\n\t\t\t\t\t\t\timageUtils.setImageNaturalSizeAttributes( item );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageinline\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport { Widget } from 'ckeditor5/src/widget.js';\n\nimport ImageTextAlternative from './imagetextalternative.js';\nimport ImageInlineEditing from './image/imageinlineediting.js';\nimport ImageInsertUI from './imageinsert/imageinsertui.js';\n\nimport '../theme/image.css';\n\n/**\n * The image inline plugin.\n *\n * This is a \"glue\" plugin which loads the following plugins:\n *\n * * {@link module:image/image/imageinlineediting~ImageInlineEditing},\n * * {@link module:image/imagetextalternative~ImageTextAlternative}.\n *\n * Usually, it is used in conjunction with other plugins from this package. See the {@glink api/image package page}\n * for more information.\n */\nexport default class ImageInline extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageInlineEditing, Widget, ImageTextAlternative, ImageInsertUI ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageInline' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/image\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport ImageBlock from './imageblock.js';\nimport ImageInline from './imageinline.js';\n\nimport '../theme/image.css';\n\n/**\n * The image plugin.\n *\n * For a detailed overview, check the {@glink features/images/images-overview image feature} documentation.\n *\n * This is a \"glue\" plugin which loads the following plugins:\n *\n * * {@link module:image/imageblock~ImageBlock},\n * * {@link module:image/imageinline~ImageInline},\n *\n * Usually, it is used in conjunction with other plugins from this package. See the {@glink api/image package page}\n * for more information.\n */\nexport default class Image extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageBlock, ImageInline ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'Image' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagecaption/imagecaptionutils\n */\n\nimport type { DocumentSelection, Element, Selection, ViewElement, Match } from 'ckeditor5/src/engine.js';\nimport { Plugin } from 'ckeditor5/src/core.js';\n\nimport ImageUtils from '../imageutils.js';\n\n/**\n * The image caption utilities plugin.\n */\nexport default class ImageCaptionUtils extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageCaptionUtils' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageUtils ] as const;\n\t}\n\n\t/**\n\t * Returns the caption model element from a given image element. Returns `null` if no caption is found.\n\t */\n\tpublic getCaptionFromImageModelElement( imageModelElement: Element ): Element | null {\n\t\tfor ( const node of imageModelElement.getChildren() ) {\n\t\t\tif ( !!node && node.is( 'element', 'caption' ) ) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns the caption model element for a model selection. Returns `null` if the selection has no caption element ancestor.\n\t */\n\tpublic getCaptionFromModelSelection( selection: Selection | DocumentSelection ): Element | null {\n\t\tconst imageUtils: ImageUtils = this.editor.plugins.get( 'ImageUtils' );\n\t\tconst captionElement = selection.getFirstPosition()!.findAncestor( 'caption' );\n\n\t\tif ( !captionElement ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( imageUtils.isBlockImage( captionElement.parent as Element ) ) {\n\t\t\treturn captionElement;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * {@link module:engine/view/matcher~Matcher} pattern. Checks if a given element is a `<figcaption>` element that is placed\n\t * inside the image `<figure>` element.\n\t * @returns Returns the object accepted by {@link module:engine/view/matcher~Matcher} or `null` if the element\n\t * cannot be matched.\n\t */\n\tpublic matchImageCaptionViewElement( element: ViewElement ): Match | null {\n\t\tconst imageUtils: ImageUtils = this.editor.plugins.get( 'ImageUtils' );\n\n\t\t// Convert only captions for images.\n\t\tif ( element.name == 'figcaption' && imageUtils.isBlockImageView( element.parent as ViewElement ) ) {\n\t\t\treturn { name: true };\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagecaption/toggleimagecaptioncommand\n */\n\nimport type { Element, Writer } from 'ckeditor5/src/engine.js';\nimport { Command } from 'ckeditor5/src/core.js';\n\nimport ImageBlockEditing from '../image/imageblockediting.js';\nimport type ImageCaptionUtils from './imagecaptionutils.js';\nimport type ImageUtils from '../imageutils.js';\nimport type ImageCaptionEditing from './imagecaptionediting.js';\n\n/**\n * The toggle image caption command.\n *\n * This command is registered by {@link module:image/imagecaption/imagecaptionediting~ImageCaptionEditing} as the\n * `'toggleImageCaption'` editor command.\n *\n * Executing this command:\n *\n * * either adds or removes the image caption of a selected image (depending on whether the caption is present or not),\n * * removes the image caption if the selection is anchored in one.\n *\n * ```ts\n * // Toggle the presence of the caption.\n * editor.execute( 'toggleImageCaption' );\n * ```\n *\n * **Note**: Upon executing this command, the selection will be set on the image if previously anchored in the caption element.\n *\n * **Note**: You can move the selection to the caption right away as it shows up upon executing this command by using\n * the `focusCaptionOnShow` option:\n *\n * ```ts\n * editor.execute( 'toggleImageCaption', { focusCaptionOnShow: true } );\n * ```\n */\nexport default class ToggleImageCaptionCommand extends Command {\n\tdeclare public value: boolean;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override refresh(): void {\n\t\tconst editor = this.editor;\n\t\tconst imageCaptionUtils: ImageCaptionUtils = editor.plugins.get( 'ImageCaptionUtils' );\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\t// Only block images can get captions.\n\t\tif ( !editor.plugins.has( ImageBlockEditing ) ) {\n\t\t\tthis.isEnabled = false;\n\t\t\tthis.value = false;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst selection = editor.model.document.selection;\n\t\tconst selectedElement = selection.getSelectedElement();\n\n\t\tif ( !selectedElement ) {\n\t\t\tconst ancestorCaptionElement = imageCaptionUtils.getCaptionFromModelSelection( selection );\n\n\t\t\tthis.isEnabled = !!ancestorCaptionElement;\n\t\t\tthis.value = !!ancestorCaptionElement;\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Block images support captions by default but the command should also be enabled for inline\n\t\t// images because toggling the caption when one is selected should convert it into a block image.\n\t\tthis.isEnabled = imageUtils.isImage( selectedElement );\n\n\t\tif ( !this.isEnabled ) {\n\t\t\tthis.value = false;\n\t\t} else {\n\t\t\tthis.value = !!imageCaptionUtils.getCaptionFromImageModelElement( selectedElement );\n\t\t}\n\t}\n\n\t/**\n\t * Executes the command.\n\t *\n\t * ```ts\n\t * editor.execute( 'toggleImageCaption' );\n\t * ```\n\t *\n\t * @param options Options for the executed command.\n\t * @param options.focusCaptionOnShow When true and the caption shows up, the selection will be moved into it straight away.\n\t * @fires execute\n\t */\n\tpublic override execute( options: { focusCaptionOnShow?: boolean } = {} ): void {\n\t\tconst { focusCaptionOnShow } = options;\n\n\t\tthis.editor.model.change( writer => {\n\t\t\tif ( this.value ) {\n\t\t\t\tthis._hideImageCaption( writer );\n\t\t\t} else {\n\t\t\t\tthis._showImageCaption( writer, focusCaptionOnShow );\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Shows the caption of the `<imageBlock>` or `<imageInline>`. Also:\n\t *\n\t * * it converts `<imageInline>` to `<imageBlock>` to show the caption,\n\t * * it attempts to restore the caption content from the `ImageCaptionEditing` caption registry,\n\t * * it moves the selection to the caption right away, it the `focusCaptionOnShow` option was set.\n\t */\n\tprivate _showImageCaption( writer: Writer, focusCaptionOnShow?: boolean ): void {\n\t\tconst model = this.editor.model;\n\t\tconst selection = model.document.selection;\n\t\tconst imageCaptionEditing: ImageCaptionEditing = this.editor.plugins.get( 'ImageCaptionEditing' );\n\t\tconst imageUtils: ImageUtils = this.editor.plugins.get( 'ImageUtils' );\n\n\t\tlet selectedImage = selection.getSelectedElement()!;\n\n\t\tconst savedCaption = imageCaptionEditing._getSavedCaption( selectedImage );\n\n\t\t// Convert imageInline -> image first.\n\t\tif ( imageUtils.isInlineImage( selectedImage ) ) {\n\t\t\tthis.editor.execute( 'imageTypeBlock' );\n\n\t\t\t// Executing the command created a new model element. Let's pick it again.\n\t\t\tselectedImage = selection.getSelectedElement()!;\n\t\t}\n\n\t\t// Try restoring the caption from the ImageCaptionEditing plugin storage.\n\t\tconst newCaptionElement = savedCaption || writer.createElement( 'caption' );\n\n\t\twriter.append( newCaptionElement, selectedImage );\n\n\t\tif ( focusCaptionOnShow ) {\n\t\t\twriter.setSelection( newCaptionElement, 'in' );\n\t\t}\n\t}\n\n\t/**\n\t * Hides the caption of a selected image (or an image caption the selection is anchored to).\n\t *\n\t * The content of the caption is stored in the `ImageCaptionEditing` caption registry to make this\n\t * a reversible action.\n\t */\n\tprivate _hideImageCaption( writer: Writer ): void {\n\t\tconst editor = this.editor;\n\t\tconst selection = editor.model.document.selection;\n\t\tconst imageCaptionEditing: ImageCaptionEditing = editor.plugins.get( 'ImageCaptionEditing' );\n\t\tconst imageCaptionUtils: ImageCaptionUtils = editor.plugins.get( 'ImageCaptionUtils' );\n\t\tlet selectedImage = selection.getSelectedElement()!;\n\t\tlet captionElement: Element;\n\n\t\tif ( selectedImage ) {\n\t\t\tcaptionElement = imageCaptionUtils.getCaptionFromImageModelElement( selectedImage )!;\n\t\t} else {\n\t\t\tcaptionElement = imageCaptionUtils.getCaptionFromModelSelection( selection )!;\n\t\t\tselectedImage = captionElement!.parent as Element;\n\t\t}\n\n\t\t// Store the caption content so it can be restored quickly if the user changes their mind even if they toggle image<->imageInline.\n\t\timageCaptionEditing._saveCaption( selectedImage, captionElement );\n\n\t\twriter.setSelection( selectedImage, 'on' );\n\t\twriter.remove( captionElement );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagecaption/imagecaptionediting\n */\n\nimport { type Editor, Plugin, type CommandExecuteEvent } from 'ckeditor5/src/core.js';\nimport { Element, enablePlaceholder, type DocumentChangeEvent, type DiffItemAttribute } from 'ckeditor5/src/engine.js';\nimport { toWidgetEditable } from 'ckeditor5/src/widget.js';\nimport type { GetCallback } from 'ckeditor5/src/utils.js';\n\nimport ToggleImageCaptionCommand from './toggleimagecaptioncommand.js';\nimport ImageUtils from '../imageutils.js';\nimport ImageCaptionUtils from './imagecaptionutils.js';\n\n/**\n * The image caption engine plugin. It is responsible for:\n *\n * * registering converters for the caption element,\n * * registering converters for the caption model attribute,\n * * registering the {@link module:image/imagecaption/toggleimagecaptioncommand~ToggleImageCaptionCommand `toggleImageCaption`} command.\n */\nexport default class ImageCaptionEditing extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageUtils, ImageCaptionUtils ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageCaptionEditing' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * A map that keeps saved JSONified image captions and image model elements they are\n\t * associated with.\n\t *\n\t * To learn more about this system, see {@link #_saveCaption}.\n\t */\n\tprivate _savedCaptionsMap: WeakMap<Element, unknown>;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( editor: Editor ) {\n\t\tsuper( editor );\n\n\t\tthis._savedCaptionsMap = new WeakMap();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst editor = this.editor;\n\t\tconst schema = editor.model.schema;\n\n\t\t// Schema configuration.\n\t\tif ( !schema.isRegistered( 'caption' ) ) {\n\t\t\tschema.register( 'caption', {\n\t\t\t\tallowIn: 'imageBlock',\n\t\t\t\tallowContentOf: '$block',\n\t\t\t\tisLimit: true\n\t\t\t} );\n\t\t} else {\n\t\t\tschema.extend( 'caption', {\n\t\t\t\tallowIn: 'imageBlock'\n\t\t\t} );\n\t\t}\n\n\t\teditor.commands.add( 'toggleImageCaption', new ToggleImageCaptionCommand( this.editor ) );\n\n\t\tthis._setupConversion();\n\t\tthis._setupImageTypeCommandsIntegration();\n\t\tthis._registerCaptionReconversion();\n\t}\n\n\t/**\n\t * Configures conversion pipelines to support upcasting and downcasting\n\t * image captions.\n\t */\n\tprivate _setupConversion(): void {\n\t\tconst editor = this.editor;\n\t\tconst view = editor.editing.view;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst imageCaptionUtils: ImageCaptionUtils = editor.plugins.get( 'ImageCaptionUtils' );\n\t\tconst t = editor.t;\n\n\t\t// View -> model converter for the data pipeline.\n\t\teditor.conversion.for( 'upcast' ).elementToElement( {\n\t\t\tview: element => imageCaptionUtils.matchImageCaptionViewElement( element ),\n\t\t\tmodel: 'caption'\n\t\t} );\n\n\t\t// Model -> view converter for the data pipeline.\n\t\teditor.conversion.for( 'dataDowncast' ).elementToElement( {\n\t\t\tmodel: 'caption',\n\t\t\tview: ( modelElement, { writer } ) => {\n\t\t\t\tif ( !imageUtils.isBlockImage( modelElement.parent as Element ) ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn writer.createContainerElement( 'figcaption' );\n\t\t\t}\n\t\t} );\n\n\t\t// Model -> view converter for the editing pipeline.\n\t\teditor.conversion.for( 'editingDowncast' ).elementToElement( {\n\t\t\tmodel: 'caption',\n\t\t\tview: ( modelElement, { writer } ) => {\n\t\t\t\tif ( !imageUtils.isBlockImage( modelElement.parent as Element ) ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst figcaptionElement = writer.createEditableElement( 'figcaption' );\n\t\t\t\twriter.setCustomProperty( 'imageCaption', true, figcaptionElement );\n\n\t\t\t\tfigcaptionElement.placeholder = t( 'Enter image caption' );\n\t\t\t\tenablePlaceholder( {\n\t\t\t\t\tview,\n\t\t\t\t\telement: figcaptionElement,\n\t\t\t\t\tkeepOnFocus: true\n\t\t\t\t} );\n\n\t\t\t\tconst imageAlt = ( modelElement.parent as Element ).getAttribute( 'alt' ) as string;\n\t\t\t\tconst label = imageAlt ? t( 'Caption for image: %0', [ imageAlt ] ) : t( 'Caption for the image' );\n\n\t\t\t\treturn toWidgetEditable( figcaptionElement, writer, { label } );\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Integrates with {@link module:image/image/imagetypecommand~ImageTypeCommand image type commands}\n\t * to make sure the caption is preserved when the type of an image changes so it can be restored\n\t * in the future if the user decides they want their caption back.\n\t */\n\tprivate _setupImageTypeCommandsIntegration(): void {\n\t\tconst editor = this.editor;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst imageCaptionUtils: ImageCaptionUtils = editor.plugins.get( 'ImageCaptionUtils' );\n\t\tconst imageTypeInlineCommand = editor.commands.get( 'imageTypeInline' );\n\t\tconst imageTypeBlockCommand = editor.commands.get( 'imageTypeBlock' );\n\n\t\tconst handleImageTypeChange: GetCallback<CommandExecuteEvent> = evt => {\n\t\t\t// The image type command execution can be unsuccessful.\n\t\t\tif ( !evt.return ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { oldElement, newElement } = evt.return as { oldElement: Element; newElement: Element };\n\n\t\t\t/* istanbul ignore if: paranoid check -- @preserve */\n\t\t\tif ( !oldElement ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( imageUtils.isBlockImage( oldElement ) ) {\n\t\t\t\tconst oldCaptionElement = imageCaptionUtils.getCaptionFromImageModelElement( oldElement );\n\n\t\t\t\t// If the old element was a captioned block image (the caption was visible),\n\t\t\t\t// simply save it so it can be restored.\n\t\t\t\tif ( oldCaptionElement ) {\n\t\t\t\t\tthis._saveCaption( newElement, oldCaptionElement );\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst savedOldElementCaption = this._getSavedCaption( oldElement );\n\n\t\t\t// If either:\n\t\t\t//\n\t\t\t// * the block image didn't have a visible caption,\n\t\t\t// * the block image caption was hidden (and already saved),\n\t\t\t// * the inline image was passed\n\t\t\t//\n\t\t\t// just try to \"pass\" the saved caption from the old image to the new image\n\t\t\t// so it can be retrieved in the future if the user wants it back.\n\t\t\tif ( savedOldElementCaption ) {\n\t\t\t\t// Note: Since we're writing to a WeakMap, we don't bother with removing the\n\t\t\t\t// [ oldElement, savedOldElementCaption ] pair from it.\n\t\t\t\tthis._saveCaption( newElement, savedOldElementCaption );\n\t\t\t}\n\t\t};\n\n\t\t// Presence of the commands depends on the Image(Inline|Block)Editing plugins loaded in the editor.\n\t\tif ( imageTypeInlineCommand ) {\n\t\t\tthis.listenTo<CommandExecuteEvent>( imageTypeInlineCommand, 'execute', handleImageTypeChange, { priority: 'low' } );\n\t\t}\n\n\t\tif ( imageTypeBlockCommand ) {\n\t\t\tthis.listenTo<CommandExecuteEvent>( imageTypeBlockCommand, 'execute', handleImageTypeChange, { priority: 'low' } );\n\t\t}\n\t}\n\n\t/**\n\t * Returns the saved {@link module:engine/model/element~Element#toJSON JSONified} caption\n\t * of an image model element.\n\t *\n\t * See {@link #_saveCaption}.\n\t *\n\t * @internal\n\t * @param imageModelElement The model element the caption should be returned for.\n\t * @returns The model caption element or `null` if there is none.\n\t */\n\tpublic _getSavedCaption( imageModelElement: Element ): Element | null {\n\t\tconst jsonObject = this._savedCaptionsMap.get( imageModelElement );\n\n\t\treturn jsonObject ? Element.fromJSON( jsonObject ) : null;\n\t}\n\n\t/**\n\t * Saves a {@link module:engine/model/element~Element#toJSON JSONified} caption for\n\t * an image element to allow restoring it in the future.\n\t *\n\t * A caption is saved every time it gets hidden and/or the type of an image changes. The\n\t * user should be able to restore it on demand.\n\t *\n\t * **Note**: The caption cannot be stored in the image model element attribute because,\n\t * for instance, when the model state propagates to collaborators, the attribute would get\n\t * lost (mainly because it does not convert to anything when the caption is hidden) and\n\t * the states of collaborators' models would de-synchronize causing numerous issues.\n\t *\n\t * See {@link #_getSavedCaption}.\n\t *\n\t * @internal\n\t * @param imageModelElement The model element the caption is saved for.\n\t * @param caption The caption model element to be saved.\n\t */\n\tpublic _saveCaption( imageModelElement: Element, caption: Element ): void {\n\t\tthis._savedCaptionsMap.set( imageModelElement, caption.toJSON() );\n\t}\n\n\t/**\n\t * Reconverts image caption when image alt attribute changes.\n\t * The change of alt attribute is reflected in caption's aria-label attribute.\n\t */\n\tprivate _registerCaptionReconversion(): void {\n\t\tconst editor = this.editor;\n\t\tconst model = editor.model;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst imageCaptionUtils: ImageCaptionUtils = editor.plugins.get( 'ImageCaptionUtils' );\n\n\t\tmodel.document.on<DocumentChangeEvent>( 'change:data', () => {\n\t\t\tconst changes = model.document.differ.getChanges();\n\n\t\t\tfor ( const change of changes as Array<DiffItemAttribute> ) {\n\t\t\t\tif ( change.attributeKey !== 'alt' ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst image = change.range.start.nodeAfter as Element;\n\n\t\t\t\tif ( imageUtils.isBlockImage( image ) ) {\n\t\t\t\t\tconst caption = imageCaptionUtils.getCaptionFromImageModelElement( image );\n\n\t\t\t\t\tif ( !caption ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.editing.reconvertItem( caption );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagecaption/imagecaptionui\n */\n\nimport { Plugin, icons } from 'ckeditor5/src/core.js';\nimport { ButtonView } from 'ckeditor5/src/ui.js';\nimport ImageCaptionUtils from './imagecaptionutils.js';\nimport type ToggleImageCaptionCommand from './toggleimagecaptioncommand.js';\n\n/**\n * The image caption UI plugin. It introduces the `'toggleImageCaption'` UI button.\n */\nexport default class ImageCaptionUI extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageCaptionUtils ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageCaptionUI' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst editor = this.editor;\n\t\tconst editingView = editor.editing.view;\n\t\tconst imageCaptionUtils: ImageCaptionUtils = editor.plugins.get( 'ImageCaptionUtils' );\n\t\tconst t = editor.t;\n\n\t\teditor.ui.componentFactory.add( 'toggleImageCaption', locale => {\n\t\t\tconst command: ToggleImageCaptionCommand = editor.commands.get( 'toggleImageCaption' )!;\n\t\t\tconst view = new ButtonView( locale );\n\n\t\t\tview.set( {\n\t\t\t\ticon: icons.caption,\n\t\t\t\ttooltip: true,\n\t\t\t\tisToggleable: true\n\t\t\t} );\n\n\t\t\tview.bind( 'isOn', 'isEnabled' ).to( command, 'value', 'isEnabled' );\n\t\t\tview.bind( 'label' ).to( command, 'value', value => value ? t( 'Toggle caption off' ) : t( 'Toggle caption on' ) );\n\n\t\t\tthis.listenTo( view, 'execute', () => {\n\t\t\t\teditor.execute( 'toggleImageCaption', { focusCaptionOnShow: true } );\n\n\t\t\t\t// Scroll to the selection and highlight the caption if the caption showed up.\n\t\t\t\tconst modelCaptionElement = imageCaptionUtils.getCaptionFromModelSelection( editor.model.document.selection );\n\n\t\t\t\tif ( modelCaptionElement ) {\n\t\t\t\t\tconst figcaptionElement = editor.editing.mapper.toViewElement( modelCaptionElement );\n\n\t\t\t\t\teditingView.scrollToTheSelection();\n\n\t\t\t\t\teditingView.change( writer => {\n\t\t\t\t\t\twriter.addClass( 'image__caption_highlighted', figcaptionElement! );\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\teditor.editing.view.focus();\n\t\t\t} );\n\n\t\t\treturn view;\n\t\t} );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagecaption\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport ImageCaptionEditing from './imagecaption/imagecaptionediting.js';\nimport ImageCaptionUI from './imagecaption/imagecaptionui.js';\n\nimport '../theme/imagecaption.css';\n\n/**\n * The image caption plugin.\n *\n * For a detailed overview, check the {@glink features/images/images-captions image caption} documentation.\n */\nexport default class ImageCaption extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageCaptionEditing, ImageCaptionUI ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageCaption' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageupload/utils\n */\n\n/* global fetch, File */\n\nimport type { ViewElement } from 'ckeditor5/src/engine.js';\nimport { global } from 'ckeditor5/src/utils.js';\nimport type ImageUtils from '../imageutils.js';\n\n/**\n * Creates a regular expression used to test for image files.\n *\n * ```ts\n * const imageType = createImageTypeRegExp( [ 'png', 'jpeg', 'svg+xml', 'vnd.microsoft.icon' ] );\n *\n * console.log( 'is supported image', imageType.test( file.type ) );\n * ```\n */\nexport function createImageTypeRegExp( types: Array<string> ): RegExp {\n\t// Sanitize the MIME type name which may include: \"+\", \"-\" or \".\".\n\tconst regExpSafeNames = types.map( type => type.replace( '+', '\\\\+' ) );\n\n\treturn new RegExp( `^image\\\\/(${ regExpSafeNames.join( '|' ) })$` );\n}\n\n/**\n * Creates a promise that fetches the image local source (Base64 or blob) and resolves with a `File` object.\n *\n * @param image Image whose source to fetch.\n * @returns A promise which resolves when an image source is fetched and converted to a `File` instance.\n * It resolves with a `File` object. If there were any errors during file processing, the promise will be rejected.\n */\nexport function fetchLocalImage( image: ViewElement ): Promise<File> {\n\treturn new Promise( ( resolve, reject ) => {\n\t\tconst imageSrc = image.getAttribute( 'src' )!;\n\n\t\t// Fetch works asynchronously and so does not block browser UI when processing data.\n\t\tfetch( imageSrc )\n\t\t\t.then( resource => resource.blob() )\n\t\t\t.then( blob => {\n\t\t\t\tconst mimeType = getImageMimeType( blob, imageSrc );\n\t\t\t\tconst ext = mimeType.replace( 'image/', '' );\n\t\t\t\tconst filename = `image.${ ext }`;\n\t\t\t\tconst file = new File( [ blob ], filename, { type: mimeType } );\n\n\t\t\t\tresolve( file );\n\t\t\t} )\n\t\t\t.catch( err => {\n\t\t\t\t// Fetch fails only, if it can't make a request due to a network failure or if anything prevented the request\n\t\t\t\t// from completing, i.e. the Content Security Policy rules. It is not possible to detect the exact cause of failure,\n\t\t\t\t// so we are just trying the fallback solution, if general TypeError is thrown.\n\t\t\t\treturn err && err.name === 'TypeError' ?\n\t\t\t\t\tconvertLocalImageOnCanvas( imageSrc ).then( resolve ).catch( reject ) :\n\t\t\t\t\treject( err );\n\t\t\t} );\n\t} );\n}\n\n/**\n * Checks whether a given node is an image element with a local source (Base64 or blob).\n *\n * @param node The node to check.\n */\nexport function isLocalImage( imageUtils: ImageUtils, node: ViewElement ): boolean {\n\tif ( !imageUtils.isInlineImageView( node ) || !node.getAttribute( 'src' ) ) {\n\t\treturn false;\n\t}\n\n\treturn !!node.getAttribute( 'src' )!.match( /^data:image\\/\\w+;base64,/g ) ||\n\t\t!!node.getAttribute( 'src' )!.match( /^blob:/g );\n}\n\n/**\n * Extracts an image type based on its blob representation or its source.\n * @param blob Image blob representation.\n * @param src Image `src` attribute value.\n */\nfunction getImageMimeType( blob: Blob, src: string ): string {\n\tif ( blob.type ) {\n\t\treturn blob.type;\n\t} else if ( src.match( /data:(image\\/\\w+);base64/ ) ) {\n\t\treturn src.match( /data:(image\\/\\w+);base64/ )![ 1 ].toLowerCase();\n\t} else {\n\t\t// Fallback to 'jpeg' as common extension.\n\t\treturn 'image/jpeg';\n\t}\n}\n\n/**\n * Creates a promise that converts the image local source (Base64 or blob) to a blob using canvas and resolves\n * with a `File` object.\n * @param imageSrc Image `src` attribute value.\n * @returns A promise which resolves when an image source is converted to a `File` instance.\n * It resolves with a `File` object. If there were any errors during file processing, the promise will be rejected.\n */\nfunction convertLocalImageOnCanvas( imageSrc: string ): Promise<File> {\n\treturn getBlobFromCanvas( imageSrc ).then( blob => {\n\t\tconst mimeType = getImageMimeType( blob, imageSrc );\n\t\tconst ext = mimeType.replace( 'image/', '' );\n\t\tconst filename = `image.${ ext }`;\n\n\t\treturn new File( [ blob ], filename, { type: mimeType } );\n\t} );\n}\n\n/**\n * Creates a promise that resolves with a `Blob` object converted from the image source (Base64 or blob).\n * @param imageSrc Image `src` attribute value.\n */\nfunction getBlobFromCanvas( imageSrc: string ): Promise<Blob> {\n\treturn new Promise( ( resolve, reject ) => {\n\t\tconst image = global.document.createElement( 'img' );\n\n\t\timage.addEventListener( 'load', () => {\n\t\t\tconst canvas = global.document.createElement( 'canvas' );\n\n\t\t\tcanvas.width = image.width;\n\t\t\tcanvas.height = image.height;\n\n\t\t\tconst ctx = canvas.getContext( '2d' )!;\n\n\t\t\tctx.drawImage( image, 0, 0 );\n\n\t\t\tcanvas.toBlob( blob => blob ? resolve( blob ) : reject() );\n\t\t} );\n\n\t\timage.addEventListener( 'error', () => reject() );\n\n\t\timage.src = imageSrc;\n\t} );\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageupload/imageuploadui\n */\n\nimport { Plugin, icons } from 'ckeditor5/src/core.js';\nimport {\n\tFileDialogButtonView, MenuBarMenuListItemFileDialogButtonView,\n\ttype ButtonView, type MenuBarMenuListItemButtonView\n} from 'ckeditor5/src/ui.js';\nimport { createImageTypeRegExp } from './utils.js';\nimport type ImageInsertUI from '../imageinsert/imageinsertui.js';\n\n/**\n * The image upload button plugin.\n *\n * For a detailed overview, check the {@glink features/images/image-upload/image-upload Image upload feature} documentation.\n *\n * Adds the `'uploadImage'` button to the {@link module:ui/componentfactory~ComponentFactory UI component factory}\n * and also the `imageUpload` button as an alias for backward compatibility.\n *\n * Adds the `'menuBar:uploadImage'` menu button to the {@link module:ui/componentfactory~ComponentFactory UI component factory}.\n *\n * It also integrates with the `insertImage` toolbar component and `menuBar:insertImage` menu component, which are the default components\n * through which image upload is available.\n */\nexport default class ImageUploadUI extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageUploadUI' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst editor = this.editor;\n\n\t\t// Setup `uploadImage` button and add `imageUpload` button as an alias for backward compatibility.\n\t\teditor.ui.componentFactory.add( 'uploadImage', () => this._createToolbarButton() );\n\t\teditor.ui.componentFactory.add( 'imageUpload', () => this._createToolbarButton() );\n\n\t\teditor.ui.componentFactory.add( 'menuBar:uploadImage', () => this._createMenuBarButton( 'standalone' ) );\n\n\t\tif ( editor.plugins.has( 'ImageInsertUI' ) ) {\n\t\t\teditor.plugins.get( 'ImageInsertUI' ).registerIntegration( {\n\t\t\t\tname: 'upload',\n\t\t\t\tobservable: () => editor.commands.get( 'uploadImage' )!,\n\t\t\t\tbuttonViewCreator: () => this._createToolbarButton(),\n\t\t\t\tformViewCreator: () => this._createDropdownButton(),\n\t\t\t\tmenuBarButtonViewCreator: isOnly => this._createMenuBarButton( isOnly ? 'insertOnly' : 'insertNested' )\n\t\t\t} );\n\t\t}\n\t}\n\n\t/**\n\t * Creates the base for various kinds of the button component provided by this feature.\n\t */\n\tprivate _createButton<T extends typeof FileDialogButtonView | typeof MenuBarMenuListItemFileDialogButtonView>(\n\t\tButtonClass: T\n\t): InstanceType<T> {\n\t\tconst editor = this.editor;\n\t\tconst locale = editor.locale;\n\t\tconst command = editor.commands.get( 'uploadImage' )!;\n\t\tconst imageTypes = editor.config.get( 'image.upload.types' )!;\n\t\tconst imageTypesRegExp = createImageTypeRegExp( imageTypes );\n\n\t\tconst view = new ButtonClass( editor.locale ) as InstanceType<T>;\n\t\tconst t = locale.t;\n\n\t\tview.set( {\n\t\t\tacceptedType: imageTypes.map( type => `image/${ type }` ).join( ',' ),\n\t\t\tallowMultipleFiles: true,\n\t\t\tlabel: t( 'Upload from computer' ),\n\t\t\ticon: icons.imageUpload\n\t\t} );\n\n\t\tview.bind( 'isEnabled' ).to( command );\n\n\t\tview.on( 'done', ( evt, files: FileList ) => {\n\t\t\tconst imagesToUpload = Array.from( files ).filter( file => imageTypesRegExp.test( file.type ) );\n\n\t\t\tif ( imagesToUpload.length ) {\n\t\t\t\teditor.execute( 'uploadImage', { file: imagesToUpload } );\n\n\t\t\t\teditor.editing.view.focus();\n\t\t\t}\n\t\t} );\n\n\t\treturn view;\n\t}\n\n\t/**\n\t * Creates a simple toolbar button, with an icon and a tooltip.\n\t */\n\tprivate _createToolbarButton(): ButtonView {\n\t\tconst t = this.editor.locale.t;\n\t\tconst imageInsertUI: ImageInsertUI = this.editor.plugins.get( 'ImageInsertUI' );\n\t\tconst uploadImageCommand = this.editor.commands.get( 'uploadImage' )!;\n\n\t\tconst button = this._createButton( FileDialogButtonView );\n\n\t\tbutton.tooltip = true;\n\t\tbutton.bind( 'label' ).to(\n\t\t\timageInsertUI,\n\t\t\t'isImageSelected',\n\t\t\tuploadImageCommand,\n\t\t\t'isAccessAllowed',\n\t\t\t( isImageSelected, isAccessAllowed ) => {\n\t\t\t\tif ( !isAccessAllowed ) {\n\t\t\t\t\treturn t( 'You have no image upload permissions.' );\n\t\t\t\t}\n\n\t\t\t\treturn isImageSelected ? t( 'Replace image from computer' ) : t( 'Upload image from computer' );\n\t\t\t}\n\t\t);\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Creates a button for the dropdown view, with an icon, text and no tooltip.\n\t */\n\tprivate _createDropdownButton(): ButtonView {\n\t\tconst t = this.editor.locale.t;\n\t\tconst imageInsertUI: ImageInsertUI = this.editor.plugins.get( 'ImageInsertUI' );\n\n\t\tconst button = this._createButton( FileDialogButtonView );\n\n\t\tbutton.withText = true;\n\n\t\tbutton.bind( 'label' ).to(\n\t\t\timageInsertUI,\n\t\t\t'isImageSelected',\n\t\t\tisImageSelected => isImageSelected ? t( 'Replace from computer' ) : t( 'Upload from computer' )\n\t\t);\n\n\t\tbutton.on( 'execute', () => {\n\t\t\timageInsertUI.dropdownView!.isOpen = false;\n\t\t} );\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Creates a button for the menu bar.\n\t */\n\tprivate _createMenuBarButton( type: 'standalone' | 'insertOnly' | 'insertNested' ): MenuBarMenuListItemButtonView {\n\t\tconst t = this.editor.locale.t;\n\t\tconst button = this._createButton( MenuBarMenuListItemFileDialogButtonView );\n\n\t\tbutton.withText = true;\n\n\t\tswitch ( type ) {\n\t\t\tcase 'standalone':\n\t\t\t\tbutton.label = t( 'Image from computer' );\n\t\t\t\tbreak;\n\t\t\tcase 'insertOnly':\n\t\t\t\tbutton.label = t( 'Image' );\n\t\t\t\tbreak;\n\t\t\tcase 'insertNested':\n\t\t\t\tbutton.label = t( 'From computer' );\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn button;\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageupload/imageuploadprogress\n */\n\n/* globals setTimeout */\n\nimport { type Editor, Plugin } from 'ckeditor5/src/core.js';\nimport { FileRepository, type FileLoader } from 'ckeditor5/src/upload.js';\n\nimport '../../theme/imageuploadprogress.css';\nimport '../../theme/imageuploadicon.css';\nimport '../../theme/imageuploadloader.css';\nimport type { GetCallback } from 'ckeditor5/src/utils.js';\nimport type {\n\tDowncastWriter,\n\tEditingView,\n\tViewElement,\n\tViewContainerElement,\n\tViewUIElement,\n\tDowncastAttributeEvent,\n\tElement\n} from 'ckeditor5/src/engine.js';\nimport type ImageUtils from '../imageutils.js';\n\n/**\n * The image upload progress plugin.\n * It shows a placeholder when the image is read from the disk and a progress bar while the image is uploading.\n */\nexport default class ImageUploadProgress extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageUploadProgress' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * The image placeholder that is displayed before real image data can be accessed.\n\t *\n\t * For the record, this image is a 1x1 px GIF with an aspect ratio set by CSS.\n\t */\n\tprivate placeholder: string;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( editor: Editor ) {\n\t\tsuper( editor );\n\n\t\tthis.placeholder = 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst editor = this.editor;\n\n\t\t// Upload status change - update image's view according to that status.\n\t\tif ( editor.plugins.has( 'ImageBlockEditing' ) ) {\n\t\t\teditor.editing.downcastDispatcher.on<DowncastAttributeEvent>(\n\t\t\t\t'attribute:uploadStatus:imageBlock',\n\t\t\t\tthis.uploadStatusChange\n\t\t\t);\n\t\t}\n\n\t\tif ( editor.plugins.has( 'ImageInlineEditing' ) ) {\n\t\t\teditor.editing.downcastDispatcher.on<DowncastAttributeEvent>(\n\t\t\t\t'attribute:uploadStatus:imageInline',\n\t\t\t\tthis.uploadStatusChange\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * This method is called each time the image `uploadStatus` attribute is changed.\n\t *\n\t * @param evt An object containing information about the fired event.\n\t * @param data Additional information about the change.\n\t */\n\tprivate uploadStatusChange: GetCallback<DowncastAttributeEvent> = ( evt, data, conversionApi ) => {\n\t\tconst editor = this.editor;\n\t\tconst modelImage = data.item as Element;\n\t\tconst uploadId = modelImage.getAttribute( 'uploadId' ) as string | number;\n\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst fileRepository = editor.plugins.get( FileRepository );\n\t\tconst status = uploadId ? data.attributeNewValue : null;\n\t\tconst placeholder = this.placeholder;\n\t\tconst viewFigure = editor.editing.mapper.toViewElement( modelImage )! as ViewContainerElement;\n\t\tconst viewWriter = conversionApi.writer;\n\n\t\tif ( status == 'reading' ) {\n\t\t\t// Start \"appearing\" effect and show placeholder with infinite progress bar on the top\n\t\t\t// while image is read from disk.\n\t\t\t_startAppearEffect( viewFigure, viewWriter );\n\t\t\t_showPlaceholder( imageUtils, placeholder, viewFigure, viewWriter );\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Show progress bar on the top of the image when image is uploading.\n\t\tif ( status == 'uploading' ) {\n\t\t\tconst loader = fileRepository.loaders.get( uploadId );\n\n\t\t\t// Start appear effect if needed - see https://github.com/ckeditor/ckeditor5-image/issues/191.\n\t\t\t_startAppearEffect( viewFigure, viewWriter );\n\n\t\t\tif ( !loader ) {\n\t\t\t\t// There is no loader associated with uploadId - this means that image came from external changes.\n\t\t\t\t// In such cases we still want to show the placeholder until image is fully uploaded.\n\t\t\t\t// Show placeholder if needed - see https://github.com/ckeditor/ckeditor5-image/issues/191.\n\t\t\t\t_showPlaceholder( imageUtils, placeholder, viewFigure, viewWriter );\n\t\t\t} else {\n\t\t\t\t// Hide placeholder and initialize progress bar showing upload progress.\n\t\t\t\t_hidePlaceholder( viewFigure, viewWriter );\n\t\t\t\t_showProgressBar( viewFigure, viewWriter, loader, editor.editing.view );\n\t\t\t\t_displayLocalImage( imageUtils, viewFigure!, viewWriter, loader );\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif ( status == 'complete' && fileRepository.loaders.get( uploadId ) ) {\n\t\t\t_showCompleteIcon( viewFigure, viewWriter, editor.editing.view );\n\t\t}\n\n\t\t// Clean up.\n\t\t_hideProgressBar( viewFigure, viewWriter );\n\t\t_hidePlaceholder( viewFigure, viewWriter );\n\t\t_stopAppearEffect( viewFigure, viewWriter );\n\t};\n}\n\n/**\n * Adds ck-appear class to the image figure if one is not already applied.\n */\nfunction _startAppearEffect( viewFigure: ViewContainerElement, writer: DowncastWriter ) {\n\tif ( !viewFigure.hasClass( 'ck-appear' ) ) {\n\t\twriter.addClass( 'ck-appear', viewFigure );\n\t}\n}\n\n/**\n * Removes ck-appear class to the image figure if one is not already removed.\n */\nfunction _stopAppearEffect( viewFigure: ViewContainerElement, writer: DowncastWriter ) {\n\twriter.removeClass( 'ck-appear', viewFigure );\n}\n\n/**\n * Shows placeholder together with infinite progress bar on given image figure.\n */\nfunction _showPlaceholder( imageUtils: ImageUtils, placeholder: string, viewFigure: ViewContainerElement, writer: DowncastWriter ) {\n\tif ( !viewFigure.hasClass( 'ck-image-upload-placeholder' ) ) {\n\t\twriter.addClass( 'ck-image-upload-placeholder', viewFigure );\n\t}\n\n\tconst viewImg = imageUtils.findViewImgElement( viewFigure )!;\n\n\tif ( viewImg.getAttribute( 'src' ) !== placeholder ) {\n\t\twriter.setAttribute( 'src', placeholder, viewImg );\n\t}\n\n\tif ( !_getUIElement( viewFigure, 'placeholder' ) ) {\n\t\twriter.insert( writer.createPositionAfter( viewImg ), _createPlaceholder( writer ) );\n\t}\n}\n\n/**\n * Removes placeholder together with infinite progress bar on given image figure.\n */\nfunction _hidePlaceholder( viewFigure: ViewContainerElement, writer: DowncastWriter ) {\n\tif ( viewFigure.hasClass( 'ck-image-upload-placeholder' ) ) {\n\t\twriter.removeClass( 'ck-image-upload-placeholder', viewFigure );\n\t}\n\n\t_removeUIElement( viewFigure, writer, 'placeholder' );\n}\n\n/**\n * Shows progress bar displaying upload progress.\n * Attaches it to the file loader to update when upload percentace is changed.\n */\nfunction _showProgressBar( viewFigure: ViewContainerElement, writer: DowncastWriter, loader: FileLoader, view: EditingView ) {\n\tconst progressBar = _createProgressBar( writer );\n\twriter.insert( writer.createPositionAt( viewFigure, 'end' ), progressBar );\n\n\t// Update progress bar width when uploadedPercent is changed.\n\tloader.on( 'change:uploadedPercent', ( evt, name, value ) => {\n\t\tview.change( writer => {\n\t\t\twriter.setStyle( 'width', value + '%', progressBar );\n\t\t} );\n\t} );\n}\n\n/**\n * Hides upload progress bar.\n */\nfunction _hideProgressBar( viewFigure: ViewContainerElement, writer: DowncastWriter ) {\n\t_removeUIElement( viewFigure, writer, 'progressBar' );\n}\n\n/**\n * Shows complete icon and hides after a certain amount of time.\n */\nfunction _showCompleteIcon( viewFigure: ViewContainerElement, writer: DowncastWriter, view: EditingView ) {\n\tconst completeIcon = writer.createUIElement( 'div', { class: 'ck-image-upload-complete-icon' } );\n\n\twriter.insert( writer.createPositionAt( viewFigure, 'end' ), completeIcon );\n\n\tsetTimeout( () => {\n\t\tview.change( writer => writer.remove( writer.createRangeOn( completeIcon ) ) );\n\t}, 3000 );\n}\n\n/**\n * Create progress bar element using {@link module:engine/view/uielement~UIElement}.\n */\nfunction _createProgressBar( writer: DowncastWriter ): ViewUIElement {\n\tconst progressBar = writer.createUIElement( 'div', { class: 'ck-progress-bar' } );\n\n\twriter.setCustomProperty( 'progressBar', true, progressBar );\n\n\treturn progressBar;\n}\n\n/**\n * Create placeholder element using {@link module:engine/view/uielement~UIElement}.\n */\nfunction _createPlaceholder( writer: DowncastWriter ): ViewUIElement {\n\tconst placeholder = writer.createUIElement( 'div', { class: 'ck-upload-placeholder-loader' } );\n\n\twriter.setCustomProperty( 'placeholder', true, placeholder );\n\n\treturn placeholder;\n}\n\n/**\n * Returns {@link module:engine/view/uielement~UIElement} of given unique property from image figure element.\n * Returns `undefined` if element is not found.\n */\nfunction _getUIElement( imageFigure: ViewElement, uniqueProperty: string ): ViewUIElement | undefined {\n\tfor ( const child of imageFigure.getChildren() ) {\n\t\tif ( ( child as ViewElement ).getCustomProperty( uniqueProperty ) ) {\n\t\t\treturn child as ViewUIElement;\n\t\t}\n\t}\n}\n\n/**\n * Removes {@link module:engine/view/uielement~UIElement} of given unique property from image figure element.\n */\nfunction _removeUIElement( viewFigure: ViewContainerElement, writer: DowncastWriter, uniqueProperty: string ) {\n\tconst element = _getUIElement( viewFigure, uniqueProperty );\n\n\tif ( element ) {\n\t\twriter.remove( writer.createRangeOn( element ) );\n\t}\n}\n\n/**\n * Displays local data from file loader.\n */\nfunction _displayLocalImage( imageUtils: ImageUtils, viewFigure: ViewElement, writer: DowncastWriter, loader: FileLoader ) {\n\tif ( loader.data ) {\n\t\tconst viewImg = imageUtils.findViewImgElement( viewFigure )!;\n\n\t\twriter.setAttribute( 'src', loader.data, viewImg );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\nimport { FileRepository } from 'ckeditor5/src/upload.js';\nimport { Command, type Editor } from 'ckeditor5/src/core.js';\nimport { toArray, type ArrayOrItem } from 'ckeditor5/src/utils.js';\nimport type { Position } from 'ckeditor5/src/engine.js';\n\nimport type ImageUtils from '../imageutils.js';\n\n/**\n * @module image/imageupload/uploadimagecommand\n */\n\n/**\n * The upload image command.\n *\n * The command is registered by the {@link module:image/imageupload/imageuploadediting~ImageUploadEditing} plugin as `uploadImage`\n * and it is also available via aliased `imageUpload` name.\n *\n * In order to upload an image at the current selection position\n * (according to the {@link module:widget/utils~findOptimalInsertionRange} algorithm),\n * execute the command and pass the native image file instance:\n *\n * ```ts\n * this.listenTo( editor.editing.view.document, 'clipboardInput', ( evt, data ) => {\n * \t// Assuming that only images were pasted:\n * \tconst images = Array.from( data.dataTransfer.files );\n *\n * \t// Upload the first image:\n * \teditor.execute( 'uploadImage', { file: images[ 0 ] } );\n * } );\n * ```\n *\n * It is also possible to insert multiple images at once:\n *\n * ```ts\n * editor.execute( 'uploadImage', {\n * \tfile: [\n * \t\tfile1,\n * \t\tfile2\n * \t]\n * } );\n * ```\n */\nexport default class UploadImageCommand extends Command {\n\t/**\n\t * The command property: `false` if there is no permission on image upload, otherwise `true`.\n\t *\n\t * @observable\n\t * @internal\n\t */\n\tdeclare public isAccessAllowed: boolean;\n\n\t/**\n\t * Creates an instance of the `imageUlpoad` command. When executed, the command upload one of\n\t * the currently selected image from computer.\n\t *\n\t * @param editor The editor instance.\n\t */\n\tconstructor( editor: Editor ) {\n\t\tsuper( editor );\n\n\t\tthis.set( 'isAccessAllowed', true );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override refresh(): void {\n\t\tconst editor = this.editor;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst selectedElement = editor.model.document.selection.getSelectedElement()!;\n\n\t\t// TODO: This needs refactoring.\n\t\tthis.isEnabled = imageUtils.isImageAllowed() || imageUtils.isImage( selectedElement );\n\t}\n\n\t/**\n\t * Executes the command.\n\t *\n\t * @fires execute\n\t * @param options Options for the executed command.\n\t * @param options.file The image file or an array of image files to upload.\n\t */\n\tpublic override execute( options: { file: ArrayOrItem<File> } ): void {\n\t\tconst files = toArray( options.file );\n\t\tconst selection = this.editor.model.document.selection;\n\t\tconst imageUtils: ImageUtils = this.editor.plugins.get( 'ImageUtils' );\n\n\t\t// In case of multiple files, each file (starting from the 2nd) will be inserted at a position that\n\t\t// follows the previous one. That will move the selection and, to stay on the safe side and make sure\n\t\t// all images inherit the same selection attributes, they are collected beforehand.\n\t\t//\n\t\t// Applying these attributes ensures, for instance, that inserting an (inline) image into a link does\n\t\t// not split that link but preserves its continuity.\n\t\t//\n\t\t// Note: Selection attributes that do not make sense for images will be filtered out by insertImage() anyway.\n\t\tconst selectionAttributes = Object.fromEntries( selection.getAttributes() );\n\n\t\tfiles.forEach( ( file, index ) => {\n\t\t\tconst selectedElement = selection.getSelectedElement();\n\n\t\t\t// Inserting of an inline image replace the selected element and make a selection on the inserted image.\n\t\t\t// Therefore inserting multiple inline images requires creating position after each element.\n\t\t\tif ( index && selectedElement && imageUtils.isImage( selectedElement ) ) {\n\t\t\t\tconst position = this.editor.model.createPositionAfter( selectedElement );\n\n\t\t\t\tthis._uploadImage( file, selectionAttributes, position );\n\t\t\t} else {\n\t\t\t\tthis._uploadImage( file, selectionAttributes );\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Handles uploading single file.\n\t */\n\tprivate _uploadImage( file: File, attributes: object, position?: Position ): void {\n\t\tconst editor = this.editor;\n\t\tconst fileRepository = editor.plugins.get( FileRepository );\n\t\tconst loader = fileRepository.createLoader( file );\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\t// Do not throw when upload adapter is not set. FileRepository will log an error anyway.\n\t\tif ( !loader ) {\n\t\t\treturn;\n\t\t}\n\n\t\timageUtils.insertImage( { ...attributes, uploadId: loader.id }, position );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageupload/imageuploadediting\n */\n\nimport { Plugin, type Editor } from 'ckeditor5/src/core.js';\n\nimport {\n\tUpcastWriter,\n\ttype Element,\n\ttype Item,\n\ttype Writer,\n\ttype DataTransfer,\n\ttype ViewElement,\n\ttype NodeAttributes,\n\ttype DowncastAttributeEvent,\n\ttype UpcastElementEvent\n} from 'ckeditor5/src/engine.js';\n\nimport { Notification } from 'ckeditor5/src/ui.js';\nimport { ClipboardPipeline, type ViewDocumentClipboardInputEvent } from 'ckeditor5/src/clipboard.js';\nimport { FileRepository, type UploadResponse, type FileLoader } from 'ckeditor5/src/upload.js';\nimport { env } from 'ckeditor5/src/utils.js';\n\nimport ImageUtils from '../imageutils.js';\nimport UploadImageCommand from './uploadimagecommand.js';\nimport { fetchLocalImage, isLocalImage } from '../../src/imageupload/utils.js';\nimport { createImageTypeRegExp } from './utils.js';\n\n/**\n * The editing part of the image upload feature. It registers the `'uploadImage'` command\n * and the `imageUpload` command as an aliased name.\n *\n * When an image is uploaded, it fires the {@link ~ImageUploadEditing#event:uploadComplete `uploadComplete`} event\n * that allows adding custom attributes to the {@link module:engine/model/element~Element image element}.\n */\nexport default class ImageUploadEditing extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ FileRepository, Notification, ClipboardPipeline, ImageUtils ] as const;\n\t}\n\n\tpublic static get pluginName() {\n\t\treturn 'ImageUploadEditing' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * An internal mapping of {@link module:upload/filerepository~FileLoader#id file loader UIDs} and\n\t * model elements during the upload.\n\t *\n\t * Model element of the uploaded image can change, for instance, when {@link module:image/image/imagetypecommand~ImageTypeCommand}\n\t * is executed as a result of adding caption or changing image style. As a result, the upload logic must keep track of the model\n\t * element (reference) and resolve the upload for the correct model element (instead of the one that landed in the `$graveyard`\n\t * after image type changed).\n\t */\n\tprivate readonly _uploadImageElements: Map<string, Set<Element>>;\n\n\t/**\n\t * An internal mapping of {@link module:upload/filerepository~FileLoader#id file loader UIDs} and\n\t * upload responses for handling images dragged during their upload process. When such images are later\n\t * dropped, their original upload IDs no longer exist in the registry (as the original upload completed).\n\t * This map preserves the upload responses to properly handle such cases.\n\t */\n\tprivate readonly _uploadedImages = new Map<string, UploadResponse>();\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( editor: Editor ) {\n\t\tsuper( editor );\n\n\t\teditor.config.define( 'image', {\n\t\t\tupload: {\n\t\t\t\ttypes: [ 'jpeg', 'png', 'gif', 'bmp', 'webp', 'tiff' ]\n\t\t\t}\n\t\t} );\n\n\t\tthis._uploadImageElements = new Map();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst editor = this.editor;\n\t\tconst doc = editor.model.document;\n\t\tconst conversion = editor.conversion;\n\t\tconst fileRepository = editor.plugins.get( FileRepository );\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst clipboardPipeline: ClipboardPipeline = editor.plugins.get( 'ClipboardPipeline' );\n\t\tconst imageTypes = createImageTypeRegExp( editor.config.get( 'image.upload.types' )! );\n\t\tconst uploadImageCommand = new UploadImageCommand( editor );\n\n\t\t// Register `uploadImage` command and add `imageUpload` command as an alias for backward compatibility.\n\t\teditor.commands.add( 'uploadImage', uploadImageCommand );\n\t\teditor.commands.add( 'imageUpload', uploadImageCommand );\n\n\t\t// Register upcast converter for uploadId.\n\t\tconversion.for( 'upcast' )\n\t\t\t.attributeToAttribute( {\n\t\t\t\tview: {\n\t\t\t\t\tname: 'img',\n\t\t\t\t\tkey: 'uploadId'\n\t\t\t\t},\n\t\t\t\tmodel: 'uploadId'\n\t\t\t} )\n\n\t\t\t// Handle the case when the image is not fully uploaded yet but it's being moved.\n\t\t\t// See more: https://github.com/ckeditor/ckeditor5/pull/17327\n\t\t\t.add( dispatcher => dispatcher.on<UpcastElementEvent>( 'element:img', ( evt, data, conversionApi ) => {\n\t\t\t\tif ( !conversionApi.consumable.test( data.viewItem, { attributes: [ 'data-ck-upload-id' ] } ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst uploadId = data.viewItem.getAttribute( 'data-ck-upload-id' );\n\n\t\t\t\tif ( !uploadId ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst [ modelElement ] = Array.from( data.modelRange!.getItems( { shallow: true } ) );\n\t\t\t\tconst loader = fileRepository.loaders.get( uploadId as string );\n\n\t\t\t\tif ( modelElement ) {\n\t\t\t\t\t// Handle case when `uploadId` is set on the image element but the loader is not present in the registry.\n\t\t\t\t\t// It may happen when the image was successfully uploaded and the loader was removed from the registry.\n\t\t\t\t\t// It's still present in the `_uploadedImages` map though. It's why we do not place this line in the condition below.\n\t\t\t\t\tconversionApi.writer.setAttribute( 'uploadId', uploadId, modelElement );\n\t\t\t\t\tconversionApi.consumable.consume( data.viewItem, { attributes: [ 'data-ck-upload-id' ] } );\n\n\t\t\t\t\tif ( loader && loader.data ) {\n\t\t\t\t\t\tconversionApi.writer.setAttribute( 'uploadStatus', loader.status, modelElement );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, { priority: 'low' } ) );\n\n\t\t// Handle pasted images.\n\t\t// For every image file, a new file loader is created and a placeholder image is\n\t\t// inserted into the content. Then, those images are uploaded once they appear in the model\n\t\t// (see Document#change listener below).\n\t\tthis.listenTo<ViewDocumentClipboardInputEvent>( editor.editing.view.document, 'clipboardInput', ( evt, data ) => {\n\t\t\t// Skip if non empty HTML data is included.\n\t\t\t// https://github.com/ckeditor/ckeditor5-upload/issues/68\n\t\t\tif ( isHtmlIncluded( data.dataTransfer ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst images = Array.from( data.dataTransfer.files ).filter( file => {\n\t\t\t\t// See https://github.com/ckeditor/ckeditor5-image/pull/254.\n\t\t\t\tif ( !file ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn imageTypes.test( file.type );\n\t\t\t} );\n\n\t\t\tif ( !images.length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevt.stop();\n\n\t\t\teditor.model.change( writer => {\n\t\t\t\t// Set selection to paste target.\n\t\t\t\tif ( data.targetRanges ) {\n\t\t\t\t\twriter.setSelection( data.targetRanges.map( viewRange => editor.editing.mapper.toModelRange( viewRange ) ) );\n\t\t\t\t}\n\n\t\t\t\teditor.execute( 'uploadImage', { file: images } );\n\t\t\t} );\n\n\t\t\tconst uploadImageCommand = editor.commands.get( 'uploadImage' )!;\n\n\t\t\tif ( !uploadImageCommand.isAccessAllowed ) {\n\t\t\t\tconst notification: Notification = editor.plugins.get( 'Notification' );\n\t\t\t\tconst t = editor.locale.t;\n\n\t\t\t\t// eslint-disable-next-line max-len\n\t\t\t\tnotification.showWarning( t( 'You have no image upload permissions.' ), {\n\t\t\t\t\tnamespace: 'image'\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\n\t\t// Handle HTML pasted with images with base64 or blob sources.\n\t\t// For every image file, a new file loader is created and a placeholder image is\n\t\t// inserted into the content. Then, those images are uploaded once they appear in the model\n\t\t// (see Document#change listener below).\n\t\tthis.listenTo( clipboardPipeline, 'inputTransformation', ( evt, data ) => {\n\t\t\tconst fetchableImages = Array.from( editor.editing.view.createRangeIn( data.content ) )\n\t\t\t\t.map( value => value.item as ViewElement )\n\t\t\t\t.filter( viewElement =>\n\t\t\t\t\tisLocalImage( imageUtils, viewElement ) &&\n\t\t\t\t\t!viewElement.getAttribute( 'uploadProcessed' ) )\n\t\t\t\t.map( viewElement => { return { promise: fetchLocalImage( viewElement ), imageElement: viewElement }; } );\n\n\t\t\tif ( !fetchableImages.length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst writer = new UpcastWriter( editor.editing.view.document );\n\n\t\t\tfor ( const fetchableImage of fetchableImages ) {\n\t\t\t\t// Set attribute marking that the image was processed already.\n\t\t\t\twriter.setAttribute( 'uploadProcessed', true, fetchableImage.imageElement );\n\n\t\t\t\tconst loader = fileRepository.createLoader( fetchableImage.promise );\n\n\t\t\t\tif ( loader ) {\n\t\t\t\t\twriter.setAttribute( 'src', '', fetchableImage.imageElement );\n\t\t\t\t\twriter.setAttribute( 'uploadId', loader.id, fetchableImage.imageElement );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\n\t\t// Prevents from the browser redirecting to the dropped image.\n\t\teditor.editing.view.document.on( 'dragover', ( evt, data ) => {\n\t\t\tdata.preventDefault();\n\t\t} );\n\n\t\t// Upload placeholder images that appeared in the model.\n\t\tdoc.on( 'change', () => {\n\t\t\t// Note: Reversing changes to start with insertions and only then handle removals. If it was the other way around,\n\t\t\t// loaders for **all** images that land in the $graveyard would abort while in fact only those that were **not** replaced\n\t\t\t// by other images should be aborted.\n\t\t\tconst changes = doc.differ.getChanges( { includeChangesInGraveyard: true } ).reverse();\n\t\t\tconst insertedImagesIds = new Set();\n\n\t\t\tfor ( const entry of changes ) {\n\t\t\t\tif ( entry.type == 'insert' && entry.name != '$text' ) {\n\t\t\t\t\tconst item = entry.position.nodeAfter!;\n\t\t\t\t\tconst isInsertedInGraveyard = entry.position.root.rootName == '$graveyard';\n\n\t\t\t\t\tfor ( const imageElement of getImagesFromChangeItem( editor, item ) ) {\n\t\t\t\t\t\t// Check if the image element still has upload id.\n\t\t\t\t\t\tconst uploadId = imageElement.getAttribute( 'uploadId' ) as string;\n\n\t\t\t\t\t\tif ( !uploadId ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check if the image is loaded on this client.\n\t\t\t\t\t\tconst loader = fileRepository.loaders.get( uploadId );\n\n\t\t\t\t\t\tif ( !loader ) {\n\t\t\t\t\t\t\t// If the loader does not exist, it means that the image was already uploaded\n\t\t\t\t\t\t\t// and the loader promise was removed from the registry. In that scenario we need\n\t\t\t\t\t\t\t// to restore response object from the internal map.\n\t\t\t\t\t\t\tif ( !isInsertedInGraveyard && this._uploadedImages.has( uploadId ) ) {\n\t\t\t\t\t\t\t\t// Fire `uploadComplete` to set proper attributes on the image element.\n\t\t\t\t\t\t\t\teditor.model.enqueueChange( { isUndoable: false }, writer => {\n\t\t\t\t\t\t\t\t\twriter.setAttribute( 'uploadStatus', 'complete', imageElement );\n\n\t\t\t\t\t\t\t\t\tthis.fire<ImageUploadCompleteEvent>( 'uploadComplete', {\n\t\t\t\t\t\t\t\t\t\tdata: this._uploadedImages.get( uploadId )!,\n\t\t\t\t\t\t\t\t\t\timageElement: imageElement as Element\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\t// While it makes sense to remove the image from the `_uploadedImages` map here,\n\t\t\t\t\t\t\t\t// it's counterintuitive for the user that pastes image in uploading several times.\n\t\t\t\t\t\t\t\t// It'll work the first time, but the next time the image will be empty because the\n\t\t\t\t\t\t\t\t// `_uploadedImages` no longer contain the response.\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( isInsertedInGraveyard ) {\n\t\t\t\t\t\t\t// If the image was inserted to the graveyard for good (**not** replaced by another image),\n\t\t\t\t\t\t\t// only then abort the loading process.\n\t\t\t\t\t\t\tif ( !insertedImagesIds.has( uploadId ) ) {\n\t\t\t\t\t\t\t\t// ... but abort it only if all remain images that share the same loader are in the graveyard too.\n\t\t\t\t\t\t\t\t// This is to prevent situation when we have two images in uploading state and one of them is being\n\t\t\t\t\t\t\t\t// placed in the graveyard (e.g. using undo). The other one should not be aborted.\n\t\t\t\t\t\t\t\tconst allImagesThatShareUploaderInGraveyard = Array\n\t\t\t\t\t\t\t\t\t.from( this._uploadImageElements.get( uploadId )! )\n\t\t\t\t\t\t\t\t\t.every( element => element.root.rootName == '$graveyard' );\n\n\t\t\t\t\t\t\t\tif ( allImagesThatShareUploaderInGraveyard ) {\n\t\t\t\t\t\t\t\t\tloader.abort();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Remember the upload id of the inserted image. If it acted as a replacement for another\n\t\t\t\t\t\t\t// image (which landed in the $graveyard), the related loader will not be aborted because\n\t\t\t\t\t\t\t// this is still the same image upload.\n\t\t\t\t\t\t\tinsertedImagesIds.add( uploadId );\n\n\t\t\t\t\t\t\t// Keep the mapping between the upload ID and the image model element so the upload\n\t\t\t\t\t\t\t// can later resolve in the context of the correct model element. The model element could\n\t\t\t\t\t\t\t// change for the same upload if one image was replaced by another (e.g. image type was changed),\n\t\t\t\t\t\t\t// so this may also replace an existing mapping.\n\t\t\t\t\t\t\tif ( !this._uploadImageElements.has( uploadId ) ) {\n\t\t\t\t\t\t\t\tthis._uploadImageElements.set( uploadId, new Set( [ imageElement as Element ] ) );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis._uploadImageElements.get( uploadId )!.add( imageElement as Element );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( loader.status == 'idle' ) {\n\t\t\t\t\t\t\t\t// If the image was inserted into content and has not been loaded yet, start loading it.\n\t\t\t\t\t\t\t\tthis._readAndUpload( loader );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\n\t\t// Set the default handler for feeding the image element with `src` and `srcset` attributes.\n\t\t// Also set the natural `width` and `height` attributes (if not already set).\n\t\tthis.on<ImageUploadCompleteEvent>( 'uploadComplete', ( evt, { imageElement, data } ) => {\n\t\t\tconst urls = data.urls ? data.urls as Record<string, unknown> : data;\n\n\t\t\tthis.editor.model.change( writer => {\n\t\t\t\twriter.setAttribute( 'src', urls.default, imageElement );\n\t\t\t\tthis._parseAndSetSrcsetAttributeOnImage( urls, imageElement, writer );\n\t\t\t\timageUtils.setImageNaturalSizeAttributes( imageElement );\n\t\t\t} );\n\t\t}, { priority: 'low' } );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic afterInit(): void {\n\t\tconst schema = this.editor.model.schema;\n\n\t\t// Setup schema to allow uploadId and uploadStatus for images.\n\t\t// Wait for ImageBlockEditing or ImageInlineEditing to register their elements first,\n\t\t// that's why doing this in afterInit() instead of init().\n\t\tif ( this.editor.plugins.has( 'ImageBlockEditing' ) ) {\n\t\t\tschema.extend( 'imageBlock', {\n\t\t\t\tallowAttributes: [ 'uploadId', 'uploadStatus' ]\n\t\t\t} );\n\n\t\t\tthis._registerConverters( 'imageBlock' );\n\t\t}\n\n\t\tif ( this.editor.plugins.has( 'ImageInlineEditing' ) ) {\n\t\t\tschema.extend( 'imageInline', {\n\t\t\t\tallowAttributes: [ 'uploadId', 'uploadStatus' ]\n\t\t\t} );\n\n\t\t\tthis._registerConverters( 'imageInline' );\n\t\t}\n\t}\n\n\t/**\n\t * Reads and uploads an image.\n\t *\n\t * The image is read from the disk and as a Base64-encoded string it is set temporarily to\n\t * `image[src]`. When the image is successfully uploaded, the temporary data is replaced with the target\n\t * image's URL (the URL to the uploaded image on the server).\n\t */\n\tprotected _readAndUpload( loader: FileLoader ): Promise<void> {\n\t\tconst editor = this.editor;\n\t\tconst model = editor.model;\n\t\tconst t = editor.locale.t;\n\t\tconst fileRepository = editor.plugins.get( FileRepository );\n\t\tconst notification = editor.plugins.get( Notification );\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst imageUploadElements = this._uploadImageElements;\n\n\t\tmodel.enqueueChange( { isUndoable: false }, writer => {\n\t\t\tconst elements = imageUploadElements.get( loader.id )!;\n\n\t\t\tfor ( const element of elements ) {\n\t\t\t\twriter.setAttribute( 'uploadStatus', 'reading', element );\n\t\t\t}\n\t\t} );\n\n\t\treturn loader.read()\n\t\t\t.then( () => {\n\t\t\t\tconst promise = loader.upload();\n\n\t\t\t\tif ( editor.ui ) {\n\t\t\t\t\teditor.ui.ariaLiveAnnouncer.announce( t( 'Uploading image' ) );\n\t\t\t\t}\n\n\t\t\t\tfor ( const imageElement of imageUploadElements.get( loader.id )! ) {\n\t\t\t\t\t// Force re–paint in Safari. Without it, the image will display with a wrong size.\n\t\t\t\t\t// https://github.com/ckeditor/ckeditor5/issues/1975\n\t\t\t\t\t/* istanbul ignore next -- @preserve */\n\t\t\t\t\tif ( env.isSafari ) {\n\t\t\t\t\t\tconst viewFigure = editor.editing.mapper.toViewElement( imageElement )!;\n\t\t\t\t\t\tconst viewImg = imageUtils.findViewImgElement( viewFigure )!;\n\n\t\t\t\t\t\teditor.editing.view.once( 'render', () => {\n\t\t\t\t\t\t\t// Early returns just to be safe. There might be some code ran\n\t\t\t\t\t\t\t// in between the outer scope and this callback.\n\t\t\t\t\t\t\tif ( !viewImg.parent ) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst domFigure = editor.editing.view.domConverter.mapViewToDom( viewImg.parent ) as HTMLElement | undefined;\n\n\t\t\t\t\t\t\tif ( !domFigure ) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst originalDisplay = domFigure.style.display;\n\n\t\t\t\t\t\t\tdomFigure.style.display = 'none';\n\n\t\t\t\t\t\t\t// Make sure this line will never be removed during minification for having \"no effect\".\n\t\t\t\t\t\t\t( domFigure as any )._ckHack = domFigure.offsetHeight;\n\n\t\t\t\t\t\t\tdomFigure.style.display = originalDisplay;\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t\tmodel.enqueueChange( { isUndoable: false }, writer => {\n\t\t\t\t\t\twriter.setAttribute( 'uploadStatus', 'uploading', imageElement );\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\treturn promise;\n\t\t\t} )\n\t\t\t.then( data => {\n\t\t\t\tmodel.enqueueChange( { isUndoable: false }, writer => {\n\t\t\t\t\tfor ( const imageElement of imageUploadElements.get( loader.id )! ) {\n\t\t\t\t\t\twriter.setAttribute( 'uploadStatus', 'complete', imageElement );\n\t\t\t\t\t\tthis.fire<ImageUploadCompleteEvent>( 'uploadComplete', { data, imageElement } );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( editor.ui ) {\n\t\t\t\t\t\teditor.ui.ariaLiveAnnouncer.announce( t( 'Image upload complete' ) );\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._uploadedImages.set( loader.id, data );\n\t\t\t\t} );\n\n\t\t\t\tclean();\n\t\t\t} )\n\t\t\t.catch( error => {\n\t\t\t\tif ( editor.ui ) {\n\t\t\t\t\teditor.ui.ariaLiveAnnouncer.announce( t( 'Error during image upload' ) );\n\t\t\t\t}\n\n\t\t\t\t// If status is not 'error' nor 'aborted' - throw error because it means that something else went wrong,\n\t\t\t\t// it might be generic error and it would be real pain to find what is going on.\n\t\t\t\tif ( loader.status !== 'error' && loader.status !== 'aborted' ) {\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\n\t\t\t\t// Might be 'aborted'.\n\t\t\t\tif ( loader.status == 'error' && error ) {\n\t\t\t\t\tnotification.showWarning( error, {\n\t\t\t\t\t\ttitle: t( 'Upload failed' ),\n\t\t\t\t\t\tnamespace: 'upload'\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\t// Permanently remove image from insertion batch.\n\t\t\t\tmodel.enqueueChange( { isUndoable: false }, writer => {\n\t\t\t\t\tfor ( const imageElement of imageUploadElements.get( loader.id )! ) {\n\t\t\t\t\t\t// Handle situation when the image has been removed and then `abort` exception was thrown.\n\t\t\t\t\t\t// See: https://github.com/cksource/ckeditor5-commercial/issues/6817\n\t\t\t\t\t\tif ( imageElement.root.rootName !== '$graveyard' ) {\n\t\t\t\t\t\t\twriter.remove( imageElement );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tclean();\n\t\t\t} );\n\n\t\tfunction clean() {\n\t\t\tmodel.enqueueChange( { isUndoable: false }, writer => {\n\t\t\t\tfor ( const imageElement of imageUploadElements.get( loader.id )! ) {\n\t\t\t\t\twriter.removeAttribute( 'uploadId', imageElement );\n\t\t\t\t\twriter.removeAttribute( 'uploadStatus', imageElement );\n\t\t\t\t}\n\n\t\t\t\timageUploadElements.delete( loader.id );\n\t\t\t} );\n\n\t\t\tfileRepository.destroyLoader( loader );\n\t\t}\n\t}\n\n\t/**\n\t * Creates the `srcset` attribute based on a given file upload response and sets it as an attribute to a specific image element.\n\t *\n\t * @param data Data object from which `srcset` will be created.\n\t * @param image The image element on which the `srcset` attribute will be set.\n\t */\n\tprotected _parseAndSetSrcsetAttributeOnImage( data: Record<string, unknown>, image: Element, writer: Writer ): void {\n\t\t// Srcset attribute for responsive images support.\n\t\tlet maxWidth = 0;\n\n\t\tconst srcsetAttribute = Object.keys( data )\n\t\t\t// Filter out keys that are not integers.\n\t\t\t.filter( key => {\n\t\t\t\tconst width = parseInt( key, 10 );\n\n\t\t\t\tif ( !isNaN( width ) ) {\n\t\t\t\t\tmaxWidth = Math.max( maxWidth, width );\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t// Convert each key to srcset entry.\n\t\t\t.map( key => `${ data[ key ] } ${ key }w` )\n\n\t\t\t// Join all entries.\n\t\t\t.join( ', ' );\n\n\t\tif ( srcsetAttribute != '' ) {\n\t\t\tconst attributes: NodeAttributes = {\n\t\t\t\tsrcset: srcsetAttribute\n\t\t\t};\n\n\t\t\tif ( !image.hasAttribute( 'width' ) && !image.hasAttribute( 'height' ) ) {\n\t\t\t\tattributes.width = maxWidth;\n\t\t\t}\n\n\t\t\twriter.setAttributes( attributes, image );\n\t\t}\n\t}\n\n\t/**\n\t * Registers image upload converters.\n\t *\n\t * @param imageType The type of the image.\n\t */\n\tprivate _registerConverters( imageType: 'imageBlock' | 'imageInline' ) {\n\t\tconst { conversion, plugins } = this.editor;\n\n\t\tconst fileRepository = plugins.get( FileRepository );\n\t\tconst imageUtils = plugins.get( ImageUtils );\n\n\t\t// It sets `data-ck-upload-id` attribute on the view image elements that are not fully uploaded.\n\t\t// It avoids the situation when image disappears when it's being moved and upload is not finished yet.\n\t\t// See more: https://github.com/ckeditor/ckeditor5/issues/16967\n\t\tconversion.for( 'dataDowncast' ).add( dispatcher => {\n\t\t\tdispatcher.on<DowncastAttributeEvent>( `attribute:uploadId:${ imageType }`, ( evt, data, conversionApi ) => {\n\t\t\t\tif ( !conversionApi.consumable.test( data.item, evt.name ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst loader = fileRepository.loaders.get( data.attributeNewValue as string );\n\n\t\t\t\tif ( !loader || !loader.data ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst viewElement = conversionApi.mapper.toViewElement( data.item as Element )!;\n\t\t\t\tconst img = imageUtils.findViewImgElement( viewElement );\n\n\t\t\t\tif ( img ) {\n\t\t\t\t\tconversionApi.consumable.consume( data.item, evt.name );\n\t\t\t\t\tconversionApi.writer.setAttribute( 'data-ck-upload-id', loader.id, img );\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\t}\n}\n\n/**\n * Returns `true` if non-empty `text/html` is included in the data transfer.\n */\nexport function isHtmlIncluded( dataTransfer: DataTransfer ): boolean {\n\treturn Array.from( dataTransfer.types ).includes( 'text/html' ) && dataTransfer.getData( 'text/html' ) !== '';\n}\n\nfunction getImagesFromChangeItem( editor: Editor, item: Item ): Array<Item> {\n\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\treturn Array.from( editor.model.createRangeOn( item ) )\n\t\t.filter( value => imageUtils.isImage( value.item as Element ) )\n\t\t.map( value => value.item );\n}\n\n/**\n * An event fired when an image is uploaded. You can hook into this event to provide\n * custom attributes to the {@link module:engine/model/element~Element image element} based on the data from\n * the server.\n *\n * ```ts\n * const imageUploadEditing = editor.plugins.get( 'ImageUploadEditing' );\n *\n * imageUploadEditing.on( 'uploadComplete', ( evt, { data, imageElement } ) => {\n * \teditor.model.change( writer => {\n * \t\twriter.setAttribute( 'someAttribute', 'foo', imageElement );\n * \t} );\n * } );\n * ```\n *\n * You can also stop the default handler that sets the `src` and `srcset` attributes\n * if you want to provide custom values for these attributes.\n *\n * ```ts\n * imageUploadEditing.on( 'uploadComplete', ( evt, { data, imageElement } ) => {\n * \tevt.stop();\n * } );\n * ```\n *\n * **Note**: This event is fired by the {@link module:image/imageupload/imageuploadediting~ImageUploadEditing} plugin.\n *\n * @eventName ~ImageUploadEditing#uploadComplete\n * @param data The `uploadComplete` event data.\n */\nexport type ImageUploadCompleteEvent = {\n\tname: 'uploadComplete';\n\targs: [ data: ImageUploadCompleteData];\n};\n\nexport type ImageUploadCompleteData = {\n\n\t/**\n\t * The data coming from the upload adapter.\n\t */\n\tdata: UploadResponse;\n\n\t/**\n\t * The model {@link module:engine/model/element~Element image element} that can be customized.\n\t */\n\timageElement: Element;\n};\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageupload\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport ImageUploadUI from './imageupload/imageuploadui.js';\nimport ImageUploadProgress from './imageupload/imageuploadprogress.js';\nimport ImageUploadEditing from './imageupload/imageuploadediting.js';\n\n/**\n * The image upload plugin.\n *\n * For a detailed overview, check the {@glink features/images/image-upload/image-upload image upload feature} documentation.\n *\n * This plugin does not do anything directly, but it loads a set of specific plugins to enable image uploading:\n *\n * * {@link module:image/imageupload/imageuploadediting~ImageUploadEditing},\n * * {@link module:image/imageupload/imageuploadui~ImageUploadUI},\n * * {@link module:image/imageupload/imageuploadprogress~ImageUploadProgress}.\n */\nexport default class ImageUpload extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageUpload' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageUploadEditing, ImageUploadUI, ImageUploadProgress ] as const;\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageinsert/ui/imageinserturlview\n */\n\nimport {\n\tView,\n\tLabeledFieldView,\n\tcreateLabeledInputText,\n\tsubmitHandler,\n\ttype InputTextView\n} from 'ckeditor5/src/ui.js';\nimport { KeystrokeHandler, type Locale } from 'ckeditor5/src/utils.js';\n\n/**\n * The insert an image via URL view.\n *\n * See {@link module:image/imageinsert/imageinsertviaurlui~ImageInsertViaUrlUI}.\n */\nexport default class ImageInsertUrlView extends View {\n\t/**\n\t * The URL input field view.\n\t */\n\tpublic urlInputView: LabeledFieldView<InputTextView>;\n\n\t/**\n\t * The value of the URL input.\n\t *\n\t * @observable\n\t */\n\tdeclare public imageURLInputValue: string;\n\n\t/**\n\t * Observable property used to alter labels while some image is selected and when it is not.\n\t *\n\t * @observable\n\t */\n\tdeclare public isImageSelected: boolean;\n\n\t/**\n\t * Observable property indicating whether the form interactive elements should be enabled.\n\t *\n\t * @observable\n\t */\n\tdeclare public isEnabled: boolean;\n\n\t/**\n\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\n\t */\n\tpublic readonly keystrokes: KeystrokeHandler;\n\n\t/**\n\t * Creates a view for the dropdown panel of {@link module:image/imageinsert/imageinsertui~ImageInsertUI}.\n\t *\n\t * @param locale The localization services instance.\n\t */\n\tconstructor( locale: Locale ) {\n\t\tsuper( locale );\n\n\t\tthis.set( 'imageURLInputValue', '' );\n\t\tthis.set( 'isImageSelected', false );\n\t\tthis.set( 'isEnabled', true );\n\n\t\tthis.keystrokes = new KeystrokeHandler();\n\n\t\tthis.urlInputView = this._createUrlInputView();\n\n\t\tthis.setTemplate( {\n\t\t\ttag: 'form',\n\n\t\t\tattributes: {\n\t\t\t\tclass: [\n\t\t\t\t\t'ck',\n\t\t\t\t\t'ck-image-insert-url'\n\t\t\t\t],\n\t\t\t\ttabindex: '-1'\n\t\t\t},\n\n\t\t\tchildren: [\n\t\t\t\tthis.urlInputView,\n\t\t\t\t{\n\t\t\t\t\ttag: 'div',\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\tclass: [\n\t\t\t\t\t\t\t'ck',\n\t\t\t\t\t\t\t'ck-image-insert-url__action-row'\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override render(): void {\n\t\tsuper.render();\n\n\t\tsubmitHandler( {\n\t\t\tview: this\n\t\t} );\n\n\t\t// Start listening for the keystrokes coming from #element.\n\t\tthis.keystrokes.listenTo( this.element! );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override destroy(): void {\n\t\tsuper.destroy();\n\n\t\tthis.keystrokes.destroy();\n\t}\n\n\t/**\n\t * Creates the {@link #urlInputView}.\n\t */\n\tprivate _createUrlInputView() {\n\t\tconst locale = this.locale!;\n\t\tconst t = locale.t;\n\t\tconst urlInputView = new LabeledFieldView( locale, createLabeledInputText );\n\n\t\turlInputView.bind( 'label' ).to( this, 'isImageSelected',\n\t\t\tvalue => value ? t( 'Update image URL' ) : t( 'Insert image via URL' )\n\t\t);\n\n\t\turlInputView.bind( 'isEnabled' ).to( this );\n\n\t\turlInputView.fieldView.inputMode = 'url';\n\t\turlInputView.fieldView.placeholder = 'https://example.com/image.png';\n\n\t\turlInputView.fieldView.bind( 'value' ).to( this, 'imageURLInputValue', ( value: string ) => value || '' );\n\t\turlInputView.fieldView.on( 'input', () => {\n\t\t\tthis.imageURLInputValue = urlInputView.fieldView.element!.value.trim();\n\t\t} );\n\n\t\treturn urlInputView;\n\t}\n\n\t/**\n\t * Focuses the view.\n\t */\n\tpublic focus(): void {\n\t\tthis.urlInputView.focus();\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageinsert/imageinsertviaurlui\n */\n\nimport { icons, Plugin } from 'ckeditor5/src/core.js';\nimport { ButtonView, Dialog, MenuBarMenuListItemButtonView } from 'ckeditor5/src/ui.js';\n\nimport ImageInsertUI from './imageinsertui.js';\nimport ImageInsertUrlView from './ui/imageinserturlview.js';\n\n/**\n * The image insert via URL plugin (UI part).\n *\n * The plugin introduces two UI components to the {@link module:ui/componentfactory~ComponentFactory UI component factory}:\n *\n * * the `'insertImageViaUrl'` toolbar button,\n * * the `'menuBar:insertImageViaUrl'` menu bar component.\n *\n * It also integrates with the `insertImage` toolbar component and `menuBar:insertImage` menu component, which are default components\n * through which inserting image via URL is available.\n */\nexport default class ImageInsertViaUrlUI extends Plugin {\n\tprivate _imageInsertUI!: ImageInsertUI;\n\tprivate _formView?: ImageInsertUrlView;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageInsertViaUrlUI' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageInsertUI, Dialog ] as const;\n\t}\n\n\tpublic init(): void {\n\t\tthis.editor.ui.componentFactory.add( 'insertImageViaUrl', () => this._createToolbarButton() );\n\t\tthis.editor.ui.componentFactory.add( 'menuBar:insertImageViaUrl', () => this._createMenuBarButton( 'standalone' ) );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic afterInit(): void {\n\t\tthis._imageInsertUI = this.editor.plugins.get( 'ImageInsertUI' );\n\n\t\tthis._imageInsertUI.registerIntegration( {\n\t\t\tname: 'url',\n\t\t\tobservable: () => this.editor.commands.get( 'insertImage' )!,\n\t\t\tbuttonViewCreator: () => this._createToolbarButton(),\n\t\t\tformViewCreator: () => this._createDropdownButton(),\n\t\t\tmenuBarButtonViewCreator: isOnly => this._createMenuBarButton( isOnly ? 'insertOnly' : 'insertNested' )\n\t\t} );\n\t}\n\n\t/**\n\t * Creates the base for various kinds of the button component provided by this feature.\n\t */\n\tprivate _createInsertUrlButton<T extends typeof ButtonView | typeof MenuBarMenuListItemButtonView>(\n\t\tButtonClass: T\n\t): InstanceType<T> {\n\t\tconst button = new ButtonClass( this.editor.locale ) as InstanceType<T>;\n\n\t\tbutton.icon = icons.imageUrl;\n\t\tbutton.on( 'execute', () => {\n\t\t\tthis._showModal();\n\t\t} );\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Creates a simple toolbar button, with an icon and a tooltip.\n\t */\n\tprivate _createToolbarButton(): ButtonView {\n\t\tconst t = this.editor.locale.t;\n\t\tconst button = this._createInsertUrlButton( ButtonView );\n\n\t\tbutton.tooltip = true;\n\t\tbutton.bind( 'label' ).to(\n\t\t\tthis._imageInsertUI,\n\t\t\t'isImageSelected',\n\t\t\tisImageSelected => isImageSelected ? t( 'Update image URL' ) : t( 'Insert image via URL' )\n\t\t);\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Creates a button for the dropdown view, with an icon, text and no tooltip.\n\t */\n\tprivate _createDropdownButton(): ButtonView {\n\t\tconst t = this.editor.locale.t;\n\t\tconst button = this._createInsertUrlButton( ButtonView );\n\n\t\tbutton.withText = true;\n\t\tbutton.bind( 'label' ).to(\n\t\t\tthis._imageInsertUI,\n\t\t\t'isImageSelected',\n\t\t\tisImageSelected => isImageSelected ? t( 'Update image URL' ) : t( 'Insert via URL' )\n\t\t);\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Creates a button for the menu bar.\n\t */\n\tprivate _createMenuBarButton( type: 'standalone' | 'insertOnly' | 'insertNested' ): MenuBarMenuListItemButtonView {\n\t\tconst t = this.editor.locale.t;\n\t\tconst button = this._createInsertUrlButton( MenuBarMenuListItemButtonView );\n\n\t\tbutton.withText = true;\n\n\t\tswitch ( type ) {\n\t\t\tcase 'standalone':\n\t\t\t\tbutton.label = t( 'Image via URL' );\n\t\t\t\tbreak;\n\t\t\tcase 'insertOnly':\n\t\t\t\tbutton.label = t( 'Image' );\n\t\t\t\tbreak;\n\t\t\tcase 'insertNested':\n\t\t\t\tbutton.label = t( 'Via URL' );\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Creates the form view used to submit the image URL.\n\t */\n\tprivate _createInsertUrlView(): ImageInsertUrlView {\n\t\tconst editor = this.editor;\n\t\tconst locale = editor.locale;\n\n\t\tconst replaceImageSourceCommand = editor.commands.get( 'replaceImageSource' )!;\n\t\tconst insertImageCommand = editor.commands.get( 'insertImage' )!;\n\n\t\tconst imageInsertUrlView = new ImageInsertUrlView( locale );\n\n\t\timageInsertUrlView.bind( 'isImageSelected' ).to( this._imageInsertUI );\n\t\timageInsertUrlView.bind( 'isEnabled' ).toMany( [ insertImageCommand, replaceImageSourceCommand ], 'isEnabled', ( ...isEnabled ) => (\n\t\t\tisEnabled.some( isCommandEnabled => isCommandEnabled )\n\t\t) );\n\n\t\treturn imageInsertUrlView;\n\t}\n\n\t/**\n\t * Shows the insert image via URL form view in a modal.\n\t */\n\tprivate _showModal() {\n\t\tconst editor = this.editor;\n\t\tconst locale = editor.locale;\n\t\tconst t = locale.t;\n\t\tconst dialog = editor.plugins.get( 'Dialog' );\n\n\t\tif ( !this._formView ) {\n\t\t\tthis._formView = this._createInsertUrlView();\n\t\t\tthis._formView.on( 'submit', () => this._handleSave() );\n\t\t}\n\n\t\tconst replaceImageSourceCommand = editor.commands.get( 'replaceImageSource' )!;\n\t\tthis._formView.imageURLInputValue = replaceImageSourceCommand.value || '';\n\n\t\tdialog.show( {\n\t\t\tid: 'insertImageViaUrl',\n\t\t\ttitle: this._imageInsertUI.isImageSelected ?\n\t\t\t\tt( 'Update image URL' ) :\n\t\t\t\tt( 'Insert image via URL' ),\n\t\t\tisModal: true,\n\t\t\tcontent: this._formView,\n\t\t\tactionButtons: [\n\t\t\t\t{\n\t\t\t\t\tlabel: t( 'Cancel' ),\n\t\t\t\t\twithText: true,\n\t\t\t\t\tonExecute: () => dialog.hide()\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: t( 'Accept' ),\n\t\t\t\t\tclass: 'ck-button-action',\n\t\t\t\t\twithText: true,\n\t\t\t\t\tonExecute: () => this._handleSave()\n\t\t\t\t}\n\t\t\t]\n\t\t} );\n\t}\n\n\t/**\n\t * Executes appropriate command depending on selection and form value.\n\t */\n\tprivate _handleSave() {\n\t\tconst replaceImageSourceCommand = this.editor.commands.get( 'replaceImageSource' )!;\n\n\t\t// If an image element is currently selected, we want to replace its source attribute (instead of inserting a new image).\n\t\t// We detect if an image is selected by checking `replaceImageSource` command state.\n\t\tif ( replaceImageSourceCommand.isEnabled ) {\n\t\t\tthis.editor.execute( 'replaceImageSource', { source: this._formView!.imageURLInputValue } );\n\t\t} else {\n\t\t\tthis.editor.execute( 'insertImage', { source: this._formView!.imageURLInputValue } );\n\t\t}\n\n\t\tthis.editor.plugins.get( 'Dialog' ).hide();\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageinsertviaurl\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport ImageInsertUI from './imageinsert/imageinsertui.js';\nimport ImageInsertViaUrlUI from './imageinsert/imageinsertviaurlui.js';\n\n/**\n * The image insert via URL plugin.\n *\n * For a detailed overview, check the {@glink features/images/images-inserting\n * Insert images via source URL} documentation.\n *\n * This plugin does not do anything directly, but it loads a set of specific plugins\n * to enable image inserting via implemented integrations:\n *\n * * {@link module:image/imageinsert/imageinsertui~ImageInsertUI},\n */\nexport default class ImageInsertViaUrl extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageInsertViaUrl' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageInsertViaUrlUI, ImageInsertUI ] as const;\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageinsert\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport ImageUpload from './imageupload.js';\nimport ImageInsertViaUrl from './imageinsertviaurl.js';\nimport ImageInsertUI from './imageinsert/imageinsertui.js';\n\n/**\n * The image insert plugin.\n *\n * For a detailed overview, check the {@glink features/images/image-upload/image-upload Image upload feature}\n * and {@glink features/images/images-inserting Insert images via source URL} documentation.\n *\n * This plugin does not do anything directly, but it loads a set of specific plugins\n * to enable image uploading or inserting via implemented integrations:\n *\n * * {@link module:image/imageupload~ImageUpload}\n * * {@link module:image/imageinsert/imageinsertui~ImageInsertUI}\n */\nexport default class ImageInsert extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageInsert' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageUpload, ImageInsertViaUrl, ImageInsertUI ] as const;\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageresize/resizeimagecommand\n */\n\nimport { Command } from 'ckeditor5/src/core.js';\nimport type ImageUtils from '../imageutils.js';\n\n/**\n * The resize image command. Currently, it only supports the width attribute.\n */\nexport default class ResizeImageCommand extends Command {\n\t/**\n\t * Desired image width and height.\n\t */\n\tdeclare public value: null | {\n\t\twidth: string | null;\n\t\theight: string | null;\n\t};\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override refresh(): void {\n\t\tconst editor = this.editor;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst element = imageUtils.getClosestSelectedImageElement( editor.model.document.selection );\n\n\t\tthis.isEnabled = !!element;\n\n\t\tif ( !element || !element.hasAttribute( 'resizedWidth' ) ) {\n\t\t\tthis.value = null;\n\t\t} else {\n\t\t\tthis.value = {\n\t\t\t\twidth: element.getAttribute( 'resizedWidth' ) as string,\n\t\t\t\theight: null\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Executes the command.\n\t *\n\t * ```ts\n\t * // Sets the width to 50%:\n\t * editor.execute( 'resizeImage', { width: '50%' } );\n\t *\n\t * // Removes the width attribute:\n\t * editor.execute( 'resizeImage', { width: null } );\n\t * ```\n\t *\n\t * @param options\n\t * @param options.width The new width of the image.\n\t * @fires execute\n\t */\n\tpublic override execute( options: { width: string | null } ): void {\n\t\tconst editor = this.editor;\n\t\tconst model = editor.model;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst imageElement = imageUtils.getClosestSelectedImageElement( model.document.selection );\n\n\t\tthis.value = {\n\t\t\twidth: options.width,\n\t\t\theight: null\n\t\t};\n\n\t\tif ( imageElement ) {\n\t\t\tmodel.change( writer => {\n\t\t\t\twriter.setAttribute( 'resizedWidth', options.width, imageElement );\n\t\t\t\twriter.removeAttribute( 'resizedHeight', imageElement );\n\t\t\t\timageUtils.setImageNaturalSizeAttributes( imageElement );\n\t\t\t} );\n\t\t}\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageresize/imageresizeediting\n */\n\nimport type { ViewElement } from 'ckeditor5/src/engine.js';\nimport { type Editor, Plugin } from 'ckeditor5/src/core.js';\nimport ImageUtils from '../imageutils.js';\nimport ResizeImageCommand from './resizeimagecommand.js';\nimport { widthAndHeightStylesAreBothSet } from '../image/utils.js';\n\n/**\n * The image resize editing feature.\n *\n * It adds the ability to resize each image using handles or manually by\n * {@link module:image/imageresize/imageresizebuttons~ImageResizeButtons} buttons.\n */\nexport default class ImageResizeEditing extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageUtils ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageResizeEditing' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( editor: Editor ) {\n\t\tsuper( editor );\n\n\t\teditor.config.define( 'image', {\n\t\t\tresizeUnit: '%',\n\t\t\tresizeOptions: [\n\t\t\t\t{\n\t\t\t\t\tname: 'resizeImage:original',\n\t\t\t\t\tvalue: null,\n\t\t\t\t\ticon: 'original'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'resizeImage:custom',\n\t\t\t\t\tvalue: 'custom',\n\t\t\t\t\ticon: 'custom'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'resizeImage:25',\n\t\t\t\t\tvalue: '25',\n\t\t\t\t\ticon: 'small'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'resizeImage:50',\n\t\t\t\t\tvalue: '50',\n\t\t\t\t\ticon: 'medium'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'resizeImage:75',\n\t\t\t\t\tvalue: '75',\n\t\t\t\t\ticon: 'large'\n\t\t\t\t}\n\t\t\t]\n\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst editor = this.editor;\n\t\tconst resizeImageCommand = new ResizeImageCommand( editor );\n\n\t\tthis._registerConverters( 'imageBlock' );\n\t\tthis._registerConverters( 'imageInline' );\n\n\t\t// Register `resizeImage` command and add `imageResize` command as an alias for backward compatibility.\n\t\teditor.commands.add( 'resizeImage', resizeImageCommand );\n\t\teditor.commands.add( 'imageResize', resizeImageCommand );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic afterInit(): void {\n\t\tthis._registerSchema();\n\t}\n\n\tprivate _registerSchema(): void {\n\t\tif ( this.editor.plugins.has( 'ImageBlockEditing' ) ) {\n\t\t\tthis.editor.model.schema.extend( 'imageBlock', { allowAttributes: [ 'resizedWidth', 'resizedHeight' ] } );\n\t\t}\n\n\t\tif ( this.editor.plugins.has( 'ImageInlineEditing' ) ) {\n\t\t\tthis.editor.model.schema.extend( 'imageInline', { allowAttributes: [ 'resizedWidth', 'resizedHeight' ] } );\n\t\t}\n\t}\n\n\t/**\n\t * Registers image resize converters.\n\t *\n\t * @param imageType The type of the image.\n\t */\n\tprivate _registerConverters( imageType: 'imageBlock' | 'imageInline' ) {\n\t\tconst editor = this.editor;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\t// Dedicated converter to propagate image's attribute to the img tag.\n\t\teditor.conversion.for( 'downcast' ).add( dispatcher =>\n\t\t\tdispatcher.on( `attribute:resizedWidth:${ imageType }`, ( evt, data, conversionApi ) => {\n\t\t\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst viewWriter = conversionApi.writer;\n\t\t\t\tconst viewImg = conversionApi.mapper.toViewElement( data.item );\n\n\t\t\t\tif ( data.attributeNewValue !== null ) {\n\t\t\t\t\tviewWriter.setStyle( 'width', data.attributeNewValue, viewImg );\n\t\t\t\t\tviewWriter.addClass( 'image_resized', viewImg );\n\t\t\t\t} else {\n\t\t\t\t\tviewWriter.removeStyle( 'width', viewImg );\n\t\t\t\t\tviewWriter.removeClass( 'image_resized', viewImg );\n\t\t\t\t}\n\t\t\t} )\n\t\t);\n\n\t\teditor.conversion.for( 'dataDowncast' ).attributeToAttribute( {\n\t\t\tmodel: {\n\t\t\t\tname: imageType,\n\t\t\t\tkey: 'resizedHeight'\n\t\t\t},\n\t\t\tview: modelAttributeValue => ( {\n\t\t\t\tkey: 'style',\n\t\t\t\tvalue: {\n\t\t\t\t\t'height': modelAttributeValue\n\t\t\t\t}\n\t\t\t} )\n\t\t} );\n\n\t\teditor.conversion.for( 'editingDowncast' ).add( dispatcher =>\n\t\t\tdispatcher.on( `attribute:resizedHeight:${ imageType }`, ( evt, data, conversionApi ) => {\n\t\t\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst viewWriter = conversionApi.writer;\n\t\t\t\tconst viewImg = conversionApi.mapper.toViewElement( data.item );\n\t\t\t\tconst target = imageType === 'imageInline' ? imageUtils.findViewImgElement( viewImg ) : viewImg;\n\n\t\t\t\tif ( data.attributeNewValue !== null ) {\n\t\t\t\t\tviewWriter.setStyle( 'height', data.attributeNewValue, target );\n\t\t\t\t} else {\n\t\t\t\t\tviewWriter.removeStyle( 'height', target );\n\t\t\t\t}\n\t\t\t} )\n\t\t);\n\n\t\teditor.conversion.for( 'upcast' )\n\t\t\t.attributeToAttribute( {\n\t\t\t\tview: {\n\t\t\t\t\tname: imageType === 'imageBlock' ? 'figure' : 'img',\n\t\t\t\t\tstyles: {\n\t\t\t\t\t\twidth: /.+/\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmodel: {\n\t\t\t\t\tkey: 'resizedWidth',\n\t\t\t\t\tvalue: ( viewElement: ViewElement ) => {\n\t\t\t\t\t\tif ( widthAndHeightStylesAreBothSet( viewElement ) ) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn viewElement.getStyle( 'width' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\teditor.conversion.for( 'upcast' )\n\t\t\t.attributeToAttribute( {\n\t\t\t\tview: {\n\t\t\t\t\tname: imageType === 'imageBlock' ? 'figure' : 'img',\n\t\t\t\t\tstyles: {\n\t\t\t\t\t\theight: /.+/\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmodel: {\n\t\t\t\t\tkey: 'resizedHeight',\n\t\t\t\t\tvalue: ( viewElement: ViewElement ) => {\n\t\t\t\t\t\tif ( widthAndHeightStylesAreBothSet( viewElement ) ) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn viewElement.getStyle( 'height' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageresize/imageresizebuttons\n */\nimport { map } from 'lodash-es';\n\nimport { Plugin, icons, type Editor } from 'ckeditor5/src/core.js';\nimport {\n\tButtonView,\n\tDropdownButtonView,\n\tViewModel,\n\tcreateDropdown,\n\taddListToDropdown,\n\ttype ListDropdownItemDefinition\n} from 'ckeditor5/src/ui.js';\nimport { CKEditorError, Collection, type Locale } from 'ckeditor5/src/utils.js';\n\nimport ImageResizeEditing from './imageresizeediting.js';\n\nimport type ResizeImageCommand from './resizeimagecommand.js';\nimport type { ImageResizeOption } from '../imageconfig.js';\n\nconst RESIZE_ICONS = /* #__PURE__ */ ( () => ( {\n\tsmall: icons.objectSizeSmall,\n\tmedium: icons.objectSizeMedium,\n\tlarge: icons.objectSizeLarge,\n\tcustom: icons.objectSizeCustom,\n\toriginal: icons.objectSizeFull\n} ) )();\n\n/**\n * The image resize buttons plugin.\n *\n * It adds a possibility to resize images using the toolbar dropdown or individual buttons, depending on the plugin configuration.\n */\nexport default class ImageResizeButtons extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageResizeEditing ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageResizeButtons' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * The resize unit.\n\t * @default '%'\n\t */\n\tprivate readonly _resizeUnit: 'px' | '%';\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( editor: Editor ) {\n\t\tsuper( editor );\n\n\t\tthis._resizeUnit = editor.config.get( 'image.resizeUnit' )!;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst editor = this.editor;\n\t\tconst options = editor.config.get( 'image.resizeOptions' )!;\n\t\tconst command: ResizeImageCommand = editor.commands.get( 'resizeImage' )!;\n\n\t\tthis.bind( 'isEnabled' ).to( command );\n\n\t\tfor ( const option of options ) {\n\t\t\tthis._registerImageResizeButton( option );\n\t\t}\n\n\t\tthis._registerImageResizeDropdown( options );\n\t}\n\n\t/**\n\t * A helper function that creates a standalone button component for the plugin.\n\t *\n\t * @param resizeOption A model of the resize option.\n\t */\n\tprivate _registerImageResizeButton( option: ImageResizeOption ): void {\n\t\tconst editor = this.editor;\n\t\tconst { name, value, icon } = option;\n\n\t\teditor.ui.componentFactory.add( name, locale => {\n\t\t\tconst button = new ButtonView( locale );\n\t\t\tconst command: ResizeImageCommand = editor.commands.get( 'resizeImage' )!;\n\t\t\tconst labelText = this._getOptionLabelValue( option, true );\n\n\t\t\tif ( !RESIZE_ICONS[ icon as keyof typeof RESIZE_ICONS ] ) {\n\t\t\t\t/**\n\t\t\t\t * When configuring {@link module:image/imageconfig~ImageConfig#resizeOptions `config.image.resizeOptions`} for standalone\n\t\t\t\t * buttons, a valid `icon` token must be set for each option.\n\t\t\t\t *\n\t\t\t\t * See all valid options described in the\n\t\t\t\t * {@link module:image/imageconfig~ImageResizeOption plugin configuration}.\n\t\t\t\t *\n\t\t\t\t * @error imageresizebuttons-missing-icon\n\t\t\t\t * @param option Invalid image resize option.\n\t\t\t\t*/\n\t\t\t\tthrow new CKEditorError(\n\t\t\t\t\t'imageresizebuttons-missing-icon',\n\t\t\t\t\teditor,\n\t\t\t\t\toption\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tbutton.set( {\n\t\t\t\t// Use the `label` property for a verbose description (because of ARIA).\n\t\t\t\tlabel: labelText,\n\t\t\t\ticon: RESIZE_ICONS[ icon as keyof typeof RESIZE_ICONS ],\n\t\t\t\ttooltip: labelText,\n\t\t\t\tisToggleable: true\n\t\t\t} );\n\n\t\t\t// Bind button to the command.\n\t\t\tbutton.bind( 'isEnabled' ).to( this );\n\n\t\t\tif ( editor.plugins.has( 'ImageCustomResizeUI' ) && isCustomImageResizeOption( option ) ) {\n\t\t\t\tconst customResizeUI = editor.plugins.get( 'ImageCustomResizeUI' );\n\n\t\t\t\tthis.listenTo( button, 'execute', () => {\n\t\t\t\t\tcustomResizeUI._showForm( this._resizeUnit );\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tconst optionValueWithUnit = value ? value + this._resizeUnit : null;\n\n\t\t\t\tbutton.bind( 'isOn' ).to( command, 'value', getIsOnButtonCallback( optionValueWithUnit ) );\n\n\t\t\t\tthis.listenTo( button, 'execute', () => {\n\t\t\t\t\teditor.execute( 'resizeImage', { width: optionValueWithUnit } );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\treturn button;\n\t\t} );\n\t}\n\n\t/**\n\t * A helper function that creates a dropdown component for the plugin containing all the resize options defined in\n\t * the editor configuration.\n\t *\n\t * @param options An array of configured options.\n\t */\n\tprivate _registerImageResizeDropdown( options: Array<ImageResizeOption> ): void {\n\t\tconst editor = this.editor;\n\t\tconst t = editor.t;\n\t\tconst originalSizeOption = options.find( option => !option.value )!;\n\n\t\tconst componentCreator = ( locale: Locale ) => {\n\t\t\tconst command: ResizeImageCommand = editor.commands.get( 'resizeImage' )!;\n\t\t\tconst dropdownView = createDropdown( locale, DropdownButtonView );\n\t\t\tconst dropdownButton: typeof dropdownView.buttonView & { commandValue?: string | null } = dropdownView.buttonView;\n\t\t\tconst accessibleLabel = t( 'Resize image' );\n\n\t\t\tdropdownButton.set( {\n\t\t\t\ttooltip: accessibleLabel,\n\t\t\t\tcommandValue: originalSizeOption.value,\n\t\t\t\ticon: RESIZE_ICONS.medium,\n\t\t\t\tisToggleable: true,\n\t\t\t\tlabel: this._getOptionLabelValue( originalSizeOption ),\n\t\t\t\twithText: true,\n\t\t\t\tclass: 'ck-resize-image-button',\n\t\t\t\tariaLabel: accessibleLabel,\n\t\t\t\tariaLabelledBy: undefined\n\t\t\t} );\n\n\t\t\tdropdownButton.bind( 'label' ).to( command, 'value', commandValue => {\n\t\t\t\tif ( commandValue && commandValue.width ) {\n\t\t\t\t\treturn commandValue.width;\n\t\t\t\t} else {\n\t\t\t\t\treturn this._getOptionLabelValue( originalSizeOption );\n\t\t\t\t}\n\t\t\t} );\n\t\t\tdropdownView.bind( 'isEnabled' ).to( this );\n\n\t\t\taddListToDropdown( dropdownView, () => this._getResizeDropdownListItemDefinitions( options, command ), {\n\t\t\t\tariaLabel: t( 'Image resize list' ),\n\t\t\t\trole: 'menu'\n\t\t\t} );\n\n\t\t\t// Execute command when an item from the dropdown is selected.\n\t\t\tthis.listenTo( dropdownView, 'execute', evt => {\n\t\t\t\tif ( 'onClick' in evt.source ) {\n\t\t\t\t\t( evt.source as any ).onClick();\n\t\t\t\t} else {\n\t\t\t\t\teditor.execute( ( evt.source as any ).commandName, { width: ( evt.source as any ).commandValue } );\n\t\t\t\t\teditor.editing.view.focus();\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\treturn dropdownView;\n\t\t};\n\n\t\t// Register `resizeImage` dropdown and add `imageResize` dropdown as an alias for backward compatibility.\n\t\teditor.ui.componentFactory.add( 'resizeImage', componentCreator );\n\t\teditor.ui.componentFactory.add( 'imageResize', componentCreator );\n\t}\n\n\t/**\n\t * A helper function for creating an option label value string.\n\t *\n\t * @param option A resize option object.\n\t * @param forTooltip An optional flag for creating a tooltip label.\n\t * @returns A user-defined label combined from the numeric value and the resize unit or the default label\n\t * for reset options (`Original`).\n\t */\n\tprivate _getOptionLabelValue( option: ImageResizeOption, forTooltip: boolean = false ): string {\n\t\tconst t = this.editor.t;\n\n\t\tif ( option.label ) {\n\t\t\treturn option.label;\n\t\t} else if ( forTooltip ) {\n\t\t\tif ( isCustomImageResizeOption( option ) ) {\n\t\t\t\treturn t( 'Custom image size' );\n\t\t\t} else if ( option.value ) {\n\t\t\t\treturn t( 'Resize image to %0', option.value + this._resizeUnit );\n\t\t\t} else {\n\t\t\t\treturn t( 'Resize image to the original size' );\n\t\t\t}\n\t\t} else {\n\t\t\tif ( isCustomImageResizeOption( option ) ) {\n\t\t\t\treturn t( 'Custom' );\n\t\t\t} else if ( option.value ) {\n\t\t\t\treturn option.value + this._resizeUnit;\n\t\t\t} else {\n\t\t\t\treturn t( 'Original' );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * A helper function that parses the resize options and returns list item definitions ready for use in the dropdown.\n\t *\n\t * @param options The resize options.\n\t * @param command The resize image command.\n\t * @returns Dropdown item definitions.\n\t */\n\tprivate _getResizeDropdownListItemDefinitions(\n\t\toptions: Array<ImageResizeOption>,\n\t\tcommand: ResizeImageCommand\n\t): Collection<ListDropdownItemDefinition> {\n\t\tconst { editor } = this;\n\t\tconst itemDefinitions = new Collection<ListDropdownItemDefinition>();\n\n\t\tconst optionsWithSerializedValues = options.map( option => {\n\t\t\tif ( isCustomImageResizeOption( option ) ) {\n\t\t\t\treturn {\n\t\t\t\t\t...option,\n\t\t\t\t\tvalueWithUnits: 'custom'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif ( !option.value ) {\n\t\t\t\treturn {\n\t\t\t\t\t...option,\n\t\t\t\t\tvalueWithUnits: null\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...option,\n\t\t\t\tvalueWithUnits: `${ option.value }${ this._resizeUnit }`\n\t\t\t};\n\t\t} );\n\n\t\tfor ( const option of optionsWithSerializedValues ) {\n\t\t\tlet definition: ListDropdownItemDefinition | null = null;\n\n\t\t\tif ( editor.plugins.has( 'ImageCustomResizeUI' ) && isCustomImageResizeOption( option ) ) {\n\t\t\t\tconst customResizeUI = editor.plugins.get( 'ImageCustomResizeUI' );\n\n\t\t\t\tdefinition = {\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\tmodel: new ViewModel( {\n\t\t\t\t\t\tlabel: this._getOptionLabelValue( option ),\n\t\t\t\t\t\trole: 'menuitemradio',\n\t\t\t\t\t\twithText: true,\n\t\t\t\t\t\ticon: null,\n\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\tcustomResizeUI._showForm( this._resizeUnit );\n\t\t\t\t\t\t}\n\t\t\t\t\t} )\n\t\t\t\t};\n\n\t\t\t\tconst allDropdownValues = map( optionsWithSerializedValues, 'valueWithUnits' );\n\n\t\t\t\tdefinition.model.bind( 'isOn' ).to( command, 'value', getIsOnCustomButtonCallback( allDropdownValues ) );\n\t\t\t} else {\n\t\t\t\tdefinition = {\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\tmodel: new ViewModel( {\n\t\t\t\t\t\tcommandName: 'resizeImage',\n\t\t\t\t\t\tcommandValue: option.valueWithUnits,\n\t\t\t\t\t\tlabel: this._getOptionLabelValue( option ),\n\t\t\t\t\t\trole: 'menuitemradio',\n\t\t\t\t\t\twithText: true,\n\t\t\t\t\t\ticon: null\n\t\t\t\t\t} )\n\t\t\t\t};\n\n\t\t\t\tdefinition.model.bind( 'isOn' ).to( command, 'value', getIsOnButtonCallback( option.valueWithUnits ) );\n\t\t\t}\n\n\t\t\tdefinition.model.bind( 'isEnabled' ).to( command, 'isEnabled' );\n\t\t\titemDefinitions.add( definition );\n\t\t}\n\n\t\treturn itemDefinitions;\n\t}\n}\n\n/**\n * A helper that checks if provided option triggers custom resize balloon.\n */\nfunction isCustomImageResizeOption( option: ImageResizeOption ) {\n\treturn option.value === 'custom';\n}\n\n/**\n * A helper function for setting the `isOn` state of buttons in value bindings.\n */\nfunction getIsOnButtonCallback( value: string | null ): ( commandValue: unknown ) => boolean {\n\treturn ( commandValue: unknown ): boolean => {\n\t\tconst objectCommandValue = commandValue as null | { width: string | null };\n\t\tif ( value === null && objectCommandValue === value ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn objectCommandValue !== null && objectCommandValue.width === value;\n\t};\n}\n\n/**\n * A helper function for setting the `isOn` state of custom size button in value bindings.\n */\nfunction getIsOnCustomButtonCallback( allDropdownValues: Array<string | null> ): ( commandValue: unknown ) => boolean {\n\treturn ( commandValue: unknown ): boolean => !allDropdownValues.some(\n\t\tdropdownValue => getIsOnButtonCallback( dropdownValue )( commandValue )\n\t);\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageresize/imageresizehandles\n */\n\nimport type { Element, ViewElement } from 'ckeditor5/src/engine.js';\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport { WidgetResize } from 'ckeditor5/src/widget.js';\nimport ImageUtils from '../imageutils.js';\n\nimport ImageLoadObserver, { type ImageLoadedEvent } from '../image/imageloadobserver.js';\nimport type ResizeImageCommand from './resizeimagecommand.js';\n\nconst RESIZABLE_IMAGES_CSS_SELECTOR =\n\t'figure.image.ck-widget > img,' +\n\t'figure.image.ck-widget > picture > img,' +\n\t'figure.image.ck-widget > a > img,' +\n\t'figure.image.ck-widget > a > picture > img,' +\n\t'span.image-inline.ck-widget > img,' +\n\t'span.image-inline.ck-widget > picture > img';\n\nconst RESIZED_IMAGE_CLASS = 'image_resized';\n\n/**\n * The image resize by handles feature.\n *\n * It adds the ability to resize each image using handles or manually by\n * {@link module:image/imageresize/imageresizebuttons~ImageResizeButtons} buttons.\n */\nexport default class ImageResizeHandles extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ WidgetResize, ImageUtils ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageResizeHandles' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst command: ResizeImageCommand = this.editor.commands.get( 'resizeImage' )!;\n\t\tthis.bind( 'isEnabled' ).to( command );\n\n\t\tthis._setupResizerCreator();\n\t}\n\n\t/**\n\t * Attaches the listeners responsible for creating a resizer for each image, except for images inside the HTML embed preview.\n\t */\n\tprivate _setupResizerCreator(): void {\n\t\tconst editor = this.editor;\n\t\tconst editingView = editor.editing.view;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\teditingView.addObserver( ImageLoadObserver );\n\n\t\tthis.listenTo<ImageLoadedEvent>( editingView.document, 'imageLoaded', ( evt, domEvent ) => {\n\t\t\t// The resizer must be attached only to images loaded by the `ImageInsert`, `ImageUpload` or `LinkImage` plugins.\n\t\t\tif ( !( domEvent.target as HTMLElement ).matches( RESIZABLE_IMAGES_CSS_SELECTOR ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst domConverter = editor.editing.view.domConverter;\n\t\t\tconst imageView = domConverter.domToView( domEvent.target as HTMLElement ) as ViewElement;\n\t\t\tconst widgetView = imageUtils.getImageWidgetFromImageView( imageView )!;\n\t\t\tlet resizer = this.editor.plugins.get( WidgetResize ).getResizerByViewElement( widgetView );\n\n\t\t\tif ( resizer ) {\n\t\t\t\t// There are rare cases when the image will be triggered multiple times for the same widget, e.g. when\n\t\t\t\t// the image's source was changed after upload (https://github.com/ckeditor/ckeditor5/pull/8108#issuecomment-708302992).\n\t\t\t\tresizer.redraw();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst mapper = editor.editing.mapper;\n\t\t\tconst imageModel = mapper.toModelElement( widgetView )!;\n\n\t\t\tresizer = editor.plugins\n\t\t\t\t.get( WidgetResize )\n\t\t\t\t.attachTo( {\n\t\t\t\t\tunit: editor.config.get( 'image.resizeUnit' )!,\n\n\t\t\t\t\tmodelElement: imageModel,\n\t\t\t\t\tviewElement: widgetView,\n\t\t\t\t\teditor,\n\n\t\t\t\t\tgetHandleHost( domWidgetElement ) {\n\t\t\t\t\t\treturn domWidgetElement.querySelector( 'img' )!;\n\t\t\t\t\t},\n\t\t\t\t\tgetResizeHost() {\n\t\t\t\t\t\treturn domConverter.mapViewToDom( mapper.toViewElement( imageModel as Element )! ) as HTMLElement;\n\t\t\t\t\t},\n\n\t\t\t\t\tisCentered() {\n\t\t\t\t\t\tconst imageStyle = imageModel.getAttribute( 'imageStyle' );\n\n\t\t\t\t\t\treturn imageStyle == 'alignCenter';\n\t\t\t\t\t},\n\n\t\t\t\t\tonCommit( newValue ) {\n\t\t\t\t\t\t// Get rid of the CSS class in case the command execution that follows is unsuccessful\n\t\t\t\t\t\t// (e.g. Track Changes can override it and the new dimensions will not apply). Otherwise,\n\t\t\t\t\t\t// the presence of the class and the absence of the width style will cause it to take 100%\n\t\t\t\t\t\t// of the horizontal space.\n\t\t\t\t\t\teditingView.change( writer => {\n\t\t\t\t\t\t\twriter.removeClass( RESIZED_IMAGE_CLASS, widgetView );\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\teditor.execute( 'resizeImage', { width: newValue } );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\tresizer.on( 'updateSize', () => {\n\t\t\t\tif ( !widgetView.hasClass( RESIZED_IMAGE_CLASS ) ) {\n\t\t\t\t\teditingView.change( writer => {\n\t\t\t\t\t\twriter.addClass( RESIZED_IMAGE_CLASS, widgetView );\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\tconst target = imageModel.name === 'imageInline' ? imageView : widgetView;\n\n\t\t\t\tif ( target.getStyle( 'height' ) ) {\n\t\t\t\t\teditingView.change( writer => {\n\t\t\t\t\t\twriter.removeStyle( 'height', target );\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tresizer.bind( 'isEnabled' ).to( this );\n\t\t} );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageresize/utils/tryparsedimensionwithunit\n */\n\n/**\n * Parses provided string with dimension value and returns extracted numeric value and unit.\n *\n * \t* If non-string dimension is passed then `null` value is returned.\n * \t* If unit is missing then `null` is returned.\n * \t* If numeric value part of string is not a number then `null` is returned.\n *\n * Example:\n * \t`\"222px\"` => `{ value: 222, unit: \"px\" }`\n *\t`\"99%\"` => `{ value: 99, unit: \"%\" }`\n\n * @param dimension Unsafe string with dimension.\n * @returns Parsed dimension with extracted numeric value and units.\n */\nexport function tryParseDimensionWithUnit( dimension: string | null | undefined ): DimensionWithUnit | null {\n\tif ( !dimension ) {\n\t\treturn null;\n\t}\n\n\tconst [ , rawValue, unit ] = dimension.trim().match( /([.,\\d]+)(%|px)$/ ) || [];\n\tconst parsedValue = Number.parseFloat( rawValue );\n\n\tif ( Number.isNaN( parsedValue ) ) {\n\t\treturn null;\n\t}\n\n\treturn {\n\t\tvalue: parsedValue,\n\t\tunit\n\t};\n}\n\n/**\n * Converts dimension between `px` -> `%` and `%` -> `px`.\n *\n * @param parentDimensionPx\tDimension of parent element that contains measured element.\n * @param dimension Measured element dimension.\n * @returns Casted dimension.\n */\nexport function tryCastDimensionsToUnit( parentDimensionPx: number, dimension: DimensionWithUnit, targetUnit: string ): DimensionWithUnit {\n\t// \"%\" -> \"px\" conversion\n\tif ( targetUnit === 'px' ) {\n\t\treturn {\n\t\t\tvalue: dimension.value,\n\t\t\tunit: 'px'\n\t\t};\n\t}\n\n\t// \"px\" -> \"%\" conversion\n\treturn {\n\t\tvalue: dimension.value / parentDimensionPx * 100,\n\t\tunit: '%'\n\t};\n}\n\n/**\n * @internal\n */\nexport type DimensionWithUnit = {\n\tvalue: number;\n\tunit: string;\n};\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageresize/utils/getselectedimageeditornodes\n */\n\nimport type { ViewElement, Element } from 'ckeditor5/src/engine.js';\nimport type { Editor } from 'ckeditor5/src/core.js';\n\n/**\n * Finds model, view and DOM element for selected image element. Returns `null` if there is no image selected.\n *\n * @param editor Editor instance.\n */\nexport function getSelectedImageEditorNodes( editor: Editor ): ImageEditorNodes | null {\n\tconst { editing } = editor;\n\n\tconst imageUtils = editor.plugins.get( 'ImageUtils' );\n\tconst imageModelElement = imageUtils.getClosestSelectedImageElement( editor.model.document.selection );\n\n\tif ( !imageModelElement ) {\n\t\treturn null;\n\t}\n\n\tconst imageViewElement = editing.mapper.toViewElement( imageModelElement )!;\n\tconst imageDOMElement = editing.view.domConverter.mapViewToDom( imageViewElement )!;\n\n\treturn {\n\t\tmodel: imageModelElement,\n\t\tview: imageViewElement,\n\t\tdom: imageDOMElement\n\t};\n}\n\n/**\n * @internal;\n */\ntype ImageEditorNodes = {\n\tmodel: Element;\n\tview: ViewElement;\n\tdom: HTMLElement;\n};\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageresize/utils/getselectedimagewidthinunits\n */\n\nimport { Rect } from 'ckeditor5/src/utils.js';\n\nimport { calculateResizeHostAncestorWidth } from 'ckeditor5/src/widget.js';\nimport type { Editor } from 'ckeditor5/src/core.js';\n\nimport { tryCastDimensionsToUnit, tryParseDimensionWithUnit, type DimensionWithUnit } from './tryparsedimensionwithunit.js';\nimport { getSelectedImageEditorNodes } from './getselectedimageeditornodes.js';\n\n/**\n * Returns image width in specified units. It is width of image after resize.\n *\n * \t* If image is not selected or command is disabled then `null` will be returned.\n * \t* If image is not fully loaded (and it is impossible to determine its natural size) then `null` will be returned.\n *\t* If `targetUnit` percentage is passed then it will return width percentage of image related to its accessors.\n *\n * @param editor Editor instance.\n * @param targetUnit Unit in which dimension will be returned.\n * @returns Parsed image width after resize (with unit).\n */\nexport function getSelectedImageWidthInUnits( editor: Editor, targetUnit: string ): DimensionWithUnit | null {\n\tconst imageNodes = getSelectedImageEditorNodes( editor );\n\n\tif ( !imageNodes ) {\n\t\treturn null;\n\t}\n\n\tconst parsedResizedWidth = tryParseDimensionWithUnit(\n\t\timageNodes.model.getAttribute( 'resizedWidth' ) as string || null\n\t);\n\n\tif ( !parsedResizedWidth ) {\n\t\treturn null;\n\t}\n\n\tif ( parsedResizedWidth.unit === targetUnit ) {\n\t\treturn parsedResizedWidth;\n\t}\n\n\tconst imageParentWidthPx = calculateResizeHostAncestorWidth( imageNodes.dom );\n\tconst imageHolderDimension = {\n\t\tunit: 'px',\n\t\tvalue: new Rect( imageNodes.dom ).width\n\t};\n\n\treturn tryCastDimensionsToUnit( imageParentWidthPx, imageHolderDimension, targetUnit );\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageresize/ui/imagecustomresizeformview\n */\n\nimport {\n\tButtonView,\n\tFocusCycler,\n\tLabeledFieldView,\n\tView,\n\tViewCollection,\n\tcreateLabeledInputNumber,\n\tsubmitHandler,\n\ttype FocusableView,\n\ttype InputNumberView\n} from 'ckeditor5/src/ui.js';\n\nimport { FocusTracker, KeystrokeHandler, type Locale } from 'ckeditor5/src/utils.js';\nimport { icons } from 'ckeditor5/src/core.js';\n\nimport '../../../theme/imagecustomresizeform.css';\n\n// See: #8833.\n// eslint-disable-next-line ckeditor5-rules/ckeditor-imports\nimport '@ckeditor/ckeditor5-ui/theme/components/responsive-form/responsiveform.css';\n\n/**\n * The ImageCustomResizeFormView class.\n */\nexport default class ImageCustomResizeFormView extends View {\n\t/**\n\t * Tracks information about the DOM focus in the form.\n\t */\n\tpublic readonly focusTracker: FocusTracker;\n\n\t/**\n\t * An instance of the {@link module:utils/keystrokehandler~KeystrokeHandler}.\n\t */\n\tpublic readonly keystrokes: KeystrokeHandler;\n\n\t/**\n\t * Resize unit shortcut.\n\t */\n\tpublic readonly unit: string;\n\n\t/**\n\t * An input with a label.\n\t */\n\tpublic labeledInput: LabeledFieldView<InputNumberView>;\n\n\t/**\n\t * A button used to submit the form.\n\t */\n\tpublic saveButtonView: ButtonView;\n\n\t/**\n\t * A button used to cancel the form.\n\t */\n\tpublic cancelButtonView: ButtonView;\n\n\t/**\n\t * A collection of views which can be focused in the form.\n\t */\n\tprotected readonly _focusables: ViewCollection<FocusableView>;\n\n\t/**\n\t * Helps cycling over {@link #_focusables} in the form.\n\t */\n\tprotected readonly _focusCycler: FocusCycler;\n\n\t/**\n\t * An array of form validators used by {@link #isValid}.\n\t */\n\tprivate readonly _validators: Array<ImageCustomResizeFormValidatorCallback>;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor( locale: Locale, unit: string, validators: Array<ImageCustomResizeFormValidatorCallback> ) {\n\t\tsuper( locale );\n\t\tconst t = this.locale!.t;\n\n\t\tthis.focusTracker = new FocusTracker();\n\t\tthis.keystrokes = new KeystrokeHandler();\n\t\tthis.unit = unit;\n\n\t\tthis.labeledInput = this._createLabeledInputView();\n\n\t\tthis.saveButtonView = this._createButton( t( 'Save' ), icons.check, 'ck-button-save' );\n\t\tthis.saveButtonView.type = 'submit';\n\n\t\tthis.cancelButtonView = this._createButton( t( 'Cancel' ), icons.cancel, 'ck-button-cancel', 'cancel' );\n\n\t\tthis._focusables = new ViewCollection();\n\t\tthis._validators = validators;\n\n\t\tthis._focusCycler = new FocusCycler( {\n\t\t\tfocusables: this._focusables,\n\t\t\tfocusTracker: this.focusTracker,\n\t\t\tkeystrokeHandler: this.keystrokes,\n\t\t\tactions: {\n\t\t\t\t// Navigate form fields backwards using the Shift + Tab keystroke.\n\t\t\t\tfocusPrevious: 'shift + tab',\n\n\t\t\t\t// Navigate form fields forwards using the Tab key.\n\t\t\t\tfocusNext: 'tab'\n\t\t\t}\n\t\t} );\n\n\t\tthis.setTemplate( {\n\t\t\ttag: 'form',\n\t\t\tattributes: {\n\t\t\t\tclass: [\n\t\t\t\t\t'ck',\n\t\t\t\t\t'ck-image-custom-resize-form',\n\t\t\t\t\t'ck-responsive-form'\n\t\t\t\t],\n\n\t\t\t\t// https://github.com/ckeditor/ckeditor5-image/issues/40\n\t\t\t\ttabindex: '-1'\n\t\t\t},\n\n\t\t\tchildren: [\n\t\t\t\tthis.labeledInput,\n\t\t\t\tthis.saveButtonView,\n\t\t\t\tthis.cancelButtonView\n\t\t\t]\n\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override render(): void {\n\t\tsuper.render();\n\n\t\tthis.keystrokes.listenTo( this.element! );\n\n\t\tsubmitHandler( { view: this } );\n\n\t\t[ this.labeledInput, this.saveButtonView, this.cancelButtonView ]\n\t\t\t.forEach( v => {\n\t\t\t\t// Register the view as focusable.\n\t\t\t\tthis._focusables.add( v );\n\n\t\t\t\t// Register the view in the focus tracker.\n\t\t\t\tthis.focusTracker.add( v.element! );\n\t\t\t} );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override destroy(): void {\n\t\tsuper.destroy();\n\n\t\tthis.focusTracker.destroy();\n\t\tthis.keystrokes.destroy();\n\t}\n\n\t/**\n\t * Creates the button view.\n\t *\n\t * @param label The button label\n\t * @param icon The button's icon.\n\t * @param className The additional button CSS class name.\n\t * @param eventName The event name that the ButtonView#execute event will be delegated to.\n\t * @returns The button view instance.\n\t */\n\tprivate _createButton( label: string, icon: string, className: string, eventName?: string ): ButtonView {\n\t\tconst button = new ButtonView( this.locale );\n\n\t\tbutton.set( {\n\t\t\tlabel,\n\t\t\ticon,\n\t\t\ttooltip: true\n\t\t} );\n\n\t\tbutton.extendTemplate( {\n\t\t\tattributes: {\n\t\t\t\tclass: className\n\t\t\t}\n\t\t} );\n\n\t\tif ( eventName ) {\n\t\t\tbutton.delegate( 'execute' ).to( this, eventName );\n\t\t}\n\n\t\treturn button;\n\t}\n\n\t/**\n\t * Creates an input with a label.\n\t *\n\t * @returns Labeled field view instance.\n\t */\n\tprivate _createLabeledInputView(): LabeledFieldView<InputNumberView> {\n\t\tconst t = this.locale!.t;\n\t\tconst labeledInput = new LabeledFieldView<InputNumberView>( this.locale, createLabeledInputNumber );\n\n\t\tlabeledInput.label = t( 'Resize image (in %0)', this.unit );\n\t\tlabeledInput.fieldView.set( {\n\t\t\tstep: 0.1\n\t\t} );\n\n\t\treturn labeledInput;\n\t}\n\n\t/**\n\t * Validates the form and returns `false` when some fields are invalid.\n\t */\n\tpublic isValid(): boolean {\n\t\tthis.resetFormStatus();\n\n\t\tfor ( const validator of this._validators ) {\n\t\t\tconst errorText = validator( this );\n\n\t\t\t// One error per field is enough.\n\t\t\tif ( errorText ) {\n\t\t\t\t// Apply updated error.\n\t\t\t\tthis.labeledInput.errorText = errorText;\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Cleans up the supplementary error and information text of the {@link #labeledInput}\n\t * bringing them back to the state when the form has been displayed for the first time.\n\t *\n\t * See {@link #isValid}.\n\t */\n\tpublic resetFormStatus(): void {\n\t\tthis.labeledInput.errorText = null;\n\t}\n\n\t/**\n\t * The native DOM `value` of the input element of {@link #labeledInput}.\n\t */\n\tpublic get rawSize(): string | null {\n\t\tconst { element } = this.labeledInput.fieldView;\n\n\t\tif ( !element ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn element.value;\n\t}\n\n\t/**\n\t * Get numeric value of size. Returns `null` if value of size input element in {@link #labeledInput}.is not a number.\n\t */\n\tpublic get parsedSize(): number | null {\n\t\tconst { rawSize } = this;\n\n\t\tif ( rawSize === null ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst parsed = Number.parseFloat( rawSize );\n\n\t\tif ( Number.isNaN( parsed ) ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn parsed;\n\t}\n\n\t/**\n\t * Returns serialized image input size with unit.\n\t * Returns `null` if value of size input element in {@link #labeledInput}.is not a number.\n\t */\n\tpublic get sizeWithUnits(): string | null {\n\t\tconst { parsedSize, unit } = this;\n\n\t\tif ( parsedSize === null ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn `${ parsedSize }${ unit }`;\n\t}\n}\n\n/**\n * Callback used by {@link ~ImageCustomResizeFormView} to check if passed form value is valid.\n *\n * \t* If `undefined` is returned, it is assumed that the form value is correct and there is no error.\n * \t* If string is returned, it is assumed that the form value is incorrect and the returned string is displayed in the error label\n */\nexport type ImageCustomResizeFormValidatorCallback = ( form: ImageCustomResizeFormView ) => string | undefined;\n\n/**\n * Fired when the form view is submitted.\n *\n * @eventName ~ImageCustomResizeFormView#submit\n */\nexport type ImageCustomResizeFormViewSubmitEvent = {\n\tname: 'submit';\n\targs: [];\n};\n\n/**\n * Fired when the form view is canceled.\n *\n * @eventName ~ImageCustomResizeFormView#cancel\n */\nexport type ImageCustomResizeFormViewCancelEvent = {\n\tname: 'cancel';\n\targs: [];\n};\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageresize/utils/getselectedimagepossibleresizerange\n */\n\nimport type { Editor } from 'ckeditor5/src/core.js';\n\nimport { calculateResizeHostAncestorWidth } from 'ckeditor5/src/widget.js';\nimport { getSelectedImageEditorNodes } from './getselectedimageeditornodes.js';\nimport { tryCastDimensionsToUnit, tryParseDimensionWithUnit } from './tryparsedimensionwithunit.js';\n\n/**\n * Returns min and max value of resize image in specified unit.\n *\n * @param editor Editor instance.\n * @param targetUnit Unit in which dimension will be returned.\n * @returns Possible resize range in numeric form.\n */\nexport function getSelectedImagePossibleResizeRange( editor: Editor, targetUnit: string ): PossibleResizeImageRange | null {\n\tconst imageNodes = getSelectedImageEditorNodes( editor );\n\n\tif ( !imageNodes ) {\n\t\treturn null;\n\t}\n\n\tconst imageParentWidthPx = calculateResizeHostAncestorWidth( imageNodes.dom );\n\tconst minimumImageWidth = tryParseDimensionWithUnit( window.getComputedStyle( imageNodes.dom ).minWidth ) || {\n\t\tvalue: 1,\n\t\tunit: 'px'\n\t};\n\n\tconst lower = Math.max( 0.1, tryCastDimensionsToUnit( imageParentWidthPx, minimumImageWidth, targetUnit ).value );\n\tconst upper = targetUnit === 'px' ? imageParentWidthPx : 100;\n\n\treturn {\n\t\tunit: targetUnit,\n\t\tlower,\n\t\tupper\n\t};\n}\n\n/**\n * @internal\n */\nexport type PossibleResizeImageRange = {\n\tunit: string;\n\tlower: number;\n\tupper: number;\n};\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageresize/imagecustomresizeui\n */\n\nimport { Plugin, type Editor } from 'ckeditor5/src/core.js';\nimport {\n\tContextualBalloon,\n\tclickOutsideHandler,\n\tCssTransitionDisablerMixin,\n\ttype ViewWithCssTransitionDisabler\n} from 'ckeditor5/src/ui.js';\n\nimport { getBalloonPositionData } from '../image/ui/utils.js';\nimport { getSelectedImageWidthInUnits } from './utils/getselectedimagewidthinunits.js';\n\nimport ImageCustomResizeFormView, {\n\ttype ImageCustomResizeFormValidatorCallback,\n\ttype ImageCustomResizeFormViewCancelEvent,\n\ttype ImageCustomResizeFormViewSubmitEvent\n} from './ui/imagecustomresizeformview.js';\nimport { getSelectedImagePossibleResizeRange } from './utils/getselectedimagepossibleresizerange.js';\n\n/**\n * The custom resize image UI plugin.\n *\n * The plugin uses the {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon}.\n */\nexport default class ImageCustomResizeUI extends Plugin {\n\t/**\n\t * The contextual balloon plugin instance.\n\t */\n\tprivate _balloon?: ContextualBalloon;\n\n\t/**\n\t * A form containing a textarea and buttons, used to change the `alt` text value.\n\t */\n\tprivate _form?: ImageCustomResizeFormView & ViewWithCssTransitionDisabler;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ContextualBalloon ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageCustomResizeUI' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override destroy(): void {\n\t\tsuper.destroy();\n\n\t\t// Destroy created UI components as they are not automatically destroyed (see ckeditor5#1341).\n\t\tif ( this._form ) {\n\t\t\tthis._form.destroy();\n\t\t}\n\t}\n\n\t/**\n\t * Creates the {@link module:image/imageresize/ui/imagecustomresizeformview~ImageCustomResizeFormView}\n\t * form.\n\t */\n\tprivate _createForm( unit: string ): void {\n\t\tconst editor = this.editor;\n\n\t\tthis._balloon = this.editor.plugins.get( 'ContextualBalloon' );\n\n\t\tthis._form = new ( CssTransitionDisablerMixin( ImageCustomResizeFormView ) )( editor.locale, unit, getFormValidators( editor ) );\n\n\t\t// Render the form so its #element is available for clickOutsideHandler.\n\t\tthis._form.render();\n\n\t\tthis.listenTo<ImageCustomResizeFormViewSubmitEvent>( this._form, 'submit', () => {\n\t\t\tif ( this._form!.isValid() ) {\n\t\t\t\teditor.execute( 'resizeImage', {\n\t\t\t\t\twidth: this._form!.sizeWithUnits\n\t\t\t\t} );\n\n\t\t\t\tthis._hideForm( true );\n\t\t\t}\n\t\t} );\n\n\t\t// Update balloon position when form error label is added .\n\t\tthis.listenTo( this._form.labeledInput, 'change:errorText', () => {\n\t\t\teditor.ui.update();\n\t\t} );\n\n\t\tthis.listenTo<ImageCustomResizeFormViewCancelEvent>( this._form, 'cancel', () => {\n\t\t\tthis._hideForm( true );\n\t\t} );\n\n\t\t// Close the form on Esc key press.\n\t\tthis._form.keystrokes.set( 'Esc', ( data, cancel ) => {\n\t\t\tthis._hideForm( true );\n\t\t\tcancel();\n\t\t} );\n\n\t\t// Close on click outside of balloon panel element.\n\t\tclickOutsideHandler( {\n\t\t\temitter: this._form,\n\t\t\tactivator: () => this._isVisible,\n\t\t\tcontextElements: () => [ this._balloon!.view.element! ],\n\t\t\tcallback: () => this._hideForm()\n\t\t} );\n\t}\n\n\t/**\n\t * Shows the {@link #_form} in the {@link #_balloon}.\n\t *\n\t * @internal\n\t */\n\tpublic _showForm( unit: string ): void {\n\t\tif ( this._isVisible ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( !this._form ) {\n\t\t\tthis._createForm( unit );\n\t\t}\n\n\t\tconst editor = this.editor;\n\t\tconst labeledInput = this._form!.labeledInput;\n\n\t\tthis._form!.disableCssTransitions();\n\t\tthis._form!.resetFormStatus();\n\n\t\tif ( !this._isInBalloon ) {\n\t\t\tthis._balloon!.add( {\n\t\t\t\tview: this._form!,\n\t\t\t\tposition: getBalloonPositionData( editor )\n\t\t\t} );\n\t\t}\n\n\t\t// Make sure that each time the panel shows up, the field remains in sync with the value of\n\t\t// the command. If the user typed in the input, then canceled the balloon (`labeledInput#value`\n\t\t// stays unaltered) and re-opened it without changing the value of the command, they would see the\n\t\t// old value instead of the actual value of the command.\n\t\tconst currentParsedWidth = getSelectedImageWidthInUnits( editor, unit );\n\t\tconst initialInputValue = currentParsedWidth ? currentParsedWidth.value.toFixed( 1 ) : '';\n\t\tconst possibleRange = getSelectedImagePossibleResizeRange( editor, unit );\n\n\t\tlabeledInput.fieldView.value = labeledInput.fieldView.element!.value = initialInputValue;\n\n\t\tif ( possibleRange ) {\n\t\t\tObject.assign( labeledInput.fieldView, {\n\t\t\t\tmin: possibleRange.lower.toFixed( 1 ),\n\t\t\t\tmax: Math.ceil( possibleRange.upper ).toFixed( 1 )\n\t\t\t} );\n\t\t}\n\n\t\tthis._form!.labeledInput.fieldView.select();\n\t\tthis._form!.enableCssTransitions();\n\t}\n\n\t/**\n\t * Removes the {@link #_form} from the {@link #_balloon}.\n\t *\n\t * @param focusEditable Controls whether the editing view is focused afterwards.\n\t */\n\tprivate _hideForm( focusEditable: boolean = false ): void {\n\t\tif ( !this._isInBalloon ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Blur the input element before removing it from DOM to prevent issues in some browsers.\n\t\t// See https://github.com/ckeditor/ckeditor5/issues/1501.\n\t\tif ( this._form!.focusTracker.isFocused ) {\n\t\t\tthis._form!.saveButtonView.focus();\n\t\t}\n\n\t\tthis._balloon!.remove( this._form! );\n\n\t\tif ( focusEditable ) {\n\t\t\tthis.editor.editing.view.focus();\n\t\t}\n\t}\n\n\t/**\n\t * Returns `true` when the {@link #_form} is the visible view in the {@link #_balloon}.\n\t */\n\tprivate get _isVisible(): boolean {\n\t\treturn !!this._balloon && this._balloon.visibleView === this._form;\n\t}\n\n\t/**\n\t * Returns `true` when the {@link #_form} is in the {@link #_balloon}.\n\t */\n\tprivate get _isInBalloon(): boolean {\n\t\treturn !!this._balloon && this._balloon.hasView( this._form! );\n\t}\n}\n\n/**\n * Returns image resize form validation callbacks.\n *\n * @param editor Editor instance.\n */\nfunction getFormValidators( editor: Editor ): Array<ImageCustomResizeFormValidatorCallback> {\n\tconst t = editor.t;\n\n\treturn [\n\t\tform => {\n\t\t\tif ( form.rawSize!.trim() === '' ) {\n\t\t\t\treturn t( 'The value must not be empty.' );\n\t\t\t}\n\n\t\t\tif ( form.parsedSize === null ) {\n\t\t\t\treturn t( 'The value should be a plain number.' );\n\t\t\t}\n\t\t}\n\t];\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imageresize\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport ImageResizeButtons from './imageresize/imageresizebuttons.js';\nimport ImageResizeEditing from './imageresize/imageresizeediting.js';\nimport ImageResizeHandles from './imageresize/imageresizehandles.js';\nimport ImageCustomResizeUI from './imageresize/imagecustomresizeui.js';\n\nimport '../theme/imageresize.css';\n\n/**\n * The image resize plugin.\n *\n * It adds a possibility to resize each image using handles.\n */\nexport default class ImageResize extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageResizeEditing, ImageResizeHandles, ImageCustomResizeUI, ImageResizeButtons ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageResize' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagestyle/imagestylecommand\n */\n\nimport type { Element } from 'ckeditor5/src/engine.js';\nimport { Command, type Editor } from 'ckeditor5/src/core.js';\nimport type { ImageStyleOptionDefinition } from '../imageconfig.js';\nimport type ImageUtils from '../imageutils.js';\n\n/**\n * The image style command. It is used to apply {@link module:image/imageconfig~ImageStyleConfig#options image style option}\n * to a selected image.\n *\n * **Note**: Executing this command may change the image model element if the desired style requires an image of a different\n * type. See {@link module:image/imagestyle/imagestylecommand~ImageStyleCommand#execute} to learn more.\n */\nexport default class ImageStyleCommand extends Command {\n\t/**\n\t * An object containing names of default style options for the inline and block images.\n\t * If there is no default style option for the given image type in the configuration,\n\t * the name will be `false`.\n\t */\n\tprivate _defaultStyles: Record<string, string | false>;\n\n\t/**\n\t * The styles handled by this command.\n\t */\n\tprivate _styles: Map<string, ImageStyleOptionDefinition>;\n\n\t/**\n\t * Creates an instance of the image style command. When executed, the command applies one of\n\t * {@link module:image/imageconfig~ImageStyleConfig#options style options} to the currently selected image.\n\t *\n\t * @param editor The editor instance.\n\t * @param styles The style options that this command supports.\n\t */\n\tconstructor( editor: Editor, styles: Array<ImageStyleOptionDefinition> ) {\n\t\tsuper( editor );\n\n\t\tthis._defaultStyles = {\n\t\t\timageBlock: false,\n\t\t\timageInline: false\n\t\t};\n\n\t\tthis._styles = new Map( styles.map( style => {\n\t\t\tif ( style.isDefault ) {\n\t\t\t\tfor ( const modelElementName of style.modelElements ) {\n\t\t\t\t\tthis._defaultStyles[ modelElementName ] = style.name;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn [ style.name, style ];\n\t\t} ) );\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic override refresh(): void {\n\t\tconst editor = this.editor;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\t\tconst element = imageUtils.getClosestSelectedImageElement( this.editor.model.document.selection )!;\n\n\t\tthis.isEnabled = !!element;\n\n\t\tif ( !this.isEnabled ) {\n\t\t\tthis.value = false;\n\t\t} else if ( element.hasAttribute( 'imageStyle' ) ) {\n\t\t\tthis.value = element.getAttribute( 'imageStyle' );\n\t\t} else {\n\t\t\tthis.value = this._defaultStyles[ element.name ];\n\t\t}\n\t}\n\n\t/**\n\t * Executes the command and applies the style to the currently selected image:\n\t *\n\t * ```ts\n\t * editor.execute( 'imageStyle', { value: 'side' } );\n\t * ```\n\t *\n\t * **Note**: Executing this command may change the image model element if the desired style requires an image\n\t * of a different type. Learn more about {@link module:image/imageconfig~ImageStyleOptionDefinition#modelElements model element}\n\t * configuration for the style option.\n\t *\n\t * @param options.value The name of the style (as configured in {@link module:image/imageconfig~ImageStyleConfig#options}).\n\t * @param options.setImageSizes Specifies whether the image `width` and `height` attributes should be set automatically.\n\t * The default is `true`.\n\t * @fires execute\n\t */\n\tpublic override execute( options: { value?: string; setImageSizes?: boolean } = {} ): void {\n\t\tconst editor = this.editor;\n\t\tconst model = editor.model;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\tmodel.change( writer => {\n\t\t\tconst requestedStyle = options.value;\n\t\t\tconst { setImageSizes = true } = options;\n\n\t\t\tlet imageElement = imageUtils.getClosestSelectedImageElement( model.document.selection )!;\n\n\t\t\t// Change the image type if a style requires it.\n\t\t\tif ( requestedStyle && this.shouldConvertImageType( requestedStyle, imageElement ) ) {\n\t\t\t\tthis.editor.execute( imageUtils.isBlockImage( imageElement ) ? 'imageTypeInline' : 'imageTypeBlock', { setImageSizes } );\n\n\t\t\t\t// Update the imageElement to the newly created image.\n\t\t\t\timageElement = imageUtils.getClosestSelectedImageElement( model.document.selection )!;\n\t\t\t}\n\n\t\t\t// Default style means that there is no `imageStyle` attribute in the model.\n\t\t\t// https://github.com/ckeditor/ckeditor5-image/issues/147\n\t\t\tif ( !requestedStyle || this._styles.get( requestedStyle )!.isDefault ) {\n\t\t\t\twriter.removeAttribute( 'imageStyle', imageElement );\n\t\t\t} else {\n\t\t\t\twriter.setAttribute( 'imageStyle', requestedStyle, imageElement );\n\t\t\t}\n\n\t\t\tif ( setImageSizes ) {\n\t\t\t\timageUtils.setImageNaturalSizeAttributes( imageElement );\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Returns `true` if requested style change would trigger the image type change.\n\t *\n\t * @param requestedStyle The name of the style (as configured in {@link module:image/imageconfig~ImageStyleConfig#options}).\n\t * @param imageElement The image model element.\n\t */\n\tpublic shouldConvertImageType( requestedStyle: string, imageElement: Element ): boolean {\n\t\tconst supportedTypes = this._styles.get( requestedStyle )!.modelElements;\n\n\t\treturn !supportedTypes.includes( imageElement.name );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagestyle/utils\n */\n\nimport { type Editor, icons, type PluginCollection } from 'ckeditor5/src/core.js';\nimport { logWarning } from 'ckeditor5/src/utils.js';\nimport type { ImageStyleConfig, ImageStyleDropdownDefinition, ImageStyleOptionDefinition } from '../imageconfig.js';\n\n/**\n * Default image style options provided by the plugin that can be referred in the {@link module:image/imageconfig~ImageConfig#styles}\n * configuration.\n *\n * There are available 5 styles focused on formatting:\n *\n * * **`'alignLeft'`** aligns the inline or block image to the left and wraps it with the text using the `image-style-align-left` class,\n * * **`'alignRight'`** aligns the inline or block image to the right and wraps it with the text using the `image-style-align-right` class,\n * * **`'alignCenter'`** centers the block image using the `image-style-align-center` class,\n * * **`'alignBlockLeft'`** aligns the block image to the left using the `image-style-block-align-left` class,\n * * **`'alignBlockRight'`** aligns the block image to the right using the `image-style-block-align-right` class,\n *\n * and 3 semantic styles:\n *\n * * **`'inline'`** is an inline image without any CSS class,\n * * **`'block'`** is a block image without any CSS class,\n * * **`'side'`** is a block image styled with the `image-style-side` CSS class.\n */\nexport const DEFAULT_OPTIONS: Record<string, ImageStyleOptionDefinition> = {\n\t// This style represents an image placed in the line of text.\n\tget inline() {\n\t\treturn {\n\t\t\tname: 'inline',\n\t\t\ttitle: 'In line',\n\t\t\ticon: icons.objectInline,\n\t\t\tmodelElements: [ 'imageInline' ],\n\t\t\tisDefault: true\n\t\t};\n\t},\n\n\t// This style represents an image aligned to the left and wrapped with text.\n\tget alignLeft() {\n\t\treturn {\n\t\t\tname: 'alignLeft',\n\t\t\ttitle: 'Left aligned image',\n\t\t\ticon: icons.objectLeft,\n\t\t\tmodelElements: [ 'imageBlock', 'imageInline' ],\n\t\t\tclassName: 'image-style-align-left'\n\t\t};\n\t},\n\n\t// This style represents an image aligned to the left.\n\tget alignBlockLeft() {\n\t\treturn {\n\t\t\tname: 'alignBlockLeft',\n\t\t\ttitle: 'Left aligned image',\n\t\t\ticon: icons.objectBlockLeft,\n\t\t\tmodelElements: [ 'imageBlock' ],\n\t\t\tclassName: 'image-style-block-align-left'\n\t\t};\n\t},\n\n\t// This style represents a centered image.\n\tget alignCenter() {\n\t\treturn {\n\t\t\tname: 'alignCenter',\n\t\t\ttitle: 'Centered image',\n\t\t\ticon: icons.objectCenter,\n\t\t\tmodelElements: [ 'imageBlock' ],\n\t\t\tclassName: 'image-style-align-center'\n\t\t};\n\t},\n\n\t// This style represents an image aligned to the right and wrapped with text.\n\tget alignRight() {\n\t\treturn {\n\t\t\tname: 'alignRight',\n\t\t\ttitle: 'Right aligned image',\n\t\t\ticon: icons.objectRight,\n\t\t\tmodelElements: [ 'imageBlock', 'imageInline' ],\n\t\t\tclassName: 'image-style-align-right'\n\t\t};\n\t},\n\n\t// This style represents an image aligned to the right.\n\tget alignBlockRight() {\n\t\treturn {\n\t\t\tname: 'alignBlockRight',\n\t\t\ttitle: 'Right aligned image',\n\t\t\ticon: icons.objectBlockRight,\n\t\t\tmodelElements: [ 'imageBlock' ],\n\t\t\tclassName: 'image-style-block-align-right'\n\t\t};\n\t},\n\n\t// This option is equal to the situation when no style is applied.\n\tget block() {\n\t\treturn {\n\t\t\tname: 'block',\n\t\t\ttitle: 'Centered image',\n\t\t\ticon: icons.objectCenter,\n\t\t\tmodelElements: [ 'imageBlock' ],\n\t\t\tisDefault: true\n\t\t};\n\t},\n\n\t// This represents a side image.\n\tget side() {\n\t\treturn {\n\t\t\tname: 'side',\n\t\t\ttitle: 'Side image',\n\t\t\ticon: icons.objectRight,\n\t\t\tmodelElements: [ 'imageBlock' ],\n\t\t\tclassName: 'image-style-side'\n\t\t};\n\t}\n};\n\n/**\n * Default image style icons provided by the plugin that can be referred in the {@link module:image/imageconfig~ImageConfig#styles}\n * configuration.\n *\n * See {@link module:image/imageconfig~ImageStyleOptionDefinition#icon} to learn more.\n *\n * There are 7 default icons available: `'full'`, `'left'`, `'inlineLeft'`, `'center'`, `'right'`, `'inlineRight'`, and `'inline'`.\n */\nexport const DEFAULT_ICONS: Record<string, string> = /* #__PURE__ */ ( () => ( {\n\tfull: icons.objectFullWidth,\n\tleft: icons.objectBlockLeft,\n\tright: icons.objectBlockRight,\n\tcenter: icons.objectCenter,\n\tinlineLeft: icons.objectLeft,\n\tinlineRight: icons.objectRight,\n\tinline: icons.objectInline\n} ) )();\n\n/**\n * Default drop-downs provided by the plugin that can be referred in the {@link module:image/imageconfig~ImageConfig#toolbar}\n * configuration. The drop-downs are containers for the {@link module:image/imageconfig~ImageStyleConfig#options image style options}.\n *\n * If both of the `ImageEditing` plugins are loaded, there are 2 predefined drop-downs available:\n *\n * * **`'imageStyle:wrapText'`**, which contains the `alignLeft` and `alignRight` options, that is,\n * those that wraps the text around the image,\n * * **`'imageStyle:breakText'`**, which contains the `alignBlockLeft`, `alignCenter` and `alignBlockRight` options, that is,\n * those that breaks the text around the image.\n */\nexport const DEFAULT_DROPDOWN_DEFINITIONS: Array<ImageStyleDropdownDefinition> = [ {\n\tname: 'imageStyle:wrapText',\n\ttitle: 'Wrap text',\n\tdefaultItem: 'imageStyle:alignLeft',\n\titems: [ 'imageStyle:alignLeft', 'imageStyle:alignRight' ]\n}, {\n\tname: 'imageStyle:breakText',\n\ttitle: 'Break text',\n\tdefaultItem: 'imageStyle:block',\n\titems: [ 'imageStyle:alignBlockLeft', 'imageStyle:block', 'imageStyle:alignBlockRight' ]\n} ];\n\n/**\n * Returns a list of the normalized and validated image style options.\n *\n * @param config\n * @param config.isInlinePluginLoaded\n * Determines whether the {@link module:image/image/imageblockediting~ImageBlockEditing `ImageBlockEditing`} plugin has been loaded.\n * @param config.isBlockPluginLoaded\n * Determines whether the {@link module:image/image/imageinlineediting~ImageInlineEditing `ImageInlineEditing`} plugin has been loaded.\n * @param config.configuredStyles\n * The image styles configuration provided in the image styles {@link module:image/imageconfig~ImageConfig#styles configuration}\n * as a default or custom value.\n * @returns\n * * Each of options contains a complete icon markup.\n * * The image style options not supported by any of the loaded plugins are filtered out.\n */\nfunction normalizeStyles( config: {\n\tisInlinePluginLoaded: boolean;\n\tisBlockPluginLoaded: boolean;\n\tconfiguredStyles: ImageStyleConfig;\n}\n): Array<ImageStyleOptionDefinition> {\n\tconst configuredStyles = config.configuredStyles.options || [];\n\n\tconst styles = configuredStyles\n\t\t.map( arrangement => normalizeDefinition( arrangement ) )\n\t\t.filter( arrangement => isValidOption( arrangement, config ) );\n\n\treturn styles;\n}\n\n/**\n * Returns the default image styles configuration depending on the loaded image editing plugins.\n *\n * @param isInlinePluginLoaded\n * Determines whether the {@link module:image/image/imageblockediting~ImageBlockEditing `ImageBlockEditing`} plugin has been loaded.\n *\n * @param isBlockPluginLoaded\n * Determines whether the {@link module:image/image/imageinlineediting~ImageInlineEditing `ImageInlineEditing`} plugin has been loaded.\n *\n * @returns\n * It returns an object with the lists of the image style options and groups defined as strings related to the\n * {@link module:image/imagestyle/utils#DEFAULT_OPTIONS default options}\n */\nfunction getDefaultStylesConfiguration( isBlockPluginLoaded: boolean, isInlinePluginLoaded: boolean ): ImageStyleConfig {\n\tif ( isBlockPluginLoaded && isInlinePluginLoaded ) {\n\t\treturn {\n\t\t\toptions: [\n\t\t\t\t'inline', 'alignLeft', 'alignRight',\n\t\t\t\t'alignCenter', 'alignBlockLeft', 'alignBlockRight',\n\t\t\t\t'block', 'side'\n\t\t\t]\n\t\t};\n\t} else if ( isBlockPluginLoaded ) {\n\t\treturn {\n\t\t\toptions: [ 'block', 'side' ]\n\t\t};\n\t} else if ( isInlinePluginLoaded ) {\n\t\treturn {\n\t\t\toptions: [ 'inline', 'alignLeft', 'alignRight' ]\n\t\t};\n\t}\n\n\treturn {};\n}\n\n/**\n * Returns a list of the available predefined drop-downs' definitions depending on the loaded image editing plugins.\n */\nfunction getDefaultDropdownDefinitions( pluginCollection: PluginCollection<Editor> ): Array<ImageStyleDropdownDefinition> {\n\tif ( pluginCollection.has( 'ImageBlockEditing' ) && pluginCollection.has( 'ImageInlineEditing' ) ) {\n\t\treturn [ ...DEFAULT_DROPDOWN_DEFINITIONS ];\n\t} else {\n\t\treturn [];\n\t}\n}\n\n/**\n * Normalizes an image style option or group provided in the {@link module:image/imageconfig~ImageConfig#styles}\n * and returns it in a {@link module:image/imageconfig~ImageStyleOptionDefinition}/\n */\nfunction normalizeDefinition( definition: string | Partial<ImageStyleOptionDefinition> & { name: string } ): ImageStyleOptionDefinition {\n\tif ( typeof definition === 'string' ) {\n\t\t// Just the name of the style has been passed, but none of the defaults.\n\t\tif ( !DEFAULT_OPTIONS[ definition ] ) {\n\t\t\t// Normalize the style anyway to prevent errors.\n\t\t\tdefinition = { name: definition };\n\t\t}\n\t\t// Just the name of the style has been passed and it's one of the defaults, just use it.\n\t\t// Clone the style to avoid overriding defaults.\n\t\telse {\n\t\t\tdefinition = { ...DEFAULT_OPTIONS[ definition ] };\n\t\t}\n\t} else {\n\t\t// If an object style has been passed and if the name matches one of the defaults,\n\t\t// extend it with defaults – the user wants to customize a default style.\n\t\t// Note: Don't override the user–defined style object, clone it instead.\n\t\tdefinition = extendStyle( DEFAULT_OPTIONS[ definition.name ], definition );\n\t}\n\n\t// If an icon is defined as a string and correspond with a name\n\t// in default icons, use the default icon provided by the plugin.\n\tif ( typeof definition.icon === 'string' ) {\n\t\tdefinition.icon = DEFAULT_ICONS[ definition.icon ] || definition.icon;\n\t}\n\n\treturn definition as ImageStyleOptionDefinition;\n}\n\n/**\n * Checks if the image style option is valid:\n * * if it has the modelElements fields defined and filled,\n * * if the defined modelElements are supported by any of the loaded image editing plugins.\n * It also displays a console warning these conditions are not met.\n *\n * @param option image style option\n */\nfunction isValidOption(\n\toption: ImageStyleOptionDefinition,\n\t{ isBlockPluginLoaded, isInlinePluginLoaded }: { isBlockPluginLoaded: boolean; isInlinePluginLoaded: boolean }\n): boolean {\n\tconst { modelElements, name } = option;\n\n\tif ( !modelElements || !modelElements.length || !name ) {\n\t\twarnInvalidStyle( { style: option } );\n\n\t\treturn false;\n\t} else {\n\t\tconst supportedElements = [ isBlockPluginLoaded ? 'imageBlock' : null, isInlinePluginLoaded ? 'imageInline' : null ];\n\n\t\t// Check if the option is supported by any of the loaded plugins.\n\t\tif ( !modelElements.some( elementName => supportedElements.includes( elementName ) ) ) {\n\t\t\t/**\n\t\t\t * In order to work correctly, each image style {@link module:image/imageconfig~ImageStyleOptionDefinition option}\n\t\t\t * requires specific model elements (also: types of images) to be supported by the editor.\n\t\t\t *\n\t\t\t * Model element names to which the image style option can be applied are defined in the\n\t\t\t * {@link module:image/imageconfig~ImageStyleOptionDefinition#modelElements} property of the style option\n\t\t\t * definition.\n\t\t\t *\n\t\t\t * Explore the warning in the console to find out precisely which option is not supported and which editor plugins\n\t\t\t * are missing. Make sure these plugins are loaded in your editor to get this image style option working.\n\t\t\t *\n\t\t\t * @error image-style-missing-dependency\n\t\t\t * @param {String} [option] The name of the unsupported option.\n\t\t\t * @param {String} [missingPlugins] The names of the plugins one of which has to be loaded for the particular option.\n\t\t\t */\n\t\t\tlogWarning( 'image-style-missing-dependency', {\n\t\t\t\tstyle: option,\n\t\t\t\tmissingPlugins: modelElements.map( name => name === 'imageBlock' ? 'ImageBlockEditing' : 'ImageInlineEditing' )\n\t\t\t} );\n\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n/**\n * Extends the default style with a style provided by the developer.\n * Note: Don't override the custom–defined style object, clone it instead.\n */\nfunction extendStyle( source: ImageStyleOptionDefinition, style: Partial<ImageStyleOptionDefinition> ): ImageStyleOptionDefinition {\n\tconst extendedStyle: Record<string, any> = { ...style };\n\n\tfor ( const prop in source ) {\n\t\tif ( !Object.prototype.hasOwnProperty.call( style, prop ) ) {\n\t\t\textendedStyle[ prop ] = source[ prop as keyof typeof source ];\n\t\t}\n\t}\n\n\treturn extendedStyle as ImageStyleOptionDefinition;\n}\n\n/**\n * Displays a console warning with the 'image-style-configuration-definition-invalid' error.\n */\nfunction warnInvalidStyle( info: object ): void {\n\t/**\n\t * The image style definition provided in the configuration is invalid.\n\t *\n\t * Please make sure the definition implements properly one of the following:\n\t *\n\t * * {@link module:image/imageconfig~ImageStyleOptionDefinition image style option definition},\n\t * * {@link module:image/imageconfig~ImageStyleDropdownDefinition image style dropdown definition}\n\t *\n\t * @error image-style-configuration-definition-invalid\n\t * @param {String} [dropdown] The name of the invalid drop-down\n\t * @param {String} [style] The name of the invalid image style option\n\t */\n\tlogWarning( 'image-style-configuration-definition-invalid', info );\n}\n\nexport default {\n\tnormalizeStyles,\n\tgetDefaultStylesConfiguration,\n\tgetDefaultDropdownDefinitions,\n\twarnInvalidStyle,\n\tDEFAULT_OPTIONS,\n\tDEFAULT_ICONS,\n\tDEFAULT_DROPDOWN_DEFINITIONS\n};\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\nimport type { DowncastAttributeEvent, Element, UpcastElementEvent } from 'ckeditor5/src/engine.js';\nimport { first, type GetCallback } from 'ckeditor5/src/utils.js';\nimport type { ImageStyleOptionDefinition } from '../imageconfig.js';\n\n/**\n * @module image/imagestyle/converters\n */\n\n/**\n * Returns a converter for the `imageStyle` attribute. It can be used for adding, changing and removing the attribute.\n *\n * @param styles An array containing available image style options.\n * @returns A model-to-view attribute converter.\n */\nexport function modelToViewStyleAttribute( styles: Array<ImageStyleOptionDefinition> ): GetCallback<DowncastAttributeEvent> {\n\treturn ( evt, data, conversionApi ) => {\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if there is class name associated with given value.\n\t\tconst newStyle = getStyleDefinitionByName( data.attributeNewValue as string, styles );\n\t\tconst oldStyle = getStyleDefinitionByName( data.attributeOldValue as string, styles );\n\n\t\tconst viewElement = conversionApi.mapper.toViewElement( data.item as Element )!;\n\t\tconst viewWriter = conversionApi.writer;\n\n\t\tif ( oldStyle ) {\n\t\t\tviewWriter.removeClass( oldStyle.className!, viewElement );\n\t\t}\n\n\t\tif ( newStyle ) {\n\t\t\tviewWriter.addClass( newStyle.className!, viewElement );\n\t\t}\n\t};\n}\n\n/**\n * Returns a view-to-model converter converting image CSS classes to a proper value in the model.\n *\n * @param styles Image style options for which the converter is created.\n * @returns A view-to-model converter.\n */\nexport function viewToModelStyleAttribute( styles: Array<ImageStyleOptionDefinition> ): GetCallback<UpcastElementEvent> {\n\t// Convert only non–default styles.\n\tconst nonDefaultStyles: Record<string, Array<ImageStyleOptionDefinition>> = {\n\t\timageInline: styles.filter( style => !style.isDefault && style.modelElements.includes( 'imageInline' ) ),\n\t\timageBlock: styles.filter( style => !style.isDefault && style.modelElements.includes( 'imageBlock' ) )\n\t};\n\n\treturn ( evt, data, conversionApi ) => {\n\t\tif ( !data.modelRange ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewElement = data.viewItem;\n\t\tconst modelImageElement = first( data.modelRange.getItems() );\n\n\t\t// Run this converter only if an image has been found in the model.\n\t\t// In some cases it may not be found (for example if we run this on a figure with different type than image).\n\t\tif ( !modelImageElement ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// ...and the `imageStyle` attribute is allowed for that element, otherwise stop conversion early.\n\t\tif ( !conversionApi.schema.checkAttribute( modelImageElement, 'imageStyle' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Convert styles one by one.\n\t\tfor ( const style of nonDefaultStyles[ ( modelImageElement as Element ).name ] ) {\n\t\t\t// Try to consume class corresponding with the style.\n\t\t\tif ( conversionApi.consumable.consume( viewElement, { classes: style.className } ) ) {\n\t\t\t\t// And convert this style to model attribute.\n\t\t\t\tconversionApi.writer.setAttribute( 'imageStyle', style.name, modelImageElement );\n\t\t\t}\n\t\t}\n\t};\n}\n\n/**\n * Returns the style with a given `name` from an array of styles.\n */\nfunction getStyleDefinitionByName( name: string, styles: Array<ImageStyleOptionDefinition> ): ImageStyleOptionDefinition | undefined {\n\tfor ( const style of styles ) {\n\t\tif ( style.name === name ) {\n\t\t\treturn style;\n\t\t}\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagestyle/imagestyleediting\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport type { Element, UpcastElementEvent } from 'ckeditor5/src/engine.js';\n\nimport ImageStyleCommand from './imagestylecommand.js';\nimport ImageUtils from '../imageutils.js';\nimport utils from './utils.js';\nimport { viewToModelStyleAttribute, modelToViewStyleAttribute } from './converters.js';\nimport type { ImageStyleOptionDefinition } from '../imageconfig.js';\n\n/**\n * The image style engine plugin. It sets the default configuration, creates converters and registers\n * {@link module:image/imagestyle/imagestylecommand~ImageStyleCommand ImageStyleCommand}.\n */\nexport default class ImageStyleEditing extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageStyleEditing' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageUtils ] as const;\n\t}\n\n\t/**\n\t * It contains a list of the normalized and validated style options.\n\t *\n\t * * Each option contains a complete icon markup.\n\t * * The style options not supported by any of the loaded image editing plugins (\n\t * {@link module:image/image/imageinlineediting~ImageInlineEditing `ImageInlineEditing`} or\n\t * {@link module:image/image/imageblockediting~ImageBlockEditing `ImageBlockEditing`}) are filtered out.\n\t *\n\t * @internal\n\t * @readonly\n\t */\n\tpublic normalizedStyles?: Array<ImageStyleOptionDefinition>;\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst { normalizeStyles, getDefaultStylesConfiguration } = utils;\n\t\tconst editor = this.editor;\n\t\tconst isBlockPluginLoaded = editor.plugins.has( 'ImageBlockEditing' );\n\t\tconst isInlinePluginLoaded = editor.plugins.has( 'ImageInlineEditing' );\n\n\t\teditor.config.define( 'image.styles', getDefaultStylesConfiguration( isBlockPluginLoaded, isInlinePluginLoaded ) );\n\n\t\tthis.normalizedStyles = normalizeStyles( {\n\t\t\tconfiguredStyles: editor.config.get( 'image.styles' )!,\n\t\t\tisBlockPluginLoaded,\n\t\t\tisInlinePluginLoaded\n\t\t} );\n\n\t\tthis._setupConversion( isBlockPluginLoaded, isInlinePluginLoaded );\n\t\tthis._setupPostFixer();\n\n\t\t// Register imageStyle command.\n\t\teditor.commands.add( 'imageStyle', new ImageStyleCommand( editor, this.normalizedStyles ) );\n\t}\n\n\t/**\n\t * Sets the editor conversion taking the presence of\n\t * {@link module:image/image/imageinlineediting~ImageInlineEditing `ImageInlineEditing`}\n\t * and {@link module:image/image/imageblockediting~ImageBlockEditing `ImageBlockEditing`} plugins into consideration.\n\t */\n\tprivate _setupConversion( isBlockPluginLoaded: boolean, isInlinePluginLoaded: boolean ): void {\n\t\tconst editor = this.editor;\n\t\tconst schema = editor.model.schema;\n\n\t\tconst modelToViewConverter = modelToViewStyleAttribute( this.normalizedStyles! );\n\t\tconst viewToModelConverter = viewToModelStyleAttribute( this.normalizedStyles! );\n\n\t\teditor.editing.downcastDispatcher.on( 'attribute:imageStyle', modelToViewConverter );\n\t\teditor.data.downcastDispatcher.on( 'attribute:imageStyle', modelToViewConverter );\n\n\t\t// Allow imageStyle attribute in image and imageInline.\n\t\t// We could call it 'style' but https://github.com/ckeditor/ckeditor5-engine/issues/559.\n\t\tif ( isBlockPluginLoaded ) {\n\t\t\tschema.extend( 'imageBlock', { allowAttributes: 'imageStyle' } );\n\n\t\t\t// Converter for figure element from view to model.\n\t\t\teditor.data.upcastDispatcher.on<UpcastElementEvent>( 'element:figure', viewToModelConverter, { priority: 'low' } );\n\t\t}\n\n\t\tif ( isInlinePluginLoaded ) {\n\t\t\tschema.extend( 'imageInline', { allowAttributes: 'imageStyle' } );\n\n\t\t\t// Converter for the img element from view to model.\n\t\t\teditor.data.upcastDispatcher.on( 'element:img', viewToModelConverter, { priority: 'low' } );\n\t\t}\n\t}\n\n\t/**\n\t * Registers a post-fixer that will make sure that the style attribute value is correct for a specific image type (block vs inline).\n\t */\n\tprivate _setupPostFixer(): void {\n\t\tconst editor = this.editor;\n\t\tconst document = editor.model.document;\n\n\t\tconst imageUtils = editor.plugins.get( ImageUtils );\n\t\tconst stylesMap = new Map( this.normalizedStyles!.map( style => [ style.name, style ] ) );\n\n\t\t// Make sure that style attribute is valid for the image type.\n\t\tdocument.registerPostFixer( writer => {\n\t\t\tlet changed = false;\n\n\t\t\tfor ( const change of document.differ.getChanges() ) {\n\t\t\t\tif ( change.type == 'insert' || change.type == 'attribute' && change.attributeKey == 'imageStyle' ) {\n\t\t\t\t\tlet element = change.type == 'insert' ? change.position.nodeAfter! : change.range.start.nodeAfter!;\n\n\t\t\t\t\tif ( element && element.is( 'element', 'paragraph' ) && element.childCount > 0 ) {\n\t\t\t\t\t\telement = element.getChild( 0 )!;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !imageUtils.isImage( element as Element ) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst imageStyle = element.getAttribute( 'imageStyle' ) as string | undefined;\n\n\t\t\t\t\tif ( !imageStyle ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst imageStyleDefinition = stylesMap.get( imageStyle );\n\n\t\t\t\t\tif ( !imageStyleDefinition || !imageStyleDefinition.modelElements.includes( ( element as Element ).name ) ) {\n\t\t\t\t\t\twriter.removeAttribute( 'imageStyle', element );\n\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn changed;\n\t\t} );\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagestyle/imagestyleui\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport { ButtonView, createDropdown, addToolbarToDropdown, SplitButtonView } from 'ckeditor5/src/ui.js';\nimport { isObject, identity } from 'lodash-es';\nimport ImageStyleEditing from './imagestyleediting.js';\nimport utils from './utils.js';\nimport type { ImageStyleDropdownDefinition, ImageStyleOptionDefinition } from '../imageconfig.js';\nimport type ImageStyleCommand from './imagestylecommand.js';\n\nimport '../../theme/imagestyle.css';\n\n/**\n * The image style UI plugin.\n *\n * It registers buttons corresponding to the {@link module:image/imageconfig~ImageConfig#styles} configuration.\n * It also registers the {@link module:image/imagestyle/utils#DEFAULT_DROPDOWN_DEFINITIONS default drop-downs} and the\n * custom drop-downs defined by the developer in the {@link module:image/imageconfig~ImageConfig#toolbar} configuration.\n */\nexport default class ImageStyleUI extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageStyleEditing ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageStyleUI' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns the default localized style titles provided by the plugin.\n\t *\n\t * The following localized titles corresponding with\n\t * {@link module:image/imagestyle/utils#DEFAULT_OPTIONS} are available:\n\t *\n\t * * `'Wrap text'`,\n\t * * `'Break text'`,\n\t * * `'In line'`,\n\t * * `'Full size image'`,\n\t * * `'Side image'`,\n\t * * `'Left aligned image'`,\n\t * * `'Centered image'`,\n\t * * `'Right aligned image'`\n\t */\n\tpublic get localizedDefaultStylesTitles(): Record<string, string> {\n\t\tconst t = this.editor.t;\n\n\t\treturn {\n\t\t\t'Wrap text': t( 'Wrap text' ),\n\t\t\t'Break text': t( 'Break text' ),\n\t\t\t'In line': t( 'In line' ),\n\t\t\t'Full size image': t( 'Full size image' ),\n\t\t\t'Side image': t( 'Side image' ),\n\t\t\t'Left aligned image': t( 'Left aligned image' ),\n\t\t\t'Centered image': t( 'Centered image' ),\n\t\t\t'Right aligned image': t( 'Right aligned image' )\n\t\t};\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic init(): void {\n\t\tconst plugins = this.editor.plugins;\n\t\tconst toolbarConfig = this.editor.config.get( 'image.toolbar' ) || [];\n\t\tconst imageStyleEditing: ImageStyleEditing = plugins.get( 'ImageStyleEditing' );\n\n\t\tconst definedStyles = translateStyles(\n\t\t\timageStyleEditing.normalizedStyles!,\n\t\t\tthis.localizedDefaultStylesTitles\n\t\t);\n\n\t\tfor ( const styleConfig of definedStyles ) {\n\t\t\tthis._createButton( styleConfig );\n\t\t}\n\n\t\tconst definedDropdowns = translateStyles(\n\t\t\t[\n\t\t\t\t...toolbarConfig.filter( isObject ) as Array<ImageStyleDropdownDefinition>,\n\t\t\t\t...utils.getDefaultDropdownDefinitions( plugins )\n\t\t\t],\n\t\t\tthis.localizedDefaultStylesTitles\n\t\t);\n\n\t\tfor ( const dropdownConfig of definedDropdowns ) {\n\t\t\tthis._createDropdown( dropdownConfig, definedStyles );\n\t\t}\n\t}\n\n\t/**\n\t * Creates a dropdown and stores it in the editor {@link module:ui/componentfactory~ComponentFactory}.\n\t */\n\tprivate _createDropdown( dropdownConfig: ImageStyleDropdownDefinition, definedStyles: Array<ImageStyleOptionDefinition> ): void {\n\t\tconst factory = this.editor.ui.componentFactory;\n\n\t\tfactory.add( dropdownConfig.name, locale => {\n\t\t\tlet defaultButton: ButtonView | undefined;\n\n\t\t\tconst { defaultItem, items, title } = dropdownConfig;\n\t\t\tconst buttonViews = items\n\t\t\t\t.filter( itemName => definedStyles.find( ( { name } ) => getUIComponentName( name ) === itemName ) )\n\t\t\t\t.map( buttonName => {\n\t\t\t\t\tconst button = factory.create( buttonName ) as ButtonView;\n\n\t\t\t\t\tif ( buttonName === defaultItem ) {\n\t\t\t\t\t\tdefaultButton = button;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn button;\n\t\t\t\t} );\n\n\t\t\tif ( items.length !== buttonViews.length ) {\n\t\t\t\tutils.warnInvalidStyle( { dropdown: dropdownConfig } );\n\t\t\t}\n\n\t\t\tconst dropdownView = createDropdown( locale, SplitButtonView );\n\t\t\tconst splitButtonView = dropdownView.buttonView as SplitButtonView;\n\t\t\tconst splitButtonViewArrow = splitButtonView.arrowView;\n\n\t\t\taddToolbarToDropdown( dropdownView, buttonViews, { enableActiveItemFocusOnDropdownOpen: true } );\n\n\t\t\tsplitButtonView.set( {\n\t\t\t\tlabel: getDropdownButtonTitle( title, defaultButton!.label! ),\n\t\t\t\tclass: null,\n\t\t\t\ttooltip: true\n\t\t\t} );\n\n\t\t\tsplitButtonViewArrow.unbind( 'label' );\n\t\t\tsplitButtonViewArrow.set( {\n\t\t\t\tlabel: title\n\t\t\t} );\n\n\t\t\tsplitButtonView.bind( 'icon' ).toMany( buttonViews, 'isOn', ( ...areOn ) => {\n\t\t\t\tconst index = areOn.findIndex( identity );\n\n\t\t\t\treturn ( index < 0 ) ? defaultButton!.icon : buttonViews[ index ].icon;\n\t\t\t} );\n\n\t\t\tsplitButtonView.bind( 'label' ).toMany( buttonViews, 'isOn', ( ...areOn ) => {\n\t\t\t\tconst index = areOn.findIndex( identity );\n\n\t\t\t\treturn getDropdownButtonTitle( title, ( index < 0 ) ? defaultButton!.label! : buttonViews[ index ].label! );\n\t\t\t} );\n\n\t\t\tsplitButtonView.bind( 'isOn' ).toMany( buttonViews, 'isOn', ( ...areOn ) => areOn.some( identity ) );\n\n\t\t\tsplitButtonView.bind( 'class' )\n\t\t\t\t.toMany( buttonViews, 'isOn', ( ...areOn ) => areOn.some( identity ) ? 'ck-splitbutton_flatten' : undefined );\n\n\t\t\tsplitButtonView.on( 'execute', () => {\n\t\t\t\tif ( !buttonViews.some( ( { isOn } ) => isOn ) ) {\n\t\t\t\t\tdefaultButton!.fire( 'execute' );\n\t\t\t\t} else {\n\t\t\t\t\tdropdownView.isOpen = !dropdownView.isOpen;\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tdropdownView.bind( 'isEnabled' )\n\t\t\t\t.toMany( buttonViews, 'isEnabled', ( ...areEnabled ) => areEnabled.some( identity ) );\n\n\t\t\t// Focus the editable after executing the command.\n\t\t\t// Overrides a default behaviour where the focus is moved to the dropdown button (#12125).\n\t\t\tthis.listenTo( dropdownView, 'execute', () => {\n\t\t\t\tthis.editor.editing.view.focus();\n\t\t\t} );\n\n\t\t\treturn dropdownView;\n\t\t} );\n\t}\n\n\t/**\n\t * Creates a button and stores it in the editor {@link module:ui/componentfactory~ComponentFactory}.\n\t */\n\tprivate _createButton( buttonConfig: ImageStyleOptionDefinition ): void {\n\t\tconst buttonName = buttonConfig.name;\n\n\t\tthis.editor.ui.componentFactory.add( getUIComponentName( buttonName ), locale => {\n\t\t\tconst command: ImageStyleCommand = this.editor.commands.get( 'imageStyle' )!;\n\t\t\tconst view = new ButtonView( locale );\n\n\t\t\tview.set( {\n\t\t\t\tlabel: buttonConfig.title,\n\t\t\t\ticon: buttonConfig.icon,\n\t\t\t\ttooltip: true,\n\t\t\t\tisToggleable: true\n\t\t\t} );\n\n\t\t\tview.bind( 'isEnabled' ).to( command, 'isEnabled' );\n\t\t\tview.bind( 'isOn' ).to( command, 'value', value => value === buttonName );\n\t\t\tview.on( 'execute', this._executeCommand.bind( this, buttonName ) );\n\n\t\t\treturn view;\n\t\t} );\n\t}\n\n\tprivate _executeCommand( name: string ): void {\n\t\tthis.editor.execute( 'imageStyle', { value: name } );\n\t\tthis.editor.editing.view.focus();\n\t}\n}\n\n/**\n * Returns the translated `title` from the passed styles array.\n */\nfunction translateStyles<T extends ImageStyleOptionDefinition | ImageStyleDropdownDefinition>(\n\tstyles: Array<T>,\n\ttitles: Record<string, string>\n): Array<T> {\n\tfor ( const style of styles ) {\n\t\t// Localize the titles of the styles, if a title corresponds with\n\t\t// a localized default provided by the plugin.\n\t\tif ( titles[ style.title! ] ) {\n\t\t\tstyle.title = titles[ style.title! ];\n\t\t}\n\t}\n\n\treturn styles;\n}\n\n/**\n * Returns the image style component name with the \"imageStyle:\" prefix.\n */\nfunction getUIComponentName( name: string ): string {\n\treturn `imageStyle:${ name }`;\n}\n\n/**\n * Returns title for the splitbutton containing the dropdown title and default action item title.\n */\nfunction getDropdownButtonTitle( dropdownTitle: string | undefined, buttonTitle: string ): string {\n\treturn ( dropdownTitle ? dropdownTitle + ': ' : '' ) + buttonTitle;\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagestyle\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport ImageStyleEditing from './imagestyle/imagestyleediting.js';\nimport ImageStyleUI from './imagestyle/imagestyleui.js';\n\n/**\n * The image style plugin.\n *\n * For a detailed overview of the image styles feature, check the {@glink features/images/images-styles documentation}.\n *\n * This is a \"glue\" plugin which loads the following plugins:\n * * {@link module:image/imagestyle/imagestyleediting~ImageStyleEditing},\n * * {@link module:image/imagestyle/imagestyleui~ImageStyleUI}\n *\n * It provides a default configuration, which can be extended or overwritten.\n * Read more about the {@link module:image/imageconfig~ImageConfig#styles image styles configuration}.\n */\nexport default class ImageStyle extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageStyleEditing, ImageStyleUI ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageStyle' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/imagetoolbar\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\nimport { WidgetToolbarRepository } from 'ckeditor5/src/widget.js';\n\nimport ImageUtils from './imageutils.js';\nimport type { ImageStyleDropdownDefinition } from './imageconfig.js';\n\nimport { isObject } from 'lodash-es';\n\n/**\n * The image toolbar plugin. It creates and manages the image toolbar (the toolbar displayed when an image is selected).\n *\n * For an overview, check the {@glink features/images/images-overview#image-contextual-toolbar image contextual toolbar} documentation.\n *\n * Instances of toolbar components (e.g. buttons) are created using the editor's\n * {@link module:ui/componentfactory~ComponentFactory component factory}\n * based on the {@link module:image/imageconfig~ImageConfig#toolbar `image.toolbar` configuration option}.\n *\n * The toolbar uses the {@link module:ui/panel/balloon/contextualballoon~ContextualBalloon}.\n */\nexport default class ImageToolbar extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ WidgetToolbarRepository, ImageUtils ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'ImageToolbar' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic afterInit(): void {\n\t\tconst editor = this.editor;\n\t\tconst t = editor.t;\n\t\tconst widgetToolbarRepository = editor.plugins.get( WidgetToolbarRepository );\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\twidgetToolbarRepository.register( 'image', {\n\t\t\tariaLabel: t( 'Image toolbar' ),\n\t\t\titems: normalizeDeclarativeConfig( editor.config.get( 'image.toolbar' ) || [] ),\n\t\t\tgetRelatedElement: selection => imageUtils.getClosestSelectedImageWidget( selection )!\n\t\t} );\n\t}\n}\n\n/**\n * Convert the dropdown definitions to their keys registered in the ComponentFactory.\n * The registration precess should be handled by the plugin which handles the UI of a particular feature.\n */\nfunction normalizeDeclarativeConfig( config: Array<string | ImageStyleDropdownDefinition> ): Array<string> {\n\treturn config.map( item => isObject( item ) ? item.name : item );\n}\n","/**\n * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options\n */\n\n/**\n * @module image/pictureediting\n */\n\nimport { Plugin } from 'ckeditor5/src/core.js';\n\nimport ImageEditing from './image/imageediting.js';\nimport ImageUtils from './imageutils.js';\nimport { downcastSourcesAttribute, upcastPicture } from './image/converters.js';\nimport type { default as ImageUploadEditing, ImageUploadCompleteEvent } from './imageupload/imageuploadediting.js';\n\n/**\n * This plugin enables the [`<picture>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/picture) element support in the editor.\n *\n * * It enables the `sources` model attribute on `imageBlock` and `imageInline` model elements\n * (brought by {@link module:image/imageblock~ImageBlock} and {@link module:image/imageinline~ImageInline}, respectively).\n * * It translates the `sources` model element to the view (also: data) structure that may look as follows:\n *\n * ```html\n * <p>Inline image using picture:\n * \t<picture>\n * \t\t<source media=\"(min-width: 800px)\" srcset=\"image-large.webp\" type=\"image/webp\">\n * \t\t<source media=\"(max-width: 800px)\" srcset=\"image-small.webp\" type=\"image/webp\">\n * \t\t<!-- Other sources as specified in the \"sources\" model attribute... -->\n * \t\t<img src=\"image.png\" alt=\"An image using picture\" />\n * \t</picture>\n * </p>\n *\n * <p>Block image using picture:</p>\n * <figure class=\"image\">\n * \t<picture>\n * \t\t<source media=\"(min-width: 800px)\" srcset=\"image-large.webp\" type=\"image/webp\">\n * \t\t<source media=\"(max-width: 800px)\" srcset=\"image-small.webp\" type=\"image/webp\">\n * \t\t<!-- Other sources as specified in the \"sources\" model attribute... -->\n * \t\t<img src=\"image.png\" alt=\"An image using picture\" />\n * \t</picture>\n * \t<figcaption>Caption of the image</figcaption>\n * </figure>\n * ```\n *\n * **Note:** The value of the `sources` {@glink framework/architecture/editing-engine#changing-the-model model attribute}\n * in both examples equals:\n *\n * ```css\n * [\n * \t{\n * \t\tmedia: '(min-width: 800px)',\n * \t\tsrcset: 'image-large.webp',\n * \t\ttype: 'image/webp'\n * \t},\n * \t{\n * \t\tmedia: '(max-width: 800px)',\n * \t\tsrcset: 'image-small.webp',\n * \t\ttype: 'image/webp'\n * \t}\n * ]\n * ```\n *\n * * It integrates with the {@link module:image/imageupload~ImageUpload} plugin so images uploaded in the editor\n * automatically render using `<picture>` if the {@glink features/images/image-upload/image-upload upload adapter}\n * supports image sources and provides neccessary data.\n *\n * @private\n */\nexport default class PictureEditing extends Plugin {\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get requires() {\n\t\treturn [ ImageEditing, ImageUtils ] as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static get pluginName() {\n\t\treturn 'PictureEditing' as const;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic static override get isOfficialPlugin(): true {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tpublic afterInit(): void {\n\t\tconst editor = this.editor;\n\n\t\tif ( editor.plugins.has( 'ImageBlockEditing' ) ) {\n\t\t\teditor.model.schema.extend( 'imageBlock', {\n\t\t\t\tallowAttributes: [ 'sources' ]\n\t\t\t} );\n\t\t}\n\n\t\tif ( editor.plugins.has( 'ImageInlineEditing' ) ) {\n\t\t\teditor.model.schema.extend( 'imageInline', {\n\t\t\t\tallowAttributes: [ 'sources' ]\n\t\t\t} );\n\t\t}\n\n\t\tthis._setupConversion();\n\t\tthis._setupImageUploadEditingIntegration();\n\t}\n\n\t/**\n\t * Configures conversion pipelines to support upcasting and downcasting images using the `<picture>` view element\n\t * and the model `sources` attribute.\n\t */\n\tprivate _setupConversion(): void {\n\t\tconst editor = this.editor;\n\t\tconst conversion = editor.conversion;\n\t\tconst imageUtils: ImageUtils = editor.plugins.get( 'ImageUtils' );\n\n\t\tconversion.for( 'upcast' ).add( upcastPicture( imageUtils ) );\n\t\tconversion.for( 'downcast' ).add( downcastSourcesAttribute( imageUtils ) );\n\t}\n\n\t/**\n\t * Makes it possible for uploaded images to get the `sources` model attribute and the `<picture>...</picture>`\n\t * view structure out-of-the-box if relevant data is provided along the\n\t * {@link module:image/imageupload/imageuploadediting~ImageUploadEditing#event:uploadComplete} event.\n\t */\n\tprivate _setupImageUploadEditingIntegration(): void {\n\t\tconst editor = this.editor;\n\n\t\tif ( !editor.plugins.has( 'ImageUploadEditing' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst imageUploadEditing: ImageUploadEditing = editor.plugins.get( 'ImageUploadEditing' );\n\n\t\tthis.listenTo<ImageUploadCompleteEvent>(\n\t\t\timageUploadEditing,\n\t\t\t'uploadComplete',\n\t\t\t( evt, { imageElement, data } ) => {\n\t\t\t\tconst sources = data.sources;\n\n\t\t\t\tif ( !sources ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\teditor.model.change( writer => {\n\t\t\t\t\twriter.setAttributes( {\n\t\t\t\t\t\tsources\n\t\t\t\t\t}, imageElement );\n\t\t\t\t} );\n\t\t\t} );\n\t}\n}\n"],"names":["createInlineImageViewElement","writer","createContainerElement","class","createEmptyElement","createBlockImageViewElement","createSlot","getImgViewElementMatcher","editor","matchImageType","imageUtils","plugins","get","areBothImagePluginsLoaded","has","element","isInlineImageView","getPositiveMatchPattern","imageType","getStyle","findAncestor","isBlockImageView","pattern","name","hasAttribute","attributes","determineImageTypeForInsertionAtSelection","schema","selection","firstBlock","first","getSelectedBlocks","isObject","isEmpty","getSizeValueIfInPx","size","endsWith","parseInt","widthAndHeightStylesAreBothSet","viewElement","widthStyle","heightStyle","IMAGE_WIDGETS_CLASSES_MATCH_REGEXP","ImageUtils","Plugin","_domEmitter","DomEmitterMixin","pluginName","isOfficialPlugin","isImage","modelElement","isInlineImage","isBlockImage","is","hasClass","insertImage","selectable","options","model","document","determinedImageType","determineImageTypeForInsertion","Object","fromEntries","getAttributes","attributeName","checkAttribute","change","setImageSizes","imageElement","createElement","insertObject","setSelection","findOptimalPosition","undefined","parent","setImageNaturalSizeAttributes","src","getAttribute","img","global","window","Image","listenTo","enqueueChange","batch","setAttribute","naturalWidth","naturalHeight","stopListening","getClosestSelectedImageWidget","selectionPosition","getFirstPosition","getSelectedElement","isImageWidget","getClosestSelectedImageElement","selectedElement","getImageWidgetFromImageView","imageView","classes","isImageAllowedInParent","isNotInsideImage","label","setCustomProperty","labelCreator","imgElement","findViewImgElement","altText","toWidget","getCustomProperty","isWidget","figureView","editingView","editing","view","item","createRangeIn","destroy","getInsertImageParent","checkChild","focus","getAncestors","every","ancestor","insertionRange","findOptimalInsertionRange","start","configImageInsertType","config","IMAGE_URL_REGEXP","RegExp","String","source","AutoImage","requires","Clipboard","Undo","Delete","constructor","_timeoutId","_positionToInsert","modelDocument","clipboardPipeline","firstRange","getFirstRange","leftLivePosition","LivePosition","fromPosition","stickiness","rightLivePosition","end","once","_embedImageBetweenPositions","detach","priority","commands","on","clearTimeout","leftPosition","rightPosition","urlRange","LiveRange","walker","getWalker","ignoreElementEnd","selectionAttributes","node","data","trim","match","setTimeout","imageCommand","isEnabled","remove","insertionPosition","root","rootName","toPosition","deletePlugin","requestUndoOnBackspace","ImageTextAlternativeCommand","Command","value","execute","newValue","ImageTextAlternativeEditing","add","TextAlternativeFormView","View","locale","t","focusTracker","FocusTracker","keystrokes","KeystrokeHandler","labeledInput","_createLabeledInputView","saveButtonView","_createButton","icons","check","type","cancelButtonView","cancel","_focusables","ViewCollection","_focusCycler","FocusCycler","focusables","keystrokeHandler","actions","focusPrevious","focusNext","setTemplate","tag","tabindex","children","render","submitHandler","forEach","v","icon","className","eventName","button","ButtonView","set","tooltip","extendTemplate","delegate","to","LabeledFieldView","createLabeledInputText","repositionContextualBalloon","balloon","position","getBalloonPositionData","updatePosition","defaultPositions","BalloonPanelView","target","domConverter","mapViewToDom","positions","northArrowSouth","northArrowSouthWest","northArrowSouthEast","southArrowNorth","southArrowNorthWest","southArrowNorthEast","viewportStickyNorth","ImageTextAlternativeUI","ContextualBalloon","_form","ui","componentFactory","command","textAlternative","bind","_showForm","viewDocument","_balloon","CssTransitionDisablerMixin","fieldView","_hideForm","_isVisible","clickOutsideHandler","emitter","activator","contextElements","callback","_createForm","disableCssTransitions","_isInBalloon","select","enableCssTransitions","focusEditable","isFocused","visibleView","hasView","ImageTextAlternative","upcastImageFigure","converter","evt","conversionApi","consumable","test","viewItem","viewImage","consume","conversionResult","convertItem","modelCursor","modelImage","modelRange","getItems","revert","convertChildren","updateConversionResult","dispatcher","upcastPicture","sourceAttributeNames","pictureViewElement","sources","Map","childSourceElement","getChildren","keys","length","imgViewElement","sourceElement","Array","from","values","downcastSrcsetAttribute","mapper","toViewElement","attributeNewValue","removeAttribute","downcastSourcesAttribute","viewWriter","attributeElements","parentElement","unwrap","createRangeOn","unshift","hasPictureElement","pictureElement","insert","createPositionBefore","createPositionAt","map","sourceAttributes","move","attributeElement","wrap","downcastImageAttribute","attributeKey","ImageLoadObserver","Observer","observe","domRoot","event","domEvent","domElement","checkShouldIgnoreEventFromTarget","tagName","_fireEvents","useCapture","stopObserving","fire","InsertImageCommand","logWarning","isImageAllowed","sourceDefinitions","toArray","sourceDefinition","index","createPositionAfter","breakBlock","ReplaceImageSourceCommand","decorate","image","cleanupImage","ImageEditing","conversion","addObserver","for","attributeToAttribute","key","insertImageCommand","replaceImageSourceCommand","ImageSizeAttributes","_registerSchema","_registerConverters","extend","allowAttributes","viewElementName","styles","width","height","attachDowncastConverter","modelAttributeName","viewAttributeName","setRatioForInlineImage","isEditingDowncast","hasSizes","isResized","setStyle","ImageTypeCommand","modelElementName","_modelElementName","oldElement","uploadId","markers","filter","marker","getRange","containsItem","newElement","createSelection","newElementRange","markerRange","range","getJoined","updateMarker","ImagePlaceholder","_setupSchema","_setupConversion","_setupLoadListener","isRegistered","addClass","removeClass","removeStyle","mapDomToView","toModelElement","isUndoable","ImageBlockEditing","ClipboardPipeline","register","inheritAllFrom","_setupClipboardIntegration","elementToStructure","toImageWidget","elementToElement","docFragmentChildren","content","targetRanges","toModelRange","UpcastWriter","blockViewImages","inlineViewImage","createDocumentFragment","method","ImageInsertFormView","integrations","createCollection","CollapsibleView","addMany","stopPropagation","focusFirst","ImageInsertUI","_integrations","define","isImageSelected","componentCreator","_createToolbarComponent","menuBarComponentCreator","_createMenuBarComponent","observable","buttonViewCreator","formViewCreator","menuBarButtonViewCreator","requiresForm","override","_prepareIntegrations","dropdownButton","firstIntegration","actionButton","SplitButtonView","dropdownView","createDropdown","observables","toMany","some","integrationViews","flatMap","imageInsertFormView","panelView","resultView","MenuBarMenuView","listView","MenuBarMenuListView","buttonView","integrationView","listItemView","MenuBarMenuListItemView","items","result","includes","push","ImageBlock","Widget","ImageInlineEditing","disallowIn","inlineViewImages","blockViewImage","childCount","attribute","getChild","ImageInline","ImageCaptionUtils","getCaptionFromImageModelElement","imageModelElement","getCaptionFromModelSelection","captionElement","matchImageCaptionViewElement","ToggleImageCaptionCommand","imageCaptionUtils","ancestorCaptionElement","focusCaptionOnShow","_hideImageCaption","_showImageCaption","imageCaptionEditing","selectedImage","savedCaption","_getSavedCaption","newCaptionElement","append","_saveCaption","ImageCaptionEditing","_savedCaptionsMap","WeakMap","allowIn","allowContentOf","isLimit","_setupImageTypeCommandsIntegration","_registerCaptionReconversion","figcaptionElement","createEditableElement","placeholder","enablePlaceholder","keepOnFocus","imageAlt","toWidgetEditable","imageTypeInlineCommand","imageTypeBlockCommand","handleImageTypeChange","return","oldCaptionElement","savedOldElementCaption","jsonObject","Element","fromJSON","caption","toJSON","changes","differ","getChanges","nodeAfter","reconvertItem","ImageCaptionUI","isToggleable","modelCaptionElement","scrollToTheSelection","ImageCaption","createImageTypeRegExp","types","regExpSafeNames","replace","join","fetchLocalImage","Promise","resolve","reject","imageSrc","fetch","then","resource","blob","mimeType","getImageMimeType","ext","filename","file","File","catch","err","convertLocalImageOnCanvas","isLocalImage","toLowerCase","getBlobFromCanvas","addEventListener","canvas","ctx","getContext","drawImage","toBlob","ImageUploadUI","_createToolbarButton","_createMenuBarButton","registerIntegration","_createDropdownButton","isOnly","ButtonClass","imageTypes","imageTypesRegExp","acceptedType","allowMultipleFiles","imageUpload","files","imagesToUpload","imageInsertUI","uploadImageCommand","FileDialogButtonView","isAccessAllowed","withText","isOpen","MenuBarMenuListItemFileDialogButtonView","ImageUploadProgress","downcastDispatcher","uploadStatusChange","fileRepository","FileRepository","status","viewFigure","_startAppearEffect","_showPlaceholder","loader","loaders","_hidePlaceholder","_showProgressBar","_displayLocalImage","_showCompleteIcon","_hideProgressBar","_stopAppearEffect","viewImg","_getUIElement","_createPlaceholder","_removeUIElement","progressBar","_createProgressBar","completeIcon","createUIElement","imageFigure","uniqueProperty","child","UploadImageCommand","_uploadImage","createLoader","id","ImageUploadEditing","Notification","_uploadedImages","upload","_uploadImageElements","doc","shallow","isHtmlIncluded","dataTransfer","images","stop","viewRange","notification","showWarning","namespace","fetchableImages","promise","fetchableImage","preventDefault","includeChangesInGraveyard","reverse","insertedImagesIds","Set","entry","isInsertedInGraveyard","getImagesFromChangeItem","allImagesThatShareUploaderInGraveyard","abort","_readAndUpload","urls","default","_parseAndSetSrcsetAttributeOnImage","imageUploadElements","elements","read","ariaLiveAnnouncer","announce","env","isSafari","domFigure","originalDisplay","style","display","_ckHack","offsetHeight","clean","error","title","delete","destroyLoader","maxWidth","srcsetAttribute","isNaN","Math","max","srcset","setAttributes","getData","ImageUpload","ImageInsertUrlView","urlInputView","_createUrlInputView","inputMode","imageURLInputValue","ImageInsertViaUrlUI","_imageInsertUI","_formView","Dialog","init","_createInsertUrlButton","imageUrl","_showModal","MenuBarMenuListItemButtonView","imageInsertUrlView","isCommandEnabled","dialog","_createInsertUrlView","_handleSave","show","isModal","actionButtons","onExecute","hide","ImageInsertViaUrl","ImageInsert","ResizeImageCommand","ImageResizeEditing","resizeUnit","resizeOptions","resizeImageCommand","modelAttributeValue","RESIZE_ICONS","small","objectSizeSmall","medium","objectSizeMedium","large","objectSizeLarge","custom","objectSizeCustom","original","objectSizeFull","ImageResizeButtons","_resizeUnit","option","_registerImageResizeButton","_registerImageResizeDropdown","labelText","_getOptionLabelValue","CKEditorError","isCustomImageResizeOption","customResizeUI","optionValueWithUnit","getIsOnButtonCallback","originalSizeOption","find","DropdownButtonView","accessibleLabel","commandValue","ariaLabel","ariaLabelledBy","addListToDropdown","_getResizeDropdownListItemDefinitions","role","onClick","commandName","forTooltip","itemDefinitions","Collection","optionsWithSerializedValues","valueWithUnits","definition","ViewModel","allDropdownValues","getIsOnCustomButtonCallback","objectCommandValue","dropdownValue","RESIZABLE_IMAGES_CSS_SELECTOR","RESIZED_IMAGE_CLASS","ImageResizeHandles","WidgetResize","_setupResizerCreator","matches","domToView","widgetView","resizer","getResizerByViewElement","redraw","imageModel","attachTo","unit","getHandleHost","domWidgetElement","querySelector","getResizeHost","isCentered","imageStyle","onCommit","tryParseDimensionWithUnit","dimension","rawValue","parsedValue","Number","parseFloat","tryCastDimensionsToUnit","parentDimensionPx","targetUnit","getSelectedImageEditorNodes","imageViewElement","imageDOMElement","dom","getSelectedImageWidthInUnits","imageNodes","parsedResizedWidth","imageParentWidthPx","calculateResizeHostAncestorWidth","imageHolderDimension","Rect","ImageCustomResizeFormView","validators","_validators","createLabeledInputNumber","step","resetFormStatus","validator","errorText","rawSize","parsedSize","parsed","sizeWithUnits","getSelectedImagePossibleResizeRange","minimumImageWidth","getComputedStyle","minWidth","lower","upper","ImageCustomResizeUI","getFormValidators","isValid","update","currentParsedWidth","initialInputValue","toFixed","possibleRange","assign","min","ceil","form","ImageResize","ImageStyleCommand","_defaultStyles","imageBlock","imageInline","_styles","isDefault","modelElements","requestedStyle","shouldConvertImageType","supportedTypes","DEFAULT_OPTIONS","inline","objectInline","alignLeft","objectLeft","alignBlockLeft","objectBlockLeft","alignCenter","objectCenter","alignRight","objectRight","alignBlockRight","objectBlockRight","block","side","DEFAULT_ICONS","full","objectFullWidth","left","right","center","inlineLeft","inlineRight","DEFAULT_DROPDOWN_DEFINITIONS","defaultItem","normalizeStyles","configuredStyles","arrangement","normalizeDefinition","isValidOption","getDefaultStylesConfiguration","isBlockPluginLoaded","isInlinePluginLoaded","getDefaultDropdownDefinitions","pluginCollection","extendStyle","warnInvalidStyle","supportedElements","elementName","missingPlugins","extendedStyle","prop","prototype","hasOwnProperty","call","info","modelToViewStyleAttribute","newStyle","getStyleDefinitionByName","oldStyle","attributeOldValue","viewToModelStyleAttribute","nonDefaultStyles","modelImageElement","ImageStyleEditing","utils","normalizedStyles","_setupPostFixer","modelToViewConverter","viewToModelConverter","upcastDispatcher","stylesMap","registerPostFixer","changed","imageStyleDefinition","ImageStyleUI","localizedDefaultStylesTitles","toolbarConfig","imageStyleEditing","definedStyles","translateStyles","styleConfig","definedDropdowns","dropdownConfig","_createDropdown","factory","defaultButton","buttonViews","itemName","getUIComponentName","buttonName","create","dropdown","splitButtonView","splitButtonViewArrow","arrowView","addToolbarToDropdown","enableActiveItemFocusOnDropdownOpen","getDropdownButtonTitle","unbind","areOn","findIndex","identity","isOn","areEnabled","buttonConfig","_executeCommand","titles","dropdownTitle","buttonTitle","ImageStyle","ImageToolbar","WidgetToolbarRepository","widgetToolbarRepository","normalizeDeclarativeConfig","getRelatedElement","PictureEditing","_setupImageUploadEditingIntegration","imageUploadEditing"],"mappings":"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","ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58],"debugId":null}}]
}